{"version":3,"file":"transfer-function-editor.module.js","sources":["../src/Types.ts","../src/draw.ts","../src/Container.ts","../src/NumberInputField.ts","../node_modules/d3-color/src/define.js","../node_modules/d3-color/src/color.js","../node_modules/d3-color/src/math.js","../node_modules/d3-color/src/lab.js","../node_modules/d3-color/src/cubehelix.js","../node_modules/d3-hsv/node_modules/d3-color/src/define.js","../node_modules/d3-hsv/node_modules/d3-color/src/color.js","../node_modules/d3-hsv/src/hsv.js","../node_modules/d3-hsv/src/constant.js","../node_modules/d3-hsv/src/color.js","../node_modules/d3-hsv/src/interpolateHsv.js","../src/ColorPicker.ts","../node_modules/deepmerge/dist/cjs.js","../node_modules/d3-array/src/ascending.js","../node_modules/d3-array/src/bisector.js","../node_modules/d3-array/src/bisect.js","../node_modules/d3-array/src/number.js","../node_modules/d3-array/src/ticks.js","../node_modules/d3-scale/src/init.js","../node_modules/d3-scale/node_modules/d3-color/src/define.js","../node_modules/d3-scale/node_modules/d3-color/src/color.js","../node_modules/d3-scale/node_modules/d3-interpolate/src/constant.js","../node_modules/d3-scale/node_modules/d3-interpolate/src/color.js","../node_modules/d3-scale/node_modules/d3-interpolate/src/rgb.js","../node_modules/d3-scale/node_modules/d3-interpolate/src/numberArray.js","../node_modules/d3-scale/node_modules/d3-interpolate/src/array.js","../node_modules/d3-scale/node_modules/d3-interpolate/src/date.js","../node_modules/d3-scale/node_modules/d3-interpolate/src/number.js","../node_modules/d3-scale/node_modules/d3-interpolate/src/object.js","../node_modules/d3-scale/node_modules/d3-interpolate/src/string.js","../node_modules/d3-scale/node_modules/d3-interpolate/src/value.js","../node_modules/d3-scale/node_modules/d3-interpolate/src/round.js","../node_modules/d3-scale/src/number.js","../node_modules/d3-scale/src/continuous.js","../node_modules/d3-scale/src/constant.js","../node_modules/d3-format/src/formatDecimal.js","../node_modules/d3-format/src/exponent.js","../node_modules/d3-format/src/formatSpecifier.js","../node_modules/d3-format/src/formatPrefixAuto.js","../node_modules/d3-format/src/formatRounded.js","../node_modules/d3-format/src/formatTypes.js","../node_modules/d3-format/src/identity.js","../node_modules/d3-format/src/locale.js","../node_modules/d3-format/src/defaultLocale.js","../node_modules/d3-scale/src/linear.js","../node_modules/d3-scale/src/tickFormat.js","../node_modules/d3-format/src/precisionPrefix.js","../node_modules/d3-format/src/precisionRound.js","../node_modules/d3-format/src/precisionFixed.js","../node_modules/d3-format/src/formatGroup.js","../node_modules/d3-format/src/formatNumerals.js","../node_modules/d3-format/src/formatTrim.js","../node_modules/d3-interpolate/src/constant.js","../node_modules/d3-interpolate/src/color.js","../node_modules/d3-interpolate/src/rgb.js","../node_modules/d3-interpolate/src/number.js","../node_modules/d3-interpolate/src/hsl.js","../node_modules/d3-interpolate/src/lab.js","../node_modules/d3-interpolate/src/hcl.js","../node_modules/d3-interpolate/src/cubehelix.js","../src/convert.ts","../src/utils.ts","../src/ColorMapEditor.ts","../src/TransparencyEditor.ts","../src/TransferFunctionEditor.ts"],"sourcesContent":["/** A single entry for the transparency component of a transfer function. */\r\nexport interface AlphaStop {\r\n  /** The value at which the alpha value applies. */\r\n  stop: number;\r\n\r\n  /** The amount of transparency. 0 is fully transparent, 1 is fully opaque. */\r\n  alpha: number;\r\n}\r\n\r\n/** A single entry for the color component of a transfer function. */\r\nexport interface ColorStop {\r\n  /** The value at which the color applies. */\r\n  stop: number;\r\n\r\n  /** A CSS color string. */\r\n  color: string;\r\n}\r\n\r\n/** A complete color map. */\r\nexport interface ColorMap {\r\n  /** The colors at the specified stops. */\r\n  colorStops: Array<ColorStop>;\r\n\r\n  /** The method on how the color between stops is being computed. */\r\n  interpolationMethod: InterpolationMethod;\r\n\r\n  /** If the color map has discrete bins. */\r\n  discrete?: boolean;\r\n\r\n  /** The number of bins in this color map. */\r\n  bins?: number;\r\n}\r\n\r\n/** Combines transparency and color to create a transfer function. */\r\nexport interface TransferFunction {\r\n  /** Defines the function of transparency. */\r\n  alphaStops: Array<AlphaStop>;\r\n\r\n  /** Defines the function of color. */\r\n  colorMap: ColorMap;\r\n}\r\n\r\n/** For discrete color maps this defines a bin. */\r\nexport interface ColorMapBin {\r\n  /** The minimum value of this bin. */\r\n  lowerBound: number;\r\n\r\n  /** The middle value of the bin. */\r\n  center: number;\r\n\r\n  /** The maximum value of this bin. */\r\n  upperBound: number;\r\n\r\n  /** The color that applies to the whole bin. */\r\n  color: string;\r\n}\r\n\r\n/** The methods of interpolation between color stops. See https://github.com/d3/d3-interpolate#color-spaces. */\r\nexport enum InterpolationMethod {\r\n  RGB = 'RGB',\r\n  HSL = 'HSL',\r\n  HSL_LONG = 'HSL_LONG',\r\n  HSV = 'HSV',\r\n  HSV_LONG = 'HSV_LONG',\r\n  HCL = 'HCL',\r\n  HCL_LONG = 'HCL_LONG',\r\n  LAB = 'LAB',\r\n  CUBEHELIX = 'CUBEHELIX',\r\n  CUBEHELIX_LONG = 'CUBEHELIX_LONG',\r\n}\r\n","export function drawControlPoint(context: CanvasRenderingContext2D, x: number, y: number, pointSize: number) {\r\n  const strokes = 10;\r\n  for (let i = 0; i < strokes; i++) {\r\n    context.beginPath();\r\n    context.strokeStyle = i % 2 === 0 ? 'white' : 'black';\r\n    context.arc(x, y, pointSize, (i / strokes) * (2 * Math.PI), ((i + 1) / strokes) * (2 * Math.PI));\r\n    context.stroke();\r\n  }\r\n}\r\n","/** This class handles common functionality of all components in this library. */\r\nexport default class Container {\r\n  /** The root element, in which the component gets embedded. */\r\n  protected readonly parent: HTMLElement;\r\n\r\n  constructor(container: HTMLElement | string) {\r\n    // Figure out which element we want to embed in.\r\n    if (container) {\r\n      if (typeof container === 'string') {\r\n        this.parent = document.querySelector(container);\r\n      } else {\r\n        this.parent = container;\r\n      }\r\n    } else {\r\n      throw 'No element given!';\r\n    }\r\n  }\r\n}\r\n","import Container from './Container';\r\n\r\n/**\r\n * This container is a wrapper around an HTMLInputElement of type number. It adds the ability to change the number with\r\n * the scroll wheel and adds robust validation, so that the field always contains a number.\r\n */\r\nexport default class NumberInputField extends Container {\r\n  /** The actual number. This always contains a value. */\r\n  private value: number;\r\n\r\n  /** An optional label, that wraps the input element. */\r\n  private readonly label?: HTMLLabelElement;\r\n\r\n  /** The number input element. */\r\n  private readonly input: HTMLInputElement;\r\n\r\n  /** An optional lower bound for accepted values. */\r\n  private readonly min?: number;\r\n\r\n  /** An optional upper bound for accepted values. */\r\n  private readonly max?: number;\r\n\r\n  /** Controls how much the value increases/decreases on button and scroll wheel input. */\r\n  private readonly step: number;\r\n\r\n  /** If the value shall be treated as an integer. If true, it always gets rounded. */\r\n  private readonly integerOnly: boolean;\r\n\r\n  /** This gets called, when the value changes to notify users of this library. */\r\n  private callbacks: Map<number, (value: number) => void> = new Map();\r\n  private callbackCounter = 0;\r\n\r\n  /**\r\n   * Creates a new number input field inside the given container.\r\n   *\r\n   * @param container Either an HTMLElement or a query string to an element, in which the number input will be embedded.\r\n   * @param options   Can be used to configure the number input field. See {@link NumberInputFieldOptions}.\r\n   */\r\n  constructor(container: HTMLElement | string, options?: NumberInputFieldOptions) {\r\n    super(container);\r\n\r\n    // Set all defaults.\r\n    const defaultOptions: NumberInputFieldOptions = {\r\n      label: undefined,\r\n      initialValue: 0,\r\n      min: undefined,\r\n      max: undefined,\r\n      step: 1,\r\n      integerOnly: true,\r\n    };\r\n\r\n    // Merge the options with the defaults.\r\n    // !!! DON'T USE options AND defaultOptions AFTER THIS LINE !!!\r\n    const finalOptions = Object.assign(defaultOptions, options);\r\n\r\n    this.parent.classList.add('tfe-number-input-field-root');\r\n    this.input = document.createElement('input');\r\n    this.input.classList.add('tfe-number-input-field-input');\r\n    this.input.type = 'number';\r\n\r\n    if (finalOptions.min !== undefined) {\r\n      this.input.min = finalOptions.min.toString();\r\n      this.min = finalOptions.min;\r\n    }\r\n\r\n    if (finalOptions.max !== undefined) {\r\n      this.input.max = finalOptions.max.toString();\r\n      this.max = finalOptions.max;\r\n    }\r\n\r\n    this.input.step = finalOptions.step.toString();\r\n    this.step = finalOptions.step;\r\n    this.integerOnly = finalOptions.integerOnly;\r\n\r\n    this.setValue(finalOptions.initialValue);\r\n\r\n    // If a label string is given, we wrap the input element in a label element.\r\n    if (finalOptions.label) {\r\n      this.label = document.createElement('label');\r\n      this.label.classList.add('tfe-number-input-field-label');\r\n      this.label.innerText = finalOptions.label;\r\n      this.label.appendChild(this.input);\r\n      this.parent.appendChild(this.label);\r\n    } else {\r\n      this.parent.appendChild(this.input);\r\n    }\r\n\r\n    this.setUpEventListeners();\r\n  }\r\n\r\n  /**\r\n   * Register a callback that gets called, when the value changes. The callback gets called once immediately.\r\n   *\r\n   * @param callback The function that gets called whenever the value changes.\r\n   */\r\n  public addListener(callback: (value: number) => void): number {\r\n    const id = this.callbackCounter++;\r\n    this.callbacks.set(id, callback);\r\n    callback(this.value);\r\n    return id;\r\n  }\r\n\r\n  /** Removes the listener with the given id. */\r\n  public removeListener(id: number) {\r\n    this.callbacks.delete(id);\r\n  }\r\n\r\n  /** Returns the number value. */\r\n  public getValue(): number {\r\n    return this.value;\r\n  }\r\n\r\n  /**\r\n   * Sets a new value. The value might be modified to fulfill the min, max and integerOnly constraints. By default, the\r\n   * observers will be notified as well. This can be suppressed with the second argument set to false.\r\n   */\r\n  public setValue(value: number, notifyObservers: boolean = true) {\r\n    if (value === this.value) {\r\n      return;\r\n    }\r\n\r\n    let tmp = value;\r\n    if (this.min !== undefined && value < this.min) {\r\n      tmp = this.min;\r\n    } else if (this.max !== undefined && value > this.max) {\r\n      tmp = this.max;\r\n    }\r\n\r\n    this.value = this.integerOnly ? Math.round(tmp) : tmp;\r\n    this.input.valueAsNumber = this.value;\r\n\r\n    if (notifyObservers) {\r\n      this.callbacks.forEach((callback) => {\r\n        callback(this.value);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This function clamp the number inside the input field to a given range and returns the number or null if it is not\r\n   * valid.\r\n   */\r\n  private validateInput(): number | null {\r\n    if (this.min !== undefined && this.input.valueAsNumber < this.min) {\r\n      this.input.valueAsNumber = this.min;\r\n    } else if (this.max !== undefined && this.input.valueAsNumber > this.max) {\r\n      this.input.valueAsNumber = this.max;\r\n    }\r\n\r\n    return Number.isFinite(this.input.valueAsNumber) ? this.input.valueAsNumber : null;\r\n  }\r\n\r\n  /** This function validates the content of the input, once it gets submitted or the focus is lost. */\r\n  private validateFinalInput(): number | null {\r\n    const value = this.validateInput();\r\n    if (value === null) {\r\n      this.input.valueAsNumber = this.min;\r\n      return this.min;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Adds listeners for handling mouse wheel events and validation.\r\n   */\r\n  private setUpEventListeners() {\r\n    // Adds support for changing the number with the mouse wheel.\r\n    this.input.addEventListener('wheel', (ev: WheelEvent) => {\r\n      ev.preventDefault();\r\n\r\n      if (ev.deltaY > 0) {\r\n        // Decrement\r\n        this.setValue(this.value - this.step);\r\n      } else if (ev.deltaY < 0) {\r\n        // Increment\r\n        this.setValue(this.value + this.step);\r\n      }\r\n    });\r\n\r\n    // This listener makes sure, that the number is always clamped to the min/max constraints. It allows an empty input.\r\n    // An empty input will be handled by the next two listeners.\r\n    this.input.addEventListener('input', () => {\r\n      const value = this.validateInput();\r\n      if (value !== null) {\r\n        this.setValue(value);\r\n      }\r\n    });\r\n\r\n    // If focus is lost, the input gets validated to fulfill all requirements.\r\n    this.input.addEventListener('focusout', () => {\r\n      const value = this.validateFinalInput();\r\n      if (value !== null) {\r\n        this.setValue(value);\r\n      }\r\n    });\r\n\r\n    // If enter is pressed, the input gets validated to fulfill all requirements.\r\n    this.input.addEventListener('keypress', (ev: KeyboardEvent) => {\r\n      if (ev.key === 'Enter') {\r\n        const value = this.validateFinalInput();\r\n        if (value !== null) {\r\n          this.setValue(value);\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * The config options for the {@link NumberInputField} component.\r\n */\r\ninterface NumberInputFieldOptions {\r\n  /**\r\n   * If set, the input will be wrapped in a label with the given string.\r\n   *\r\n   * default: undefined\r\n   */\r\n  label?: string;\r\n\r\n  /**\r\n   * The starting value.\r\n   *\r\n   * default: 0\r\n   */\r\n  initialValue?: number;\r\n\r\n  /**\r\n   * An optional lower bound for the number value.\r\n   *\r\n   * default: undefined\r\n   */\r\n  min?: number;\r\n\r\n  /**\r\n   * An optional upper bound for the number value.\r\n   *\r\n   * default: undefined\r\n   */\r\n  max?: number;\r\n\r\n  /**\r\n   * The amount to increment and decrement the value when using the arrows or the mouse wheel.\r\n   *\r\n   * default: 1\r\n   */\r\n  step?: number;\r\n\r\n  /**\r\n   * If the number value should be treated as an integer.\r\n   *\r\n   * default: true\r\n   */\r\n  integerOnly?: boolean;\r\n}\r\n","export default function(constructor, factory, prototype) {\n  constructor.prototype = factory.prototype = prototype;\n  prototype.constructor = constructor;\n}\n\nexport function extend(parent, definition) {\n  var prototype = Object.create(parent.prototype);\n  for (var key in definition) prototype[key] = definition[key];\n  return prototype;\n}\n","import define, {extend} from \"./define.js\";\n\nexport function Color() {}\n\nexport var darker = 0.7;\nexport var brighter = 1 / darker;\n\nvar reI = \"\\\\s*([+-]?\\\\d+)\\\\s*\",\n    reN = \"\\\\s*([+-]?(?:\\\\d*\\\\.)?\\\\d+(?:[eE][+-]?\\\\d+)?)\\\\s*\",\n    reP = \"\\\\s*([+-]?(?:\\\\d*\\\\.)?\\\\d+(?:[eE][+-]?\\\\d+)?)%\\\\s*\",\n    reHex = /^#([0-9a-f]{3,8})$/,\n    reRgbInteger = new RegExp(`^rgb\\\\(${reI},${reI},${reI}\\\\)$`),\n    reRgbPercent = new RegExp(`^rgb\\\\(${reP},${reP},${reP}\\\\)$`),\n    reRgbaInteger = new RegExp(`^rgba\\\\(${reI},${reI},${reI},${reN}\\\\)$`),\n    reRgbaPercent = new RegExp(`^rgba\\\\(${reP},${reP},${reP},${reN}\\\\)$`),\n    reHslPercent = new RegExp(`^hsl\\\\(${reN},${reP},${reP}\\\\)$`),\n    reHslaPercent = new RegExp(`^hsla\\\\(${reN},${reP},${reP},${reN}\\\\)$`);\n\nvar named = {\n  aliceblue: 0xf0f8ff,\n  antiquewhite: 0xfaebd7,\n  aqua: 0x00ffff,\n  aquamarine: 0x7fffd4,\n  azure: 0xf0ffff,\n  beige: 0xf5f5dc,\n  bisque: 0xffe4c4,\n  black: 0x000000,\n  blanchedalmond: 0xffebcd,\n  blue: 0x0000ff,\n  blueviolet: 0x8a2be2,\n  brown: 0xa52a2a,\n  burlywood: 0xdeb887,\n  cadetblue: 0x5f9ea0,\n  chartreuse: 0x7fff00,\n  chocolate: 0xd2691e,\n  coral: 0xff7f50,\n  cornflowerblue: 0x6495ed,\n  cornsilk: 0xfff8dc,\n  crimson: 0xdc143c,\n  cyan: 0x00ffff,\n  darkblue: 0x00008b,\n  darkcyan: 0x008b8b,\n  darkgoldenrod: 0xb8860b,\n  darkgray: 0xa9a9a9,\n  darkgreen: 0x006400,\n  darkgrey: 0xa9a9a9,\n  darkkhaki: 0xbdb76b,\n  darkmagenta: 0x8b008b,\n  darkolivegreen: 0x556b2f,\n  darkorange: 0xff8c00,\n  darkorchid: 0x9932cc,\n  darkred: 0x8b0000,\n  darksalmon: 0xe9967a,\n  darkseagreen: 0x8fbc8f,\n  darkslateblue: 0x483d8b,\n  darkslategray: 0x2f4f4f,\n  darkslategrey: 0x2f4f4f,\n  darkturquoise: 0x00ced1,\n  darkviolet: 0x9400d3,\n  deeppink: 0xff1493,\n  deepskyblue: 0x00bfff,\n  dimgray: 0x696969,\n  dimgrey: 0x696969,\n  dodgerblue: 0x1e90ff,\n  firebrick: 0xb22222,\n  floralwhite: 0xfffaf0,\n  forestgreen: 0x228b22,\n  fuchsia: 0xff00ff,\n  gainsboro: 0xdcdcdc,\n  ghostwhite: 0xf8f8ff,\n  gold: 0xffd700,\n  goldenrod: 0xdaa520,\n  gray: 0x808080,\n  green: 0x008000,\n  greenyellow: 0xadff2f,\n  grey: 0x808080,\n  honeydew: 0xf0fff0,\n  hotpink: 0xff69b4,\n  indianred: 0xcd5c5c,\n  indigo: 0x4b0082,\n  ivory: 0xfffff0,\n  khaki: 0xf0e68c,\n  lavender: 0xe6e6fa,\n  lavenderblush: 0xfff0f5,\n  lawngreen: 0x7cfc00,\n  lemonchiffon: 0xfffacd,\n  lightblue: 0xadd8e6,\n  lightcoral: 0xf08080,\n  lightcyan: 0xe0ffff,\n  lightgoldenrodyellow: 0xfafad2,\n  lightgray: 0xd3d3d3,\n  lightgreen: 0x90ee90,\n  lightgrey: 0xd3d3d3,\n  lightpink: 0xffb6c1,\n  lightsalmon: 0xffa07a,\n  lightseagreen: 0x20b2aa,\n  lightskyblue: 0x87cefa,\n  lightslategray: 0x778899,\n  lightslategrey: 0x778899,\n  lightsteelblue: 0xb0c4de,\n  lightyellow: 0xffffe0,\n  lime: 0x00ff00,\n  limegreen: 0x32cd32,\n  linen: 0xfaf0e6,\n  magenta: 0xff00ff,\n  maroon: 0x800000,\n  mediumaquamarine: 0x66cdaa,\n  mediumblue: 0x0000cd,\n  mediumorchid: 0xba55d3,\n  mediumpurple: 0x9370db,\n  mediumseagreen: 0x3cb371,\n  mediumslateblue: 0x7b68ee,\n  mediumspringgreen: 0x00fa9a,\n  mediumturquoise: 0x48d1cc,\n  mediumvioletred: 0xc71585,\n  midnightblue: 0x191970,\n  mintcream: 0xf5fffa,\n  mistyrose: 0xffe4e1,\n  moccasin: 0xffe4b5,\n  navajowhite: 0xffdead,\n  navy: 0x000080,\n  oldlace: 0xfdf5e6,\n  olive: 0x808000,\n  olivedrab: 0x6b8e23,\n  orange: 0xffa500,\n  orangered: 0xff4500,\n  orchid: 0xda70d6,\n  palegoldenrod: 0xeee8aa,\n  palegreen: 0x98fb98,\n  paleturquoise: 0xafeeee,\n  palevioletred: 0xdb7093,\n  papayawhip: 0xffefd5,\n  peachpuff: 0xffdab9,\n  peru: 0xcd853f,\n  pink: 0xffc0cb,\n  plum: 0xdda0dd,\n  powderblue: 0xb0e0e6,\n  purple: 0x800080,\n  rebeccapurple: 0x663399,\n  red: 0xff0000,\n  rosybrown: 0xbc8f8f,\n  royalblue: 0x4169e1,\n  saddlebrown: 0x8b4513,\n  salmon: 0xfa8072,\n  sandybrown: 0xf4a460,\n  seagreen: 0x2e8b57,\n  seashell: 0xfff5ee,\n  sienna: 0xa0522d,\n  silver: 0xc0c0c0,\n  skyblue: 0x87ceeb,\n  slateblue: 0x6a5acd,\n  slategray: 0x708090,\n  slategrey: 0x708090,\n  snow: 0xfffafa,\n  springgreen: 0x00ff7f,\n  steelblue: 0x4682b4,\n  tan: 0xd2b48c,\n  teal: 0x008080,\n  thistle: 0xd8bfd8,\n  tomato: 0xff6347,\n  turquoise: 0x40e0d0,\n  violet: 0xee82ee,\n  wheat: 0xf5deb3,\n  white: 0xffffff,\n  whitesmoke: 0xf5f5f5,\n  yellow: 0xffff00,\n  yellowgreen: 0x9acd32\n};\n\ndefine(Color, color, {\n  copy(channels) {\n    return Object.assign(new this.constructor, this, channels);\n  },\n  displayable() {\n    return this.rgb().displayable();\n  },\n  hex: color_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: color_formatHex,\n  formatHex8: color_formatHex8,\n  formatHsl: color_formatHsl,\n  formatRgb: color_formatRgb,\n  toString: color_formatRgb\n});\n\nfunction color_formatHex() {\n  return this.rgb().formatHex();\n}\n\nfunction color_formatHex8() {\n  return this.rgb().formatHex8();\n}\n\nfunction color_formatHsl() {\n  return hslConvert(this).formatHsl();\n}\n\nfunction color_formatRgb() {\n  return this.rgb().formatRgb();\n}\n\nexport default function color(format) {\n  var m, l;\n  format = (format + \"\").trim().toLowerCase();\n  return (m = reHex.exec(format)) ? (l = m[1].length, m = parseInt(m[1], 16), l === 6 ? rgbn(m) // #ff0000\n      : l === 3 ? new Rgb((m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), ((m & 0xf) << 4) | (m & 0xf), 1) // #f00\n      : l === 8 ? rgba(m >> 24 & 0xff, m >> 16 & 0xff, m >> 8 & 0xff, (m & 0xff) / 0xff) // #ff000000\n      : l === 4 ? rgba((m >> 12 & 0xf) | (m >> 8 & 0xf0), (m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), (((m & 0xf) << 4) | (m & 0xf)) / 0xff) // #f000\n      : null) // invalid hex\n      : (m = reRgbInteger.exec(format)) ? new Rgb(m[1], m[2], m[3], 1) // rgb(255, 0, 0)\n      : (m = reRgbPercent.exec(format)) ? new Rgb(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, 1) // rgb(100%, 0%, 0%)\n      : (m = reRgbaInteger.exec(format)) ? rgba(m[1], m[2], m[3], m[4]) // rgba(255, 0, 0, 1)\n      : (m = reRgbaPercent.exec(format)) ? rgba(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, m[4]) // rgb(100%, 0%, 0%, 1)\n      : (m = reHslPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, 1) // hsl(120, 50%, 50%)\n      : (m = reHslaPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, m[4]) // hsla(120, 50%, 50%, 1)\n      : named.hasOwnProperty(format) ? rgbn(named[format]) // eslint-disable-line no-prototype-builtins\n      : format === \"transparent\" ? new Rgb(NaN, NaN, NaN, 0)\n      : null;\n}\n\nfunction rgbn(n) {\n  return new Rgb(n >> 16 & 0xff, n >> 8 & 0xff, n & 0xff, 1);\n}\n\nfunction rgba(r, g, b, a) {\n  if (a <= 0) r = g = b = NaN;\n  return new Rgb(r, g, b, a);\n}\n\nexport function rgbConvert(o) {\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Rgb;\n  o = o.rgb();\n  return new Rgb(o.r, o.g, o.b, o.opacity);\n}\n\nexport function rgb(r, g, b, opacity) {\n  return arguments.length === 1 ? rgbConvert(r) : new Rgb(r, g, b, opacity == null ? 1 : opacity);\n}\n\nexport function Rgb(r, g, b, opacity) {\n  this.r = +r;\n  this.g = +g;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Rgb, rgb, extend(Color, {\n  brighter(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  darker(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  rgb() {\n    return this;\n  },\n  clamp() {\n    return new Rgb(clampi(this.r), clampi(this.g), clampi(this.b), clampa(this.opacity));\n  },\n  displayable() {\n    return (-0.5 <= this.r && this.r < 255.5)\n        && (-0.5 <= this.g && this.g < 255.5)\n        && (-0.5 <= this.b && this.b < 255.5)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  hex: rgb_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: rgb_formatHex,\n  formatHex8: rgb_formatHex8,\n  formatRgb: rgb_formatRgb,\n  toString: rgb_formatRgb\n}));\n\nfunction rgb_formatHex() {\n  return `#${hex(this.r)}${hex(this.g)}${hex(this.b)}`;\n}\n\nfunction rgb_formatHex8() {\n  return `#${hex(this.r)}${hex(this.g)}${hex(this.b)}${hex((isNaN(this.opacity) ? 1 : this.opacity) * 255)}`;\n}\n\nfunction rgb_formatRgb() {\n  const a = clampa(this.opacity);\n  return `${a === 1 ? \"rgb(\" : \"rgba(\"}${clampi(this.r)}, ${clampi(this.g)}, ${clampi(this.b)}${a === 1 ? \")\" : `, ${a})`}`;\n}\n\nfunction clampa(opacity) {\n  return isNaN(opacity) ? 1 : Math.max(0, Math.min(1, opacity));\n}\n\nfunction clampi(value) {\n  return Math.max(0, Math.min(255, Math.round(value) || 0));\n}\n\nfunction hex(value) {\n  value = clampi(value);\n  return (value < 16 ? \"0\" : \"\") + value.toString(16);\n}\n\nfunction hsla(h, s, l, a) {\n  if (a <= 0) h = s = l = NaN;\n  else if (l <= 0 || l >= 1) h = s = NaN;\n  else if (s <= 0) h = NaN;\n  return new Hsl(h, s, l, a);\n}\n\nexport function hslConvert(o) {\n  if (o instanceof Hsl) return new Hsl(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Hsl;\n  if (o instanceof Hsl) return o;\n  o = o.rgb();\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      min = Math.min(r, g, b),\n      max = Math.max(r, g, b),\n      h = NaN,\n      s = max - min,\n      l = (max + min) / 2;\n  if (s) {\n    if (r === max) h = (g - b) / s + (g < b) * 6;\n    else if (g === max) h = (b - r) / s + 2;\n    else h = (r - g) / s + 4;\n    s /= l < 0.5 ? max + min : 2 - max - min;\n    h *= 60;\n  } else {\n    s = l > 0 && l < 1 ? 0 : h;\n  }\n  return new Hsl(h, s, l, o.opacity);\n}\n\nexport function hsl(h, s, l, opacity) {\n  return arguments.length === 1 ? hslConvert(h) : new Hsl(h, s, l, opacity == null ? 1 : opacity);\n}\n\nfunction Hsl(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Hsl, hsl, extend(Color, {\n  brighter(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb() {\n    var h = this.h % 360 + (this.h < 0) * 360,\n        s = isNaN(h) || isNaN(this.s) ? 0 : this.s,\n        l = this.l,\n        m2 = l + (l < 0.5 ? l : 1 - l) * s,\n        m1 = 2 * l - m2;\n    return new Rgb(\n      hsl2rgb(h >= 240 ? h - 240 : h + 120, m1, m2),\n      hsl2rgb(h, m1, m2),\n      hsl2rgb(h < 120 ? h + 240 : h - 120, m1, m2),\n      this.opacity\n    );\n  },\n  clamp() {\n    return new Hsl(clamph(this.h), clampt(this.s), clampt(this.l), clampa(this.opacity));\n  },\n  displayable() {\n    return (0 <= this.s && this.s <= 1 || isNaN(this.s))\n        && (0 <= this.l && this.l <= 1)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  formatHsl() {\n    const a = clampa(this.opacity);\n    return `${a === 1 ? \"hsl(\" : \"hsla(\"}${clamph(this.h)}, ${clampt(this.s) * 100}%, ${clampt(this.l) * 100}%${a === 1 ? \")\" : `, ${a})`}`;\n  }\n}));\n\nfunction clamph(value) {\n  value = (value || 0) % 360;\n  return value < 0 ? value + 360 : value;\n}\n\nfunction clampt(value) {\n  return Math.max(0, Math.min(1, value || 0));\n}\n\n/* From FvD 13.37, CSS Color Module Level 3 */\nfunction hsl2rgb(h, m1, m2) {\n  return (h < 60 ? m1 + (m2 - m1) * h / 60\n      : h < 180 ? m2\n      : h < 240 ? m1 + (m2 - m1) * (240 - h) / 60\n      : m1) * 255;\n}\n","export const radians = Math.PI / 180;\nexport const degrees = 180 / Math.PI;\n","import define, {extend} from \"./define.js\";\nimport {Color, rgbConvert, Rgb} from \"./color.js\";\nimport {degrees, radians} from \"./math.js\";\n\n// https://observablehq.com/@mbostock/lab-and-rgb\nconst K = 18,\n    Xn = 0.96422,\n    Yn = 1,\n    Zn = 0.82521,\n    t0 = 4 / 29,\n    t1 = 6 / 29,\n    t2 = 3 * t1 * t1,\n    t3 = t1 * t1 * t1;\n\nfunction labConvert(o) {\n  if (o instanceof Lab) return new Lab(o.l, o.a, o.b, o.opacity);\n  if (o instanceof Hcl) return hcl2lab(o);\n  if (!(o instanceof Rgb)) o = rgbConvert(o);\n  var r = rgb2lrgb(o.r),\n      g = rgb2lrgb(o.g),\n      b = rgb2lrgb(o.b),\n      y = xyz2lab((0.2225045 * r + 0.7168786 * g + 0.0606169 * b) / Yn), x, z;\n  if (r === g && g === b) x = z = y; else {\n    x = xyz2lab((0.4360747 * r + 0.3850649 * g + 0.1430804 * b) / Xn);\n    z = xyz2lab((0.0139322 * r + 0.0971045 * g + 0.7141733 * b) / Zn);\n  }\n  return new Lab(116 * y - 16, 500 * (x - y), 200 * (y - z), o.opacity);\n}\n\nexport function gray(l, opacity) {\n  return new Lab(l, 0, 0, opacity == null ? 1 : opacity);\n}\n\nexport default function lab(l, a, b, opacity) {\n  return arguments.length === 1 ? labConvert(l) : new Lab(l, a, b, opacity == null ? 1 : opacity);\n}\n\nexport function Lab(l, a, b, opacity) {\n  this.l = +l;\n  this.a = +a;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Lab, lab, extend(Color, {\n  brighter(k) {\n    return new Lab(this.l + K * (k == null ? 1 : k), this.a, this.b, this.opacity);\n  },\n  darker(k) {\n    return new Lab(this.l - K * (k == null ? 1 : k), this.a, this.b, this.opacity);\n  },\n  rgb() {\n    var y = (this.l + 16) / 116,\n        x = isNaN(this.a) ? y : y + this.a / 500,\n        z = isNaN(this.b) ? y : y - this.b / 200;\n    x = Xn * lab2xyz(x);\n    y = Yn * lab2xyz(y);\n    z = Zn * lab2xyz(z);\n    return new Rgb(\n      lrgb2rgb( 3.1338561 * x - 1.6168667 * y - 0.4906146 * z),\n      lrgb2rgb(-0.9787684 * x + 1.9161415 * y + 0.0334540 * z),\n      lrgb2rgb( 0.0719453 * x - 0.2289914 * y + 1.4052427 * z),\n      this.opacity\n    );\n  }\n}));\n\nfunction xyz2lab(t) {\n  return t > t3 ? Math.pow(t, 1 / 3) : t / t2 + t0;\n}\n\nfunction lab2xyz(t) {\n  return t > t1 ? t * t * t : t2 * (t - t0);\n}\n\nfunction lrgb2rgb(x) {\n  return 255 * (x <= 0.0031308 ? 12.92 * x : 1.055 * Math.pow(x, 1 / 2.4) - 0.055);\n}\n\nfunction rgb2lrgb(x) {\n  return (x /= 255) <= 0.04045 ? x / 12.92 : Math.pow((x + 0.055) / 1.055, 2.4);\n}\n\nfunction hclConvert(o) {\n  if (o instanceof Hcl) return new Hcl(o.h, o.c, o.l, o.opacity);\n  if (!(o instanceof Lab)) o = labConvert(o);\n  if (o.a === 0 && o.b === 0) return new Hcl(NaN, 0 < o.l && o.l < 100 ? 0 : NaN, o.l, o.opacity);\n  var h = Math.atan2(o.b, o.a) * degrees;\n  return new Hcl(h < 0 ? h + 360 : h, Math.sqrt(o.a * o.a + o.b * o.b), o.l, o.opacity);\n}\n\nexport function lch(l, c, h, opacity) {\n  return arguments.length === 1 ? hclConvert(l) : new Hcl(h, c, l, opacity == null ? 1 : opacity);\n}\n\nexport function hcl(h, c, l, opacity) {\n  return arguments.length === 1 ? hclConvert(h) : new Hcl(h, c, l, opacity == null ? 1 : opacity);\n}\n\nexport function Hcl(h, c, l, opacity) {\n  this.h = +h;\n  this.c = +c;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\nfunction hcl2lab(o) {\n  if (isNaN(o.h)) return new Lab(o.l, 0, 0, o.opacity);\n  var h = o.h * radians;\n  return new Lab(o.l, Math.cos(h) * o.c, Math.sin(h) * o.c, o.opacity);\n}\n\ndefine(Hcl, hcl, extend(Color, {\n  brighter(k) {\n    return new Hcl(this.h, this.c, this.l + K * (k == null ? 1 : k), this.opacity);\n  },\n  darker(k) {\n    return new Hcl(this.h, this.c, this.l - K * (k == null ? 1 : k), this.opacity);\n  },\n  rgb() {\n    return hcl2lab(this).rgb();\n  }\n}));\n","import define, {extend} from \"./define.js\";\nimport {Color, rgbConvert, Rgb, darker, brighter} from \"./color.js\";\nimport {degrees, radians} from \"./math.js\";\n\nvar A = -0.14861,\n    B = +1.78277,\n    C = -0.29227,\n    D = -0.90649,\n    E = +1.97294,\n    ED = E * D,\n    EB = E * B,\n    BC_DA = B * C - D * A;\n\nfunction cubehelixConvert(o) {\n  if (o instanceof Cubehelix) return new Cubehelix(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Rgb)) o = rgbConvert(o);\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      l = (BC_DA * b + ED * r - EB * g) / (BC_DA + ED - EB),\n      bl = b - l,\n      k = (E * (g - l) - C * bl) / D,\n      s = Math.sqrt(k * k + bl * bl) / (E * l * (1 - l)), // NaN if l=0 or l=1\n      h = s ? Math.atan2(k, bl) * degrees - 120 : NaN;\n  return new Cubehelix(h < 0 ? h + 360 : h, s, l, o.opacity);\n}\n\nexport default function cubehelix(h, s, l, opacity) {\n  return arguments.length === 1 ? cubehelixConvert(h) : new Cubehelix(h, s, l, opacity == null ? 1 : opacity);\n}\n\nexport function Cubehelix(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Cubehelix, cubehelix, extend(Color, {\n  brighter(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Cubehelix(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Cubehelix(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb() {\n    var h = isNaN(this.h) ? 0 : (this.h + 120) * radians,\n        l = +this.l,\n        a = isNaN(this.s) ? 0 : this.s * l * (1 - l),\n        cosh = Math.cos(h),\n        sinh = Math.sin(h);\n    return new Rgb(\n      255 * (l + a * (A * cosh + B * sinh)),\n      255 * (l + a * (C * cosh + D * sinh)),\n      255 * (l + a * (E * cosh)),\n      this.opacity\n    );\n  }\n}));\n","export default function(constructor, factory, prototype) {\n  constructor.prototype = factory.prototype = prototype;\n  prototype.constructor = constructor;\n}\n\nexport function extend(parent, definition) {\n  var prototype = Object.create(parent.prototype);\n  for (var key in definition) prototype[key] = definition[key];\n  return prototype;\n}\n","import define, {extend} from \"./define.js\";\n\nexport function Color() {}\n\nexport var darker = 0.7;\nexport var brighter = 1 / darker;\n\nvar reI = \"\\\\s*([+-]?\\\\d+)\\\\s*\",\n    reN = \"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)\\\\s*\",\n    reP = \"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)%\\\\s*\",\n    reHex = /^#([0-9a-f]{3,8})$/,\n    reRgbInteger = new RegExp(\"^rgb\\\\(\" + [reI, reI, reI] + \"\\\\)$\"),\n    reRgbPercent = new RegExp(\"^rgb\\\\(\" + [reP, reP, reP] + \"\\\\)$\"),\n    reRgbaInteger = new RegExp(\"^rgba\\\\(\" + [reI, reI, reI, reN] + \"\\\\)$\"),\n    reRgbaPercent = new RegExp(\"^rgba\\\\(\" + [reP, reP, reP, reN] + \"\\\\)$\"),\n    reHslPercent = new RegExp(\"^hsl\\\\(\" + [reN, reP, reP] + \"\\\\)$\"),\n    reHslaPercent = new RegExp(\"^hsla\\\\(\" + [reN, reP, reP, reN] + \"\\\\)$\");\n\nvar named = {\n  aliceblue: 0xf0f8ff,\n  antiquewhite: 0xfaebd7,\n  aqua: 0x00ffff,\n  aquamarine: 0x7fffd4,\n  azure: 0xf0ffff,\n  beige: 0xf5f5dc,\n  bisque: 0xffe4c4,\n  black: 0x000000,\n  blanchedalmond: 0xffebcd,\n  blue: 0x0000ff,\n  blueviolet: 0x8a2be2,\n  brown: 0xa52a2a,\n  burlywood: 0xdeb887,\n  cadetblue: 0x5f9ea0,\n  chartreuse: 0x7fff00,\n  chocolate: 0xd2691e,\n  coral: 0xff7f50,\n  cornflowerblue: 0x6495ed,\n  cornsilk: 0xfff8dc,\n  crimson: 0xdc143c,\n  cyan: 0x00ffff,\n  darkblue: 0x00008b,\n  darkcyan: 0x008b8b,\n  darkgoldenrod: 0xb8860b,\n  darkgray: 0xa9a9a9,\n  darkgreen: 0x006400,\n  darkgrey: 0xa9a9a9,\n  darkkhaki: 0xbdb76b,\n  darkmagenta: 0x8b008b,\n  darkolivegreen: 0x556b2f,\n  darkorange: 0xff8c00,\n  darkorchid: 0x9932cc,\n  darkred: 0x8b0000,\n  darksalmon: 0xe9967a,\n  darkseagreen: 0x8fbc8f,\n  darkslateblue: 0x483d8b,\n  darkslategray: 0x2f4f4f,\n  darkslategrey: 0x2f4f4f,\n  darkturquoise: 0x00ced1,\n  darkviolet: 0x9400d3,\n  deeppink: 0xff1493,\n  deepskyblue: 0x00bfff,\n  dimgray: 0x696969,\n  dimgrey: 0x696969,\n  dodgerblue: 0x1e90ff,\n  firebrick: 0xb22222,\n  floralwhite: 0xfffaf0,\n  forestgreen: 0x228b22,\n  fuchsia: 0xff00ff,\n  gainsboro: 0xdcdcdc,\n  ghostwhite: 0xf8f8ff,\n  gold: 0xffd700,\n  goldenrod: 0xdaa520,\n  gray: 0x808080,\n  green: 0x008000,\n  greenyellow: 0xadff2f,\n  grey: 0x808080,\n  honeydew: 0xf0fff0,\n  hotpink: 0xff69b4,\n  indianred: 0xcd5c5c,\n  indigo: 0x4b0082,\n  ivory: 0xfffff0,\n  khaki: 0xf0e68c,\n  lavender: 0xe6e6fa,\n  lavenderblush: 0xfff0f5,\n  lawngreen: 0x7cfc00,\n  lemonchiffon: 0xfffacd,\n  lightblue: 0xadd8e6,\n  lightcoral: 0xf08080,\n  lightcyan: 0xe0ffff,\n  lightgoldenrodyellow: 0xfafad2,\n  lightgray: 0xd3d3d3,\n  lightgreen: 0x90ee90,\n  lightgrey: 0xd3d3d3,\n  lightpink: 0xffb6c1,\n  lightsalmon: 0xffa07a,\n  lightseagreen: 0x20b2aa,\n  lightskyblue: 0x87cefa,\n  lightslategray: 0x778899,\n  lightslategrey: 0x778899,\n  lightsteelblue: 0xb0c4de,\n  lightyellow: 0xffffe0,\n  lime: 0x00ff00,\n  limegreen: 0x32cd32,\n  linen: 0xfaf0e6,\n  magenta: 0xff00ff,\n  maroon: 0x800000,\n  mediumaquamarine: 0x66cdaa,\n  mediumblue: 0x0000cd,\n  mediumorchid: 0xba55d3,\n  mediumpurple: 0x9370db,\n  mediumseagreen: 0x3cb371,\n  mediumslateblue: 0x7b68ee,\n  mediumspringgreen: 0x00fa9a,\n  mediumturquoise: 0x48d1cc,\n  mediumvioletred: 0xc71585,\n  midnightblue: 0x191970,\n  mintcream: 0xf5fffa,\n  mistyrose: 0xffe4e1,\n  moccasin: 0xffe4b5,\n  navajowhite: 0xffdead,\n  navy: 0x000080,\n  oldlace: 0xfdf5e6,\n  olive: 0x808000,\n  olivedrab: 0x6b8e23,\n  orange: 0xffa500,\n  orangered: 0xff4500,\n  orchid: 0xda70d6,\n  palegoldenrod: 0xeee8aa,\n  palegreen: 0x98fb98,\n  paleturquoise: 0xafeeee,\n  palevioletred: 0xdb7093,\n  papayawhip: 0xffefd5,\n  peachpuff: 0xffdab9,\n  peru: 0xcd853f,\n  pink: 0xffc0cb,\n  plum: 0xdda0dd,\n  powderblue: 0xb0e0e6,\n  purple: 0x800080,\n  rebeccapurple: 0x663399,\n  red: 0xff0000,\n  rosybrown: 0xbc8f8f,\n  royalblue: 0x4169e1,\n  saddlebrown: 0x8b4513,\n  salmon: 0xfa8072,\n  sandybrown: 0xf4a460,\n  seagreen: 0x2e8b57,\n  seashell: 0xfff5ee,\n  sienna: 0xa0522d,\n  silver: 0xc0c0c0,\n  skyblue: 0x87ceeb,\n  slateblue: 0x6a5acd,\n  slategray: 0x708090,\n  slategrey: 0x708090,\n  snow: 0xfffafa,\n  springgreen: 0x00ff7f,\n  steelblue: 0x4682b4,\n  tan: 0xd2b48c,\n  teal: 0x008080,\n  thistle: 0xd8bfd8,\n  tomato: 0xff6347,\n  turquoise: 0x40e0d0,\n  violet: 0xee82ee,\n  wheat: 0xf5deb3,\n  white: 0xffffff,\n  whitesmoke: 0xf5f5f5,\n  yellow: 0xffff00,\n  yellowgreen: 0x9acd32\n};\n\ndefine(Color, color, {\n  copy: function(channels) {\n    return Object.assign(new this.constructor, this, channels);\n  },\n  displayable: function() {\n    return this.rgb().displayable();\n  },\n  hex: color_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: color_formatHex,\n  formatHsl: color_formatHsl,\n  formatRgb: color_formatRgb,\n  toString: color_formatRgb\n});\n\nfunction color_formatHex() {\n  return this.rgb().formatHex();\n}\n\nfunction color_formatHsl() {\n  return hslConvert(this).formatHsl();\n}\n\nfunction color_formatRgb() {\n  return this.rgb().formatRgb();\n}\n\nexport default function color(format) {\n  var m, l;\n  format = (format + \"\").trim().toLowerCase();\n  return (m = reHex.exec(format)) ? (l = m[1].length, m = parseInt(m[1], 16), l === 6 ? rgbn(m) // #ff0000\n      : l === 3 ? new Rgb((m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), ((m & 0xf) << 4) | (m & 0xf), 1) // #f00\n      : l === 8 ? rgba(m >> 24 & 0xff, m >> 16 & 0xff, m >> 8 & 0xff, (m & 0xff) / 0xff) // #ff000000\n      : l === 4 ? rgba((m >> 12 & 0xf) | (m >> 8 & 0xf0), (m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), (((m & 0xf) << 4) | (m & 0xf)) / 0xff) // #f000\n      : null) // invalid hex\n      : (m = reRgbInteger.exec(format)) ? new Rgb(m[1], m[2], m[3], 1) // rgb(255, 0, 0)\n      : (m = reRgbPercent.exec(format)) ? new Rgb(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, 1) // rgb(100%, 0%, 0%)\n      : (m = reRgbaInteger.exec(format)) ? rgba(m[1], m[2], m[3], m[4]) // rgba(255, 0, 0, 1)\n      : (m = reRgbaPercent.exec(format)) ? rgba(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, m[4]) // rgb(100%, 0%, 0%, 1)\n      : (m = reHslPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, 1) // hsl(120, 50%, 50%)\n      : (m = reHslaPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, m[4]) // hsla(120, 50%, 50%, 1)\n      : named.hasOwnProperty(format) ? rgbn(named[format]) // eslint-disable-line no-prototype-builtins\n      : format === \"transparent\" ? new Rgb(NaN, NaN, NaN, 0)\n      : null;\n}\n\nfunction rgbn(n) {\n  return new Rgb(n >> 16 & 0xff, n >> 8 & 0xff, n & 0xff, 1);\n}\n\nfunction rgba(r, g, b, a) {\n  if (a <= 0) r = g = b = NaN;\n  return new Rgb(r, g, b, a);\n}\n\nexport function rgbConvert(o) {\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Rgb;\n  o = o.rgb();\n  return new Rgb(o.r, o.g, o.b, o.opacity);\n}\n\nexport function rgb(r, g, b, opacity) {\n  return arguments.length === 1 ? rgbConvert(r) : new Rgb(r, g, b, opacity == null ? 1 : opacity);\n}\n\nexport function Rgb(r, g, b, opacity) {\n  this.r = +r;\n  this.g = +g;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Rgb, rgb, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  rgb: function() {\n    return this;\n  },\n  displayable: function() {\n    return (-0.5 <= this.r && this.r < 255.5)\n        && (-0.5 <= this.g && this.g < 255.5)\n        && (-0.5 <= this.b && this.b < 255.5)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  hex: rgb_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: rgb_formatHex,\n  formatRgb: rgb_formatRgb,\n  toString: rgb_formatRgb\n}));\n\nfunction rgb_formatHex() {\n  return \"#\" + hex(this.r) + hex(this.g) + hex(this.b);\n}\n\nfunction rgb_formatRgb() {\n  var a = this.opacity; a = isNaN(a) ? 1 : Math.max(0, Math.min(1, a));\n  return (a === 1 ? \"rgb(\" : \"rgba(\")\n      + Math.max(0, Math.min(255, Math.round(this.r) || 0)) + \", \"\n      + Math.max(0, Math.min(255, Math.round(this.g) || 0)) + \", \"\n      + Math.max(0, Math.min(255, Math.round(this.b) || 0))\n      + (a === 1 ? \")\" : \", \" + a + \")\");\n}\n\nfunction hex(value) {\n  value = Math.max(0, Math.min(255, Math.round(value) || 0));\n  return (value < 16 ? \"0\" : \"\") + value.toString(16);\n}\n\nfunction hsla(h, s, l, a) {\n  if (a <= 0) h = s = l = NaN;\n  else if (l <= 0 || l >= 1) h = s = NaN;\n  else if (s <= 0) h = NaN;\n  return new Hsl(h, s, l, a);\n}\n\nexport function hslConvert(o) {\n  if (o instanceof Hsl) return new Hsl(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Hsl;\n  if (o instanceof Hsl) return o;\n  o = o.rgb();\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      min = Math.min(r, g, b),\n      max = Math.max(r, g, b),\n      h = NaN,\n      s = max - min,\n      l = (max + min) / 2;\n  if (s) {\n    if (r === max) h = (g - b) / s + (g < b) * 6;\n    else if (g === max) h = (b - r) / s + 2;\n    else h = (r - g) / s + 4;\n    s /= l < 0.5 ? max + min : 2 - max - min;\n    h *= 60;\n  } else {\n    s = l > 0 && l < 1 ? 0 : h;\n  }\n  return new Hsl(h, s, l, o.opacity);\n}\n\nexport function hsl(h, s, l, opacity) {\n  return arguments.length === 1 ? hslConvert(h) : new Hsl(h, s, l, opacity == null ? 1 : opacity);\n}\n\nfunction Hsl(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Hsl, hsl, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb: function() {\n    var h = this.h % 360 + (this.h < 0) * 360,\n        s = isNaN(h) || isNaN(this.s) ? 0 : this.s,\n        l = this.l,\n        m2 = l + (l < 0.5 ? l : 1 - l) * s,\n        m1 = 2 * l - m2;\n    return new Rgb(\n      hsl2rgb(h >= 240 ? h - 240 : h + 120, m1, m2),\n      hsl2rgb(h, m1, m2),\n      hsl2rgb(h < 120 ? h + 240 : h - 120, m1, m2),\n      this.opacity\n    );\n  },\n  displayable: function() {\n    return (0 <= this.s && this.s <= 1 || isNaN(this.s))\n        && (0 <= this.l && this.l <= 1)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  formatHsl: function() {\n    var a = this.opacity; a = isNaN(a) ? 1 : Math.max(0, Math.min(1, a));\n    return (a === 1 ? \"hsl(\" : \"hsla(\")\n        + (this.h || 0) + \", \"\n        + (this.s || 0) * 100 + \"%, \"\n        + (this.l || 0) * 100 + \"%\"\n        + (a === 1 ? \")\" : \", \" + a + \")\");\n  }\n}));\n\n/* From FvD 13.37, CSS Color Module Level 3 */\nfunction hsl2rgb(h, m1, m2) {\n  return (h < 60 ? m1 + (m2 - m1) * h / 60\n      : h < 180 ? m2\n      : h < 240 ? m1 + (m2 - m1) * (240 - h) / 60\n      : m1) * 255;\n}\n","import {color, rgb} from \"d3-color\";\n\nvar darker = 0.7,\n    brighter = 1 / darker;\n\nfunction hsvConvert(o) {\n  if (o instanceof Hsv) return new Hsv(o.h, o.s, o.v, o.opacity);\n  if (!(o instanceof rgb)) o = rgb(o);\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      min = Math.min(r, g, b),\n      max = Math.max(r, g, b),\n      d = max - min,\n      h = NaN,\n      s = d / max,\n      v = max;\n  if (d) {\n    if (r === max) h = (g - b) / d + (g < b) * 6;\n    else if (g === max) h = (b - r) / d + 2;\n    else h = (r - g) / d + 4;\n    h *= 60;\n  }\n  return new Hsv(h, s, v, o.opacity);\n}\n\nexport default function hsv(h, s, v, opacity) {\n  return arguments.length === 1 ? hsvConvert(h) : new Hsv(h, s, v, opacity == null ? 1 : opacity);\n}\n\nexport function Hsv(h, s, v, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.v = +v;\n  this.opacity = +opacity;\n}\n\nvar hsvPrototype = Hsv.prototype = hsv.prototype = Object.create(color.prototype);\n\nhsvPrototype.constructor = Hsv;\n\nhsvPrototype.brighter = function(k) {\n  k = k == null ? brighter : Math.pow(brighter, k);\n  return new Hsv(this.h, this.s, this.v * k, this.opacity);\n};\n\nhsvPrototype.darker = function(k) {\n  k = k == null ? darker : Math.pow(darker, k);\n  return new Hsv(this.h, this.s, this.v * k, this.opacity);\n};\n\nhsvPrototype.rgb = function() {\n  var h = isNaN(this.h) ? 0 : this.h % 360 + (this.h < 0) * 360,\n      s = isNaN(this.h) || isNaN(this.s) ? 0 : this.s,\n      v = this.v,\n      a = this.opacity,\n      c = v * s,\n      x = c * (1 - Math.abs((h / 60) % 2 - 1)),\n      m = v - c;\n  return h < 60 ? hsv2rgb(c, x, 0, m, a)\n      : h < 120 ? hsv2rgb(x, c, 0, m, a)\n      : h < 180 ? hsv2rgb(0, c, x, m, a)\n      : h < 240 ? hsv2rgb(0, x, c, m, a)\n      : h < 300 ? hsv2rgb(x, 0, c, m, a)\n      : hsv2rgb(c, 0, x, m, a);\n};\n\nhsvPrototype.displayable = function() {\n  return (0 <= this.s && this.s <= 1 || isNaN(this.s))\n      && (0 <= this.v && this.v <= 1)\n      && (0 <= this.opacity && this.opacity <= 1);\n};\n\nfunction hsv2rgb(r1, g1, b1, m, a) {\n  return rgb((r1 + m) * 255, (g1 + m) * 255, (b1 + m) * 255, a);\n}\n","export default function(x) {\n  return function() {\n    return x;\n  };\n}\n","import constant from \"./constant\";\n\nfunction linear(a, d) {\n  return function(t) {\n    return a + t * d;\n  };\n}\n\nexport function hue(a, b) {\n  var d = b - a;\n  return d ? linear(a, d > 180 || d < -180 ? d - 360 * Math.round(d / 360) : d) : constant(isNaN(a) ? b : a);\n}\n\nexport default function(a, b) {\n  var d = b - a;\n  return d ? linear(a, d) : constant(isNaN(a) ? b : a);\n}\n","import color, {hue} from \"./color\";\nimport colorHsv from \"./hsv\";\n\nfunction hsv(hue) {\n  return function(start, end) {\n    var h = hue((start = colorHsv(start)).h, (end = colorHsv(end)).h),\n        s = color(start.s, end.s),\n        v = color(start.v, end.v),\n        opacity = color(start.opacity, end.opacity);\n    return function(t) {\n      start.h = h(t);\n      start.s = s(t);\n      start.v = v(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n}\n\nexport default hsv(hue);\nexport var hsvLong = hsv(color);\n","import {drawControlPoint} from './draw';\r\nimport Container from './Container';\r\nimport NumberInputField from './NumberInputField';\r\nimport { hsl } from \"d3-color\";\r\nimport { hsv, HSVColor } from \"d3-hsv\";\r\n\r\n/**\r\n * This creates a color picker component, that will be embedded in the given container. The color can be chosen with a\r\n * hue, saturation and value picker, or by text fields for hsv, rgb and hex values. This might be more configurable in\r\n * the future.\r\n *\r\n * @example\r\n * ```js\r\n *   const cp = new ColorPicker(\"#color-picker-container\", { initialColor: \"cyan\" });\r\n *\r\n *   cp.addListener((colorPicker) => {\r\n *     console.log(\"rgb: \", colorPicker.getRGB()); // rgb: { r: 0, g: 255, b: 255 }\r\n *     console.log(\"hsv: \", colorPicker.getHSV()); // hsv: { r: 180, g: 100, b: 50 }\r\n *     console.log(\"hsl: \", colorPicker.getHSL()); // hsl: { h: 180, s: 100, l: 100 }\r\n *\r\n *     console.log(\"rgb: \", colorPicker.getRGBNormalized()); // rgb: { r: 0.0, g: 1.0, b: 1.0 }\r\n *     console.log(\"hsv: \", colorPicker.getHSVNormalized()); // hsv: { r: 0.5, g: 1.0, b: 0.5 }\r\n *     console.log(\"hsl: \", colorPicker.getHSLNormalized()); // hsl: { h: 0.5, s: 1.0, l: 1.0 }\r\n *     console.log(\"hex: \", colorPicker.getHEX()); // hex: \"#00ffff\"\r\n *   });\r\n * ```\r\n */\r\nexport class ColorPicker extends Container {\r\n  /** This is the internal color state. We chose hsv as a fitting internal representation. */\r\n  private hsv: HSVColor;\r\n\r\n  /**\r\n   * If a color on the black-grey-white spectrum is selected the hue becomes undefined. This field saves the last valid\r\n   * hue state to ensure that the hue value doesn't vanish.\r\n   */\r\n  private backUpHue;\r\n\r\n  /**\r\n   * If the value is zero, the saturation becomes undefined. This field saves the last valid saturation state to ensure\r\n   * that the saturation value doesn't vanish.\r\n   */\r\n  private backUpSaturation;\r\n\r\n  /** The saturation and value picker is painted in this canvas. It also handles mouse input. */\r\n  private readonly svCanvas: HTMLCanvasElement;\r\n\r\n  /** The context to the svCanvas for convenience. */\r\n  private svContext: CanvasRenderingContext2D;\r\n\r\n  /** The hue picker is painted in this canvas. It also handles mouse input. */\r\n  private readonly hCanvas: HTMLCanvasElement;\r\n\r\n  /** The context to the hCanvas for convenience. */\r\n  private hContext: CanvasRenderingContext2D;\r\n\r\n  /** The default dimensions of the color picker components. Might become configurable in the future. */\r\n  private readonly CANVAS_SIZE: number = 256;\r\n\r\n  /** The size of the control points. Might become configurable in the future. */\r\n  private controlPointSize: number = 7;\r\n\r\n  /** This gets called, when the color changes to notify users of this library. */\r\n  private callbacks: Map<number, ColorCallback> = new Map();\r\n  private callbackCounter = 0;\r\n\r\n  /** All the inputs for manual editing the hsv, rgb and hex values. */\r\n  private inputFields: {\r\n    h: NumberInputField;\r\n    s: NumberInputField;\r\n    v: NumberInputField;\r\n    r: NumberInputField;\r\n    g: NumberInputField;\r\n    b: NumberInputField;\r\n    hex: HTMLInputElement;\r\n  };\r\n\r\n  /** Displays the resulting color. */\r\n  private previewElement: HTMLDivElement;\r\n\r\n  /**\r\n   * Creates a new color picker inside the given container.\r\n   *\r\n   * @param container Either an HTMLElement or a query string to an element, in which the color picker will be embedded.\r\n   * @param options   Can be used to configure the color picker. See {@link ColorPickerOptions}.\r\n   */\r\n  constructor(container: HTMLElement | string, options?: ColorPickerOptions) {\r\n    super(container);\r\n\r\n    // Set all defaults.\r\n    const defaultOptions: ColorPickerOptions = {\r\n      initialColor: '#FFF',\r\n    };\r\n\r\n    // Merge the options with the defaults.\r\n    // !!! DON'T USE options AND defaultOptions AFTER THIS LINE !!!\r\n    const finalOptions = Object.assign(defaultOptions, options);\r\n\r\n    this.hsv = hsv(finalOptions.initialColor);\r\n    if (Number.isNaN(this.hsv.h)) {\r\n      this.hsv.h = 180;\r\n    }\r\n\r\n    if (Number.isNaN(this.hsv.s)) {\r\n      this.hsv.s = 1;\r\n    }\r\n\r\n    this.backUpHue = this.hsv.h;\r\n    this.backUpSaturation = this.hsv.s;\r\n\r\n    // Fill the given container with all the HTML and CSS that we need.\r\n    this.parent.classList.add('tfe-color-picker');\r\n    this.parent.innerHTML = `\r\n      <div class=\"tfe-color-picker-root\">\r\n        <div class=\"tfe-color-picker-sl-picker\" style=\"width: ${this.CANVAS_SIZE}px; height: ${this.CANVAS_SIZE}px\">\r\n          <canvas class=\"tfe-color-picker-sl-picker-canvas\" width=\"${this.CANVAS_SIZE}\" height=\"${this.CANVAS_SIZE}\" />\r\n        </div>\r\n        <div class=\"tfe-color-picker-h-picker\"  style=\"height: ${this.CANVAS_SIZE}px\">\r\n          <canvas class=\"tfe-color-picker-h-picker-canvas\" width=\"18\" height=\"${this.CANVAS_SIZE}\" />\r\n        </div>\r\n        <form class=\"tfe-color-picker-input-root\">\r\n          <div class=\"tfe-color-preview\" style=\"background: ${this.getHEX()}\"></div>\r\n          <div></div>\r\n          <div class=\"tfe-color-picker-h-input\"></div>\r\n          <div class=\"tfe-color-picker-s-input\"></div>\r\n          <div class=\"tfe-color-picker-v-input\"></div>\r\n          <div></div>\r\n          <div class=\"tfe-color-picker-r-input\"></div>\r\n          <div class=\"tfe-color-picker-g-input\"></div>\r\n          <div class=\"tfe-color-picker-b-input\"></div>\r\n          <div></div>\r\n          <label>hex:\r\n            <input class=\"tfe-color-picker-hex-input\" type=\"text\" minlength=\"4\" maxlength=\"7\" value=\"${this.getHEX()}\">\r\n          </label>\r\n        </form>\r\n      </div>\r\n    `;\r\n\r\n    // Prepare the canvas and context for the saturation and value picker.\r\n    this.svCanvas = this.parent.querySelector<HTMLCanvasElement>('.tfe-color-picker-sl-picker-canvas');\r\n    this.svContext = this.svCanvas.getContext('2d', {alpha: false});\r\n    this.drawSVPicker();\r\n    this.addSVEventListener();\r\n\r\n    // Prepare the canvas and context for the hue picker.\r\n    this.hCanvas = this.parent.querySelector<HTMLCanvasElement>('.tfe-color-picker-h-picker-canvas');\r\n    this.hCanvas.style.background = 'linear-gradient(#f00, #f0f, #00f, #0ff, #0f0, #ff0, #f00)';\r\n\r\n    this.hContext = this.hCanvas.getContext('2d', {alpha: true});\r\n    this.drawHPicker();\r\n    this.addHEventListener();\r\n\r\n    // Get the preview element.\r\n    this.previewElement = this.parent.querySelector<HTMLDivElement>('.tfe-color-preview');\r\n\r\n    // Initialize all input fields.\r\n    this.inputFields = {\r\n      h: new NumberInputField(this.parent.querySelector<HTMLDivElement>('.tfe-color-picker-h-input'), {\r\n        label: 'h: ',\r\n        min: 0,\r\n        max: 360,\r\n        initialValue: this.hsv.h,\r\n      }),\r\n      s: new NumberInputField(this.parent.querySelector<HTMLDivElement>('.tfe-color-picker-s-input'), {\r\n        label: 's: ',\r\n        min: 0,\r\n        max: 100,\r\n        initialValue: this.hsv.s * 100,\r\n      }),\r\n      v: new NumberInputField(this.parent.querySelector<HTMLDivElement>('.tfe-color-picker-v-input'), {\r\n        label: 'v: ',\r\n        min: 0,\r\n        max: 100,\r\n        initialValue: this.hsv.v * 100,\r\n      }),\r\n\r\n      r: new NumberInputField(this.parent.querySelector<HTMLDivElement>('.tfe-color-picker-r-input'), {\r\n        label: 'r: ',\r\n        min: 0,\r\n        max: 255,\r\n        initialValue: this.hsv.rgb().r,\r\n      }),\r\n      g: new NumberInputField(this.parent.querySelector<HTMLDivElement>('.tfe-color-picker-g-input'), {\r\n        label: 'g: ',\r\n        min: 0,\r\n        max: 255,\r\n        initialValue: this.hsv.rgb().g,\r\n      }),\r\n      b: new NumberInputField(this.parent.querySelector<HTMLDivElement>('.tfe-color-picker-b-input'), {\r\n        label: 'b: ',\r\n        min: 0,\r\n        max: 255,\r\n        initialValue: this.hsv.rgb().b,\r\n      }),\r\n\r\n      hex: this.parent.querySelector<HTMLInputElement>('.tfe-color-picker-hex-input'),\r\n    };\r\n    this.addInputEventListeners();\r\n  }\r\n\r\n  /**\r\n   * Register a callback that gets called, when a new color is picked. The callback gets called once immediately.\r\n   *\r\n   * @param callback The function that gets called whenever the color changes.\r\n   */\r\n  public addListener(callback: ColorCallback): number {\r\n    const id = this.callbackCounter++;\r\n    this.callbacks.set(id, callback);\r\n    callback(this);\r\n    return id;\r\n  }\r\n\r\n  /** Removes the listener with the given id. */\r\n  public removeListener(id: number) {\r\n    this.callbacks.delete(id);\r\n  }\r\n\r\n  /**\r\n   * Sets a new color for the color picker in HEX format. Theoretically all valid CSS color strings can be given\r\n   * here, but for consistency with other function names we keep the name as is.\r\n   */\r\n  public setHEX(color: string) {\r\n    this.hsv = hsv(color);\r\n    this.validateHueAndSaturation();\r\n    this.sendUpdate();\r\n    this.updateAll();\r\n  }\r\n\r\n  /** Sets a new color for the color picker in RGB format. The given values must be in the range of 0 - 255. */\r\n  public setRGB(r: number, g: number, b: number) {\r\n    this.hsv = hsv(`rgb(${r},${g},${b})`);\r\n    this.validateHueAndSaturation();\r\n    this.sendUpdate();\r\n    this.updateAll();\r\n  }\r\n\r\n  /** Sets a new color for the color picker in RGB format. The given values must be in the range of 0.0 - 1.0. */\r\n  public setRGBNormalized(r: number, g: number, b: number) {\r\n    this.setRGB(r * 255, g * 255, b * 255);\r\n  }\r\n\r\n  /**\r\n   * Sets a new color for the color picker in HSL format. The given values must be in the range of 0 - 360 for h and\r\n   * 0 - 100 for s and l.\r\n   */\r\n  public setHSL(h: number, s: number, l: number) {\r\n    this.hsv = hsv(`hsl(${h} ${s} ${l})`);\r\n    this.validateHueAndSaturation();\r\n    this.sendUpdate();\r\n    this.updateAll();\r\n  }\r\n\r\n  /** Sets a new color for the color picker in HSL format. The given values must be in the range of 0.0 - 1.0. */\r\n  public setHSLNormalized(h: number, s: number, l: number) {\r\n    this.setHSL(h * 360, s * 100, l * 100);\r\n  }\r\n\r\n  /**\r\n   * Sets a new color for the color picker in HSV format. The given values must be in the range of 0 - 360 for h and\r\n   * 0 - 100 for s and v.\r\n   */\r\n  public setHSV(h: number, s: number, v: number) {\r\n    this.hsv = hsv(h, s, v);\r\n    this.validateHueAndSaturation();\r\n    this.sendUpdate();\r\n    this.updateAll();\r\n  }\r\n\r\n  /** Sets a new color for the color picker in HSV format. The given values must be in the range of 0.0 - 1.0. */\r\n  public setHSVNormalized(h: number, s: number, v: number) {\r\n    this.setHSV(h * 360, s * 100, v * 100);\r\n  }\r\n\r\n  /** Returns the currently selected color in HEX format. */\r\n  public getHEX(): string {\r\n    return this.hsv.formatHex();\r\n  }\r\n\r\n  /** Returns the currently selected color on RGB format with values between 0 - 255. */\r\n  public getRGB(): RGB {\r\n    const rgb = this.hsv.rgb();\r\n    return {r: rgb.r, g: rgb.g, b: rgb.b};\r\n  }\r\n\r\n  /** Returns the currently selected color on RGB format with values between 0.0 - 1.0. */\r\n  public getRGBNormalized(): RGB {\r\n    const rgb = this.hsv.rgb();\r\n    return {r: rgb.r / 255, g: rgb.g / 255, b: rgb.b / 255};\r\n  }\r\n\r\n  /** Returns the currently selected color on HSL format with values between 0 - 360 for h and 0 - 100 for s and l. */\r\n  public getHSL(): HSL {\r\n    const hslColor = hsl(this.hsv.formatHsl());\r\n    return {h: hslColor.h, s: hslColor.s * 100, l: hslColor.l * 100};\r\n  }\r\n\r\n  /** Returns the currently selected color on HSL format with values between 0.0 - 1.0. */\r\n  public getHSLNormalized(): HSL {\r\n    const hslColor = hsl(this.hsv.formatHsl());\r\n    return {h: hslColor.h / 360, s: hslColor.s, l: hslColor.l};\r\n  }\r\n\r\n  /** Returns the currently selected color on HSV format with values between 0 - 360 for h and 0 - 100 for s and v. */\r\n  public getHSV(): HSV {\r\n    return {h: this.hsv.h, s: this.hsv.s * 100, v: this.hsv.v * 100};\r\n  }\r\n\r\n  /** Returns the currently selected color on HSV format with values between 0.0 - 1.0. */\r\n  public getHSVNormalized(): HSV {\r\n    return {h: this.hsv.h / 360, s: this.hsv.s, v: this.hsv.v};\r\n  }\r\n\r\n  /**\r\n   * Returns a collection of all different color representations of the currently selected color. RGB values are in the\r\n   * range 0 - 255, hue is in the range 0 - 360, saturation, value and lightness are in the range 0 - 100.\r\n   */\r\n  public getColor(): Color {\r\n    const rgb = this.getRGB();\r\n    const hsl = this.getHSL();\r\n    const hsv = this.getHSV();\r\n    const hex = this.getHEX();\r\n    return {rgb, hsl, hsv, hex};\r\n  }\r\n\r\n  /**\r\n   * Returns a collection of all different color representations of the currently selected color. All numerical values\r\n   * are in the range 0.0 - 1.0.\r\n   */\r\n  public getColorNormalized(): Color {\r\n    const rgb = this.getRGBNormalized();\r\n    const hsl = this.getHSLNormalized();\r\n    const hsv = this.getHSVNormalized();\r\n    const hex = this.getHEX();\r\n    return {rgb, hsl, hsv, hex};\r\n  }\r\n\r\n  /**\r\n   * This function should be called everytime the color changes. It triggers the callback and sets the color of the\r\n   * preview element.\r\n   */\r\n  private sendUpdate() {\r\n    this.previewElement.style.backgroundColor = this.getHEX();\r\n    this.callbacks.forEach((callback) => {\r\n      callback(this);\r\n    });\r\n  }\r\n\r\n  /** Draws the canvases and updates the input fields. */\r\n  private updateAll() {\r\n    this.drawAll();\r\n    this.updateInputFields();\r\n  }\r\n\r\n  /** Draws the saturation-value picker and the hue picker. */\r\n  private drawAll() {\r\n    this.drawHPicker();\r\n    this.drawSVPicker();\r\n  }\r\n\r\n  /** Draws the saturation-value picker. */\r\n  private drawSVPicker() {\r\n    // We draw the saturation value picker in three steps:\r\n\r\n    // 1. Draw the current hue with full saturation and value as the backgrund color.\r\n    this.svContext.fillStyle = hsv(this.hsv.h, 1, 1).formatHex();\r\n    this.svContext.fillRect(0, 0, this.CANVAS_SIZE, this.CANVAS_SIZE);\r\n\r\n    // 2. Draw a white to transparent gradient for the saturation from left to right.\r\n    const saturationGradient = this.svContext.createLinearGradient(\r\n      0,\r\n      this.CANVAS_SIZE / 2,\r\n      this.CANVAS_SIZE,\r\n      this.CANVAS_SIZE / 2\r\n    );\r\n    saturationGradient.addColorStop(0, 'rgb(255, 255, 255)');\r\n    saturationGradient.addColorStop(1, 'rgb(255, 255, 255, 0)');\r\n    this.svContext.fillStyle = saturationGradient;\r\n    this.svContext.fillRect(0, 0, this.CANVAS_SIZE, this.CANVAS_SIZE);\r\n\r\n    // 3. Draw a black to transparent gradient for the value from bottom to top.\r\n    const valueGradient = this.svContext.createLinearGradient(\r\n      this.CANVAS_SIZE / 2,\r\n      this.CANVAS_SIZE,\r\n      this.CANVAS_SIZE / 2,\r\n      0\r\n    );\r\n    valueGradient.addColorStop(0, 'rgb(0, 0, 0)');\r\n    valueGradient.addColorStop(1, 'rgb(0, 0, 0, 0)');\r\n    this.svContext.fillStyle = valueGradient;\r\n    this.svContext.fillRect(0, 0, this.CANVAS_SIZE, this.CANVAS_SIZE);\r\n\r\n    // Draw the control point. To ensure visibility everywhere it is an alternating circle in white and black.\r\n    const x = this.hsv.s * this.CANVAS_SIZE;\r\n    const y = (1 - this.hsv.v) * this.CANVAS_SIZE;\r\n    drawControlPoint(this.svContext, x, y, this.controlPointSize);\r\n  }\r\n\r\n  /** Draws the hue picker. */\r\n  private drawHPicker() {\r\n    // Draw the hue gradient.\r\n    this.hContext.clearRect(0, 0, this.hCanvas.width, this.hCanvas.height);\r\n\r\n    // Draw the control point. To ensure visibility everywhere it is an alternating circle in white and black.\r\n    const x = this.hCanvas.width / 2;\r\n    const y = (1 - this.hsv.h / 360) * this.hCanvas.height;\r\n    drawControlPoint(this.hContext, x, y, this.controlPointSize);\r\n  }\r\n\r\n  /** Adds all the mouse input events for moving the control point of the saturation-value picker around. */\r\n  private addSVEventListener() {\r\n    let isDragging = false;\r\n    let abortController: AbortController = null;\r\n\r\n    // Gets called when a new value was selected with the mouse.\r\n    const updateSV = (x, y) => {\r\n      // Calculate new values from mouse position.\r\n      this.hsv.s = clamp(x / this.CANVAS_SIZE, 0, 1);\r\n      this.backUpSaturation = this.hsv.s;\r\n      this.hsv.v = clamp(1 - y / this.CANVAS_SIZE, 0, 1);\r\n\r\n      // Send an update to the user.\r\n      this.sendUpdate();\r\n\r\n      // Update other relevant components.\r\n      this.drawSVPicker();\r\n      this.updateHSVInputFields();\r\n      this.updateRGBInputFields();\r\n      this.updateHEXInputField();\r\n    };\r\n\r\n    // When the left mouse button is pressed we attach a mouse move listener to the document to track the mouse movement\r\n    // even outside the canvas.\r\n    this.svCanvas.addEventListener('mousedown', (e) => {\r\n      if (e.button === 0) {\r\n        abortController = new AbortController();\r\n        document.addEventListener(\r\n          'mousemove',\r\n          (e) => {\r\n            e.preventDefault();\r\n            updateSV(\r\n              e.clientX - this.svCanvas.getBoundingClientRect().x,\r\n              e.clientY - this.svCanvas.getBoundingClientRect().y\r\n            );\r\n          },\r\n          {signal: abortController.signal}\r\n        );\r\n\r\n        isDragging = true;\r\n        updateSV(e.offsetX, e.offsetY);\r\n      }\r\n    });\r\n\r\n    // Stop the drag tracking and remove the move listener from the document.\r\n    document.addEventListener('mouseup', () => {\r\n      if (isDragging && abortController) {\r\n        abortController.abort();\r\n        abortController = null;\r\n        isDragging = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  /** Adds all the mouse input events for moving the control point of the hue picker around. */\r\n  private addHEventListener() {\r\n    let isDragging = false;\r\n    let abortController: AbortController = null;\r\n\r\n    // Gets called when a new value was selected with the mouse.\r\n    const updateH = (y) => {\r\n      // Calculate the new value from the mouse position.\r\n      this.hsv.h = clamp(Math.round((1 - y / this.CANVAS_SIZE) * 360), 0, 360);\r\n      this.backUpHue = this.hsv.h;\r\n\r\n      // Send an update to the user.\r\n      this.sendUpdate();\r\n\r\n      // Update other relevant components.\r\n      this.drawAll();\r\n      this.inputFields.h.setValue(this.hsv.h);\r\n      this.updateRGBInputFields();\r\n      this.updateHEXInputField();\r\n    };\r\n\r\n    // When the left mouse button is pressed we attach a mouse move listener to the document to track the mouse movement\r\n    // even outside the canvas.\r\n    this.hCanvas.addEventListener('mousedown', (e) => {\r\n      abortController = new AbortController();\r\n      document.addEventListener(\r\n        'mousemove',\r\n        (e) => {\r\n          e.preventDefault();\r\n          updateH(e.clientY - this.svCanvas.getBoundingClientRect().y);\r\n        },\r\n        {signal: abortController.signal}\r\n      );\r\n\r\n      isDragging = true;\r\n      updateH(e.offsetY);\r\n    });\r\n\r\n    // Stop the drag tracking and remove the move listener from the document.\r\n    document.addEventListener('mouseup', () => {\r\n      if (isDragging && abortController) {\r\n        abortController.abort();\r\n        abortController = null;\r\n        isDragging = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  /** Adds all the listeners to the text input fields. It also adds validation, so the values are always valid. */\r\n  private addInputEventListeners() {\r\n    this.setupNumberInputListeners();\r\n    this.setupHEXListeners();\r\n  }\r\n\r\n  /** Sets up all listeners for the HSV and RGB input fields. */\r\n  private setupNumberInputListeners() {\r\n    // Serves to prevent cyclic updates.\r\n    let updateInProgress = false;\r\n\r\n    const onHSVUpdate = () => {\r\n      if (!updateInProgress) {\r\n        updateInProgress = true;\r\n        this.sendUpdate();\r\n        this.drawAll();\r\n        this.updateRGBInputFields();\r\n        this.updateHEXInputField();\r\n        updateInProgress = false;\r\n      }\r\n    };\r\n\r\n    const onRGBUpdate = (r, g, b) => {\r\n      if (!updateInProgress) {\r\n        updateInProgress = true;\r\n        this.hsv = hsv(`rgb(${Math.round(r)},${Math.round(g)},${Math.round(b)})`);\r\n        this.validateHueAndSaturation();\r\n        this.sendUpdate();\r\n        this.drawAll();\r\n        this.updateHSVInputFields();\r\n        this.updateHEXInputField();\r\n        updateInProgress = false;\r\n      }\r\n    };\r\n\r\n    // hsv\r\n\r\n    this.inputFields.h.addListener((value) => {\r\n      if (value !== this.hsv.h) {\r\n        this.hsv.h = value;\r\n        this.backUpHue = value;\r\n        onHSVUpdate();\r\n      }\r\n    });\r\n\r\n    this.inputFields.s.addListener((value) => {\r\n      if (value !== this.hsv.s) {\r\n        this.hsv.s = value / 100;\r\n        this.backUpSaturation = this.hsv.s;\r\n        onHSVUpdate();\r\n      }\r\n    });\r\n\r\n    this.inputFields.v.addListener((value) => {\r\n      if (value !== this.hsv.v) {\r\n        this.hsv.v = value / 100;\r\n        onHSVUpdate();\r\n      }\r\n    });\r\n\r\n    // rgb\r\n\r\n    this.inputFields.r.addListener((value) => {\r\n      const oldRGB = this.hsv.rgb();\r\n      if (value !== oldRGB.r) {\r\n        onRGBUpdate(value, oldRGB.g, oldRGB.b);\r\n      }\r\n    });\r\n\r\n    this.inputFields.g.addListener((value) => {\r\n      const oldRGB = this.hsv.rgb();\r\n      if (value !== oldRGB.g) {\r\n        onRGBUpdate(oldRGB.r, value, oldRGB.b);\r\n      }\r\n    });\r\n\r\n    this.inputFields.b.addListener((value) => {\r\n      const oldRGB = this.hsv.rgb();\r\n      if (value !== oldRGB.b) {\r\n        onRGBUpdate(oldRGB.r, oldRGB.g, value);\r\n      }\r\n    });\r\n  }\r\n\r\n  /** Sets up all listeners for the HEX input field. */\r\n  private setupHEXListeners() {\r\n    this.inputFields.hex.addEventListener('input', (ev: InputEvent) => {\r\n      const element = ev.currentTarget as HTMLInputElement;\r\n      const value = element.value;\r\n      if (value.match(/#([0-7a-fA-F]{3}$|[0-7a-fA-F]{6}$)/)) {\r\n        this.hsv = hsv(value);\r\n        this.validateHueAndSaturation();\r\n        this.sendUpdate();\r\n        this.drawAll();\r\n        this.updateRGBInputFields();\r\n        this.updateHSVInputFields();\r\n        element.classList.remove('tfe-color-picker-input-hex-invalid');\r\n      } else {\r\n        element.classList.add('tfe-color-picker-input-hex-invalid');\r\n      }\r\n    });\r\n\r\n    this.inputFields.hex.addEventListener('focusout', (ev: InputEvent) => {\r\n      const element = ev.currentTarget as HTMLInputElement;\r\n      const value = element.value;\r\n      if (!value.match(/#([0-7a-fA-F]{3}$|[0-7a-fA-F]{6}$)/)) {\r\n        element.value = this.getHEX();\r\n        element.classList.remove('tfe-color-picker-input-hex-invalid');\r\n      }\r\n    });\r\n  }\r\n\r\n  /** Updates the text in all input fields. */\r\n  private updateInputFields() {\r\n    this.updateHSVInputFields();\r\n    this.updateRGBInputFields();\r\n    this.updateHEXInputField();\r\n  }\r\n\r\n  /** Updates the text inside the hsv input fields. */\r\n  private updateHSVInputFields() {\r\n    this.inputFields.h.setValue(this.hsv.h, false);\r\n    this.inputFields.s.setValue(this.hsv.s * 100, false);\r\n    this.inputFields.v.setValue(this.hsv.v * 100, false);\r\n  }\r\n\r\n  /** Updates the text inside the rgb input fields. */\r\n  private updateRGBInputFields() {\r\n    const rgb = this.hsv.rgb();\r\n    this.inputFields.r.setValue(rgb.r, false);\r\n    this.inputFields.g.setValue(rgb.g, false);\r\n    this.inputFields.b.setValue(rgb.b, false);\r\n  }\r\n\r\n  /** Updates the text inside the hex input field. */\r\n  private updateHEXInputField() {\r\n    this.inputFields.hex.value = this.getHEX();\r\n  }\r\n\r\n  /**\r\n   * Some colors have arbitrary hue or saturation values. We would like to show the last valid value in that case. This\r\n   * function ensures that this always is true. It must be called everytime the hsv field is updated.\r\n   */\r\n  private validateHueAndSaturation() {\r\n    if (Number.isNaN(this.hsv.h)) {\r\n      this.hsv.h = this.backUpHue;\r\n    } else {\r\n      this.backUpHue = this.hsv.h;\r\n    }\r\n\r\n    if (Number.isNaN(this.hsv.s)) {\r\n      this.hsv.s = this.backUpSaturation;\r\n    } else {\r\n      this.backUpSaturation = this.hsv.s;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * The config options for the {@link ColorPicker} component.\r\n */\r\nexport interface ColorPickerOptions {\r\n  /**\r\n   * The initially selected color.\r\n   * Default: '#FFF'\r\n   */\r\n  initialColor?: string;\r\n}\r\n\r\n/** Simple utility to clamp a number between two values. */\r\nfunction clamp(number, min, max): number {\r\n  return Math.max(min, Math.min(max, number));\r\n}\r\n\r\ninterface RGB {\r\n  r: number;\r\n  g: number;\r\n  b: number;\r\n}\r\n\r\ninterface HSL {\r\n  h: number;\r\n  s: number;\r\n  l: number;\r\n}\r\n\r\ninterface HSV {\r\n  h: number;\r\n  s: number;\r\n  v: number;\r\n}\r\n\r\ninterface Color {\r\n  rgb: RGB;\r\n  hsl: HSL;\r\n  hsv: HSV;\r\n  hex: string;\r\n}\r\n\r\ntype ColorCallback = (colorPicker: ColorPicker) => void;\r\n\r\n// Add a stylesheet to the header, that contains the base layout of the color picker.\r\nif (document.head.querySelector('#tfe-color-picker-style') === null) {\r\n  document.head.insertAdjacentHTML(\r\n    'beforeend',\r\n    `\r\n    <style id=\"tfe-color-picker-style\">\r\n      .tfe-color-picker-root {\r\n        display: flex;\r\n        justify-content: center;\r\n      }\r\n    \r\n      .tfe-color-picker-sl-picker {\r\n        border: 1px solid grey;\r\n      }\r\n    \r\n      .tfe-color-picker-h-picker {\r\n        width: 18px;\r\n        margin-left: 12px;\r\n        border: 1px solid grey;\r\n      }\r\n    \r\n      .tfe-color-picker-input-root {\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: flex-end;\r\n        justify-content: space-between;\r\n        align-content: space-evenly;\r\n        margin-left: 12px;\r\n        margin-bottom: 0;\r\n      }\r\n    \r\n      .tfe-color-preview {\r\n        height: 50px;\r\n        width: 100%;\r\n        border: 1px solid grey;\r\n        border-radius: 25px;\r\n      }\r\n    \r\n      .tfe-color-picker-input-root > label {\r\n        text-align: right;\r\n      }\r\n    \r\n      .tfe-color-picker-input-root input {\r\n        width: 60px;\r\n        text-align: right;\r\n        font-family: monospace;\r\n      }\r\n    \r\n      .tfe-color-picker-input-hex-invalid:focus-visible {\r\n        outline-color: red;\r\n      }\r\n    </style>`\r\n  );\r\n}\r\n","'use strict';\n\nvar isMergeableObject = function isMergeableObject(value) {\n\treturn isNonNullObject(value)\n\t\t&& !isSpecial(value)\n};\n\nfunction isNonNullObject(value) {\n\treturn !!value && typeof value === 'object'\n}\n\nfunction isSpecial(value) {\n\tvar stringValue = Object.prototype.toString.call(value);\n\n\treturn stringValue === '[object RegExp]'\n\t\t|| stringValue === '[object Date]'\n\t\t|| isReactElement(value)\n}\n\n// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25\nvar canUseSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;\n\nfunction isReactElement(value) {\n\treturn value.$$typeof === REACT_ELEMENT_TYPE\n}\n\nfunction emptyTarget(val) {\n\treturn Array.isArray(val) ? [] : {}\n}\n\nfunction cloneUnlessOtherwiseSpecified(value, options) {\n\treturn (options.clone !== false && options.isMergeableObject(value))\n\t\t? deepmerge(emptyTarget(value), value, options)\n\t\t: value\n}\n\nfunction defaultArrayMerge(target, source, options) {\n\treturn target.concat(source).map(function(element) {\n\t\treturn cloneUnlessOtherwiseSpecified(element, options)\n\t})\n}\n\nfunction getMergeFunction(key, options) {\n\tif (!options.customMerge) {\n\t\treturn deepmerge\n\t}\n\tvar customMerge = options.customMerge(key);\n\treturn typeof customMerge === 'function' ? customMerge : deepmerge\n}\n\nfunction getEnumerableOwnPropertySymbols(target) {\n\treturn Object.getOwnPropertySymbols\n\t\t? Object.getOwnPropertySymbols(target).filter(function(symbol) {\n\t\t\treturn Object.propertyIsEnumerable.call(target, symbol)\n\t\t})\n\t\t: []\n}\n\nfunction getKeys(target) {\n\treturn Object.keys(target).concat(getEnumerableOwnPropertySymbols(target))\n}\n\nfunction propertyIsOnObject(object, property) {\n\ttry {\n\t\treturn property in object\n\t} catch(_) {\n\t\treturn false\n\t}\n}\n\n// Protects from prototype poisoning and unexpected merging up the prototype chain.\nfunction propertyIsUnsafe(target, key) {\n\treturn propertyIsOnObject(target, key) // Properties are safe to merge if they don't exist in the target yet,\n\t\t&& !(Object.hasOwnProperty.call(target, key) // unsafe if they exist up the prototype chain,\n\t\t\t&& Object.propertyIsEnumerable.call(target, key)) // and also unsafe if they're nonenumerable.\n}\n\nfunction mergeObject(target, source, options) {\n\tvar destination = {};\n\tif (options.isMergeableObject(target)) {\n\t\tgetKeys(target).forEach(function(key) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(target[key], options);\n\t\t});\n\t}\n\tgetKeys(source).forEach(function(key) {\n\t\tif (propertyIsUnsafe(target, key)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (propertyIsOnObject(target, key) && options.isMergeableObject(source[key])) {\n\t\t\tdestination[key] = getMergeFunction(key, options)(target[key], source[key], options);\n\t\t} else {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(source[key], options);\n\t\t}\n\t});\n\treturn destination\n}\n\nfunction deepmerge(target, source, options) {\n\toptions = options || {};\n\toptions.arrayMerge = options.arrayMerge || defaultArrayMerge;\n\toptions.isMergeableObject = options.isMergeableObject || isMergeableObject;\n\t// cloneUnlessOtherwiseSpecified is added to `options` so that custom arrayMerge()\n\t// implementations can use it. The caller may not replace it.\n\toptions.cloneUnlessOtherwiseSpecified = cloneUnlessOtherwiseSpecified;\n\n\tvar sourceIsArray = Array.isArray(source);\n\tvar targetIsArray = Array.isArray(target);\n\tvar sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;\n\n\tif (!sourceAndTargetTypesMatch) {\n\t\treturn cloneUnlessOtherwiseSpecified(source, options)\n\t} else if (sourceIsArray) {\n\t\treturn options.arrayMerge(target, source, options)\n\t} else {\n\t\treturn mergeObject(target, source, options)\n\t}\n}\n\ndeepmerge.all = function deepmergeAll(array, options) {\n\tif (!Array.isArray(array)) {\n\t\tthrow new Error('first argument should be an array')\n\t}\n\n\treturn array.reduce(function(prev, next) {\n\t\treturn deepmerge(prev, next, options)\n\t}, {})\n};\n\nvar deepmerge_1 = deepmerge;\n\nmodule.exports = deepmerge_1;\n","export default function(a, b) {\n  return a < b ? -1 : a > b ? 1 : a >= b ? 0 : NaN;\n}\n","import ascending from \"./ascending.js\";\n\nexport default function(f) {\n  let delta = f;\n  let compare = f;\n\n  if (f.length === 1) {\n    delta = (d, x) => f(d) - x;\n    compare = ascendingComparator(f);\n  }\n\n  function left(a, x, lo, hi) {\n    if (lo == null) lo = 0;\n    if (hi == null) hi = a.length;\n    while (lo < hi) {\n      const mid = (lo + hi) >>> 1;\n      if (compare(a[mid], x) < 0) lo = mid + 1;\n      else hi = mid;\n    }\n    return lo;\n  }\n\n  function right(a, x, lo, hi) {\n    if (lo == null) lo = 0;\n    if (hi == null) hi = a.length;\n    while (lo < hi) {\n      const mid = (lo + hi) >>> 1;\n      if (compare(a[mid], x) > 0) hi = mid;\n      else lo = mid + 1;\n    }\n    return lo;\n  }\n\n  function center(a, x, lo, hi) {\n    if (lo == null) lo = 0;\n    if (hi == null) hi = a.length;\n    const i = left(a, x, lo, hi - 1);\n    return i > lo && delta(a[i - 1], x) > -delta(a[i], x) ? i - 1 : i;\n  }\n\n  return {left, center, right};\n}\n\nfunction ascendingComparator(f) {\n  return (d, x) => ascending(f(d), x);\n}\n","import ascending from \"./ascending.js\";\nimport bisector from \"./bisector.js\";\nimport number from \"./number.js\";\n\nconst ascendingBisect = bisector(ascending);\nexport const bisectRight = ascendingBisect.right;\nexport const bisectLeft = ascendingBisect.left;\nexport const bisectCenter = bisector(number).center;\nexport default bisectRight;\n","export default function(x) {\n  return x === null ? NaN : +x;\n}\n\nexport function* numbers(values, valueof) {\n  if (valueof === undefined) {\n    for (let value of values) {\n      if (value != null && (value = +value) >= value) {\n        yield value;\n      }\n    }\n  } else {\n    let index = -1;\n    for (let value of values) {\n      if ((value = valueof(value, ++index, values)) != null && (value = +value) >= value) {\n        yield value;\n      }\n    }\n  }\n}\n","var e10 = Math.sqrt(50),\n    e5 = Math.sqrt(10),\n    e2 = Math.sqrt(2);\n\nexport default function(start, stop, count) {\n  var reverse,\n      i = -1,\n      n,\n      ticks,\n      step;\n\n  stop = +stop, start = +start, count = +count;\n  if (start === stop && count > 0) return [start];\n  if (reverse = stop < start) n = start, start = stop, stop = n;\n  if ((step = tickIncrement(start, stop, count)) === 0 || !isFinite(step)) return [];\n\n  if (step > 0) {\n    let r0 = Math.round(start / step), r1 = Math.round(stop / step);\n    if (r0 * step < start) ++r0;\n    if (r1 * step > stop) --r1;\n    ticks = new Array(n = r1 - r0 + 1);\n    while (++i < n) ticks[i] = (r0 + i) * step;\n  } else {\n    step = -step;\n    let r0 = Math.round(start * step), r1 = Math.round(stop * step);\n    if (r0 / step < start) ++r0;\n    if (r1 / step > stop) --r1;\n    ticks = new Array(n = r1 - r0 + 1);\n    while (++i < n) ticks[i] = (r0 + i) / step;\n  }\n\n  if (reverse) ticks.reverse();\n\n  return ticks;\n}\n\nexport function tickIncrement(start, stop, count) {\n  var step = (stop - start) / Math.max(0, count),\n      power = Math.floor(Math.log(step) / Math.LN10),\n      error = step / Math.pow(10, power);\n  return power >= 0\n      ? (error >= e10 ? 10 : error >= e5 ? 5 : error >= e2 ? 2 : 1) * Math.pow(10, power)\n      : -Math.pow(10, -power) / (error >= e10 ? 10 : error >= e5 ? 5 : error >= e2 ? 2 : 1);\n}\n\nexport function tickStep(start, stop, count) {\n  var step0 = Math.abs(stop - start) / Math.max(0, count),\n      step1 = Math.pow(10, Math.floor(Math.log(step0) / Math.LN10)),\n      error = step0 / step1;\n  if (error >= e10) step1 *= 10;\n  else if (error >= e5) step1 *= 5;\n  else if (error >= e2) step1 *= 2;\n  return stop < start ? -step1 : step1;\n}\n","export function initRange(domain, range) {\n  switch (arguments.length) {\n    case 0: break;\n    case 1: this.range(domain); break;\n    default: this.range(range).domain(domain); break;\n  }\n  return this;\n}\n\nexport function initInterpolator(domain, interpolator) {\n  switch (arguments.length) {\n    case 0: break;\n    case 1: {\n      if (typeof domain === \"function\") this.interpolator(domain);\n      else this.range(domain);\n      break;\n    }\n    default: {\n      this.domain(domain);\n      if (typeof interpolator === \"function\") this.interpolator(interpolator);\n      else this.range(interpolator);\n      break;\n    }\n  }\n  return this;\n}\n","export default function(constructor, factory, prototype) {\n  constructor.prototype = factory.prototype = prototype;\n  prototype.constructor = constructor;\n}\n\nexport function extend(parent, definition) {\n  var prototype = Object.create(parent.prototype);\n  for (var key in definition) prototype[key] = definition[key];\n  return prototype;\n}\n","import define, {extend} from \"./define.js\";\n\nexport function Color() {}\n\nexport var darker = 0.7;\nexport var brighter = 1 / darker;\n\nvar reI = \"\\\\s*([+-]?\\\\d+)\\\\s*\",\n    reN = \"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)\\\\s*\",\n    reP = \"\\\\s*([+-]?\\\\d*\\\\.?\\\\d+(?:[eE][+-]?\\\\d+)?)%\\\\s*\",\n    reHex = /^#([0-9a-f]{3,8})$/,\n    reRgbInteger = new RegExp(\"^rgb\\\\(\" + [reI, reI, reI] + \"\\\\)$\"),\n    reRgbPercent = new RegExp(\"^rgb\\\\(\" + [reP, reP, reP] + \"\\\\)$\"),\n    reRgbaInteger = new RegExp(\"^rgba\\\\(\" + [reI, reI, reI, reN] + \"\\\\)$\"),\n    reRgbaPercent = new RegExp(\"^rgba\\\\(\" + [reP, reP, reP, reN] + \"\\\\)$\"),\n    reHslPercent = new RegExp(\"^hsl\\\\(\" + [reN, reP, reP] + \"\\\\)$\"),\n    reHslaPercent = new RegExp(\"^hsla\\\\(\" + [reN, reP, reP, reN] + \"\\\\)$\");\n\nvar named = {\n  aliceblue: 0xf0f8ff,\n  antiquewhite: 0xfaebd7,\n  aqua: 0x00ffff,\n  aquamarine: 0x7fffd4,\n  azure: 0xf0ffff,\n  beige: 0xf5f5dc,\n  bisque: 0xffe4c4,\n  black: 0x000000,\n  blanchedalmond: 0xffebcd,\n  blue: 0x0000ff,\n  blueviolet: 0x8a2be2,\n  brown: 0xa52a2a,\n  burlywood: 0xdeb887,\n  cadetblue: 0x5f9ea0,\n  chartreuse: 0x7fff00,\n  chocolate: 0xd2691e,\n  coral: 0xff7f50,\n  cornflowerblue: 0x6495ed,\n  cornsilk: 0xfff8dc,\n  crimson: 0xdc143c,\n  cyan: 0x00ffff,\n  darkblue: 0x00008b,\n  darkcyan: 0x008b8b,\n  darkgoldenrod: 0xb8860b,\n  darkgray: 0xa9a9a9,\n  darkgreen: 0x006400,\n  darkgrey: 0xa9a9a9,\n  darkkhaki: 0xbdb76b,\n  darkmagenta: 0x8b008b,\n  darkolivegreen: 0x556b2f,\n  darkorange: 0xff8c00,\n  darkorchid: 0x9932cc,\n  darkred: 0x8b0000,\n  darksalmon: 0xe9967a,\n  darkseagreen: 0x8fbc8f,\n  darkslateblue: 0x483d8b,\n  darkslategray: 0x2f4f4f,\n  darkslategrey: 0x2f4f4f,\n  darkturquoise: 0x00ced1,\n  darkviolet: 0x9400d3,\n  deeppink: 0xff1493,\n  deepskyblue: 0x00bfff,\n  dimgray: 0x696969,\n  dimgrey: 0x696969,\n  dodgerblue: 0x1e90ff,\n  firebrick: 0xb22222,\n  floralwhite: 0xfffaf0,\n  forestgreen: 0x228b22,\n  fuchsia: 0xff00ff,\n  gainsboro: 0xdcdcdc,\n  ghostwhite: 0xf8f8ff,\n  gold: 0xffd700,\n  goldenrod: 0xdaa520,\n  gray: 0x808080,\n  green: 0x008000,\n  greenyellow: 0xadff2f,\n  grey: 0x808080,\n  honeydew: 0xf0fff0,\n  hotpink: 0xff69b4,\n  indianred: 0xcd5c5c,\n  indigo: 0x4b0082,\n  ivory: 0xfffff0,\n  khaki: 0xf0e68c,\n  lavender: 0xe6e6fa,\n  lavenderblush: 0xfff0f5,\n  lawngreen: 0x7cfc00,\n  lemonchiffon: 0xfffacd,\n  lightblue: 0xadd8e6,\n  lightcoral: 0xf08080,\n  lightcyan: 0xe0ffff,\n  lightgoldenrodyellow: 0xfafad2,\n  lightgray: 0xd3d3d3,\n  lightgreen: 0x90ee90,\n  lightgrey: 0xd3d3d3,\n  lightpink: 0xffb6c1,\n  lightsalmon: 0xffa07a,\n  lightseagreen: 0x20b2aa,\n  lightskyblue: 0x87cefa,\n  lightslategray: 0x778899,\n  lightslategrey: 0x778899,\n  lightsteelblue: 0xb0c4de,\n  lightyellow: 0xffffe0,\n  lime: 0x00ff00,\n  limegreen: 0x32cd32,\n  linen: 0xfaf0e6,\n  magenta: 0xff00ff,\n  maroon: 0x800000,\n  mediumaquamarine: 0x66cdaa,\n  mediumblue: 0x0000cd,\n  mediumorchid: 0xba55d3,\n  mediumpurple: 0x9370db,\n  mediumseagreen: 0x3cb371,\n  mediumslateblue: 0x7b68ee,\n  mediumspringgreen: 0x00fa9a,\n  mediumturquoise: 0x48d1cc,\n  mediumvioletred: 0xc71585,\n  midnightblue: 0x191970,\n  mintcream: 0xf5fffa,\n  mistyrose: 0xffe4e1,\n  moccasin: 0xffe4b5,\n  navajowhite: 0xffdead,\n  navy: 0x000080,\n  oldlace: 0xfdf5e6,\n  olive: 0x808000,\n  olivedrab: 0x6b8e23,\n  orange: 0xffa500,\n  orangered: 0xff4500,\n  orchid: 0xda70d6,\n  palegoldenrod: 0xeee8aa,\n  palegreen: 0x98fb98,\n  paleturquoise: 0xafeeee,\n  palevioletred: 0xdb7093,\n  papayawhip: 0xffefd5,\n  peachpuff: 0xffdab9,\n  peru: 0xcd853f,\n  pink: 0xffc0cb,\n  plum: 0xdda0dd,\n  powderblue: 0xb0e0e6,\n  purple: 0x800080,\n  rebeccapurple: 0x663399,\n  red: 0xff0000,\n  rosybrown: 0xbc8f8f,\n  royalblue: 0x4169e1,\n  saddlebrown: 0x8b4513,\n  salmon: 0xfa8072,\n  sandybrown: 0xf4a460,\n  seagreen: 0x2e8b57,\n  seashell: 0xfff5ee,\n  sienna: 0xa0522d,\n  silver: 0xc0c0c0,\n  skyblue: 0x87ceeb,\n  slateblue: 0x6a5acd,\n  slategray: 0x708090,\n  slategrey: 0x708090,\n  snow: 0xfffafa,\n  springgreen: 0x00ff7f,\n  steelblue: 0x4682b4,\n  tan: 0xd2b48c,\n  teal: 0x008080,\n  thistle: 0xd8bfd8,\n  tomato: 0xff6347,\n  turquoise: 0x40e0d0,\n  violet: 0xee82ee,\n  wheat: 0xf5deb3,\n  white: 0xffffff,\n  whitesmoke: 0xf5f5f5,\n  yellow: 0xffff00,\n  yellowgreen: 0x9acd32\n};\n\ndefine(Color, color, {\n  copy: function(channels) {\n    return Object.assign(new this.constructor, this, channels);\n  },\n  displayable: function() {\n    return this.rgb().displayable();\n  },\n  hex: color_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: color_formatHex,\n  formatHsl: color_formatHsl,\n  formatRgb: color_formatRgb,\n  toString: color_formatRgb\n});\n\nfunction color_formatHex() {\n  return this.rgb().formatHex();\n}\n\nfunction color_formatHsl() {\n  return hslConvert(this).formatHsl();\n}\n\nfunction color_formatRgb() {\n  return this.rgb().formatRgb();\n}\n\nexport default function color(format) {\n  var m, l;\n  format = (format + \"\").trim().toLowerCase();\n  return (m = reHex.exec(format)) ? (l = m[1].length, m = parseInt(m[1], 16), l === 6 ? rgbn(m) // #ff0000\n      : l === 3 ? new Rgb((m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), ((m & 0xf) << 4) | (m & 0xf), 1) // #f00\n      : l === 8 ? rgba(m >> 24 & 0xff, m >> 16 & 0xff, m >> 8 & 0xff, (m & 0xff) / 0xff) // #ff000000\n      : l === 4 ? rgba((m >> 12 & 0xf) | (m >> 8 & 0xf0), (m >> 8 & 0xf) | (m >> 4 & 0xf0), (m >> 4 & 0xf) | (m & 0xf0), (((m & 0xf) << 4) | (m & 0xf)) / 0xff) // #f000\n      : null) // invalid hex\n      : (m = reRgbInteger.exec(format)) ? new Rgb(m[1], m[2], m[3], 1) // rgb(255, 0, 0)\n      : (m = reRgbPercent.exec(format)) ? new Rgb(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, 1) // rgb(100%, 0%, 0%)\n      : (m = reRgbaInteger.exec(format)) ? rgba(m[1], m[2], m[3], m[4]) // rgba(255, 0, 0, 1)\n      : (m = reRgbaPercent.exec(format)) ? rgba(m[1] * 255 / 100, m[2] * 255 / 100, m[3] * 255 / 100, m[4]) // rgb(100%, 0%, 0%, 1)\n      : (m = reHslPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, 1) // hsl(120, 50%, 50%)\n      : (m = reHslaPercent.exec(format)) ? hsla(m[1], m[2] / 100, m[3] / 100, m[4]) // hsla(120, 50%, 50%, 1)\n      : named.hasOwnProperty(format) ? rgbn(named[format]) // eslint-disable-line no-prototype-builtins\n      : format === \"transparent\" ? new Rgb(NaN, NaN, NaN, 0)\n      : null;\n}\n\nfunction rgbn(n) {\n  return new Rgb(n >> 16 & 0xff, n >> 8 & 0xff, n & 0xff, 1);\n}\n\nfunction rgba(r, g, b, a) {\n  if (a <= 0) r = g = b = NaN;\n  return new Rgb(r, g, b, a);\n}\n\nexport function rgbConvert(o) {\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Rgb;\n  o = o.rgb();\n  return new Rgb(o.r, o.g, o.b, o.opacity);\n}\n\nexport function rgb(r, g, b, opacity) {\n  return arguments.length === 1 ? rgbConvert(r) : new Rgb(r, g, b, opacity == null ? 1 : opacity);\n}\n\nexport function Rgb(r, g, b, opacity) {\n  this.r = +r;\n  this.g = +g;\n  this.b = +b;\n  this.opacity = +opacity;\n}\n\ndefine(Rgb, rgb, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Rgb(this.r * k, this.g * k, this.b * k, this.opacity);\n  },\n  rgb: function() {\n    return this;\n  },\n  displayable: function() {\n    return (-0.5 <= this.r && this.r < 255.5)\n        && (-0.5 <= this.g && this.g < 255.5)\n        && (-0.5 <= this.b && this.b < 255.5)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  hex: rgb_formatHex, // Deprecated! Use color.formatHex.\n  formatHex: rgb_formatHex,\n  formatRgb: rgb_formatRgb,\n  toString: rgb_formatRgb\n}));\n\nfunction rgb_formatHex() {\n  return \"#\" + hex(this.r) + hex(this.g) + hex(this.b);\n}\n\nfunction rgb_formatRgb() {\n  var a = this.opacity; a = isNaN(a) ? 1 : Math.max(0, Math.min(1, a));\n  return (a === 1 ? \"rgb(\" : \"rgba(\")\n      + Math.max(0, Math.min(255, Math.round(this.r) || 0)) + \", \"\n      + Math.max(0, Math.min(255, Math.round(this.g) || 0)) + \", \"\n      + Math.max(0, Math.min(255, Math.round(this.b) || 0))\n      + (a === 1 ? \")\" : \", \" + a + \")\");\n}\n\nfunction hex(value) {\n  value = Math.max(0, Math.min(255, Math.round(value) || 0));\n  return (value < 16 ? \"0\" : \"\") + value.toString(16);\n}\n\nfunction hsla(h, s, l, a) {\n  if (a <= 0) h = s = l = NaN;\n  else if (l <= 0 || l >= 1) h = s = NaN;\n  else if (s <= 0) h = NaN;\n  return new Hsl(h, s, l, a);\n}\n\nexport function hslConvert(o) {\n  if (o instanceof Hsl) return new Hsl(o.h, o.s, o.l, o.opacity);\n  if (!(o instanceof Color)) o = color(o);\n  if (!o) return new Hsl;\n  if (o instanceof Hsl) return o;\n  o = o.rgb();\n  var r = o.r / 255,\n      g = o.g / 255,\n      b = o.b / 255,\n      min = Math.min(r, g, b),\n      max = Math.max(r, g, b),\n      h = NaN,\n      s = max - min,\n      l = (max + min) / 2;\n  if (s) {\n    if (r === max) h = (g - b) / s + (g < b) * 6;\n    else if (g === max) h = (b - r) / s + 2;\n    else h = (r - g) / s + 4;\n    s /= l < 0.5 ? max + min : 2 - max - min;\n    h *= 60;\n  } else {\n    s = l > 0 && l < 1 ? 0 : h;\n  }\n  return new Hsl(h, s, l, o.opacity);\n}\n\nexport function hsl(h, s, l, opacity) {\n  return arguments.length === 1 ? hslConvert(h) : new Hsl(h, s, l, opacity == null ? 1 : opacity);\n}\n\nfunction Hsl(h, s, l, opacity) {\n  this.h = +h;\n  this.s = +s;\n  this.l = +l;\n  this.opacity = +opacity;\n}\n\ndefine(Hsl, hsl, extend(Color, {\n  brighter: function(k) {\n    k = k == null ? brighter : Math.pow(brighter, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  darker: function(k) {\n    k = k == null ? darker : Math.pow(darker, k);\n    return new Hsl(this.h, this.s, this.l * k, this.opacity);\n  },\n  rgb: function() {\n    var h = this.h % 360 + (this.h < 0) * 360,\n        s = isNaN(h) || isNaN(this.s) ? 0 : this.s,\n        l = this.l,\n        m2 = l + (l < 0.5 ? l : 1 - l) * s,\n        m1 = 2 * l - m2;\n    return new Rgb(\n      hsl2rgb(h >= 240 ? h - 240 : h + 120, m1, m2),\n      hsl2rgb(h, m1, m2),\n      hsl2rgb(h < 120 ? h + 240 : h - 120, m1, m2),\n      this.opacity\n    );\n  },\n  displayable: function() {\n    return (0 <= this.s && this.s <= 1 || isNaN(this.s))\n        && (0 <= this.l && this.l <= 1)\n        && (0 <= this.opacity && this.opacity <= 1);\n  },\n  formatHsl: function() {\n    var a = this.opacity; a = isNaN(a) ? 1 : Math.max(0, Math.min(1, a));\n    return (a === 1 ? \"hsl(\" : \"hsla(\")\n        + (this.h || 0) + \", \"\n        + (this.s || 0) * 100 + \"%, \"\n        + (this.l || 0) * 100 + \"%\"\n        + (a === 1 ? \")\" : \", \" + a + \")\");\n  }\n}));\n\n/* From FvD 13.37, CSS Color Module Level 3 */\nfunction hsl2rgb(h, m1, m2) {\n  return (h < 60 ? m1 + (m2 - m1) * h / 60\n      : h < 180 ? m2\n      : h < 240 ? m1 + (m2 - m1) * (240 - h) / 60\n      : m1) * 255;\n}\n","export default x => () => x;\n","import constant from \"./constant.js\";\n\nfunction linear(a, d) {\n  return function(t) {\n    return a + t * d;\n  };\n}\n\nfunction exponential(a, b, y) {\n  return a = Math.pow(a, y), b = Math.pow(b, y) - a, y = 1 / y, function(t) {\n    return Math.pow(a + t * b, y);\n  };\n}\n\nexport function hue(a, b) {\n  var d = b - a;\n  return d ? linear(a, d > 180 || d < -180 ? d - 360 * Math.round(d / 360) : d) : constant(isNaN(a) ? b : a);\n}\n\nexport function gamma(y) {\n  return (y = +y) === 1 ? nogamma : function(a, b) {\n    return b - a ? exponential(a, b, y) : constant(isNaN(a) ? b : a);\n  };\n}\n\nexport default function nogamma(a, b) {\n  var d = b - a;\n  return d ? linear(a, d) : constant(isNaN(a) ? b : a);\n}\n","import {rgb as colorRgb} from \"d3-color\";\nimport basis from \"./basis.js\";\nimport basisClosed from \"./basisClosed.js\";\nimport nogamma, {gamma} from \"./color.js\";\n\nexport default (function rgbGamma(y) {\n  var color = gamma(y);\n\n  function rgb(start, end) {\n    var r = color((start = colorRgb(start)).r, (end = colorRgb(end)).r),\n        g = color(start.g, end.g),\n        b = color(start.b, end.b),\n        opacity = nogamma(start.opacity, end.opacity);\n    return function(t) {\n      start.r = r(t);\n      start.g = g(t);\n      start.b = b(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n\n  rgb.gamma = rgbGamma;\n\n  return rgb;\n})(1);\n\nfunction rgbSpline(spline) {\n  return function(colors) {\n    var n = colors.length,\n        r = new Array(n),\n        g = new Array(n),\n        b = new Array(n),\n        i, color;\n    for (i = 0; i < n; ++i) {\n      color = colorRgb(colors[i]);\n      r[i] = color.r || 0;\n      g[i] = color.g || 0;\n      b[i] = color.b || 0;\n    }\n    r = spline(r);\n    g = spline(g);\n    b = spline(b);\n    color.opacity = 1;\n    return function(t) {\n      color.r = r(t);\n      color.g = g(t);\n      color.b = b(t);\n      return color + \"\";\n    };\n  };\n}\n\nexport var rgbBasis = rgbSpline(basis);\nexport var rgbBasisClosed = rgbSpline(basisClosed);\n","export default function(a, b) {\n  if (!b) b = [];\n  var n = a ? Math.min(b.length, a.length) : 0,\n      c = b.slice(),\n      i;\n  return function(t) {\n    for (i = 0; i < n; ++i) c[i] = a[i] * (1 - t) + b[i] * t;\n    return c;\n  };\n}\n\nexport function isNumberArray(x) {\n  return ArrayBuffer.isView(x) && !(x instanceof DataView);\n}\n","import value from \"./value.js\";\nimport numberArray, {isNumberArray} from \"./numberArray.js\";\n\nexport default function(a, b) {\n  return (isNumberArray(b) ? numberArray : genericArray)(a, b);\n}\n\nexport function genericArray(a, b) {\n  var nb = b ? b.length : 0,\n      na = a ? Math.min(nb, a.length) : 0,\n      x = new Array(na),\n      c = new Array(nb),\n      i;\n\n  for (i = 0; i < na; ++i) x[i] = value(a[i], b[i]);\n  for (; i < nb; ++i) c[i] = b[i];\n\n  return function(t) {\n    for (i = 0; i < na; ++i) c[i] = x[i](t);\n    return c;\n  };\n}\n","export default function(a, b) {\n  var d = new Date;\n  return a = +a, b = +b, function(t) {\n    return d.setTime(a * (1 - t) + b * t), d;\n  };\n}\n","export default function(a, b) {\n  return a = +a, b = +b, function(t) {\n    return a * (1 - t) + b * t;\n  };\n}\n","import value from \"./value.js\";\n\nexport default function(a, b) {\n  var i = {},\n      c = {},\n      k;\n\n  if (a === null || typeof a !== \"object\") a = {};\n  if (b === null || typeof b !== \"object\") b = {};\n\n  for (k in b) {\n    if (k in a) {\n      i[k] = value(a[k], b[k]);\n    } else {\n      c[k] = b[k];\n    }\n  }\n\n  return function(t) {\n    for (k in i) c[k] = i[k](t);\n    return c;\n  };\n}\n","import number from \"./number.js\";\n\nvar reA = /[-+]?(?:\\d+\\.?\\d*|\\.?\\d+)(?:[eE][-+]?\\d+)?/g,\n    reB = new RegExp(reA.source, \"g\");\n\nfunction zero(b) {\n  return function() {\n    return b;\n  };\n}\n\nfunction one(b) {\n  return function(t) {\n    return b(t) + \"\";\n  };\n}\n\nexport default function(a, b) {\n  var bi = reA.lastIndex = reB.lastIndex = 0, // scan index for next number in b\n      am, // current match in a\n      bm, // current match in b\n      bs, // string preceding current number in b, if any\n      i = -1, // index in s\n      s = [], // string constants and placeholders\n      q = []; // number interpolators\n\n  // Coerce inputs to strings.\n  a = a + \"\", b = b + \"\";\n\n  // Interpolate pairs of numbers in a & b.\n  while ((am = reA.exec(a))\n      && (bm = reB.exec(b))) {\n    if ((bs = bm.index) > bi) { // a string precedes the next number in b\n      bs = b.slice(bi, bs);\n      if (s[i]) s[i] += bs; // coalesce with previous string\n      else s[++i] = bs;\n    }\n    if ((am = am[0]) === (bm = bm[0])) { // numbers in a & b match\n      if (s[i]) s[i] += bm; // coalesce with previous string\n      else s[++i] = bm;\n    } else { // interpolate non-matching numbers\n      s[++i] = null;\n      q.push({i: i, x: number(am, bm)});\n    }\n    bi = reB.lastIndex;\n  }\n\n  // Add remains of b.\n  if (bi < b.length) {\n    bs = b.slice(bi);\n    if (s[i]) s[i] += bs; // coalesce with previous string\n    else s[++i] = bs;\n  }\n\n  // Special optimization for only a single match.\n  // Otherwise, interpolate each of the numbers and rejoin the string.\n  return s.length < 2 ? (q[0]\n      ? one(q[0].x)\n      : zero(b))\n      : (b = q.length, function(t) {\n          for (var i = 0, o; i < b; ++i) s[(o = q[i]).i] = o.x(t);\n          return s.join(\"\");\n        });\n}\n","import {color} from \"d3-color\";\nimport rgb from \"./rgb.js\";\nimport {genericArray} from \"./array.js\";\nimport date from \"./date.js\";\nimport number from \"./number.js\";\nimport object from \"./object.js\";\nimport string from \"./string.js\";\nimport constant from \"./constant.js\";\nimport numberArray, {isNumberArray} from \"./numberArray.js\";\n\nexport default function(a, b) {\n  var t = typeof b, c;\n  return b == null || t === \"boolean\" ? constant(b)\n      : (t === \"number\" ? number\n      : t === \"string\" ? ((c = color(b)) ? (b = c, rgb) : string)\n      : b instanceof color ? rgb\n      : b instanceof Date ? date\n      : isNumberArray(b) ? numberArray\n      : Array.isArray(b) ? genericArray\n      : typeof b.valueOf !== \"function\" && typeof b.toString !== \"function\" || isNaN(b) ? object\n      : number)(a, b);\n}\n","export default function(a, b) {\n  return a = +a, b = +b, function(t) {\n    return Math.round(a * (1 - t) + b * t);\n  };\n}\n","export default function number(x) {\n  return +x;\n}\n","import {bisect} from \"d3-array\";\nimport {interpolate as interpolateValue, interpolateNumber, interpolateRound} from \"d3-interpolate\";\nimport constant from \"./constant.js\";\nimport number from \"./number.js\";\n\nvar unit = [0, 1];\n\nexport function identity(x) {\n  return x;\n}\n\nfunction normalize(a, b) {\n  return (b -= (a = +a))\n      ? function(x) { return (x - a) / b; }\n      : constant(isNaN(b) ? NaN : 0.5);\n}\n\nfunction clamper(a, b) {\n  var t;\n  if (a > b) t = a, a = b, b = t;\n  return function(x) { return Math.max(a, Math.min(b, x)); };\n}\n\n// normalize(a, b)(x) takes a domain value x in [a,b] and returns the corresponding parameter t in [0,1].\n// interpolate(a, b)(t) takes a parameter t in [0,1] and returns the corresponding range value x in [a,b].\nfunction bimap(domain, range, interpolate) {\n  var d0 = domain[0], d1 = domain[1], r0 = range[0], r1 = range[1];\n  if (d1 < d0) d0 = normalize(d1, d0), r0 = interpolate(r1, r0);\n  else d0 = normalize(d0, d1), r0 = interpolate(r0, r1);\n  return function(x) { return r0(d0(x)); };\n}\n\nfunction polymap(domain, range, interpolate) {\n  var j = Math.min(domain.length, range.length) - 1,\n      d = new Array(j),\n      r = new Array(j),\n      i = -1;\n\n  // Reverse descending domains.\n  if (domain[j] < domain[0]) {\n    domain = domain.slice().reverse();\n    range = range.slice().reverse();\n  }\n\n  while (++i < j) {\n    d[i] = normalize(domain[i], domain[i + 1]);\n    r[i] = interpolate(range[i], range[i + 1]);\n  }\n\n  return function(x) {\n    var i = bisect(domain, x, 1, j) - 1;\n    return r[i](d[i](x));\n  };\n}\n\nexport function copy(source, target) {\n  return target\n      .domain(source.domain())\n      .range(source.range())\n      .interpolate(source.interpolate())\n      .clamp(source.clamp())\n      .unknown(source.unknown());\n}\n\nexport function transformer() {\n  var domain = unit,\n      range = unit,\n      interpolate = interpolateValue,\n      transform,\n      untransform,\n      unknown,\n      clamp = identity,\n      piecewise,\n      output,\n      input;\n\n  function rescale() {\n    var n = Math.min(domain.length, range.length);\n    if (clamp !== identity) clamp = clamper(domain[0], domain[n - 1]);\n    piecewise = n > 2 ? polymap : bimap;\n    output = input = null;\n    return scale;\n  }\n\n  function scale(x) {\n    return x == null || isNaN(x = +x) ? unknown : (output || (output = piecewise(domain.map(transform), range, interpolate)))(transform(clamp(x)));\n  }\n\n  scale.invert = function(y) {\n    return clamp(untransform((input || (input = piecewise(range, domain.map(transform), interpolateNumber)))(y)));\n  };\n\n  scale.domain = function(_) {\n    return arguments.length ? (domain = Array.from(_, number), rescale()) : domain.slice();\n  };\n\n  scale.range = function(_) {\n    return arguments.length ? (range = Array.from(_), rescale()) : range.slice();\n  };\n\n  scale.rangeRound = function(_) {\n    return range = Array.from(_), interpolate = interpolateRound, rescale();\n  };\n\n  scale.clamp = function(_) {\n    return arguments.length ? (clamp = _ ? true : identity, rescale()) : clamp !== identity;\n  };\n\n  scale.interpolate = function(_) {\n    return arguments.length ? (interpolate = _, rescale()) : interpolate;\n  };\n\n  scale.unknown = function(_) {\n    return arguments.length ? (unknown = _, scale) : unknown;\n  };\n\n  return function(t, u) {\n    transform = t, untransform = u;\n    return rescale();\n  };\n}\n\nexport default function continuous() {\n  return transformer()(identity, identity);\n}\n","export default function constants(x) {\n  return function() {\n    return x;\n  };\n}\n","export default function(x) {\n  return Math.abs(x = Math.round(x)) >= 1e21\n      ? x.toLocaleString(\"en\").replace(/,/g, \"\")\n      : x.toString(10);\n}\n\n// Computes the decimal coefficient and exponent of the specified number x with\n// significant digits p, where x is positive and p is in [1, 21] or undefined.\n// For example, formatDecimalParts(1.23) returns [\"123\", 0].\nexport function formatDecimalParts(x, p) {\n  if ((i = (x = p ? x.toExponential(p - 1) : x.toExponential()).indexOf(\"e\")) < 0) return null; // NaN, ±Infinity\n  var i, coefficient = x.slice(0, i);\n\n  // The string returned by toExponential either has the form \\d\\.\\d+e[-+]\\d+\n  // (e.g., 1.2e+3) or the form \\de[-+]\\d+ (e.g., 1e+3).\n  return [\n    coefficient.length > 1 ? coefficient[0] + coefficient.slice(2) : coefficient,\n    +x.slice(i + 1)\n  ];\n}\n","import {formatDecimalParts} from \"./formatDecimal.js\";\n\nexport default function(x) {\n  return x = formatDecimalParts(Math.abs(x)), x ? x[1] : NaN;\n}\n","// [[fill]align][sign][symbol][0][width][,][.precision][~][type]\nvar re = /^(?:(.)?([<>=^]))?([+\\-( ])?([$#])?(0)?(\\d+)?(,)?(\\.\\d+)?(~)?([a-z%])?$/i;\n\nexport default function formatSpecifier(specifier) {\n  if (!(match = re.exec(specifier))) throw new Error(\"invalid format: \" + specifier);\n  var match;\n  return new FormatSpecifier({\n    fill: match[1],\n    align: match[2],\n    sign: match[3],\n    symbol: match[4],\n    zero: match[5],\n    width: match[6],\n    comma: match[7],\n    precision: match[8] && match[8].slice(1),\n    trim: match[9],\n    type: match[10]\n  });\n}\n\nformatSpecifier.prototype = FormatSpecifier.prototype; // instanceof\n\nexport function FormatSpecifier(specifier) {\n  this.fill = specifier.fill === undefined ? \" \" : specifier.fill + \"\";\n  this.align = specifier.align === undefined ? \">\" : specifier.align + \"\";\n  this.sign = specifier.sign === undefined ? \"-\" : specifier.sign + \"\";\n  this.symbol = specifier.symbol === undefined ? \"\" : specifier.symbol + \"\";\n  this.zero = !!specifier.zero;\n  this.width = specifier.width === undefined ? undefined : +specifier.width;\n  this.comma = !!specifier.comma;\n  this.precision = specifier.precision === undefined ? undefined : +specifier.precision;\n  this.trim = !!specifier.trim;\n  this.type = specifier.type === undefined ? \"\" : specifier.type + \"\";\n}\n\nFormatSpecifier.prototype.toString = function() {\n  return this.fill\n      + this.align\n      + this.sign\n      + this.symbol\n      + (this.zero ? \"0\" : \"\")\n      + (this.width === undefined ? \"\" : Math.max(1, this.width | 0))\n      + (this.comma ? \",\" : \"\")\n      + (this.precision === undefined ? \"\" : \".\" + Math.max(0, this.precision | 0))\n      + (this.trim ? \"~\" : \"\")\n      + this.type;\n};\n","import {formatDecimalParts} from \"./formatDecimal.js\";\n\nexport var prefixExponent;\n\nexport default function(x, p) {\n  var d = formatDecimalParts(x, p);\n  if (!d) return x + \"\";\n  var coefficient = d[0],\n      exponent = d[1],\n      i = exponent - (prefixExponent = Math.max(-8, Math.min(8, Math.floor(exponent / 3))) * 3) + 1,\n      n = coefficient.length;\n  return i === n ? coefficient\n      : i > n ? coefficient + new Array(i - n + 1).join(\"0\")\n      : i > 0 ? coefficient.slice(0, i) + \".\" + coefficient.slice(i)\n      : \"0.\" + new Array(1 - i).join(\"0\") + formatDecimalParts(x, Math.max(0, p + i - 1))[0]; // less than 1y!\n}\n","import {formatDecimalParts} from \"./formatDecimal.js\";\n\nexport default function(x, p) {\n  var d = formatDecimalParts(x, p);\n  if (!d) return x + \"\";\n  var coefficient = d[0],\n      exponent = d[1];\n  return exponent < 0 ? \"0.\" + new Array(-exponent).join(\"0\") + coefficient\n      : coefficient.length > exponent + 1 ? coefficient.slice(0, exponent + 1) + \".\" + coefficient.slice(exponent + 1)\n      : coefficient + new Array(exponent - coefficient.length + 2).join(\"0\");\n}\n","import formatDecimal from \"./formatDecimal.js\";\nimport formatPrefixAuto from \"./formatPrefixAuto.js\";\nimport formatRounded from \"./formatRounded.js\";\n\nexport default {\n  \"%\": (x, p) => (x * 100).toFixed(p),\n  \"b\": (x) => Math.round(x).toString(2),\n  \"c\": (x) => x + \"\",\n  \"d\": formatDecimal,\n  \"e\": (x, p) => x.toExponential(p),\n  \"f\": (x, p) => x.toFixed(p),\n  \"g\": (x, p) => x.toPrecision(p),\n  \"o\": (x) => Math.round(x).toString(8),\n  \"p\": (x, p) => formatRounded(x * 100, p),\n  \"r\": formatRounded,\n  \"s\": formatPrefixAuto,\n  \"X\": (x) => Math.round(x).toString(16).toUpperCase(),\n  \"x\": (x) => Math.round(x).toString(16)\n};\n","export default function(x) {\n  return x;\n}\n","import exponent from \"./exponent.js\";\nimport formatGroup from \"./formatGroup.js\";\nimport formatNumerals from \"./formatNumerals.js\";\nimport formatSpecifier from \"./formatSpecifier.js\";\nimport formatTrim from \"./formatTrim.js\";\nimport formatTypes from \"./formatTypes.js\";\nimport {prefixExponent} from \"./formatPrefixAuto.js\";\nimport identity from \"./identity.js\";\n\nvar map = Array.prototype.map,\n    prefixes = [\"y\",\"z\",\"a\",\"f\",\"p\",\"n\",\"µ\",\"m\",\"\",\"k\",\"M\",\"G\",\"T\",\"P\",\"E\",\"Z\",\"Y\"];\n\nexport default function(locale) {\n  var group = locale.grouping === undefined || locale.thousands === undefined ? identity : formatGroup(map.call(locale.grouping, Number), locale.thousands + \"\"),\n      currencyPrefix = locale.currency === undefined ? \"\" : locale.currency[0] + \"\",\n      currencySuffix = locale.currency === undefined ? \"\" : locale.currency[1] + \"\",\n      decimal = locale.decimal === undefined ? \".\" : locale.decimal + \"\",\n      numerals = locale.numerals === undefined ? identity : formatNumerals(map.call(locale.numerals, String)),\n      percent = locale.percent === undefined ? \"%\" : locale.percent + \"\",\n      minus = locale.minus === undefined ? \"−\" : locale.minus + \"\",\n      nan = locale.nan === undefined ? \"NaN\" : locale.nan + \"\";\n\n  function newFormat(specifier) {\n    specifier = formatSpecifier(specifier);\n\n    var fill = specifier.fill,\n        align = specifier.align,\n        sign = specifier.sign,\n        symbol = specifier.symbol,\n        zero = specifier.zero,\n        width = specifier.width,\n        comma = specifier.comma,\n        precision = specifier.precision,\n        trim = specifier.trim,\n        type = specifier.type;\n\n    // The \"n\" type is an alias for \",g\".\n    if (type === \"n\") comma = true, type = \"g\";\n\n    // The \"\" type, and any invalid type, is an alias for \".12~g\".\n    else if (!formatTypes[type]) precision === undefined && (precision = 12), trim = true, type = \"g\";\n\n    // If zero fill is specified, padding goes after sign and before digits.\n    if (zero || (fill === \"0\" && align === \"=\")) zero = true, fill = \"0\", align = \"=\";\n\n    // Compute the prefix and suffix.\n    // For SI-prefix, the suffix is lazily computed.\n    var prefix = symbol === \"$\" ? currencyPrefix : symbol === \"#\" && /[boxX]/.test(type) ? \"0\" + type.toLowerCase() : \"\",\n        suffix = symbol === \"$\" ? currencySuffix : /[%p]/.test(type) ? percent : \"\";\n\n    // What format function should we use?\n    // Is this an integer type?\n    // Can this type generate exponential notation?\n    var formatType = formatTypes[type],\n        maybeSuffix = /[defgprs%]/.test(type);\n\n    // Set the default precision if not specified,\n    // or clamp the specified precision to the supported range.\n    // For significant precision, it must be in [1, 21].\n    // For fixed precision, it must be in [0, 20].\n    precision = precision === undefined ? 6\n        : /[gprs]/.test(type) ? Math.max(1, Math.min(21, precision))\n        : Math.max(0, Math.min(20, precision));\n\n    function format(value) {\n      var valuePrefix = prefix,\n          valueSuffix = suffix,\n          i, n, c;\n\n      if (type === \"c\") {\n        valueSuffix = formatType(value) + valueSuffix;\n        value = \"\";\n      } else {\n        value = +value;\n\n        // Determine the sign. -0 is not less than 0, but 1 / -0 is!\n        var valueNegative = value < 0 || 1 / value < 0;\n\n        // Perform the initial formatting.\n        value = isNaN(value) ? nan : formatType(Math.abs(value), precision);\n\n        // Trim insignificant zeros.\n        if (trim) value = formatTrim(value);\n\n        // If a negative value rounds to zero after formatting, and no explicit positive sign is requested, hide the sign.\n        if (valueNegative && +value === 0 && sign !== \"+\") valueNegative = false;\n\n        // Compute the prefix and suffix.\n        valuePrefix = (valueNegative ? (sign === \"(\" ? sign : minus) : sign === \"-\" || sign === \"(\" ? \"\" : sign) + valuePrefix;\n        valueSuffix = (type === \"s\" ? prefixes[8 + prefixExponent / 3] : \"\") + valueSuffix + (valueNegative && sign === \"(\" ? \")\" : \"\");\n\n        // Break the formatted value into the integer “value” part that can be\n        // grouped, and fractional or exponential “suffix” part that is not.\n        if (maybeSuffix) {\n          i = -1, n = value.length;\n          while (++i < n) {\n            if (c = value.charCodeAt(i), 48 > c || c > 57) {\n              valueSuffix = (c === 46 ? decimal + value.slice(i + 1) : value.slice(i)) + valueSuffix;\n              value = value.slice(0, i);\n              break;\n            }\n          }\n        }\n      }\n\n      // If the fill character is not \"0\", grouping is applied before padding.\n      if (comma && !zero) value = group(value, Infinity);\n\n      // Compute the padding.\n      var length = valuePrefix.length + value.length + valueSuffix.length,\n          padding = length < width ? new Array(width - length + 1).join(fill) : \"\";\n\n      // If the fill character is \"0\", grouping is applied after padding.\n      if (comma && zero) value = group(padding + value, padding.length ? width - valueSuffix.length : Infinity), padding = \"\";\n\n      // Reconstruct the final output based on the desired alignment.\n      switch (align) {\n        case \"<\": value = valuePrefix + value + valueSuffix + padding; break;\n        case \"=\": value = valuePrefix + padding + value + valueSuffix; break;\n        case \"^\": value = padding.slice(0, length = padding.length >> 1) + valuePrefix + value + valueSuffix + padding.slice(length); break;\n        default: value = padding + valuePrefix + value + valueSuffix; break;\n      }\n\n      return numerals(value);\n    }\n\n    format.toString = function() {\n      return specifier + \"\";\n    };\n\n    return format;\n  }\n\n  function formatPrefix(specifier, value) {\n    var f = newFormat((specifier = formatSpecifier(specifier), specifier.type = \"f\", specifier)),\n        e = Math.max(-8, Math.min(8, Math.floor(exponent(value) / 3))) * 3,\n        k = Math.pow(10, -e),\n        prefix = prefixes[8 + e / 3];\n    return function(value) {\n      return f(k * value) + prefix;\n    };\n  }\n\n  return {\n    format: newFormat,\n    formatPrefix: formatPrefix\n  };\n}\n","import formatLocale from \"./locale.js\";\n\nvar locale;\nexport var format;\nexport var formatPrefix;\n\ndefaultLocale({\n  thousands: \",\",\n  grouping: [3],\n  currency: [\"$\", \"\"]\n});\n\nexport default function defaultLocale(definition) {\n  locale = formatLocale(definition);\n  format = locale.format;\n  formatPrefix = locale.formatPrefix;\n  return locale;\n}\n","import {ticks, tickIncrement} from \"d3-array\";\nimport continuous, {copy} from \"./continuous.js\";\nimport {initRange} from \"./init.js\";\nimport tickFormat from \"./tickFormat.js\";\n\nexport function linearish(scale) {\n  var domain = scale.domain;\n\n  scale.ticks = function(count) {\n    var d = domain();\n    return ticks(d[0], d[d.length - 1], count == null ? 10 : count);\n  };\n\n  scale.tickFormat = function(count, specifier) {\n    var d = domain();\n    return tickFormat(d[0], d[d.length - 1], count == null ? 10 : count, specifier);\n  };\n\n  scale.nice = function(count) {\n    if (count == null) count = 10;\n\n    var d = domain();\n    var i0 = 0;\n    var i1 = d.length - 1;\n    var start = d[i0];\n    var stop = d[i1];\n    var prestep;\n    var step;\n    var maxIter = 10;\n\n    if (stop < start) {\n      step = start, start = stop, stop = step;\n      step = i0, i0 = i1, i1 = step;\n    }\n    \n    while (maxIter-- > 0) {\n      step = tickIncrement(start, stop, count);\n      if (step === prestep) {\n        d[i0] = start\n        d[i1] = stop\n        return domain(d);\n      } else if (step > 0) {\n        start = Math.floor(start / step) * step;\n        stop = Math.ceil(stop / step) * step;\n      } else if (step < 0) {\n        start = Math.ceil(start * step) / step;\n        stop = Math.floor(stop * step) / step;\n      } else {\n        break;\n      }\n      prestep = step;\n    }\n\n    return scale;\n  };\n\n  return scale;\n}\n\nexport default function linear() {\n  var scale = continuous();\n\n  scale.copy = function() {\n    return copy(scale, linear());\n  };\n\n  initRange.apply(scale, arguments);\n\n  return linearish(scale);\n}\n","import {tickStep} from \"d3-array\";\nimport {format, formatPrefix, formatSpecifier, precisionFixed, precisionPrefix, precisionRound} from \"d3-format\";\n\nexport default function tickFormat(start, stop, count, specifier) {\n  var step = tickStep(start, stop, count),\n      precision;\n  specifier = formatSpecifier(specifier == null ? \",f\" : specifier);\n  switch (specifier.type) {\n    case \"s\": {\n      var value = Math.max(Math.abs(start), Math.abs(stop));\n      if (specifier.precision == null && !isNaN(precision = precisionPrefix(step, value))) specifier.precision = precision;\n      return formatPrefix(specifier, value);\n    }\n    case \"\":\n    case \"e\":\n    case \"g\":\n    case \"p\":\n    case \"r\": {\n      if (specifier.precision == null && !isNaN(precision = precisionRound(step, Math.max(Math.abs(start), Math.abs(stop))))) specifier.precision = precision - (specifier.type === \"e\");\n      break;\n    }\n    case \"f\":\n    case \"%\": {\n      if (specifier.precision == null && !isNaN(precision = precisionFixed(step))) specifier.precision = precision - (specifier.type === \"%\") * 2;\n      break;\n    }\n  }\n  return format(specifier);\n}\n","import exponent from \"./exponent.js\";\n\nexport default function(step, value) {\n  return Math.max(0, Math.max(-8, Math.min(8, Math.floor(exponent(value) / 3))) * 3 - exponent(Math.abs(step)));\n}\n","import exponent from \"./exponent.js\";\n\nexport default function(step, max) {\n  step = Math.abs(step), max = Math.abs(max) - step;\n  return Math.max(0, exponent(max) - exponent(step)) + 1;\n}\n","import exponent from \"./exponent.js\";\n\nexport default function(step) {\n  return Math.max(0, -exponent(Math.abs(step)));\n}\n","export default function(grouping, thousands) {\n  return function(value, width) {\n    var i = value.length,\n        t = [],\n        j = 0,\n        g = grouping[0],\n        length = 0;\n\n    while (i > 0 && g > 0) {\n      if (length + g + 1 > width) g = Math.max(1, width - length);\n      t.push(value.substring(i -= g, i + g));\n      if ((length += g + 1) > width) break;\n      g = grouping[j = (j + 1) % grouping.length];\n    }\n\n    return t.reverse().join(thousands);\n  };\n}\n","export default function(numerals) {\n  return function(value) {\n    return value.replace(/[0-9]/g, function(i) {\n      return numerals[+i];\n    });\n  };\n}\n","// Trims insignificant zeros, e.g., replaces 1.2000k with 1.2k.\nexport default function(s) {\n  out: for (var n = s.length, i = 1, i0 = -1, i1; i < n; ++i) {\n    switch (s[i]) {\n      case \".\": i0 = i1 = i; break;\n      case \"0\": if (i0 === 0) i0 = i; i1 = i; break;\n      default: if (!+s[i]) break out; if (i0 > 0) i0 = 0; break;\n    }\n  }\n  return i0 > 0 ? s.slice(0, i0) + s.slice(i1 + 1) : s;\n}\n","export default x => () => x;\n","import constant from \"./constant.js\";\n\nfunction linear(a, d) {\n  return function(t) {\n    return a + t * d;\n  };\n}\n\nfunction exponential(a, b, y) {\n  return a = Math.pow(a, y), b = Math.pow(b, y) - a, y = 1 / y, function(t) {\n    return Math.pow(a + t * b, y);\n  };\n}\n\nexport function hue(a, b) {\n  var d = b - a;\n  return d ? linear(a, d > 180 || d < -180 ? d - 360 * Math.round(d / 360) : d) : constant(isNaN(a) ? b : a);\n}\n\nexport function gamma(y) {\n  return (y = +y) === 1 ? nogamma : function(a, b) {\n    return b - a ? exponential(a, b, y) : constant(isNaN(a) ? b : a);\n  };\n}\n\nexport default function nogamma(a, b) {\n  var d = b - a;\n  return d ? linear(a, d) : constant(isNaN(a) ? b : a);\n}\n","import {rgb as colorRgb} from \"d3-color\";\nimport basis from \"./basis.js\";\nimport basisClosed from \"./basisClosed.js\";\nimport nogamma, {gamma} from \"./color.js\";\n\nexport default (function rgbGamma(y) {\n  var color = gamma(y);\n\n  function rgb(start, end) {\n    var r = color((start = colorRgb(start)).r, (end = colorRgb(end)).r),\n        g = color(start.g, end.g),\n        b = color(start.b, end.b),\n        opacity = nogamma(start.opacity, end.opacity);\n    return function(t) {\n      start.r = r(t);\n      start.g = g(t);\n      start.b = b(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n\n  rgb.gamma = rgbGamma;\n\n  return rgb;\n})(1);\n\nfunction rgbSpline(spline) {\n  return function(colors) {\n    var n = colors.length,\n        r = new Array(n),\n        g = new Array(n),\n        b = new Array(n),\n        i, color;\n    for (i = 0; i < n; ++i) {\n      color = colorRgb(colors[i]);\n      r[i] = color.r || 0;\n      g[i] = color.g || 0;\n      b[i] = color.b || 0;\n    }\n    r = spline(r);\n    g = spline(g);\n    b = spline(b);\n    color.opacity = 1;\n    return function(t) {\n      color.r = r(t);\n      color.g = g(t);\n      color.b = b(t);\n      return color + \"\";\n    };\n  };\n}\n\nexport var rgbBasis = rgbSpline(basis);\nexport var rgbBasisClosed = rgbSpline(basisClosed);\n","export default function(a, b) {\n  return a = +a, b = +b, function(t) {\n    return a * (1 - t) + b * t;\n  };\n}\n","import {hsl as colorHsl} from \"d3-color\";\nimport color, {hue} from \"./color.js\";\n\nfunction hsl(hue) {\n  return function(start, end) {\n    var h = hue((start = colorHsl(start)).h, (end = colorHsl(end)).h),\n        s = color(start.s, end.s),\n        l = color(start.l, end.l),\n        opacity = color(start.opacity, end.opacity);\n    return function(t) {\n      start.h = h(t);\n      start.s = s(t);\n      start.l = l(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n}\n\nexport default hsl(hue);\nexport var hslLong = hsl(color);\n","import {lab as colorLab} from \"d3-color\";\nimport color from \"./color.js\";\n\nexport default function lab(start, end) {\n  var l = color((start = colorLab(start)).l, (end = colorLab(end)).l),\n      a = color(start.a, end.a),\n      b = color(start.b, end.b),\n      opacity = color(start.opacity, end.opacity);\n  return function(t) {\n    start.l = l(t);\n    start.a = a(t);\n    start.b = b(t);\n    start.opacity = opacity(t);\n    return start + \"\";\n  };\n}\n","import {hcl as colorHcl} from \"d3-color\";\nimport color, {hue} from \"./color.js\";\n\nfunction hcl(hue) {\n  return function(start, end) {\n    var h = hue((start = colorHcl(start)).h, (end = colorHcl(end)).h),\n        c = color(start.c, end.c),\n        l = color(start.l, end.l),\n        opacity = color(start.opacity, end.opacity);\n    return function(t) {\n      start.h = h(t);\n      start.c = c(t);\n      start.l = l(t);\n      start.opacity = opacity(t);\n      return start + \"\";\n    };\n  }\n}\n\nexport default hcl(hue);\nexport var hclLong = hcl(color);\n","import {cubehelix as colorCubehelix} from \"d3-color\";\nimport color, {hue} from \"./color.js\";\n\nfunction cubehelix(hue) {\n  return (function cubehelixGamma(y) {\n    y = +y;\n\n    function cubehelix(start, end) {\n      var h = hue((start = colorCubehelix(start)).h, (end = colorCubehelix(end)).h),\n          s = color(start.s, end.s),\n          l = color(start.l, end.l),\n          opacity = color(start.opacity, end.opacity);\n      return function(t) {\n        start.h = h(t);\n        start.s = s(t);\n        start.l = l(Math.pow(t, y));\n        start.opacity = opacity(t);\n        return start + \"\";\n      };\n    }\n\n    cubehelix.gamma = cubehelixGamma;\n\n    return cubehelix;\n  })(1);\n}\n\nexport default cubehelix(hue);\nexport var cubehelixLong = cubehelix(color);\n","\r\nimport {ColorMap, ColorMapBin, InterpolationMethod} from './Types';\r\nimport { ScaleLinear, scaleLinear } from \"d3-scale\";\r\nimport {\r\n  interpolateCubehelix, interpolateCubehelixLong,\r\n  interpolateHcl,\r\n  interpolateHclLong,\r\n  interpolateHsl,\r\n  interpolateHslLong,\r\n  interpolateLab,\r\n  interpolateRgb\r\n} from \"d3-interpolate\";\r\nimport { interpolateHsv, interpolateHsvLong } from \"d3-hsv\";\r\n\r\nconst colorRangeCache = new WeakMap<ColorMap, ScaleLinear<string, string>>();\r\n\r\n/**\r\n * This utility function creates a color range method from d3 to the given color map. It also does some caching, since\r\n * this is an expensive object to create.\r\n */\r\nexport function getColorRange(colorMap: ColorMap): ScaleLinear<string, string> {\r\n  if (colorRangeCache.has(colorMap)) {\r\n    return colorRangeCache.get(colorMap);\r\n  }\r\n\r\n  const colorRange = scaleLinear<string, number>()\r\n    .domain(colorMap.colorStops.map((entry) => entry.stop))\r\n    .range(colorMap.colorStops.map((entry) => entry.color))\r\n    .interpolate(getColorInterpolator(colorMap.interpolationMethod));\r\n  colorRangeCache.set(colorMap, colorRange);\r\n  return colorRange;\r\n}\r\n\r\n/**\r\n * This function returns a color for a value in the given color map.\r\n */\r\nexport function getColorFromColorMapAt(colorMap: ColorMap, value: number): string {\r\n  const colorRange = getColorRange(colorMap);\r\n  if (colorMap.discrete && colorMap.bins) {\r\n    return colorRange(Math.floor(value * colorMap.bins) / (colorMap.bins - 1));\r\n  }\r\n\r\n  return colorRange(value);\r\n}\r\n\r\n/**\r\n * This function returns an array of bins with their color, if the color map is discrete. Otherwise, it will return an\r\n * empty array.\r\n */\r\nexport function getColorMapBins(colorMap: ColorMap): Array<ColorMapBin> {\r\n  if (!colorMap.discrete || !colorMap.bins) {\r\n    return [];\r\n  }\r\n\r\n  const min = colorMap.colorStops[0].stop;\r\n  const max = colorMap.colorStops[colorMap.colorStops.length - 1].stop;\r\n  const range = max - min;\r\n  const binSize = range / colorMap.bins;\r\n\r\n  const colorRange = getColorRange(colorMap);\r\n  const result: Array<ColorMapBin> = [];\r\n\r\n  for (let i = 0; i < colorMap.bins; i++) {\r\n    const lowerBound = min + i * binSize;\r\n    const upperBound = lowerBound + binSize;\r\n    const center = (lowerBound + upperBound) / 2;\r\n    const color = colorRange(Math.floor(center * colorMap.bins) / (colorMap.bins - 1));\r\n    result.push({lowerBound, center, upperBound, color});\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * This is a helper method, mapping the InterpolationMethod enum to d3 interpolation functions.\r\n */\r\nexport function getColorInterpolator(interpolationMethods: InterpolationMethod) {\r\n  switch (interpolationMethods) {\r\n    case InterpolationMethod.RGB:\r\n      return interpolateRgb;\r\n    case InterpolationMethod.HSL:\r\n      return interpolateHsl;\r\n    case InterpolationMethod.HSL_LONG:\r\n      return interpolateHslLong;\r\n    case InterpolationMethod.HSV:\r\n      return interpolateHsv;\r\n    case InterpolationMethod.HSV_LONG:\r\n      return interpolateHsvLong;\r\n    case InterpolationMethod.HCL:\r\n      return interpolateHcl;\r\n    case InterpolationMethod.HCL_LONG:\r\n      return interpolateHclLong;\r\n    case InterpolationMethod.LAB:\r\n      return interpolateLab;\r\n    case InterpolationMethod.CUBEHELIX:\r\n      return interpolateCubehelix;\r\n    case InterpolationMethod.CUBEHELIX_LONG:\r\n      return interpolateCubehelixLong;\r\n  }\r\n}\r\n","export const overwriteMerge = (_destinationArray: Array<any>, sourceArray: Array<any>) => sourceArray;\n","import {ColorMap, ColorMapBin, ColorStop, InterpolationMethod} from './Types';\r\nimport {ColorPicker} from './ColorPicker';\r\nimport merge from 'deepmerge';\r\nimport {getColorFromColorMapAt, getColorMapBins} from './convert';\r\nimport {drawControlPoint} from './draw';\r\nimport Container from './Container';\r\nimport { overwriteMerge } from \"./utils\";\r\nimport { hsl } from \"d3-color\";\r\n\r\n/**\r\n * This creates a color map editor component, where the user can create a color gradient using stops and colors.\r\n *\r\n * @example\r\n *   const cm = new ColorMapEditor(\"#cm\", {\r\n *     initialColorMap: {\r\n *       colorStops: [\r\n *         { stop: 0, color: \"#0f0\" },\r\n *         { stop: 0.5, color: \"#f00\" },\r\n *         { stop: 1, color: \"#000\" }\r\n *       ]\r\n *     }\r\n *   });\r\n *\r\n *   cm.addListener((colorMapEditor) => {\r\n *     console.log(colorMapEditor.getColorMap());\r\n *     // output:\r\n *     // {\r\n *     //   colorStops: [{stop: 0, color: \"#0f0\"},{stop: 0.5, color: \"#f00\"},{stop: 1, color: \"#000\"}],\r\n *     //   interpolationMethod: \"HSL_LONG\"\r\n *     // }\r\n *   });\r\n */\r\nexport class ColorMapEditor extends Container {\r\n  /** This element lays out the canvas and all other controls. */\r\n  private readonly rootElement: HTMLDivElement;\r\n\r\n  /** The gradient and stops are painted in here. It also handles mouse input. */\r\n  private readonly canvas: HTMLCanvasElement;\r\n\r\n  /** The context for the canvas for convenience. */\r\n  private ctx: CanvasRenderingContext2D;\r\n\r\n  /** This is the color map that everything revolves around. The stops are always sorted. */\r\n  private colorStops: Array<ColorStop>;\r\n\r\n  /** The used method of interpolation between two color stops. */\r\n  private interpolationMethod: InterpolationMethod;\r\n\r\n  /** The size of the control points. Might become configurable in the future. */\r\n  private controlPointSize: number;\r\n\r\n  /** If the color map should have a discrete amount of values. */\r\n  private discrete: boolean;\r\n\r\n  /** The number of bins. */\r\n  private bins: number;\r\n\r\n  /** If true, the numbers under stops get displayed. */\r\n  private showStopNumbers: boolean;\r\n\r\n  /** The color picker for editing control point colors is embedded in this div. */\r\n  private readonly colorPickerContainer: HTMLDivElement;\r\n\r\n  /** If the interpolation method is set to editable, this element is the selection dropdown. */\r\n  private interpolationMethodElement?: HTMLSelectElement;\r\n\r\n  /** If the bins are set to editable, this element shows a checkbox to toggle the discretization. */\r\n  private discreteElement?: HTMLInputElement;\r\n\r\n  /** If the bins are set to editable, this element shows a number input field to configure the number of bins. */\r\n  private binsElement?: HTMLInputElement;\r\n\r\n  /** The color picker for editing control point colors. */\r\n  private colorPicker: ColorPicker;\r\n\r\n  /** This gets called when the color changes to notify users of this library. */\r\n  private callbacks: Map<number, (colorMapEditor: ColorMapEditor) => void> = new Map();\r\n  private callbackCounter = 0;\r\n\r\n  /**\r\n   * Creates a new color map editor inside the given container.\r\n   *\r\n   * @param container Either an HTMLElement or a query string to an element, in which the editor will be embedded.\r\n   * @param options   Can be used to configure the color map editor. See {@link ColorMapEditorOptions}.\r\n   */\r\n  constructor(container: HTMLElement | string, options?: ColorMapEditorOptions) {\r\n    super(container);\r\n\r\n    // Set all defaults.\r\n    const defaultOptions: ColorMapEditorOptions = {\r\n      initialColorMap: {\r\n        colorStops: [\r\n          {stop: 0, color: 'green'},\r\n          {stop: 0.5, color: 'yellow'},\r\n          {stop: 1, color: 'red'},\r\n        ],\r\n        interpolationMethod: InterpolationMethod.HSL,\r\n        discrete: false,\r\n        bins: 7,\r\n      },\r\n      showStopNumbers: false,\r\n      interpolationMethodsEditable: true,\r\n      binSelectorEditable: true,\r\n      controlPointSize: 7,\r\n    };\r\n\r\n    // Merge the options with the defaults.\r\n    // !!! DON'T USE options AND defaultOptions AFTER THIS LINE !!!\r\n    const finalOptions = merge(defaultOptions, options ?? {}, { arrayMerge: overwriteMerge });\r\n\r\n    this.colorStops = finalOptions.initialColorMap.colorStops;\r\n    this.sortControlPoints();\r\n    this.showStopNumbers = finalOptions.showStopNumbers;\r\n    this.interpolationMethod = finalOptions.initialColorMap.interpolationMethod;\r\n    this.discrete = finalOptions.initialColorMap.discrete;\r\n    this.bins = finalOptions.initialColorMap.bins;\r\n    this.controlPointSize = finalOptions.controlPointSize;\r\n\r\n    this.parent.classList.add('tfe-color-map-editor');\r\n\r\n    // This contains the canvas and the controls.\r\n    this.rootElement = document.createElement('div');\r\n    this.rootElement.classList.add('tfe-color-map-editor-root');\r\n    this.rootElement.style.display = 'flex';\r\n    this.rootElement.style.flexDirection = 'column';\r\n    this.rootElement.style.gap = '5px';\r\n    this.parent.appendChild(this.rootElement);\r\n\r\n    // Prepare the canvas and the context.\r\n    this.canvas = document.createElement('canvas');\r\n    this.canvas.width = this.parent.clientWidth;\r\n    this.canvas.height = this.parent.clientHeight;\r\n\r\n    this.rootElement.appendChild(this.canvas);\r\n    this.ctx = this.canvas.getContext('2d', {alpha: false});\r\n\r\n    // Prepare the container for the color picker and initialize it.\r\n    this.colorPickerContainer = document.createElement('div');\r\n    this.colorPickerContainer.classList.add('tfe-color-map-editor-color-picker-container');\r\n    this.colorPickerContainer.style.width = 'fit-content';\r\n    this.colorPickerContainer.style.padding = '12px';\r\n    this.colorPickerContainer.style.backgroundColor = 'white';\r\n    this.colorPickerContainer.style.border = '1px solid black';\r\n    this.colorPickerContainer.style.visibility = 'hidden';\r\n    this.colorPickerContainer.style.position = 'relative';\r\n    this.parent.appendChild(this.colorPickerContainer);\r\n    this.colorPicker = new ColorPicker(this.colorPickerContainer);\r\n\r\n    this.setUpInputElements(finalOptions);\r\n\r\n    this.draw();\r\n\r\n    // Add all event listeners.\r\n    this.addCanvasEventListeners();\r\n  }\r\n\r\n  /** Set new color stops. */\r\n  public setColorStops(colorStops: Array<ColorStop>) {\r\n    this.colorStops = colorStops;\r\n    this.sortControlPoints();\r\n    this.draw();\r\n    this.sendUpdates();\r\n  }\r\n\r\n  /** Get the current color stops. */\r\n  public getColorStops(): Array<ColorStop> {\r\n    return this.colorStops;\r\n  }\r\n\r\n  /** Sets the interpolation method used for interpolating colors between two stops. */\r\n  public setInterpolationMethods(interpolationMethod: InterpolationMethod) {\r\n    this.interpolationMethod = interpolationMethod;\r\n\r\n    if (this.interpolationMethodElement) {\r\n      this.interpolationMethodElement.value = this.interpolationMethod;\r\n    }\r\n\r\n    this.draw();\r\n    this.sendUpdates();\r\n  }\r\n\r\n  /** Get the interpolation method used for interpolating colors between two stops. */\r\n  public getInterpolationMethods(): InterpolationMethod {\r\n    return this.interpolationMethod;\r\n  }\r\n\r\n  /**\r\n   * Sets, if the resulting color map is discrete or continuous. If discrete is true, the bins property controls how many\r\n   * bins are shown.\r\n   */\r\n  public setDiscrete(discrete: boolean) {\r\n    this.discrete = discrete;\r\n\r\n    if (this.discreteElement) {\r\n      this.binsElement.disabled = !this.discrete;\r\n    }\r\n\r\n    this.draw();\r\n    this.sendUpdates();\r\n  }\r\n\r\n  /** If the color map is discrete. */\r\n  public isDiscrete(): boolean {\r\n    return this.discrete;\r\n  }\r\n\r\n  /** Sets the number of bins, if the color map is discrete. */\r\n  public setBins(bins: number) {\r\n    this.bins = Math.max(bins, 0);\r\n\r\n    if (this.binsElement) {\r\n      this.binsElement.valueAsNumber = this.bins;\r\n    }\r\n\r\n    this.draw();\r\n    this.sendUpdates();\r\n  }\r\n\r\n  /** The number of bins, if the color map is discrete. */\r\n  public getBins(): number {\r\n    return this.bins;\r\n  }\r\n\r\n  /** Set a new color map. */\r\n  public setColorMap(colorMap: ColorMap) {\r\n    this.colorStops = colorMap.colorStops;\r\n    this.sortControlPoints();\r\n    this.discrete = colorMap.discrete;\r\n    this.bins = Math.max(colorMap.bins || 0, 0);\r\n    this.interpolationMethod = colorMap.interpolationMethod;\r\n\r\n    if (this.discreteElement && this.binsElement) {\r\n      this.discreteElement.checked = this.discrete;\r\n      this.binsElement.valueAsNumber = this.bins;\r\n      this.binsElement.disabled = !this.discrete;\r\n    }\r\n\r\n    if (this.interpolationMethodElement) {\r\n      this.interpolationMethodElement.value = this.interpolationMethod;\r\n    }\r\n\r\n    this.draw();\r\n    this.sendUpdates();\r\n  }\r\n\r\n  /** Get the current color map. */\r\n  public getColorMap(): ColorMap {\r\n    return {\r\n      colorStops: this.colorStops,\r\n      interpolationMethod: this.interpolationMethod,\r\n      discrete: this.discrete || undefined,\r\n      bins: this.discrete ? this.bins : undefined,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * This function returns an array of bins with their color, if the color map is discrete. Otherwise, it will return an\r\n   * empty array.\r\n   */\r\n  public getDiscreteColorMap(): Array<ColorMapBin> {\r\n    return getColorMapBins(this.getColorMap());\r\n  }\r\n\r\n  /**\r\n   * Register a callback that gets called, when the color map changes. The callback gets called once immediately.\r\n   *\r\n   * @param callback The function that gets called whenever the color map changes.\r\n   */\r\n  public addListener(callback: (colorMapEditor: ColorMapEditor) => void): number {\r\n    const id = this.callbackCounter++;\r\n    this.callbacks.set(id, callback);\r\n    callback(this);\r\n    return id;\r\n  }\r\n\r\n  /** Removes the listener with the given id. */\r\n  public removeListener(id: number) {\r\n    this.callbacks.delete(id);\r\n  }\r\n\r\n  /** This function notifies all listeners to this color map editor. */\r\n  private sendUpdates() {\r\n    this.callbacks.forEach((value) => value(this));\r\n  }\r\n\r\n  private sortControlPoints() {\r\n    this.colorStops.sort((a, b) => a.stop - b.stop);\r\n  }\r\n\r\n  /** Draws the gradient and the control points. */\r\n  private draw() {\r\n    // Draw the gradient.\r\n    for (let i = 0; i < this.canvas.width; ++i) {\r\n      this.ctx.fillStyle = getColorFromColorMapAt(\r\n        {\r\n          colorStops: this.colorStops,\r\n          interpolationMethod: this.interpolationMethod,\r\n          discrete: this.discrete,\r\n          bins: this.bins,\r\n        },\r\n        i / (this.canvas.width - 1)\r\n      );\r\n\r\n      this.ctx.fillRect(i, 0, 1, this.canvas.height);\r\n    }\r\n\r\n    // Draw the control points. To ensure visibility everywhere it is an alternating circle in white and black.\r\n    for (let i = 0; i < this.colorStops.length; i++) {\r\n      const x = this.colorStops[i].stop * this.canvas.width;\r\n      const y = 0.5 * this.canvas.height;\r\n      const color = this.colorStops[i].color;\r\n\r\n      this.ctx.fillStyle = color;\r\n      this.ctx.beginPath();\r\n      this.ctx.arc(x, y, this.controlPointSize, 0, 2 * Math.PI);\r\n      this.ctx.fill();\r\n\r\n      drawControlPoint(this.ctx, x, y, this.controlPointSize);\r\n\r\n      // Below the control point we draw the number of the stop, if enabled.\r\n      if (this.showStopNumbers) {\r\n        if (i === 0) {\r\n          this.ctx.textAlign = 'left';\r\n        } else if (i === this.colorStops.length - 1) {\r\n          this.ctx.textAlign = 'right';\r\n        } else {\r\n          this.ctx.textAlign = 'center';\r\n        }\r\n\r\n        const brightness = hsl(color).l;\r\n        this.ctx.fillStyle = brightness < 0.5 ? 'white' : 'black';\r\n        this.ctx.fillText(this.colorStops[i].stop.toPrecision(3), x, this.canvas.height - 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  /** Adds event listeners for adding, removing and moving control points as well as showing the color picker. */\r\n  private addCanvasEventListeners() {\r\n    // This flag prevents click events to trigger when dragging control points small distances.\r\n    let draggedBefore: boolean = false;\r\n\r\n    // Tracks if the user is currently dragging a control point.\r\n    let isDragging: boolean = false;\r\n\r\n    // The index of the currently dragged control point.\r\n    let dragIndex: number = -1;\r\n\r\n    // The AbortController is for removing the mousemove listener from the document, when the user stops dragging.\r\n    let abortController: AbortController = null;\r\n\r\n    /**\r\n     * This function checks if a control point was selected, sets the dragIndex and isDragging fields and attaches a\r\n     * mouse move listener to the document. This allows for more consistent control.\r\n     */\r\n    const checkDragStart = (e: {offsetX: number; offsetY: number}) => {\r\n      // Figure out which control point was selected.\r\n      dragIndex = -1;\r\n      for (let i = 0; i < this.colorStops.length; i++) {\r\n        const stop = this.colorStops[i];\r\n        const dx = Math.abs(stop.stop * this.canvas.width - e.offsetX);\r\n        if (dx < this.controlPointSize) {\r\n          dragIndex = i;\r\n          isDragging = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (isDragging) {\r\n        // Attach a mouse move listener to the document.\r\n        abortController = new AbortController();\r\n        document.addEventListener(\r\n          'mousemove',\r\n          (e) => {\r\n            e.preventDefault();\r\n\r\n            if (dragIndex > 0 && dragIndex < this.colorStops.length - 1) {\r\n              const offsetX = e.clientX - this.canvas.getBoundingClientRect().x;\r\n              const leftBound = this.colorStops[dragIndex - 1].stop + Number.EPSILON;\r\n              const rightBound = this.colorStops[dragIndex + 1].stop - Number.EPSILON;\r\n              this.colorStops[dragIndex].stop = Math.max(leftBound, Math.min(rightBound, offsetX / this.canvas.width));\r\n              this.draw();\r\n              this.sendUpdates();\r\n            }\r\n\r\n            draggedBefore = true;\r\n          },\r\n          {signal: abortController.signal}\r\n        );\r\n      }\r\n    };\r\n\r\n    // This listener is responsible for:\r\n    //  - Starting dragging a control point, if one was pressed on with the left mouse button.\r\n    //  - Adding a control point if the left mouse button was pressed anywhere else (also starts dragging the newly\r\n    //    created point).\r\n    //  - Removing a control point on right click.\r\n    this.canvas.addEventListener('mousedown', (e) => {\r\n      draggedBefore = false;\r\n\r\n      if (e.button === 0) {\r\n        // Left Mouse Button\r\n        // Check if a control point was selected with the left mouse button.\r\n        checkDragStart(e);\r\n\r\n        if (!isDragging) {\r\n          // If no control point was selected a new one is being created and also immediately dragged.\r\n          const x = Math.max(0, Math.min(1, e.offsetX / this.canvas.width));\r\n          const color = getColorFromColorMapAt(\r\n            {\r\n              colorStops: this.colorStops,\r\n              interpolationMethod: this.interpolationMethod,\r\n              discrete: this.discrete,\r\n              bins: this.bins,\r\n            },\r\n            x\r\n          );\r\n          const stop = {stop: x, color};\r\n          this.colorStops.push(stop);\r\n          this.sortControlPoints();\r\n          this.draw();\r\n          this.sendUpdates();\r\n          checkDragStart(e);\r\n        }\r\n      } else if (e.button === 2) {\r\n        // Right Mouse Button\r\n        e.preventDefault();\r\n        // If a control point was pressed on with the RMB it gets removed.\r\n        for (let i = 1; i < this.colorStops.length - 1; i++) {\r\n          const stop = this.colorStops[i];\r\n          const dx = stop.stop * this.canvas.width - e.offsetX;\r\n          const dy = 0.5 * this.canvas.height - e.offsetY;\r\n          if (Math.sqrt(dx * dx + dy * dy) < this.controlPointSize) {\r\n            this.colorStops.splice(i, 1);\r\n            this.draw();\r\n            this.sendUpdates();\r\n            return;\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    this.canvas.addEventListener('contextmenu', (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      return false;\r\n    });\r\n\r\n    // This listener is responsible to stop the dragging action, once the mouse is lifted.\r\n    document.addEventListener('mouseup', () => {\r\n      if (isDragging && abortController) {\r\n        abortController.abort();\r\n        abortController = null;\r\n        isDragging = false;\r\n        dragIndex = -1;\r\n      }\r\n    });\r\n\r\n    // This saves the id of the callback from the color picker.\r\n    let colorPickerListener = -1;\r\n\r\n    // When clicking a control point the color picker is shown.\r\n    this.canvas.addEventListener('click', (e) => {\r\n      if (draggedBefore) {\r\n        return;\r\n      }\r\n\r\n      e.stopPropagation();\r\n      let stop = null;\r\n      for (let i = 0; i < this.colorStops.length; i++) {\r\n        stop = this.colorStops[i];\r\n        const dx = Math.abs(stop.stop * this.canvas.width - e.offsetX);\r\n        if (dx < this.controlPointSize) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (stop !== null) {\r\n        // Figure out, where to position the color picker popup, depending on the available space.\r\n        const pageY = this.canvas.height / 2 + this.canvas.getBoundingClientRect().y;\r\n        const viewPortHeight = window.innerHeight;\r\n        const cpHeight = this.colorPickerContainer.clientHeight;\r\n\r\n        if (pageY + cpHeight < viewPortHeight) {\r\n          // Show below the point\r\n          const y = this.canvas.height / 2;\r\n          this.colorPickerContainer.style.bottom = `${y}px`;\r\n        } else if (pageY - cpHeight > 0) {\r\n          // Show above the point\r\n          const y = this.canvas.height / 2 + cpHeight;\r\n          this.colorPickerContainer.style.bottom = `${y}px`;\r\n        } else {\r\n          // Show vertically centered on the point\r\n          const y = this.canvas.height / 2 + cpHeight / 2;\r\n          this.colorPickerContainer.style.bottom = `${y}px`;\r\n        }\r\n\r\n        const pageX = stop.stop * this.canvas.width + this.canvas.getBoundingClientRect().x;\r\n        const viewPortWidth = window.innerWidth;\r\n        const cpWidth = this.colorPickerContainer.clientWidth;\r\n\r\n        if (pageX + cpWidth < viewPortWidth) {\r\n          // Show right of the point\r\n          const x = stop.stop * this.canvas.width;\r\n          this.colorPickerContainer.style.left = `${x}px`;\r\n        } else if (pageX - cpWidth > 0) {\r\n          // Show left of the point\r\n          const x = stop.stop * this.canvas.width - cpWidth;\r\n          this.colorPickerContainer.style.left = `${x}px`;\r\n        } else {\r\n          // Show horizontally centered on the point\r\n          const x = stop.stop * this.canvas.width - cpWidth / 2;\r\n          this.colorPickerContainer.style.left = `${x}px`;\r\n        }\r\n\r\n        this.colorPickerContainer.style.visibility = 'visible';\r\n        this.colorPicker.removeListener(colorPickerListener);\r\n        this.colorPicker.setHEX(stop.color);\r\n        colorPickerListener = this.colorPicker.addListener((colorPicker) => {\r\n          stop.color = colorPicker.getHEX();\r\n          this.draw();\r\n          this.sendUpdates();\r\n        });\r\n      }\r\n    });\r\n\r\n    // Hides the color picker, if you click outside it.\r\n    document.addEventListener('click', () => {\r\n      this.colorPickerContainer.style.visibility = 'hidden';\r\n    });\r\n\r\n    // This prevents the color picker from closing when clicking inside it.\r\n    this.colorPickerContainer.addEventListener('click', (e) => e.stopPropagation());\r\n\r\n    // Ensures that the canvas gets redrawn when its size changes.\r\n    const resizeObserver = new ResizeObserver(() => {\r\n      this.canvas.width = this.parent.clientWidth;\r\n      this.canvas.height = this.parent.clientHeight;\r\n      this.draw();\r\n    });\r\n    resizeObserver.observe(this.parent);\r\n  }\r\n\r\n  /**\r\n   * Depending on the users options this method creates a dropdown for selecting the interpolation method, a checkbox\r\n   * for toggling if the color map is discrete and a number input for the number of bins.\r\n   */\r\n  private setUpInputElements(finalOptions) {\r\n    // If no controls are enabled we don't add anything to the DOM.\r\n    if (!finalOptions.interpolationMethodsEditable && !finalOptions.binSelectorEditable) {\r\n      return;\r\n    }\r\n\r\n    // The root of the inputs. It aligns them horizontally and wraps them if needed.\r\n    const settingsContainer = document.createElement('div');\r\n    settingsContainer.classList.add('tfe-color-map-editor-settings');\r\n    settingsContainer.style.display = 'flex';\r\n    settingsContainer.style.flexDirection = 'row';\r\n    settingsContainer.style.justifyContent = 'space-between';\r\n    settingsContainer.style.alignItems = 'center';\r\n    settingsContainer.style.flexWrap = 'wrap';\r\n    this.rootElement.appendChild(settingsContainer);\r\n\r\n    if (finalOptions.interpolationMethodsEditable) {\r\n      const label = document.createElement('label');\r\n      label.classList.add('tfe-color-map-editor-interpolation-method-label');\r\n      label.innerText = 'Interpolation: ';\r\n\r\n      this.interpolationMethodElement = document.createElement('select');\r\n      this.interpolationMethodElement.classList.add('tfe-color-map-editor-interpolation-method-select');\r\n\r\n      // Generate options for all interpolation methods.\r\n      for (let method of Object.keys(InterpolationMethod)) {\r\n        const option = document.createElement('option');\r\n        option.classList.add('tfe-color-map-editor-interpolation-method-option');\r\n        option.value = method;\r\n        option.innerText = method.replace('_', ' ');\r\n        this.interpolationMethodElement.options.add(option);\r\n      }\r\n\r\n      this.interpolationMethodElement.value = this.interpolationMethod;\r\n\r\n      this.interpolationMethodElement.addEventListener('change', () => {\r\n        this.interpolationMethod = InterpolationMethod[this.interpolationMethodElement.value];\r\n        this.draw();\r\n        this.sendUpdates();\r\n      });\r\n\r\n      label.appendChild(this.interpolationMethodElement);\r\n      settingsContainer.appendChild(label);\r\n    }\r\n\r\n    if (finalOptions.binSelectorEditable) {\r\n      const binSelectorRoot = document.createElement('div');\r\n      binSelectorRoot.classList.add('tfe-color-map-editor-bin-selector');\r\n      binSelectorRoot.style.display = 'flex';\r\n      binSelectorRoot.style.flexDirection = 'row';\r\n      binSelectorRoot.style.gap = '10px';\r\n      binSelectorRoot.style.alignItems = 'center';\r\n      settingsContainer.appendChild(binSelectorRoot);\r\n\r\n      const checkboxLabel = document.createElement('label');\r\n      checkboxLabel.classList.add('tfe-color-map-editor-bin-selector-checkbox-label');\r\n      checkboxLabel.innerText = 'discrete: ';\r\n      binSelectorRoot.appendChild(checkboxLabel);\r\n\r\n      this.discreteElement = document.createElement('input');\r\n      this.discreteElement.classList.add('tfe-color-map-editor-bin-selector-checkbox');\r\n      this.discreteElement.type = 'checkbox';\r\n      this.discreteElement.checked = this.discrete;\r\n      checkboxLabel.appendChild(this.discreteElement);\r\n\r\n      const binsLabel = document.createElement('label');\r\n      binsLabel.classList.add('tfe-color-map-editor-bin-selector-number-label');\r\n      binsLabel.innerText = 'bins: ';\r\n      binSelectorRoot.appendChild(binsLabel);\r\n\r\n      this.binsElement = document.createElement('input');\r\n      this.binsElement.classList.add('tfe-color-map-editor-bin-selector-number-input');\r\n      this.binsElement.style.width = '50px';\r\n      this.binsElement.disabled = !this.discrete;\r\n      this.binsElement.type = 'number';\r\n      this.binsElement.min = '0';\r\n      this.binsElement.step = '1';\r\n      this.binsElement.valueAsNumber = this.bins;\r\n\r\n      this.discreteElement.addEventListener('change', () => {\r\n        this.discrete = this.discreteElement.checked;\r\n        this.binsElement.disabled = !this.discrete;\r\n\r\n        this.draw();\r\n        this.sendUpdates();\r\n      });\r\n\r\n      this.binsElement.addEventListener('change', () => {\r\n        this.bins = this.binsElement.valueAsNumber;\r\n\r\n        this.draw();\r\n        this.sendUpdates();\r\n      });\r\n\r\n      // Add scroll wheel support to the number input.\r\n      this.binsElement.addEventListener('wheel', (ev: WheelEvent) => {\r\n        ev.preventDefault();\r\n\r\n        let value = this.binsElement.valueAsNumber;\r\n        if (ev.deltaY > 0) {\r\n          // Decrement\r\n          value = Math.max(value - 1, 0);\r\n        } else if (ev.deltaY < 0) {\r\n          // Increment\r\n          value = Math.max(value + 1, 0);\r\n        }\r\n\r\n        this.binsElement.valueAsNumber = Math.round(value);\r\n        this.bins = this.binsElement.valueAsNumber;\r\n\r\n        this.draw();\r\n        this.sendUpdates();\r\n      });\r\n\r\n      // Ensure that all user inputs are properly handled. For example empty and negative input.\r\n      const validateBins = (ev: Event) => {\r\n        const el = ev.currentTarget as HTMLInputElement;\r\n        if (!el.valueAsNumber || el.valueAsNumber < 0) {\r\n          el.valueAsNumber = 0;\r\n          this.bins = this.binsElement.valueAsNumber;\r\n        }\r\n\r\n        this.draw();\r\n        this.sendUpdates();\r\n      };\r\n\r\n      this.binsElement.addEventListener('focusout', validateBins);\r\n      this.binsElement.addEventListener('keypress', (ev: KeyboardEvent) => {\r\n        if (ev.key === 'Enter') {\r\n          validateBins(ev);\r\n        }\r\n      });\r\n\r\n      binsLabel.appendChild(this.binsElement);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * The config options for the {@link ColorMapEditor} component.\r\n */\r\nexport interface ColorMapEditorOptions {\r\n  initialColorMap?:\r\n    | {\r\n        /**\r\n         * The initial color map.\r\n         * Default:\r\n         * [\r\n         *   { stop: 0, color: \"green\" },\r\n         *   { stop: 0.5, color: \"yellow\" },\r\n         *   { stop: 1, color: \"red\" }\r\n         * ]\r\n         */\r\n        colorStops?: Array<ColorStop>;\r\n\r\n        /**\r\n         * The method of interpolation.\r\n         * Default: \"HSL_LONG\"\r\n         */\r\n        interpolationMethod?: InterpolationMethod;\r\n\r\n        /**\r\n         * If the color map is discrete or continuous.\r\n         * Default: false\r\n         */\r\n        discrete?: boolean;\r\n\r\n        /**\r\n         * The number of bins in case the color map is continuous.\r\n         * Default: 7\r\n         */\r\n        bins?: number;\r\n      }\r\n    | ColorMap;\r\n\r\n  /**\r\n   * If the value of a stop is rendered below the control point.\r\n   * Default: false\r\n   */\r\n  showStopNumbers?: boolean;\r\n\r\n  /**\r\n   * If a dropdown with different interpolation methods is shown.\r\n   * Default: true\r\n   */\r\n  interpolationMethodsEditable?: boolean;\r\n\r\n  /**\r\n   * If settings for a discrete color map are shown.\r\n   * Default: true\r\n   */\r\n  binSelectorEditable?: boolean;\r\n\r\n  /**\r\n   * The size of control points in pixel.\r\n   * Default: 7\r\n   */\r\n  controlPointSize?: number;\r\n}\r\n","import {AlphaStop, ColorMap, InterpolationMethod, TransferFunction} from './Types';\r\nimport merge from 'deepmerge';\r\nimport {getColorFromColorMapAt} from './convert';\r\nimport Container from './Container';\r\nimport { overwriteMerge } from \"./utils\";\r\nimport { scaleLinear, ScaleLinear } from \"d3-scale\";\r\nimport { rgb } from \"d3-color\";\r\nimport { interpolateNumber } from \"d3-interpolate\";\r\n\r\n/**\r\n * This creates an editor to create transparency mappings.\r\n *\r\n * @example\r\n *   const te = new TransparencyEditor(\"#te\", {\r\n *      initialAlphaStops: [\r\n *        { stop: 0, alpha: 0 },\r\n *        { stop: 0.5, alpha: 0.5 },\r\n *        { stop: 1, alpha: 1 }\r\n *      ]\r\n *   });\r\n *\r\n *   te.addListener((transparencyEditor) => {\r\n *     console.log(transparencyEditor.getAlphaStops());\r\n *     // output:\r\n *     // [\r\n *     //   { stop: 0, alpha: 0 },\r\n *     //   { stop: 0.5, alpha: 0.5 },\r\n *     //   { stop: 1, alpha: 1 }\r\n *     // ]\r\n *   });\r\n */\r\nexport class TransparencyEditor extends Container {\r\n  /** The gradient and stops are painted in here. It also handles mouse input. */\r\n  private readonly canvas: HTMLCanvasElement;\r\n\r\n  /** The context for the canvas for convenience. */\r\n  private ctx: CanvasRenderingContext2D;\r\n\r\n  /** This is the transparency map, that everything revolves around. The stops are always sorted. */\r\n  private alphaStops: Array<AlphaStop>;\r\n\r\n  /**\r\n   * This color map is used for drawing a gradient in the background. It can be set via function calls, but not via user\r\n   * interaction. For a complete transfer function editor with an editable color map use the TransferFunctionEditor\r\n   * class.\r\n   */\r\n  private colorMap: ColorMap;\r\n\r\n  /** This is used to easily calculate alpha values. */\r\n  private alphaRange: ScaleLinear<number, number>;\r\n\r\n  /** The size of the control points. Might become configurable in the future. */\r\n  private controlPointSize: number;\r\n\r\n  /** If the classic grid pattern is rendered for the transparency. */\r\n  private showAlphaGrid: boolean;\r\n\r\n  /** The pixel size of the alpha grid squares. */\r\n  private alphaGridSize: number;\r\n\r\n  /** This gets called, when the transparency changes to notify users of this library. */\r\n  private callbacks: Map<number, (transparencyEditor: TransparencyEditor) => void> = new Map();\r\n  private callbackCounter = 0;\r\n\r\n  /**\r\n   * Creates a new transparency editor inside the given container.\r\n   *\r\n   * @param container Either an HTMLElement or a query string to an element, in which the editor will be embedded.\r\n   * @param options   Can be used to configure the transparency editor. See {@link TransparencyEditorOptions}.\r\n   */\r\n  constructor(container: HTMLElement | string, options?: TransparencyEditorOptions) {\r\n    super(container);\r\n\r\n    // Set all defaults.\r\n    const defaultOptions: TransparencyEditorOptions = {\r\n      initialAlphaStops: [\r\n        {stop: 0, alpha: 0},\r\n        {stop: 0.5, alpha: 0.5},\r\n        {stop: 1, alpha: 1},\r\n      ],\r\n      initialColorMap: {\r\n        colorStops: [\r\n          {stop: 0, color: 'black'},\r\n          {stop: 1, color: 'black'},\r\n        ],\r\n        interpolationMethod: InterpolationMethod.RGB,\r\n      },\r\n      controlPointSize: 7,\r\n      showAlphaGrid: true,\r\n      alphaGridSize: 8,\r\n    };\r\n\r\n    // Merge the options with the defaults.\r\n    // !!! DON'T USE options AND defaultOptions AFTER THIS LINE !!!\r\n    const finalOptions = merge(defaultOptions, options ?? {}, { arrayMerge: overwriteMerge });\r\n\r\n    this.alphaStops = finalOptions.initialAlphaStops;\r\n    this.sortControlPoints();\r\n    this.colorMap = finalOptions.initialColorMap;\r\n\r\n    this.controlPointSize = finalOptions.controlPointSize;\r\n\r\n    this.showAlphaGrid = finalOptions.showAlphaGrid;\r\n    this.alphaGridSize = finalOptions.alphaGridSize;\r\n\r\n    this.parent.classList.add('tfe-transparency-editor');\r\n\r\n    this.canvas = document.createElement('canvas');\r\n    this.canvas.width = this.parent.clientWidth;\r\n    this.canvas.height = this.parent.clientHeight;\r\n    this.canvas.style.imageRendering = 'pixelated';\r\n    this.parent.appendChild(this.canvas);\r\n    this.ctx = this.canvas.getContext('2d');\r\n    this.updateAlphaRange();\r\n    this.draw();\r\n    this.addEventListeners();\r\n  }\r\n\r\n  /**\r\n   * Register a callback that gets called, when the transfer function changes. The callback gets called once\r\n   * immediately.\r\n   *\r\n   * @param callback The function that gets called whenever the transfer function changes.\r\n   */\r\n  public addListener(callback: (transparencyEditor: TransparencyEditor) => void): number {\r\n    const id = this.callbackCounter++;\r\n    this.callbacks.set(id, callback);\r\n    callback(this);\r\n    return id;\r\n  }\r\n\r\n  /** Removes the listener with the given id. */\r\n  public removeListener(id: number) {\r\n    this.callbacks.delete(id);\r\n  }\r\n\r\n  /** Returns the complete transfer function including the alpha values and the color map. */\r\n  public getTransferFunction(): TransferFunction {\r\n    return {alphaStops: this.alphaStops, colorMap: this.colorMap};\r\n  }\r\n\r\n  /** Returns the color, excluding transparency, at the given stop. */\r\n  public getRGB(stop: number): string {\r\n    return getColorFromColorMapAt(this.colorMap, stop);\r\n  }\r\n\r\n  /** Returns the alpha value at the given stop. */\r\n  public getAlpha(stop: number): number {\r\n    return this.alphaRange(stop);\r\n  }\r\n\r\n  /** Returns the color, including transparency, at the given stop. */\r\n  public getRGBA(stop: number): string {\r\n    const color = rgb(this.getRGB(stop));\r\n    color.opacity = this.getAlpha(stop);\r\n    return color.formatHex8();\r\n  }\r\n\r\n  /** Adds a control point at the given stop with the given alpha value. */\r\n  public addControlPoint(stop, alpha): void {\r\n    this.alphaStops.push({stop, alpha});\r\n    this.sortControlPoints();\r\n    this.updateAlphaRange();\r\n    this.sendUpdate();\r\n    this.draw();\r\n  }\r\n\r\n  /** Remove a control point at the given pixel coordinates. */\r\n  public removeControlPointAt(x, y): void {\r\n    let indexToDelete = -1;\r\n    for (let i = 1; i < this.alphaStops.length - 1; i++) {\r\n      const controlPoint = this.alphaStops[i];\r\n      const dx = controlPoint.stop * this.canvas.width - x;\r\n      const dy = (1 - controlPoint.alpha) * this.canvas.height - y;\r\n      if (Math.sqrt(dx * dx + dy * dy) < this.controlPointSize) {\r\n        indexToDelete = i;\r\n        break;\r\n      }\r\n    }\r\n    if (indexToDelete !== -1) {\r\n      this.alphaStops.splice(indexToDelete, 1);\r\n      this.updateAlphaRange();\r\n      this.sendUpdate();\r\n      this.draw();\r\n    }\r\n  }\r\n\r\n  /** Get the alpha stops. */\r\n  public getAlphaStops(): Array<AlphaStop> {\r\n    return this.alphaStops;\r\n  }\r\n\r\n  /** Replace the existing alpha stops with new ones. */\r\n  public setAlphaStops(alphaStops: Array<AlphaStop>) {\r\n    this.alphaStops = alphaStops;\r\n    this.sortControlPoints();\r\n    this.updateAlphaRange();\r\n    this.sendUpdate();\r\n    this.draw();\r\n  }\r\n\r\n  /** Get the current color map. */\r\n  public getColorMap(): ColorMap {\r\n    return this.colorMap;\r\n  }\r\n\r\n  /** Set a new color map. */\r\n  public setColorMap(colorMap: ColorMap) {\r\n    this.colorMap = colorMap;\r\n    this.sendUpdate();\r\n    this.draw();\r\n  }\r\n\r\n  public createLookUpTable(numBins: number): Array<string> {\r\n    const result: Array<string> = [];\r\n    for (let i = 0.0; i <= 1.0; i += 1.0 / (numBins - 1)) {\r\n      result.push(this.getRGBA(i));\r\n    }\r\n    return result;\r\n  }\r\n\r\n  /** This function notifies all listeners to this transparency editor. */\r\n  private sendUpdate() {\r\n    this.callbacks.forEach((value) => value(this));\r\n  }\r\n\r\n  /** Generate a new d3 range. */\r\n  private updateAlphaRange() {\r\n    this.alphaRange = scaleLinear<number, number>()\r\n      .domain(this.alphaStops.map((entry) => entry.stop))\r\n      .range(this.alphaStops.map((entry) => entry.alpha))\r\n      .interpolate(interpolateNumber);\r\n  }\r\n\r\n  /** Draws the transfer function, the control points, and the transparency grid into the canvas. */\r\n  private draw() {\r\n    // Clear the drawing area.\r\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n    // If the alpha grid is enabled we draw it.\r\n    if (this.showAlphaGrid) {\r\n      this.ctx.fillStyle = '#CACACA';\r\n      for (let y = 0; y < this.canvas.height / this.alphaGridSize; y++) {\r\n        for (let x = 0; x < this.canvas.width / this.alphaGridSize; x++) {\r\n          if ((x % 2 == 0 && y % 2 == 0) || (x % 2 == 1 && y % 2 == 1)) {\r\n            this.ctx.fillRect(x * this.alphaGridSize, y * this.alphaGridSize, this.alphaGridSize, this.alphaGridSize);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Draw the color gradient.\r\n    for (let i = 0; i < this.canvas.width; ++i) {\r\n      const alpha = this.getAlpha(i / (this.canvas.width - 1));\r\n      this.ctx.fillStyle = this.getRGBA(i / (this.canvas.width - 1));\r\n      this.ctx.fillRect(i, (1 - alpha) * this.canvas.height, 1, alpha * this.canvas.height);\r\n\r\n      if (this.showAlphaGrid) {\r\n        this.ctx.clearRect(i, 0, 1, (1 - alpha) * this.canvas.height);\r\n      }\r\n    }\r\n\r\n    // Draw the lines between points.\r\n    this.ctx.strokeStyle = 'black';\r\n    this.ctx.beginPath();\r\n    for (let i = 0; i < this.alphaStops.length; i++) {\r\n      const x = this.alphaStops[i].stop * this.canvas.width;\r\n      const y = (1 - this.alphaStops[i].alpha) * this.canvas.height;\r\n      if (i === 0) {\r\n        this.ctx.moveTo(x, y);\r\n      } else {\r\n        this.ctx.lineTo(x, y);\r\n      }\r\n    }\r\n    this.ctx.stroke();\r\n\r\n    // Draw the control points.\r\n    this.ctx.fillStyle = 'white';\r\n    for (let i = 0; i < this.alphaStops.length; i++) {\r\n      const x = this.alphaStops[i].stop * this.canvas.width;\r\n      const y = (1 - this.alphaStops[i].alpha) * this.canvas.height;\r\n      this.ctx.strokeStyle = 'black';\r\n      this.ctx.beginPath();\r\n      this.ctx.arc(x, y, this.controlPointSize, 0, 2 * Math.PI);\r\n      this.ctx.fill();\r\n      this.ctx.stroke();\r\n    }\r\n  }\r\n\r\n  /** Helper function to ensure all control points are in the correct order. */\r\n  private sortControlPoints() {\r\n    this.alphaStops.sort((a, b) => a.stop - b.stop);\r\n  }\r\n\r\n  /** This helper function calculates which pixels correspond to which stop and alpha value. */\r\n  private pixelToNormalized(x: number, y: number): {stop: number; alpha: number} {\r\n    const stop = Math.max(0, Math.min(1, x / this.canvas.width));\r\n    const alpha = Math.max(0, Math.min(1, 1 - y / this.canvas.height));\r\n    return {stop, alpha};\r\n  }\r\n\r\n  /** Adds event listeners for creating, moving and deleting control points. */\r\n  private addEventListeners() {\r\n    // Tracks if the user is currently dragging a control point.\r\n    let isDragging: boolean = false;\r\n\r\n    // The index of the currently dragged control point.\r\n    let dragIndex: number = -1;\r\n\r\n    // The AbortController is for removing the mousemove listener from the document, when the user stops dragging.\r\n    let abortController: AbortController = null;\r\n\r\n    /**\r\n     * This function checks if a control point was selected, sets the dragIndex and isDragging fields and attaches a\r\n     * mouse move listener to the document. This allows for more consistent control.\r\n     */\r\n    const checkDragStart = (e: {offsetX: number; offsetY: number}) => {\r\n      // Figure out which control point was selected.\r\n      dragIndex = -1;\r\n      for (let i = 0; i < this.alphaStops.length; i++) {\r\n        const controlPoint = this.alphaStops[i];\r\n        const dx = controlPoint.stop * this.canvas.width - e.offsetX;\r\n        const dy = (1 - controlPoint.alpha) * this.canvas.height - e.offsetY;\r\n        if (Math.sqrt(dx * dx + dy * dy) < this.controlPointSize) {\r\n          dragIndex = i;\r\n          isDragging = true;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (isDragging) {\r\n        // Attach a mouse move listener to the document.\r\n        abortController = new AbortController();\r\n        document.addEventListener(\r\n          'mousemove',\r\n          (e) => {\r\n            e.preventDefault();\r\n            const offsetX = e.clientX - this.canvas.getBoundingClientRect().x;\r\n            const offsetY = e.clientY - this.canvas.getBoundingClientRect().y;\r\n\r\n            const {stop, alpha} = this.pixelToNormalized(offsetX, offsetY);\r\n\r\n            if (dragIndex === 0) {\r\n              this.alphaStops[dragIndex].alpha = alpha;\r\n            } else if (dragIndex === this.alphaStops.length - 1) {\r\n              this.alphaStops[dragIndex].alpha = alpha;\r\n            } else {\r\n              const leftBound = this.alphaStops[dragIndex - 1].stop + Number.EPSILON;\r\n              const rightBound = this.alphaStops[dragIndex + 1].stop - Number.EPSILON;\r\n              this.alphaStops[dragIndex].stop = Math.max(leftBound, Math.min(rightBound, stop));\r\n              this.alphaStops[dragIndex].alpha = alpha;\r\n            }\r\n            this.updateAlphaRange();\r\n            this.sendUpdate();\r\n            this.draw();\r\n          },\r\n          {signal: abortController.signal}\r\n        );\r\n      }\r\n    };\r\n\r\n    // This listener is responsible for:\r\n    //  - Starting dragging a control point, if one was pressed on with the left mouse button.\r\n    //  - Adding a control point if the left mouse button was pressed anywhere else (also starts dragging the newly\r\n    //    created point).\r\n    //  - Removing a control point on right click.\r\n    this.canvas.addEventListener('mousedown', (e) => {\r\n      if (e.button === 0) {\r\n        // Left click\r\n        checkDragStart(e);\r\n      }\r\n\r\n      if (isDragging) {\r\n        return;\r\n      }\r\n\r\n      if (e.button === 0) {\r\n        // Left click\r\n        const {stop, alpha} = this.pixelToNormalized(e.offsetX, e.offsetY);\r\n        this.addControlPoint(stop, alpha);\r\n        checkDragStart(e);\r\n      } else if (e.button === 2) {\r\n        // Right click\r\n        e.preventDefault();\r\n        this.removeControlPointAt(e.offsetX, e.offsetY);\r\n      }\r\n    });\r\n\r\n    this.canvas.addEventListener('contextmenu', (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      return false;\r\n    });\r\n\r\n    // This listener is responsible to stop the dragging action, once the mouse is lifted.\r\n    document.addEventListener('mouseup', () => {\r\n      if (isDragging && abortController) {\r\n        abortController.abort();\r\n        abortController = null;\r\n        isDragging = false;\r\n        dragIndex = -1;\r\n      }\r\n    });\r\n\r\n    // Ensure, that when the container size changes we adjust the canvas size and redraw.\r\n    const resizeObserver = new ResizeObserver(() => {\r\n      this.canvas.width = this.parent.clientWidth;\r\n      this.canvas.height = this.parent.clientHeight;\r\n      this.draw();\r\n    });\r\n    resizeObserver.observe(this.parent);\r\n  }\r\n}\r\n\r\n/**\r\n * The config options for the {@link TransparencyEditor} component.\r\n */\r\nexport interface TransparencyEditorOptions {\r\n  /**\r\n   * The initial list of alpha stops.\r\n   * Default:\r\n   * [\r\n   *   { stop: 0, alpha: 0 },\r\n   *   { stop: 0.5, alpha: 0.5 },\r\n   *   { stop: 1, alpha: 1 }\r\n   * ]\r\n   */\r\n  initialAlphaStops?: Array<AlphaStop>;\r\n\r\n  /**\r\n   * The initial color map.\r\n   * Default:\r\n   * {\r\n   *   colorStops: [\r\n   *     { stop: 0, color: \"black\" },\r\n   *     { stop: 1, color: \"black\" }\r\n   *   ],\r\n   *   interpolationMethod: InterpolationMethod.RGB\r\n   * }\r\n   */\r\n  initialColorMap?: ColorMap;\r\n\r\n  /**\r\n   * The size of control points in pixel.\r\n   * Default: 7\r\n   */\r\n  controlPointSize?: number;\r\n\r\n  /**\r\n   * If the transparency should be visualized using the classic grid.\r\n   * Default: true\r\n   */\r\n  showAlphaGrid?: boolean;\r\n\r\n  /**\r\n   * The size in pixel of the grid cells.\r\n   * Default: 8\r\n   */\r\n  alphaGridSize?: number;\r\n}\r\n","import {ColorMapEditor} from './ColorMapEditor';\r\nimport {TransparencyEditor} from './TransparencyEditor';\r\nimport {AlphaStop, ColorMap, ColorMapBin, ColorStop, TransferFunction} from './Types';\r\nimport merge from 'deepmerge';\r\nimport { overwriteMerge } from \"./utils\";\r\nimport { getColorFromColorMapAt } from \"./convert\";\r\nimport { rgb } from \"d3-color\";\r\n\r\n/**\r\n * This component creates a complete transfer function editor, combining the features from the transparency and color\r\n * map editors.\r\n *\r\n * @example\r\n *   const tf = new TransferFunctionEditor(\"#tf-editor\", {\r\n *     initialColorMap: {\r\n *       colorStops: [\r\n *         {stop: 0, color: \"blue\"},\r\n *         {stop: 0.5, color: \"white\"},\r\n *         {stop: 1, color: \"red\"}\r\n *       ]\r\n *     }\r\n *   });\r\n *\r\n *\r\n *   tf.addListener((transferFunctionEditor) => {\r\n *     console.log(transferFunctionEditor.getTransferFunction());\r\n *     // output:\r\n *     // {\r\n *     //   alphaStops: [\r\n *     //     { stop: 0, alpha: 0 },\r\n *     //     { stop: 0.5, alpha: 0.5 },\r\n *     //     { stop: 1, alpha: 1 }\r\n *     //   ],\r\n *     //   colorMap: {\r\n *     //     colorStops: [\r\n *     //       { stop: 0, color: \"blue\" },\r\n *     //       { stop: 0.5, color\": \"white\" },\r\n *     //       { stop: 1, color: \"red\" }\r\n *     //     ],\r\n *     //     interpolationMethod: \"HSL_LONG\"\r\n *     //   }\r\n *     // }\r\n *   }\r\n */\r\nexport class TransferFunctionEditor {\r\n  /** The element, in which the transfer function editor gets embedded. */\r\n  private container: HTMLElement;\r\n\r\n  /** The editor component for changing the transparencies. */\r\n  private transparencyEditor: TransparencyEditor;\r\n\r\n  /** The editor component for changing the colors. */\r\n  private colorMapEditor: ColorMapEditor;\r\n\r\n  /** This gets called, when the transfer function changes to notify users of this library. */\r\n  private callbacks: Map<number, (transferFunctionEditor: TransferFunctionEditor) => void> = new Map();\r\n  private callbackCounter = 0;\r\n\r\n  /**\r\n   * Creates a new transfer function editor inside the given container.\r\n   *\r\n   * @param container Either an HTMLElement or a query string to an element, in which the editor will be embedded.\r\n   * @param options   Can be used to configure the transfer function editor. See {@link TransferFunctionEditorOptions}.\r\n   */\r\n  constructor(container: HTMLElement | string, options?: TransferFunctionEditorOptions) {\r\n    if (container) {\r\n      if (typeof container === 'string') {\r\n        this.container = document.querySelector(container);\r\n      } else {\r\n        this.container = container;\r\n      }\r\n    } else {\r\n      throw 'No element given!';\r\n    }\r\n\r\n    // Set all defaults.\r\n    const defaultOptions: TransferFunctionEditorOptions = {};\r\n\r\n    // Merge the options with the defaults.\r\n    // !!! DON'T USE options AND defaultOptions AFTER THIS LINE !!!\r\n    const finalOptions = merge(defaultOptions, options ?? {}, { arrayMerge: overwriteMerge });\r\n\r\n    this.container.classList.add('tfe-transfer-function-editor');\r\n\r\n    const transparencyEditorElement = document.createElement('div');\r\n    transparencyEditorElement.style.width = '100%';\r\n    transparencyEditorElement.style.minHeight = '50px';\r\n    this.container.append(transparencyEditorElement);\r\n    this.transparencyEditor = new TransparencyEditor(transparencyEditorElement, finalOptions);\r\n\r\n    const colorMapEditorElement = document.createElement('div');\r\n    colorMapEditorElement.style.width = '100%';\r\n    colorMapEditorElement.style.minHeight = '10px';\r\n    this.container.append(colorMapEditorElement);\r\n    this.colorMapEditor = new ColorMapEditor(colorMapEditorElement, finalOptions);\r\n\r\n    // Connect the color map editor to the transparency editor.\r\n    this.colorMapEditor.addListener((colorMapEditor) =>\r\n      this.transparencyEditor.setColorMap(colorMapEditor.getColorMap())\r\n    );\r\n\r\n    this.transparencyEditor.setColorMap(this.colorMapEditor.getColorMap());\r\n\r\n    // When something in the transparency editor changes we notify our listeners. This also includes changes to the\r\n    // color map. The control flow goes like this:\r\n    // ColorMapEditor --notify--> TransparencyEditor --notify--> TransferFunctionEditor --notify--> Listeners\r\n    this.transparencyEditor.addListener(() => {\r\n      this.callbacks.forEach((value) => value(this));\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Register a callback that gets called, when the transfer function changes. The callback gets called once\r\n   * immediately.\r\n   *\r\n   * @param callback The function that gets called whenever the transfer function changes.\r\n   */\r\n  public addListener(callback: (transferFunctionEditor: TransferFunctionEditor) => void): number {\r\n    const id = this.callbackCounter++;\r\n    this.callbacks.set(id, callback);\r\n    callback(this);\r\n    return id;\r\n  }\r\n\r\n  /** Removes the listener with the given id. */\r\n  public removeListener(id: number) {\r\n    this.callbacks.delete(id);\r\n  }\r\n  /** Returns the color, excluding transparency, at the given stop. */\r\n  public getRGB(stop: number): string {\r\n    return this.transparencyEditor.getRGB(stop);\r\n  }\r\n\r\n  /** Returns the alpha value at the given stop. */\r\n  public getAlpha(stop: number): number {\r\n    return this.transparencyEditor.getAlpha(stop);\r\n  }\r\n\r\n  /** Returns the color, including transparency, at the given stop. */\r\n  public getRGBA(stop: number): string {\r\n    return this.transparencyEditor.getRGBA(stop);\r\n  }\r\n\r\n  /** Get the alpha stops. */\r\n  public getAlphaStops(): Array<AlphaStop> {\r\n    return this.transparencyEditor.getAlphaStops();\r\n  }\r\n\r\n  /** Replace the existing alpha stops with new ones. */\r\n  public setAlphaStops(alphaStops: Array<AlphaStop>) {\r\n    this.transparencyEditor.setAlphaStops(alphaStops);\r\n  }\r\n\r\n  /** Get the current color map. */\r\n  public getColorMap(): ColorMap {\r\n    return this.colorMapEditor.getColorMap();\r\n  }\r\n\r\n  /**\r\n   * This function returns an array of bins with their color, if the color map is discrete. Otherwise, it will return an\r\n   * empty array.\r\n   */\r\n  public getDiscreteColorMap(): Array<ColorMapBin> {\r\n    return this.colorMapEditor.getDiscreteColorMap();\r\n  }\r\n\r\n  /** Set a new color map. */\r\n  public setColorMap(colorMap: Array<ColorStop>) {\r\n    this.colorMapEditor.setColorStops(colorMap);\r\n  }\r\n\r\n  /** Returns the complete transfer function including the alpha values and the color map. */\r\n  public getTransferFunction(): TransferFunction {\r\n    return this.transparencyEditor.getTransferFunction();\r\n  }\r\n\r\n  public createLookUpTable(numBins: number): Array<string> {\r\n    return this.transparencyEditor.createLookUpTable(numBins);\r\n  }\r\n}\r\n\r\n/**\r\n * The config options for the {@link TransferFunctionEditor} component.\r\n */\r\nexport interface TransferFunctionEditorOptions {\r\n  /**\r\n   * The initial list of alpha stops.\r\n   * Default:\r\n   * [\r\n   *   { stop: 0, alpha: 0 },\r\n   *   { stop: 0.5, alpha: 0.5 },\r\n   *   { stop: 1, alpha: 1 }\r\n   * ]\r\n   */\r\n  initialAlphaStops?: Array<AlphaStop>;\r\n\r\n  /**\r\n   * The initial color map.\r\n   * Default:\r\n   * {\r\n   *   colorStops: [\r\n   *     { stop: 0, color: \"green\" },\r\n   *     { stop: 0.5, color: \"yellow\" },\r\n   *     { stop: 1, color: \"red\" }\r\n   *   ],\r\n   *   interpolationMethod: InterpolationMethod.HSL_LONG,\r\n   *   discrete: false,\r\n   *   bins: 7\r\n   * }\r\n   */\r\n  initialColorMap?: ColorMap;\r\n\r\n  /**\r\n   * If the value of a stop is rendered below the control point.\r\n   * Default: false\r\n   */\r\n  showStopNumbers?: boolean;\r\n\r\n  /**\r\n   * If a dropdown with different interpolation methods is shown.\r\n   * Default: true\r\n   */\r\n  interpolationMethodsEditable?: boolean;\r\n\r\n  /**\r\n   * If settings for a discrete color map are shown.\r\n   * Default: true\r\n   */\r\n  binSelectorEditable?: boolean;\r\n\r\n  /**\r\n   * The size of control points in pixel.\r\n   * Default: 7\r\n   */\r\n  controlPointSize?: number;\r\n\r\n  /**\r\n   * If the transparency should be visualized using the classic grid.\r\n   * Default: true\r\n   */\r\n  showAlphaGrid?: boolean;\r\n\r\n  /**\r\n   * The size in pixel of the grid cells.\r\n   * Default: 8\r\n   */\r\n  alphaGridSize?: number;\r\n}\r\n"],"names":["InterpolationMethod","drawControlPoint","context","x","y","pointSize","i","beginPath","strokeStyle","arc","Math","PI","stroke","Container","container","this","parent","document","querySelector","NumberInputField","_Container","options","_this","call","value","label","input","min","max","step","integerOnly","callbacks","Map","callbackCounter","finalOptions","Object","assign","undefined","initialValue","classList","add","createElement","type","toString","setValue","innerText","appendChild","setUpEventListeners","_inheritsLoose","_proto","prototype","addListener","callback","id","set","removeListener","getValue","notifyObservers","_this2","tmp","round","valueAsNumber","forEach","validateInput","Number","isFinite","validateFinalInput","_this3","addEventListener","ev","preventDefault","deltaY","key","define$2","constructor","factory","extend","definition","create","Color","darker","brighter","reI","reN","reP","reHex","reRgbInteger","RegExp","reRgbPercent","reRgbaInteger","reRgbaPercent","reHslPercent","reHslaPercent","named","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","color_formatHex","rgb","formatHex","color_formatRgb","formatRgb","color","format","m","l","trim","toLowerCase","exec","length","parseInt","rgbn","Rgb","rgba","hsla","hasOwnProperty","NaN","n","r","g","b","a","rgbConvert","o","opacity","arguments","rgb_formatHex","hex","rgb_formatRgb","clampa","clampi","isNaN","h","s","Hsl","hslConvert","hsl","clamph","clampt","hsl2rgb","m1","m2","define","copy","channels","displayable","formatHex8","formatHsl","k","pow","clamp","radians","degrees","Xn","Yn","Zn","t0","t1","t2","t3","labConvert","Lab","Hcl","hcl2lab","z","rgb2lrgb","xyz2lab","lab","t","lab2xyz","lrgb2rgb","hcl","c","atan2","sqrt","hclConvert","cos","sin","A","B","C","D","E","ED","EB","BC_DA","cubehelix","Cubehelix","bl","cubehelixConvert","define$1","cosh","sinh","hsv","v","Hsv","d","hsvConvert","hsvPrototype","hsv2rgb","r1","g1","b1","constant$2","linear","color$1","constant","hue","start","end","colorHsv","abs","interpolateHsv","hsvLong","ColorPicker","backUpHue","backUpSaturation","svCanvas","svContext","hCanvas","hContext","CANVAS_SIZE","controlPointSize","inputFields","previewElement","initialColor","innerHTML","getHEX","getContext","alpha","drawSVPicker","addSVEventListener","style","background","drawHPicker","addHEventListener","addInputEventListeners","setHEX","validateHueAndSaturation","sendUpdate","updateAll","setRGB","setRGBNormalized","setHSL","setHSLNormalized","setHSV","setHSVNormalized","getRGB","getRGBNormalized","getHSL","hslColor","getHSLNormalized","getHSV","getHSVNormalized","getColor","getColorNormalized","backgroundColor","drawAll","updateInputFields","fillStyle","fillRect","saturationGradient","createLinearGradient","addColorStop","valueGradient","clearRect","width","height","isDragging","abortController","updateSV","updateHSVInputFields","updateRGBInputFields","updateHEXInputField","e","button","AbortController","clientX","getBoundingClientRect","clientY","signal","offsetX","offsetY","abort","_this4","updateH","setupNumberInputListeners","setupHEXListeners","_this5","updateInProgress","onHSVUpdate","onRGBUpdate","oldRGB","_this6","element","currentTarget","match","remove","number","head","insertAdjacentHTML","isMergeableObject","isNonNullObject","stringValue","$$typeof","REACT_ELEMENT_TYPE","isReactElement","isSpecial","Symbol","for","cloneUnlessOtherwiseSpecified","clone","deepmerge","Array","isArray","defaultArrayMerge","target","source","concat","map","getKeys","keys","getOwnPropertySymbols","filter","symbol","propertyIsEnumerable","getEnumerableOwnPropertySymbols","propertyIsOnObject","object","property","_","arrayMerge","sourceIsArray","destination","propertyIsUnsafe","customMerge","getMergeFunction","mergeObject","all","array","Error","reduce","prev","next","cjs","ascending","bisector","f","delta","compare","left","lo","hi","mid","ascendingComparator","center","right","bisectRight","bisect","e10","e5","e2","tickIncrement","stop","count","power","floor","log","LN10","error","initRange","domain","range","constant$1","nogamma","rgbGamma","exponential","gamma","colorRgb","numberArray","slice","genericArray","nb","na","date","Date","setTime","interpolateNumber$1","reA","reB","string","am","bm","bs","bi","lastIndex","q","index","push","one","zero","join","interpolate","ArrayBuffer","isView","DataView","valueOf","interpolateRound","unit","identity","normalize","bimap","d0","d1","r0","polymap","j","reverse","formatDecimalParts","p","toExponential","indexOf","coefficient","exponent","prefixExponent","re","formatSpecifier","specifier","FormatSpecifier","fill","align","sign","comma","precision","formatRounded","formatTypes","toFixed","toLocaleString","replace","toPrecision","X","toUpperCase","locale","formatPrefix","prefixes","scale","transform","untransform","unknown","piecewise","output","interpolateValue","rescale","invert","interpolateNumber","from","rangeRound","u","transformer","apply","ticks","tickFormat","step0","step1","tickStep","precisionPrefix","precisionRound","precisionFixed","nice","prestep","i0","i1","maxIter","ceil","linearish","grouping","thousands","group","substring","currencyPrefix","currency","currencySuffix","decimal","numerals","formatNumerals","String","percent","minus","nan","newFormat","prefix","test","suffix","formatType","maybeSuffix","valuePrefix","valueSuffix","valueNegative","out","formatTrim","charCodeAt","Infinity","padding","formatLocale","interpolateRgb","colorHsl","interpolateHsl","hslLong","colorLab","colorHcl","interpolateHcl","hclLong","cubehelixGamma","colorCubehelix","interpolateCubehelix","cubehelixLong","colorRangeCache","WeakMap","getColorRange","colorMap","has","get","colorRange","scaleLinear","colorStops","entry","getColorInterpolator","interpolationMethod","getColorFromColorMapAt","discrete","bins","getColorMapBins","binSize","result","lowerBound","upperBound","interpolationMethods","RGB","HSL","HSL_LONG","interpolateHslLong","HSV","HSV_LONG","interpolateHsvLong","HCL","HCL_LONG","interpolateHclLong","LAB","interpolateLab","CUBEHELIX","CUBEHELIX_LONG","interpolateCubehelixLong","overwriteMerge","_destinationArray","sourceArray","ColorMapEditor","rootElement","canvas","ctx","showStopNumbers","colorPickerContainer","interpolationMethodElement","discreteElement","binsElement","colorPicker","merge","initialColorMap","interpolationMethodsEditable","binSelectorEditable","sortControlPoints","display","flexDirection","gap","clientWidth","clientHeight","border","visibility","position","setUpInputElements","draw","addCanvasEventListeners","setColorStops","sendUpdates","getColorStops","setInterpolationMethods","getInterpolationMethods","setDiscrete","disabled","isDiscrete","setBins","getBins","setColorMap","checked","getColorMap","getDiscreteColorMap","sort","textAlign","brightness","fillText","draggedBefore","dragIndex","checkDragStart","EPSILON","dx","dy","splice","stopPropagation","colorPickerListener","pageY","viewPortHeight","window","innerHeight","cpHeight","bottom","pageX","viewPortWidth","innerWidth","cpWidth","ResizeObserver","observe","settingsContainer","justifyContent","alignItems","flexWrap","_i2","_Object$keys","method","option","binSelectorRoot","checkboxLabel","binsLabel","validateBins","el","TransparencyEditor","alphaStops","alphaRange","showAlphaGrid","alphaGridSize","initialAlphaStops","imageRendering","updateAlphaRange","addEventListeners","getTransferFunction","getAlpha","getRGBA","addControlPoint","removeControlPointAt","indexToDelete","controlPoint","getAlphaStops","setAlphaStops","createLookUpTable","numBins","moveTo","lineTo","pixelToNormalized","_this3$pixelToNormali","_this3$pixelToNormali2","TransferFunctionEditor","transparencyEditor","colorMapEditor","transparencyEditorElement","minHeight","append","colorMapEditorElement"],"mappings":"iNA0DY,IAAAA,EC1DN,SAAUC,EAAiBC,EAAmCC,EAAWC,EAAWC,GAExF,IADA,IACSC,EAAI,EAAGA,EADA,GACaA,IAC3BJ,EAAQK,YACRL,EAAQM,YAAcF,EAAI,GAAM,EAAI,QAAU,QAC9CJ,EAAQO,IAAIN,EAAGC,EAAGC,EAAYC,EAJhB,IAIgC,EAAII,KAAKC,KAAOL,EAAI,GAJpD,IAIqE,EAAII,KAAKC,KAC5FT,EAAQU,QAEZ,EDkDA,SAAYZ,GACVA,EAAA,IAAA,MACAA,EAAA,IAAA,MACAA,EAAA,SAAA,WACAA,EAAA,IAAA,MACAA,EAAA,SAAA,WACAA,EAAA,IAAA,MACAA,EAAA,SAAA,WACAA,EAAA,IAAA,MACAA,EAAA,UAAA,YACAA,EAAA,eAAA,gBACD,CAXD,CAAYA,IAAAA,EAWX,CAAA,QEpEoBa,EAInB,SAAYC,GAEV,GAFyCC,KAFxBC,YAAM,GAInBF,EAOF,KAAM,oBALJC,KAAKC,OADkB,iBAAdF,EACKG,SAASC,cAAcJ,GAEvBA,CAKpB,ECVmBK,EAAiB,SAAAC,GAgCpC,SAAAD,EAAYL,EAAiCO,GAAiCC,IAAAA,GAC5EA,EAAAF,EAAAG,UAAMT,IAAWQ,MA/BXE,aAAKF,EAGIG,WAAK,EAAAH,EAGLI,WAAKJ,EAAAA,EAGLK,SAAGL,EAAAA,EAGHM,SAAG,EAAAN,EAGHO,YAAIP,EAGJQ,iBAAW,EAAAR,EAGpBS,UAAkD,IAAIC,IAAKV,EAC3DW,gBAAkB,EAYxB,IAWMC,EAAeC,OAAOC,OAXoB,CAC9CX,WAAOY,EACPC,aAAc,EACdX,SAAKU,EACLT,SAAKS,EACLR,KAAM,EACNC,aAAa,GAKoCT,GAkCxB,OAhC3BC,EAAKN,OAAOuB,UAAUC,IAAI,+BAC1BlB,EAAKI,MAAQT,SAASwB,cAAc,SACpCnB,EAAKI,MAAMa,UAAUC,IAAI,gCACzBlB,EAAKI,MAAMgB,KAAO,cAEOL,IAArBH,EAAaP,MACfL,EAAKI,MAAMC,IAAMO,EAAaP,IAAIgB,WAClCrB,EAAKK,IAAMO,EAAaP,UAGDU,IAArBH,EAAaN,MACfN,EAAKI,MAAME,IAAMM,EAAaN,IAAIe,WAClCrB,EAAKM,IAAMM,EAAaN,KAG1BN,EAAKI,MAAMG,KAAOK,EAAaL,KAAKc,WACpCrB,EAAKO,KAAOK,EAAaL,KACzBP,EAAKQ,YAAcI,EAAaJ,YAEhCR,EAAKsB,SAASV,EAAaI,cAGvBJ,EAAaT,OACfH,EAAKG,MAAQR,SAASwB,cAAc,SACpCnB,EAAKG,MAAMc,UAAUC,IAAI,gCACzBlB,EAAKG,MAAMoB,UAAYX,EAAaT,MACpCH,EAAKG,MAAMqB,YAAYxB,EAAKI,OAC5BJ,EAAKN,OAAO8B,YAAYxB,EAAKG,QAE7BH,EAAKN,OAAO8B,YAAYxB,EAAKI,OAG/BJ,EAAKyB,sBAAsBzB,CAC7B,CAlFoC0B,EAAA7B,EAAAC,GAkFnC,IAAA6B,EAAA9B,EAAA+B,UAqHA/B,OArHA8B,EAOME,YAAA,SAAYC,GACjB,IAAMC,EAAKtC,KAAKkB,kBAGhB,OAFAlB,KAAKgB,UAAUuB,IAAID,EAAID,GACvBA,EAASrC,KAAKS,OACP6B,CACT,EAACJ,EAGMM,eAAA,SAAeF,GACpBtC,KAAKgB,UAAgB,OAACsB,EACxB,EAACJ,EAGMO,SAAA,WACL,OAAOzC,KAAKS,KACd,EAACyB,EAMML,SAAA,SAASpB,EAAeiC,OAA+BC,EAAA3C,KAC5D,QAD6B,IAAA0C,IAAAA,GAA2B,GACpDjC,IAAUT,KAAKS,MAAnB,CAIA,IAAImC,EAAMnC,OACOa,IAAbtB,KAAKY,KAAqBH,EAAQT,KAAKY,IACzCgC,EAAM5C,KAAKY,SACWU,IAAbtB,KAAKa,KAAqBJ,EAAQT,KAAKa,MAChD+B,EAAM5C,KAAKa,KAGbb,KAAKS,MAAQT,KAAKe,YAAcpB,KAAKkD,MAAMD,GAAOA,EAClD5C,KAAKW,MAAMmC,cAAgB9C,KAAKS,MAE5BiC,GACF1C,KAAKgB,UAAU+B,QAAQ,SAACV,GACtBA,EAASM,EAAKlC,MAChB,EAfD,CAiBH,EAACyB,EAMOc,cAAA,WAON,YANiB1B,IAAbtB,KAAKY,KAAqBZ,KAAKW,MAAMmC,cAAgB9C,KAAKY,IAC5DZ,KAAKW,MAAMmC,cAAgB9C,KAAKY,SACVU,IAAbtB,KAAKa,KAAqBb,KAAKW,MAAMmC,cAAgB9C,KAAKa,MACnEb,KAAKW,MAAMmC,cAAgB9C,KAAKa,KAG3BoC,OAAOC,SAASlD,KAAKW,MAAMmC,eAAiB9C,KAAKW,MAAMmC,cAAgB,IAChF,EAACZ,EAGOiB,mBAAA,WAEN,OAAc,OADAnD,KAAKgD,iBAEjBhD,KAAKW,MAAMmC,cAAgB9C,KAAKY,SACpBA,KAGhB,IAAA,EAACsB,EAKOF,oBAAA,WAAmBoB,IAAAA,OAEzBpD,KAAKW,MAAM0C,iBAAiB,QAAS,SAACC,GACpCA,EAAGC,iBAECD,EAAGE,OAAS,EAEdJ,EAAKvB,SAASuB,EAAK3C,MAAQ2C,EAAKtC,MACvBwC,EAAGE,OAAS,GAErBJ,EAAKvB,SAASuB,EAAK3C,MAAQ2C,EAAKtC,KAEpC,GAIAd,KAAKW,MAAM0C,iBAAiB,QAAS,WACnC,IAAM5C,EAAQ2C,EAAKJ,gBACL,OAAVvC,GACF2C,EAAKvB,SAASpB,EAElB,GAGAT,KAAKW,MAAM0C,iBAAiB,WAAY,WACtC,IAAM5C,EAAQ2C,EAAKD,qBACL,OAAV1C,GACF2C,EAAKvB,SAASpB,EAElB,GAGAT,KAAKW,MAAM0C,iBAAiB,WAAY,SAACC,GACvC,GAAe,UAAXA,EAAGG,IAAiB,CACtB,IAAMhD,EAAQ2C,EAAKD,qBACL,OAAV1C,GACF2C,EAAKvB,SAASpB,EAEjB,CACH,EACF,EAACL,CAAA,CAvMmC,CAAQN,GCN/B,SAAA4D,EAASC,EAAaC,EAASzB,GAC5CwB,EAAYxB,UAAYyB,EAAQzB,UAAYA,EAC5CA,EAAUwB,YAAcA,CAC1B,CAEO,SAASE,EAAO5D,EAAQ6D,GAC7B,IAAI3B,EAAYf,OAAO2C,OAAO9D,EAAOkC,WACrC,IAAK,IAAIsB,KAAOK,EAAY3B,EAAUsB,GAAOK,EAAWL,GACxD,OAAOtB,CACT,CCPO,SAAS6B,IAAU,CAEnB,IAAIC,EAAS,GACTC,EAAW,EAAID,EAEtBE,EAAM,sBACNC,EAAM,oDACNC,EAAM,qDACNC,EAAQ,qBACRC,EAAe,IAAIC,OAAO,UAAUL,KAAOA,KAAOA,SAClDM,EAAe,IAAID,OAAO,UAAUH,KAAOA,KAAOA,SAClDK,EAAgB,IAAIF,OAAO,WAAWL,KAAOA,KAAOA,KAAOC,SAC3DO,EAAgB,IAAIH,OAAO,WAAWH,KAAOA,KAAOA,KAAOD,SAC3DQ,EAAe,IAAIJ,OAAO,UAAUJ,KAAOC,KAAOA,SAClDQ,EAAgB,IAAIL,OAAO,WAAWJ,KAAOC,KAAOA,KAAOD,SAE3DU,EAAQ,CACVC,UAAW,SACXC,aAAc,SACdC,KAAM,MACNC,WAAY,QACZC,MAAO,SACPC,MAAO,SACPC,OAAQ,SACRC,MAAO,EACPC,eAAgB,SAChBC,KAAM,IACNC,WAAY,QACZC,MAAO,SACPC,UAAW,SACXC,UAAW,QACXC,WAAY,QACZC,UAAW,SACXC,MAAO,SACPC,eAAgB,QAChBC,SAAU,SACVC,QAAS,SACTC,KAAM,MACNC,SAAU,IACVC,SAAU,MACVC,cAAe,SACfC,SAAU,SACVC,UAAW,MACXC,SAAU,SACVC,UAAW,SACXC,YAAa,QACbC,eAAgB,QAChBC,WAAY,SACZC,WAAY,SACZC,QAAS,QACTC,WAAY,SACZC,aAAc,QACdC,cAAe,QACfC,cAAe,QACfC,cAAe,QACfC,cAAe,MACfC,WAAY,QACZC,SAAU,SACVC,YAAa,MACbC,QAAS,QACTC,QAAS,QACTC,WAAY,QACZC,UAAW,SACXC,YAAa,SACbC,YAAa,QACbC,QAAS,SACTC,UAAW,SACXC,WAAY,SACZC,KAAM,SACNC,UAAW,SACXC,KAAM,QACNC,MAAO,MACPC,YAAa,SACbC,KAAM,QACNC,SAAU,SACVC,QAAS,SACTC,UAAW,SACXC,OAAQ,QACRC,MAAO,SACPC,MAAO,SACPC,SAAU,SACVC,cAAe,SACfC,UAAW,QACXC,aAAc,SACdC,UAAW,SACXC,WAAY,SACZC,UAAW,SACXC,qBAAsB,SACtBC,UAAW,SACXC,WAAY,QACZC,UAAW,SACXC,UAAW,SACXC,YAAa,SACbC,cAAe,QACfC,aAAc,QACdC,eAAgB,QAChBC,eAAgB,QAChBC,eAAgB,SAChBC,YAAa,SACbC,KAAM,MACNC,UAAW,QACXC,MAAO,SACPC,QAAS,SACTC,OAAQ,QACRC,iBAAkB,QAClBC,WAAY,IACZC,aAAc,SACdC,aAAc,QACdC,eAAgB,QAChBC,gBAAiB,QACjBC,kBAAmB,MACnBC,gBAAiB,QACjBC,gBAAiB,SACjBC,aAAc,QACdC,UAAW,SACXC,UAAW,SACXC,SAAU,SACVC,YAAa,SACbC,KAAM,IACNC,QAAS,SACTC,MAAO,QACPC,UAAW,QACXC,OAAQ,SACRC,UAAW,SACXC,OAAQ,SACRC,cAAe,SACfC,UAAW,SACXC,cAAe,SACfC,cAAe,SACfC,WAAY,SACZC,UAAW,SACXC,KAAM,SACNC,KAAM,SACNC,KAAM,SACNC,WAAY,SACZC,OAAQ,QACRC,cAAe,QACfC,IAAK,SACLC,UAAW,SACXC,UAAW,QACXC,YAAa,QACbC,OAAQ,SACRC,WAAY,SACZC,SAAU,QACVC,SAAU,SACVC,OAAQ,SACRC,OAAQ,SACRC,QAAS,QACTC,UAAW,QACXC,UAAW,QACXC,UAAW,QACXC,KAAM,SACNC,YAAa,MACbC,UAAW,QACXC,IAAK,SACLC,KAAM,MACNC,QAAS,SACTC,OAAQ,SACRC,UAAW,QACXC,OAAQ,SACRC,MAAO,SACPC,MAAO,SACPC,WAAY,SACZC,OAAQ,SACRC,YAAa,UAkBf,SAASC,IACP,OAAOnO,KAAKoO,MAAMC,WACpB,CAUA,SAASC,IACP,OAAOtO,KAAKoO,MAAMG,WACpB,CAEe,SAASC,EAAMC,GAC5B,IAAIC,EAAGC,EAEP,OADAF,GAAUA,EAAS,IAAIG,OAAOC,eACtBH,EAAIpK,EAAMwK,KAAKL,KAAYE,EAAID,EAAE,GAAGK,OAAQL,EAAIM,SAASN,EAAE,GAAI,IAAW,IAANC,EAAUM,EAAKP,GAC/E,IAANC,EAAU,IAAIO,EAAKR,GAAK,EAAI,GAAQA,GAAK,EAAI,IAAQA,GAAK,EAAI,GAAY,IAAJA,GAAiB,GAAJA,IAAY,EAAU,GAAJA,EAAU,GACzG,IAANC,EAAUQ,EAAKT,GAAK,GAAK,IAAMA,GAAK,GAAK,IAAMA,GAAK,EAAI,KAAW,IAAJA,GAAY,KACrE,IAANC,EAAUQ,EAAMT,GAAK,GAAK,GAAQA,GAAK,EAAI,IAAQA,GAAK,EAAI,GAAQA,GAAK,EAAI,IAAQA,GAAK,EAAI,GAAY,IAAJA,IAAkB,GAAJA,IAAY,EAAU,GAAJA,GAAY,KAClJ,OACCA,EAAInK,EAAauK,KAAKL,IAAW,IAAIS,EAAIR,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAI,IAC3DA,EAAIjK,EAAaqK,KAAKL,IAAW,IAAIS,EAAW,IAAPR,EAAE,GAAW,IAAY,IAAPA,EAAE,GAAW,IAAY,IAAPA,EAAE,GAAW,IAAK,IAC/FA,EAAIhK,EAAcoK,KAAKL,IAAWU,EAAKT,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,KAC3DA,EAAI/J,EAAcmK,KAAKL,IAAWU,EAAY,IAAPT,EAAE,GAAW,IAAY,IAAPA,EAAE,GAAW,IAAY,IAAPA,EAAE,GAAW,IAAKA,EAAE,KAC/FA,EAAI9J,EAAakK,KAAKL,IAAWW,EAAKV,EAAE,GAAIA,EAAE,GAAK,IAAKA,EAAE,GAAK,IAAK,IACpEA,EAAI7J,EAAciK,KAAKL,IAAWW,EAAKV,EAAE,GAAIA,EAAE,GAAK,IAAKA,EAAE,GAAK,IAAKA,EAAE,IACxE5J,EAAMuK,eAAeZ,GAAUQ,EAAKnK,EAAM2J,IAC/B,gBAAXA,EAA2B,IAAIS,EAAII,IAAKA,IAAKA,IAAK,GAClD,IACR,CAEA,SAASL,EAAKM,GACZ,OAAO,IAAIL,EAAIK,GAAK,GAAK,IAAMA,GAAK,EAAI,IAAU,IAAJA,EAAU,EAC1D,CAEA,SAASJ,EAAKK,EAAGC,EAAGC,EAAGC,GAErB,OADIA,GAAK,IAAGH,EAAIC,EAAIC,EAAIJ,KACjB,IAAIJ,EAAIM,EAAGC,EAAGC,EAAGC,EAC1B,CAEO,SAASC,EAAWC,GAEzB,OADMA,aAAa7L,IAAQ6L,EAAIrB,EAAMqB,IAChCA,EAEE,IAAIX,GADXW,EAAIA,EAAEzB,OACWoB,EAAGK,EAAEJ,EAAGI,EAAEH,EAAGG,EAAEC,SAFjB,IAAIZ,CAGrB,CAEO,SAASd,EAAIoB,EAAGC,EAAGC,EAAGI,GAC3B,OAA4B,IAArBC,UAAUhB,OAAea,EAAWJ,GAAK,IAAIN,EAAIM,EAAGC,EAAGC,EAAc,MAAXI,EAAkB,EAAIA,EACzF,CAEO,SAASZ,EAAIM,EAAGC,EAAGC,EAAGI,GAC3B9P,KAAKwP,GAAKA,EACVxP,KAAKyP,GAAKA,EACVzP,KAAK0P,GAAKA,EACV1P,KAAK8P,SAAWA,CAClB,CA8BA,SAASE,IACP,MAAO,IAAIC,EAAIjQ,KAAKwP,KAAKS,EAAIjQ,KAAKyP,KAAKQ,EAAIjQ,KAAK0P,IAClD,CAMA,SAASQ,IACP,MAAMP,EAAIQ,EAAOnQ,KAAK8P,SACtB,MAAO,GAAS,IAANH,EAAU,OAAS,UAAUS,EAAOpQ,KAAKwP,OAAOY,EAAOpQ,KAAKyP,OAAOW,EAAOpQ,KAAK0P,KAAW,IAANC,EAAU,IAAM,KAAKA,MACrH,CAEA,SAASQ,EAAOL,GACd,OAAOO,MAAMP,GAAW,EAAInQ,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,EAAGkP,GACtD,CAEA,SAASM,EAAO3P,GACd,OAAOd,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,IAAKjB,KAAKkD,MAAMpC,IAAU,GACxD,CAEA,SAASwP,EAAIxP,GAEX,QADAA,EAAQ2P,EAAO3P,IACC,GAAK,IAAM,IAAMA,EAAMmB,SAAS,GAClD,CAEA,SAASwN,EAAKkB,EAAGC,EAAG5B,EAAGgB,GAIrB,OAHIA,GAAK,EAAGW,EAAIC,EAAI5B,EAAIW,IACfX,GAAK,GAAKA,GAAK,EAAG2B,EAAIC,EAAIjB,IAC1BiB,GAAK,IAAGD,EAAIhB,KACd,IAAIkB,EAAIF,EAAGC,EAAG5B,EAAGgB,EAC1B,CAEO,SAASc,EAAWZ,GACzB,GAAIA,aAAaW,EAAK,OAAO,IAAIA,EAAIX,EAAES,EAAGT,EAAEU,EAAGV,EAAElB,EAAGkB,EAAEC,SAEtD,GADMD,aAAa7L,IAAQ6L,EAAIrB,EAAMqB,KAChCA,EAAG,OAAO,IAAIW,EACnB,GAAIX,aAAaW,EAAK,OAAOX,EAE7B,IAAIL,GADJK,EAAIA,EAAEzB,OACIoB,EAAI,IACVC,EAAII,EAAEJ,EAAI,IACVC,EAAIG,EAAEH,EAAI,IACV9O,EAAMjB,KAAKiB,IAAI4O,EAAGC,EAAGC,GACrB7O,EAAMlB,KAAKkB,IAAI2O,EAAGC,EAAGC,GACrBY,EAAIhB,IACJiB,EAAI1P,EAAMD,EACV+N,GAAK9N,EAAMD,GAAO,EAUtB,OATI2P,GACaD,EAAXd,IAAM3O,GAAU4O,EAAIC,GAAKa,EAAc,GAATd,EAAIC,GAC7BD,IAAM5O,GAAU6O,EAAIF,GAAKe,EAAI,GAC5Bf,EAAIC,GAAKc,EAAI,EACvBA,GAAK5B,EAAI,GAAM9N,EAAMD,EAAM,EAAIC,EAAMD,EACrC0P,GAAK,IAELC,EAAI5B,EAAI,GAAKA,EAAI,EAAI,EAAI2B,EAEpB,IAAIE,EAAIF,EAAGC,EAAG5B,EAAGkB,EAAEC,QAC5B,CAEO,SAASY,EAAIJ,EAAGC,EAAG5B,EAAGmB,GAC3B,OAA4B,IAArBC,UAAUhB,OAAe0B,EAAWH,GAAK,IAAIE,EAAIF,EAAGC,EAAG5B,EAAc,MAAXmB,EAAkB,EAAIA,EACzF,CAEA,SAASU,EAAIF,EAAGC,EAAG5B,EAAGmB,GACpB9P,KAAKsQ,GAAKA,EACVtQ,KAAKuQ,GAAKA,EACVvQ,KAAK2O,GAAKA,EACV3O,KAAK8P,SAAWA,CAClB,CAsCA,SAASa,EAAOlQ,GAEd,OADAA,GAASA,GAAS,GAAK,KACR,EAAIA,EAAQ,IAAMA,CACnC,CAEA,SAASmQ,EAAOnQ,GACd,OAAOd,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,EAAGH,GAAS,GAC1C,CAGA,SAASoQ,EAAQP,EAAGQ,EAAIC,GACtB,OAGY,KAHJT,EAAI,GAAKQ,GAAMC,EAAKD,GAAMR,EAAI,GAChCA,EAAI,IAAMS,EACVT,EAAI,IAAMQ,GAAMC,EAAKD,IAAO,IAAMR,GAAK,GACvCQ,EACR,CAlOAE,EAAOhN,EAAOwK,EAAO,CACnByC,KAAKC,GACH,OAAO9P,OAAOC,OAAO,IAAIrB,KAAK2D,YAAa3D,KAAMkR,EAClD,EACDC,cACE,OAAOnR,KAAKoO,MAAM+C,aACnB,EACDlB,IAAK9B,EACLE,UAAWF,EACXiD,WAUF,WACE,OAAOpR,KAAKoO,MAAMgD,YACpB,EAXEC,UAaF,WACE,OAAOZ,EAAWzQ,MAAMqR,WAC1B,EAdE9C,UAAWD,EACX1M,SAAU0M,IAiEZ0C,EAAO9B,EAAKd,EAAKvK,EAAOG,EAAO,CAC7BE,SAASoN,GAEP,OADAA,EAAS,MAALA,EAAYpN,EAAWvE,KAAK4R,IAAIrN,EAAUoN,GACvC,IAAIpC,EAAIlP,KAAKwP,EAAI8B,EAAGtR,KAAKyP,EAAI6B,EAAGtR,KAAK0P,EAAI4B,EAAGtR,KAAK8P,QACzD,EACD7L,OAAOqN,GAEL,OADAA,EAAS,MAALA,EAAYrN,EAAStE,KAAK4R,IAAItN,EAAQqN,GACnC,IAAIpC,EAAIlP,KAAKwP,EAAI8B,EAAGtR,KAAKyP,EAAI6B,EAAGtR,KAAK0P,EAAI4B,EAAGtR,KAAK8P,QACzD,EACD1B,MACE,OAAOpO,IACR,EACDwR,QACE,OAAO,IAAItC,EAAIkB,EAAOpQ,KAAKwP,GAAIY,EAAOpQ,KAAKyP,GAAIW,EAAOpQ,KAAK0P,GAAIS,EAAOnQ,KAAK8P,SAC5E,EACDqB,cACE,OAAS,IAAOnR,KAAKwP,GAAKxP,KAAKwP,EAAI,QAC1B,IAAOxP,KAAKyP,GAAKzP,KAAKyP,EAAI,QAC1B,IAAOzP,KAAK0P,GAAK1P,KAAK0P,EAAI,OAC3B,GAAK1P,KAAK8P,SAAW9P,KAAK8P,SAAW,CAC9C,EACDG,IAAKD,EACL3B,UAAW2B,EACXoB,WASF,WACE,MAAO,IAAInB,EAAIjQ,KAAKwP,KAAKS,EAAIjQ,KAAKyP,KAAKQ,EAAIjQ,KAAK0P,KAAKO,EAA+C,KAA1CI,MAAMrQ,KAAK8P,SAAW,EAAI9P,KAAK8P,WAC3F,EAVEvB,UAAW2B,EACXtO,SAAUsO,KAyEZc,EAAOR,EAAKE,EAAK7M,EAAOG,EAAO,CAC7BE,SAASoN,GAEP,OADAA,EAAS,MAALA,EAAYpN,EAAWvE,KAAK4R,IAAIrN,EAAUoN,GACvC,IAAId,EAAIxQ,KAAKsQ,EAAGtQ,KAAKuQ,EAAGvQ,KAAK2O,EAAI2C,EAAGtR,KAAK8P,QACjD,EACD7L,OAAOqN,GAEL,OADAA,EAAS,MAALA,EAAYrN,EAAStE,KAAK4R,IAAItN,EAAQqN,GACnC,IAAId,EAAIxQ,KAAKsQ,EAAGtQ,KAAKuQ,EAAGvQ,KAAK2O,EAAI2C,EAAGtR,KAAK8P,QACjD,EACD1B,MACE,IAAIkC,EAAItQ,KAAKsQ,EAAI,IAAqB,KAAdtQ,KAAKsQ,EAAI,GAC7BC,EAAIF,MAAMC,IAAMD,MAAMrQ,KAAKuQ,GAAK,EAAIvQ,KAAKuQ,EACzC5B,EAAI3O,KAAK2O,EACToC,EAAKpC,GAAKA,EAAI,GAAMA,EAAI,EAAIA,GAAK4B,EACjCO,EAAK,EAAInC,EAAIoC,EACjB,OAAO,IAAI7B,EACT2B,EAAQP,GAAK,IAAMA,EAAI,IAAMA,EAAI,IAAKQ,EAAIC,GAC1CF,EAAQP,EAAGQ,EAAIC,GACfF,EAAQP,EAAI,IAAMA,EAAI,IAAMA,EAAI,IAAKQ,EAAIC,GACzC/Q,KAAK8P,QAER,EACD0B,QACE,OAAO,IAAIhB,EAAIG,EAAO3Q,KAAKsQ,GAAIM,EAAO5Q,KAAKuQ,GAAIK,EAAO5Q,KAAK2O,GAAIwB,EAAOnQ,KAAK8P,SAC5E,EACDqB,cACE,OAAQ,GAAKnR,KAAKuQ,GAAKvQ,KAAKuQ,GAAK,GAAKF,MAAMrQ,KAAKuQ,KACzC,GAAKvQ,KAAK2O,GAAK3O,KAAK2O,GAAK,GACzB,GAAK3O,KAAK8P,SAAW9P,KAAK8P,SAAW,CAC9C,EACDuB,YACE,MAAM1B,EAAIQ,EAAOnQ,KAAK8P,SACtB,MAAO,GAAS,IAANH,EAAU,OAAS,UAAUgB,EAAO3Q,KAAKsQ,OAAwB,IAAjBM,EAAO5Q,KAAKuQ,QAA+B,IAAjBK,EAAO5Q,KAAK2O,MAAkB,IAANgB,EAAU,IAAM,KAAKA,MAClI,KCzXI,MAAM8B,EAAU9R,KAAKC,GAAK,IACpB8R,EAAU,IAAM/R,KAAKC,GCK9B+R,EAAK,OACLC,EAAK,EACLC,EAAK,OACLC,EAAK,EAAI,GACTC,EAAK,EAAI,GACTC,EAAK,EAAID,EAAKA,EACdE,EAAKF,EAAKA,EAAKA,EAEnB,SAASG,EAAWrC,GAClB,GAAIA,aAAasC,EAAK,OAAO,IAAIA,EAAItC,EAAElB,EAAGkB,EAAEF,EAAGE,EAAEH,EAAGG,EAAEC,SACtD,GAAID,aAAauC,GAAK,OAAOC,GAAQxC,GAC/BA,aAAaX,IAAMW,EAAID,EAAWC,IACxC,IAGuEzQ,EAAGkT,EAHtE9C,EAAI+C,GAAS1C,EAAEL,GACfC,EAAI8C,GAAS1C,EAAEJ,GACfC,EAAI6C,GAAS1C,EAAEH,GACfrQ,EAAImT,IAAS,SAAYhD,EAAI,SAAYC,EAAI,SAAYC,GAAKkC,GAKlE,OAJIpC,IAAMC,GAAKA,IAAMC,EAAGtQ,EAAIkT,EAAIjT,GAC9BD,EAAIoT,IAAS,SAAYhD,EAAI,SAAYC,EAAI,SAAYC,GAAKiC,GAC9DW,EAAIE,IAAS,SAAYhD,EAAI,SAAYC,EAAI,SAAYC,GAAKmC,IAEzD,IAAIM,EAAI,IAAM9S,EAAI,GAAI,KAAOD,EAAIC,GAAI,KAAOA,EAAIiT,GAAIzC,EAAEC,QAC/D,CAMe,SAAS2C,EAAI9D,EAAGgB,EAAGD,EAAGI,GACnC,OAA4B,IAArBC,UAAUhB,OAAemD,EAAWvD,GAAK,IAAIwD,EAAIxD,EAAGgB,EAAGD,EAAc,MAAXI,EAAkB,EAAIA,EACzF,CAEO,SAASqC,EAAIxD,EAAGgB,EAAGD,EAAGI,GAC3B9P,KAAK2O,GAAKA,EACV3O,KAAK2P,GAAKA,EACV3P,KAAK0P,GAAKA,EACV1P,KAAK8P,SAAWA,CAClB,CAyBA,SAAS0C,GAAQE,GACf,OAAOA,EAAIT,EAAKtS,KAAK4R,IAAImB,EAAG,EAAI,GAAKA,EAAIV,EAAKF,CAChD,CAEA,SAASa,GAAQD,GACf,OAAOA,EAAIX,EAAKW,EAAIA,EAAIA,EAAIV,GAAMU,EAAIZ,EACxC,CAEA,SAASc,GAASxT,GAChB,OAAO,KAAOA,GAAK,SAAY,MAAQA,EAAI,MAAQO,KAAK4R,IAAInS,EAAG,EAAI,KAAO,KAC5E,CAEA,SAASmT,GAASnT,GAChB,OAAQA,GAAK,MAAQ,OAAUA,EAAI,MAAQO,KAAK4R,KAAKnS,EAAI,MAAS,MAAO,IAC3E,CAcO,SAASyT,GAAIvC,EAAGwC,EAAGnE,EAAGmB,GAC3B,OAA4B,IAArBC,UAAUhB,OAbnB,SAAoBc,GAClB,GAAIA,aAAauC,GAAK,OAAO,IAAIA,GAAIvC,EAAES,EAAGT,EAAEiD,EAAGjD,EAAElB,EAAGkB,EAAEC,SAEtD,GADMD,aAAasC,IAAMtC,EAAIqC,EAAWrC,IAC5B,IAARA,EAAEF,GAAmB,IAARE,EAAEH,EAAS,OAAO,IAAI0C,GAAI9C,IAAK,EAAIO,EAAElB,GAAKkB,EAAElB,EAAI,IAAM,EAAIW,IAAKO,EAAElB,EAAGkB,EAAEC,SACvF,IAAIQ,EAAI3Q,KAAKoT,MAAMlD,EAAEH,EAAGG,EAAEF,GAAK+B,EAC/B,OAAO,IAAIU,GAAI9B,EAAI,EAAIA,EAAI,IAAMA,EAAG3Q,KAAKqT,KAAKnD,EAAEF,EAAIE,EAAEF,EAAIE,EAAEH,EAAIG,EAAEH,GAAIG,EAAElB,EAAGkB,EAAEC,QAC/E,CAOkCmD,CAAW3C,GAAK,IAAI8B,GAAI9B,EAAGwC,EAAGnE,EAAc,MAAXmB,EAAkB,EAAIA,EACzF,CAEO,SAASsC,GAAI9B,EAAGwC,EAAGnE,EAAGmB,GAC3B9P,KAAKsQ,GAAKA,EACVtQ,KAAK8S,GAAKA,EACV9S,KAAK2O,GAAKA,EACV3O,KAAK8P,SAAWA,CAClB,CAEA,SAASuC,GAAQxC,GACf,GAAIQ,MAAMR,EAAES,GAAI,OAAO,IAAI6B,EAAItC,EAAElB,EAAG,EAAG,EAAGkB,EAAEC,SAC5C,IAAIQ,EAAIT,EAAES,EAAImB,EACd,OAAO,IAAIU,EAAItC,EAAElB,EAAGhP,KAAKuT,IAAI5C,GAAKT,EAAEiD,EAAGnT,KAAKwT,IAAI7C,GAAKT,EAAEiD,EAAGjD,EAAEC,QAC9D,CAlEAkB,EAAOmB,EAAKM,EAAK5O,EAAOG,EAAO,CAC7BE,SAASoN,GACP,OAAO,IAAIa,EAAInS,KAAK2O,EAzCd,IAyC4B,MAAL2C,EAAY,EAAIA,GAAItR,KAAK2P,EAAG3P,KAAK0P,EAAG1P,KAAK8P,QACvE,EACD7L,OAAOqN,GACL,OAAO,IAAIa,EAAInS,KAAK2O,EA5Cd,IA4C4B,MAAL2C,EAAY,EAAIA,GAAItR,KAAK2P,EAAG3P,KAAK0P,EAAG1P,KAAK8P,QACvE,EACD1B,MACE,IAAI/O,GAAKW,KAAK2O,EAAI,IAAM,IACpBvP,EAAIiR,MAAMrQ,KAAK2P,GAAKtQ,EAAIA,EAAIW,KAAK2P,EAAI,IACrC2C,EAAIjC,MAAMrQ,KAAK0P,GAAKrQ,EAAIA,EAAIW,KAAK0P,EAAI,IAIzC,OAAO,IAAIR,EACT0D,GAAU,WAJZxT,EAAIuS,EAAKgB,GAAQvT,IAIW,WAH5BC,EAAIuS,EAAKe,GAAQtT,IAG2B,UAF5CiT,EAAIT,EAAKc,GAAQL,KAGfM,IAAU,SAAYxT,EAAI,UAAYC,EAAI,QAAYiT,GACtDM,GAAU,SAAYxT,EAAI,SAAYC,EAAI,UAAYiT,GACtDtS,KAAK8P,QAER,KAgDHkB,EAAOoB,GAAKS,GAAKhP,EAAOG,EAAO,CAC7BE,SAASoN,GACP,OAAO,IAAIc,GAAIpS,KAAKsQ,EAAGtQ,KAAK8S,EAAG9S,KAAK2O,EA7G9B,IA6G4C,MAAL2C,EAAY,EAAIA,GAAItR,KAAK8P,QACvE,EACD7L,OAAOqN,GACL,OAAO,IAAIc,GAAIpS,KAAKsQ,EAAGtQ,KAAK8S,EAAG9S,KAAK2O,EAhH9B,IAgH4C,MAAL2C,EAAY,EAAIA,GAAItR,KAAK8P,QACvE,EACD1B,MACE,OAAOiE,GAAQrS,MAAMoO,KACtB,KCrHH,IAAIgF,IAAK,OACLC,GAAI,QACJC,IAAK,OACLC,IAAK,OACLC,GAAI,QACJC,GAAKD,GAAID,GACTG,GAAKF,GAAIH,GACTM,GAAQN,GAAIC,GAAIC,GAAIH,GAgBT,SAASQ,GAAUtD,EAAGC,EAAG5B,EAAGmB,GACzC,OAA4B,IAArBC,UAAUhB,OAfnB,SAA0Bc,GACxB,GAAIA,aAAagE,GAAW,OAAO,IAAIA,GAAUhE,EAAES,EAAGT,EAAEU,EAAGV,EAAElB,EAAGkB,EAAEC,SAC5DD,aAAaX,IAAMW,EAAID,EAAWC,IACxC,IACIJ,EAAII,EAAEJ,EAAI,IACVC,EAAIG,EAAEH,EAAI,IACVf,GAAKgF,GAAQjE,EAAI+D,IAHb5D,EAAEL,EAAI,KAGgBkE,GAAKjE,IAAMkE,GAAQF,GAAKC,IAClDI,EAAKpE,EAAIf,EACT2C,GAAKkC,IAAK/D,EAAId,GAAK2E,GAAIQ,GAAMP,GAC7BhD,EAAI5Q,KAAKqT,KAAK1B,EAAIA,EAAIwC,EAAKA,IAAON,GAAI7E,GAAK,EAAIA,IAC/C2B,EAAIC,EAAI5Q,KAAKoT,MAAMzB,EAAGwC,GAAMpC,EAAU,IAAMpC,IAChD,OAAO,IAAIuE,GAAUvD,EAAI,EAAIA,EAAI,IAAMA,EAAGC,EAAG5B,EAAGkB,EAAEC,QACpD,CAGkCiE,CAAiBzD,GAAK,IAAIuD,GAAUvD,EAAGC,EAAG5B,EAAc,MAAXmB,EAAkB,EAAIA,EACrG,CAEO,SAAS+D,GAAUvD,EAAGC,EAAG5B,EAAGmB,GACjC9P,KAAKsQ,GAAKA,EACVtQ,KAAKuQ,GAAKA,EACVvQ,KAAK2O,GAAKA,EACV3O,KAAK8P,SAAWA,CAClB,CCpCe,SAAAkE,GAASrQ,EAAaC,EAASzB,GAC5CwB,EAAYxB,UAAYyB,EAAQzB,UAAYA,EAC5CA,EAAUwB,YAAcA,CAC1B,CAEO,SAASE,GAAO5D,EAAQ6D,GAC7B,IAAI3B,EAAYf,OAAO2C,OAAO9D,EAAOkC,WACrC,IAAK,IAAIsB,KAAOK,EAAY3B,EAAUsB,GAAOK,EAAWL,GACxD,OAAOtB,CACT,CCPO,SAAS6B,KAAU,CFoC1BgN,EAAO6C,GAAWD,GAAW/P,EAAOG,EAAO,CACzCE,SAASoN,GAEP,OADAA,EAAS,MAALA,EAAYpN,EAAWvE,KAAK4R,IAAIrN,EAAUoN,GACvC,IAAIuC,GAAU7T,KAAKsQ,EAAGtQ,KAAKuQ,EAAGvQ,KAAK2O,EAAI2C,EAAGtR,KAAK8P,QACvD,EACD7L,OAAOqN,GAEL,OADAA,EAAS,MAALA,EAAYrN,EAAStE,KAAK4R,IAAItN,EAAQqN,GACnC,IAAIuC,GAAU7T,KAAKsQ,EAAGtQ,KAAKuQ,EAAGvQ,KAAK2O,EAAI2C,EAAGtR,KAAK8P,QACvD,EACD1B,MACE,IAAIkC,EAAID,MAAMrQ,KAAKsQ,GAAK,GAAKtQ,KAAKsQ,EAAI,KAAOmB,EACzC9C,GAAK3O,KAAK2O,EACVgB,EAAIU,MAAMrQ,KAAKuQ,GAAK,EAAIvQ,KAAKuQ,EAAI5B,GAAK,EAAIA,GAC1CsF,EAAOtU,KAAKuT,IAAI5C,GAChB4D,EAAOvU,KAAKwT,IAAI7C,GACpB,OAAO,IAAIpB,EACT,KAAOP,EAAIgB,GAAKyD,GAAIa,EAAOZ,GAAIa,IAC/B,KAAOvF,EAAIgB,GAAK2D,GAAIW,EAAOV,GAAIW,IAC/B,KAAOvF,EAAIgB,GAAK6D,GAAIS,IACpBjU,KAAK8P,QAER,KEvDI,IAAI7L,GAAS,GACTC,GAAW,EAAID,GAEtBE,GAAM,sBACNC,GAAM,gDACNC,GAAM,iDACNC,GAAQ,qBACRC,GAAe,IAAIC,OAAO,UAAY,CAACL,GAAKA,GAAKA,IAAO,QACxDM,GAAe,IAAID,OAAO,UAAY,CAACH,GAAKA,GAAKA,IAAO,QACxDK,GAAgB,IAAIF,OAAO,WAAa,CAACL,GAAKA,GAAKA,GAAKC,IAAO,QAC/DO,GAAgB,IAAIH,OAAO,WAAa,CAACH,GAAKA,GAAKA,GAAKD,IAAO,QAC/DQ,GAAe,IAAIJ,OAAO,UAAY,CAACJ,GAAKC,GAAKA,IAAO,QACxDQ,GAAgB,IAAIL,OAAO,WAAa,CAACJ,GAAKC,GAAKA,GAAKD,IAAO,QAE/DU,GAAQ,CACVC,UAAW,SACXC,aAAc,SACdC,KAAM,MACNC,WAAY,QACZC,MAAO,SACPC,MAAO,SACPC,OAAQ,SACRC,MAAO,EACPC,eAAgB,SAChBC,KAAM,IACNC,WAAY,QACZC,MAAO,SACPC,UAAW,SACXC,UAAW,QACXC,WAAY,QACZC,UAAW,SACXC,MAAO,SACPC,eAAgB,QAChBC,SAAU,SACVC,QAAS,SACTC,KAAM,MACNC,SAAU,IACVC,SAAU,MACVC,cAAe,SACfC,SAAU,SACVC,UAAW,MACXC,SAAU,SACVC,UAAW,SACXC,YAAa,QACbC,eAAgB,QAChBC,WAAY,SACZC,WAAY,SACZC,QAAS,QACTC,WAAY,SACZC,aAAc,QACdC,cAAe,QACfC,cAAe,QACfC,cAAe,QACfC,cAAe,MACfC,WAAY,QACZC,SAAU,SACVC,YAAa,MACbC,QAAS,QACTC,QAAS,QACTC,WAAY,QACZC,UAAW,SACXC,YAAa,SACbC,YAAa,QACbC,QAAS,SACTC,UAAW,SACXC,WAAY,SACZC,KAAM,SACNC,UAAW,SACXC,KAAM,QACNC,MAAO,MACPC,YAAa,SACbC,KAAM,QACNC,SAAU,SACVC,QAAS,SACTC,UAAW,SACXC,OAAQ,QACRC,MAAO,SACPC,MAAO,SACPC,SAAU,SACVC,cAAe,SACfC,UAAW,QACXC,aAAc,SACdC,UAAW,SACXC,WAAY,SACZC,UAAW,SACXC,qBAAsB,SACtBC,UAAW,SACXC,WAAY,QACZC,UAAW,SACXC,UAAW,SACXC,YAAa,SACbC,cAAe,QACfC,aAAc,QACdC,eAAgB,QAChBC,eAAgB,QAChBC,eAAgB,SAChBC,YAAa,SACbC,KAAM,MACNC,UAAW,QACXC,MAAO,SACPC,QAAS,SACTC,OAAQ,QACRC,iBAAkB,QAClBC,WAAY,IACZC,aAAc,SACdC,aAAc,QACdC,eAAgB,QAChBC,gBAAiB,QACjBC,kBAAmB,MACnBC,gBAAiB,QACjBC,gBAAiB,SACjBC,aAAc,QACdC,UAAW,SACXC,UAAW,SACXC,SAAU,SACVC,YAAa,SACbC,KAAM,IACNC,QAAS,SACTC,MAAO,QACPC,UAAW,QACXC,OAAQ,SACRC,UAAW,SACXC,OAAQ,SACRC,cAAe,SACfC,UAAW,SACXC,cAAe,SACfC,cAAe,SACfC,WAAY,SACZC,UAAW,SACXC,KAAM,SACNC,KAAM,SACNC,KAAM,SACNC,WAAY,SACZC,OAAQ,QACRC,cAAe,QACfC,IAAK,SACLC,UAAW,SACXC,UAAW,QACXC,YAAa,QACbC,OAAQ,SACRC,WAAY,SACZC,SAAU,QACVC,SAAU,SACVC,OAAQ,SACRC,OAAQ,SACRC,QAAS,QACTC,UAAW,QACXC,UAAW,QACXC,UAAW,QACXC,KAAM,SACNC,YAAa,MACbC,UAAW,QACXC,IAAK,SACLC,KAAM,MACNC,QAAS,SACTC,OAAQ,SACRC,UAAW,QACXC,OAAQ,SACRC,MAAO,SACPC,MAAO,SACPC,WAAY,SACZC,OAAQ,SACRC,YAAa,UAiBf,SAASC,KACP,OAAOnO,KAAKoO,MAAMC,WACpB,CAMA,SAASC,KACP,OAAOtO,KAAKoO,MAAMG,WACpB,CAEe,SAASC,GAAMC,GAC5B,IAAIC,EAAGC,EAEP,OADAF,GAAUA,EAAS,IAAIG,OAAOC,eACtBH,EAAIpK,GAAMwK,KAAKL,KAAYE,EAAID,EAAE,GAAGK,OAAQL,EAAIM,SAASN,EAAE,GAAI,IAAW,IAANC,EAAUM,GAAKP,GAC/E,IAANC,EAAU,IAAIO,GAAKR,GAAK,EAAI,GAAQA,GAAK,EAAI,IAAQA,GAAK,EAAI,GAAY,IAAJA,GAAiB,GAAJA,IAAY,EAAU,GAAJA,EAAU,GACzG,IAANC,EAAUQ,GAAKT,GAAK,GAAK,IAAMA,GAAK,GAAK,IAAMA,GAAK,EAAI,KAAW,IAAJA,GAAY,KACrE,IAANC,EAAUQ,GAAMT,GAAK,GAAK,GAAQA,GAAK,EAAI,IAAQA,GAAK,EAAI,GAAQA,GAAK,EAAI,IAAQA,GAAK,EAAI,GAAY,IAAJA,IAAkB,GAAJA,IAAY,EAAU,GAAJA,GAAY,KAClJ,OACCA,EAAInK,GAAauK,KAAKL,IAAW,IAAIS,GAAIR,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAI,IAC3DA,EAAIjK,GAAaqK,KAAKL,IAAW,IAAIS,GAAW,IAAPR,EAAE,GAAW,IAAY,IAAPA,EAAE,GAAW,IAAY,IAAPA,EAAE,GAAW,IAAK,IAC/FA,EAAIhK,GAAcoK,KAAKL,IAAWU,GAAKT,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,KAC3DA,EAAI/J,GAAcmK,KAAKL,IAAWU,GAAY,IAAPT,EAAE,GAAW,IAAY,IAAPA,EAAE,GAAW,IAAY,IAAPA,EAAE,GAAW,IAAKA,EAAE,KAC/FA,EAAI9J,GAAakK,KAAKL,IAAWW,GAAKV,EAAE,GAAIA,EAAE,GAAK,IAAKA,EAAE,GAAK,IAAK,IACpEA,EAAI7J,GAAciK,KAAKL,IAAWW,GAAKV,EAAE,GAAIA,EAAE,GAAK,IAAKA,EAAE,GAAK,IAAKA,EAAE,IACxE5J,GAAMuK,eAAeZ,GAAUQ,GAAKnK,GAAM2J,IAC/B,gBAAXA,EAA2B,IAAIS,GAAII,IAAKA,IAAKA,IAAK,GAClD,IACR,CAEA,SAASL,GAAKM,GACZ,OAAO,IAAIL,GAAIK,GAAK,GAAK,IAAMA,GAAK,EAAI,IAAU,IAAJA,EAAU,EAC1D,CAEA,SAASJ,GAAKK,EAAGC,EAAGC,EAAGC,GAErB,OADIA,GAAK,IAAGH,EAAIC,EAAIC,EAAIJ,KACjB,IAAIJ,GAAIM,EAAGC,EAAGC,EAAGC,EAC1B,CASO,SAASvB,GAAIoB,EAAGC,EAAGC,EAAGI,GAC3B,OAA4B,IAArBC,UAAUhB,SARQc,EAQkBL,aAPxBxL,KAAQ6L,EAAIrB,GAAMqB,IAChCA,EAEE,IAAIX,IADXW,EAAIA,EAAEzB,OACWoB,EAAGK,EAAEJ,EAAGI,EAAEH,EAAGG,EAAEC,SAFjB,IAAIZ,IAM6B,IAAIA,GAAIM,EAAGC,EAAGC,EAAc,MAAXI,EAAkB,EAAIA,GARlF,IAAoBD,CAS3B,CAEO,SAASX,GAAIM,EAAGC,EAAGC,EAAGI,GAC3B9P,KAAKwP,GAAKA,EACVxP,KAAKyP,GAAKA,EACVzP,KAAK0P,GAAKA,EACV1P,KAAK8P,SAAWA,CAClB,CA0BA,SAASE,KACP,MAAO,IAAMC,GAAIjQ,KAAKwP,GAAKS,GAAIjQ,KAAKyP,GAAKQ,GAAIjQ,KAAK0P,EACpD,CAEA,SAASQ,KACP,IAAIP,EAAI3P,KAAK8P,QACb,OAAc,KADQH,EAAIU,MAAMV,GAAK,EAAIhQ,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,EAAG+O,KAC/C,OAAS,SACrBhQ,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,IAAKjB,KAAKkD,MAAM7C,KAAKwP,IAAM,IAAM,KACtD7P,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,IAAKjB,KAAKkD,MAAM7C,KAAKyP,IAAM,IAAM,KACtD9P,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,IAAKjB,KAAKkD,MAAM7C,KAAK0P,IAAM,KACzC,IAANC,EAAU,IAAM,KAAOA,EAAI,IACpC,CAEA,SAASM,GAAIxP,GAEX,QADAA,EAAQd,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,IAAKjB,KAAKkD,MAAMpC,IAAU,KACvC,GAAK,IAAM,IAAMA,EAAMmB,SAAS,GAClD,CAEA,SAASwN,GAAKkB,EAAGC,EAAG5B,EAAGgB,GAIrB,OAHIA,GAAK,EAAGW,EAAIC,EAAI5B,EAAIW,IACfX,GAAK,GAAKA,GAAK,EAAG2B,EAAIC,EAAIjB,IAC1BiB,GAAK,IAAGD,EAAIhB,KACd,IAAIkB,GAAIF,EAAGC,EAAG5B,EAAGgB,EAC1B,CAEO,SAASc,GAAWZ,GACzB,GAAIA,aAAaW,GAAK,OAAO,IAAIA,GAAIX,EAAES,EAAGT,EAAEU,EAAGV,EAAElB,EAAGkB,EAAEC,SAEtD,GADMD,aAAa7L,KAAQ6L,EAAIrB,GAAMqB,KAChCA,EAAG,OAAO,IAAIW,GACnB,GAAIX,aAAaW,GAAK,OAAOX,EAE7B,IAAIL,GADJK,EAAIA,EAAEzB,OACIoB,EAAI,IACVC,EAAII,EAAEJ,EAAI,IACVC,EAAIG,EAAEH,EAAI,IACV9O,EAAMjB,KAAKiB,IAAI4O,EAAGC,EAAGC,GACrB7O,EAAMlB,KAAKkB,IAAI2O,EAAGC,EAAGC,GACrBY,EAAIhB,IACJiB,EAAI1P,EAAMD,EACV+N,GAAK9N,EAAMD,GAAO,EAUtB,OATI2P,GACaD,EAAXd,IAAM3O,GAAU4O,EAAIC,GAAKa,EAAc,GAATd,EAAIC,GAC7BD,IAAM5O,GAAU6O,EAAIF,GAAKe,EAAI,GAC5Bf,EAAIC,GAAKc,EAAI,EACvBA,GAAK5B,EAAI,GAAM9N,EAAMD,EAAM,EAAIC,EAAMD,EACrC0P,GAAK,IAELC,EAAI5B,EAAI,GAAKA,EAAI,EAAI,EAAI2B,EAEpB,IAAIE,GAAIF,EAAGC,EAAG5B,EAAGkB,EAAEC,QAC5B,CAMA,SAASU,GAAIF,EAAGC,EAAG5B,EAAGmB,GACpB9P,KAAKsQ,GAAKA,EACVtQ,KAAKuQ,GAAKA,EACVvQ,KAAK2O,GAAKA,EACV3O,KAAK8P,SAAWA,CAClB,CAwCA,SAASe,GAAQP,EAAGQ,EAAIC,GACtB,OAGY,KAHJT,EAAI,GAAKQ,GAAMC,EAAKD,GAAMR,EAAI,GAChCA,EAAI,IAAMS,EACVT,EAAI,IAAMQ,GAAMC,EAAKD,IAAO,IAAMR,GAAK,GACvCQ,EACR,CAzMAE,GAAOhN,GAAOwK,GAAO,CACnByC,KAAM,SAASC,GACb,OAAO9P,OAAOC,OAAO,IAAIrB,KAAK2D,YAAa3D,KAAMkR,EAClD,EACDC,YAAa,WACX,OAAOnR,KAAKoO,MAAM+C,aACnB,EACDlB,IAAK9B,GACLE,UAAWF,GACXkD,UASF,WACE,OAAOZ,GAAWzQ,MAAMqR,WAC1B,EAVE9C,UAAWD,GACX1M,SAAU0M,KA6DZ0C,GAAO9B,GAAKd,GAAKvK,GAAOG,GAAO,CAC7BE,SAAU,SAASoN,GAEjB,OADAA,EAAS,MAALA,EAAYpN,GAAWvE,KAAK4R,IAAIrN,GAAUoN,GACvC,IAAIpC,GAAIlP,KAAKwP,EAAI8B,EAAGtR,KAAKyP,EAAI6B,EAAGtR,KAAK0P,EAAI4B,EAAGtR,KAAK8P,QACzD,EACD7L,OAAQ,SAASqN,GAEf,OADAA,EAAS,MAALA,EAAYrN,GAAStE,KAAK4R,IAAItN,GAAQqN,GACnC,IAAIpC,GAAIlP,KAAKwP,EAAI8B,EAAGtR,KAAKyP,EAAI6B,EAAGtR,KAAK0P,EAAI4B,EAAGtR,KAAK8P,QACzD,EACD1B,IAAK,WACH,OAAOpO,IACR,EACDmR,YAAa,WACX,OAAS,IAAOnR,KAAKwP,GAAKxP,KAAKwP,EAAI,QAC1B,IAAOxP,KAAKyP,GAAKzP,KAAKyP,EAAI,QAC1B,IAAOzP,KAAK0P,GAAK1P,KAAK0P,EAAI,OAC3B,GAAK1P,KAAK8P,SAAW9P,KAAK8P,SAAW,CAC9C,EACDG,IAAKD,GACL3B,UAAW2B,GACXzB,UAAW2B,GACXtO,SAAUsO,MAiEZc,GAAOR,GAXA,SAAaF,EAAGC,EAAG5B,EAAGmB,GAC3B,OAA4B,IAArBC,UAAUhB,OAAe0B,GAAWH,GAAK,IAAIE,GAAIF,EAAGC,EAAG5B,EAAc,MAAXmB,EAAkB,EAAIA,EACzF,EASiBjM,GAAOG,GAAO,CAC7BE,SAAU,SAASoN,GAEjB,OADAA,EAAS,MAALA,EAAYpN,GAAWvE,KAAK4R,IAAIrN,GAAUoN,GACvC,IAAId,GAAIxQ,KAAKsQ,EAAGtQ,KAAKuQ,EAAGvQ,KAAK2O,EAAI2C,EAAGtR,KAAK8P,QACjD,EACD7L,OAAQ,SAASqN,GAEf,OADAA,EAAS,MAALA,EAAYrN,GAAStE,KAAK4R,IAAItN,GAAQqN,GACnC,IAAId,GAAIxQ,KAAKsQ,EAAGtQ,KAAKuQ,EAAGvQ,KAAK2O,EAAI2C,EAAGtR,KAAK8P,QACjD,EACD1B,IAAK,WACH,IAAIkC,EAAItQ,KAAKsQ,EAAI,IAAqB,KAAdtQ,KAAKsQ,EAAI,GAC7BC,EAAIF,MAAMC,IAAMD,MAAMrQ,KAAKuQ,GAAK,EAAIvQ,KAAKuQ,EACzC5B,EAAI3O,KAAK2O,EACToC,EAAKpC,GAAKA,EAAI,GAAMA,EAAI,EAAIA,GAAK4B,EACjCO,EAAK,EAAInC,EAAIoC,EACjB,OAAO,IAAI7B,GACT2B,GAAQP,GAAK,IAAMA,EAAI,IAAMA,EAAI,IAAKQ,EAAIC,GAC1CF,GAAQP,EAAGQ,EAAIC,GACfF,GAAQP,EAAI,IAAMA,EAAI,IAAMA,EAAI,IAAKQ,EAAIC,GACzC/Q,KAAK8P,QAER,EACDqB,YAAa,WACX,OAAQ,GAAKnR,KAAKuQ,GAAKvQ,KAAKuQ,GAAK,GAAKF,MAAMrQ,KAAKuQ,KACzC,GAAKvQ,KAAK2O,GAAK3O,KAAK2O,GAAK,GACzB,GAAK3O,KAAK8P,SAAW9P,KAAK8P,SAAW,CAC9C,EACDuB,UAAW,WACT,IAAI1B,EAAI3P,KAAK8P,QACb,OAAc,KADQH,EAAIU,MAAMV,GAAK,EAAIhQ,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,EAAG+O,KAC/C,OAAS,UACpB3P,KAAKsQ,GAAK,GAAK,KACA,KAAftQ,KAAKuQ,GAAK,GAAW,MACN,KAAfvQ,KAAK2O,GAAK,GAAW,KACf,IAANgB,EAAU,IAAM,KAAOA,EAAI,IACnC,KCvWH,IACIzL,GAAW,EADF,GAwBE,SAASiQ,GAAI7D,EAAGC,EAAG6D,EAAGtE,GACnC,OAA4B,IAArBC,UAAUhB,OAtBnB,SAAoBc,GAClB,GAAIA,aAAawE,GAAK,OAAO,IAAIA,GAAIxE,EAAES,EAAGT,EAAEU,EAAGV,EAAEuE,EAAGvE,EAAEC,SAChDD,aAAazB,KAAMyB,EAAIzB,GAAIyB,IACjC,IAAIL,EAAIK,EAAEL,EAAI,IACVC,EAAII,EAAEJ,EAAI,IACVC,EAAIG,EAAEH,EAAI,IACV9O,EAAMjB,KAAKiB,IAAI4O,EAAGC,EAAGC,GACrB7O,EAAMlB,KAAKkB,IAAI2O,EAAGC,EAAGC,GACrB4E,EAAIzT,EAAMD,EACV0P,EAAIhB,IASR,OANIgF,IACahE,EAAXd,IAAM3O,GAAU4O,EAAIC,GAAK4E,EAAc,GAAT7E,EAAIC,GAC7BD,IAAM5O,GAAU6O,EAAIF,GAAK8E,EAAI,GAC5B9E,EAAIC,GAAK6E,EAAI,EACvBhE,GAAK,IAEA,IAAI+D,GAAI/D,EARPgE,EAAIzT,EACJA,EAOgBgP,EAAEC,QAC5B,CAGkCyE,CAAWjE,GAAK,IAAI+D,GAAI/D,EAAGC,EAAG6D,EAAc,MAAXtE,EAAkB,EAAIA,EACzF,CAEO,SAASuE,GAAI/D,EAAGC,EAAG6D,EAAGtE,GAC3B9P,KAAKsQ,GAAKA,EACVtQ,KAAKuQ,GAAKA,EACVvQ,KAAKoU,GAAKA,EACVpU,KAAK8P,SAAWA,CAClB,CAEA,IAAI0E,GAAeH,GAAIlS,UAAYgS,GAAIhS,UAAYf,OAAO2C,OAAOyK,GAAMrM,WAoCvE,SAASsS,GAAQC,EAAIC,EAAIC,EAAIlG,EAAGiB,GAC9B,OAAOvB,GAAe,KAAVsG,EAAKhG,GAAqB,KAAViG,EAAKjG,GAAqB,KAAVkG,EAAKlG,GAAUiB,EAC7D,CC3Ee,SAAQkF,GAACzV,GACtB,OAAO,WACL,OAAOA,CACX,CACA,CCFA,SAAS0V,GAAOnF,EAAG2E,GACjB,OAAO,SAAS5B,GACd,OAAO/C,EAAI+C,EAAI4B,CACnB,CACA,CAOe,SAAAS,GAASpF,EAAGD,GACzB,IAAI4E,EAAI5E,EAAIC,EACZ,OAAO2E,EAAIQ,GAAOnF,EAAG2E,GAAKU,GAAS3E,MAAMV,GAAKD,EAAIC,EACpD,CCbA,SAASwE,GAAIc,GACX,OAAO,SAASC,EAAOC,GACrB,IAAI7E,EAAI2E,GAAKC,EAAQE,GAASF,IAAQ5E,GAAI6E,EAAMC,GAASD,IAAM7E,GAC3DC,EAAI/B,GAAM0G,EAAM3E,EAAG4E,EAAI5E,GACvB6D,EAAI5F,GAAM0G,EAAMd,EAAGe,EAAIf,GACvBtE,EAAUtB,GAAM0G,EAAMpF,QAASqF,EAAIrF,SACvC,OAAO,SAAS4C,GAKd,OAJAwC,EAAM5E,EAAIA,EAAEoC,GACZwC,EAAM3E,EAAIA,EAAEmC,GACZwC,EAAMd,EAAIA,EAAE1B,GACZwC,EAAMpF,QAAUA,EAAQ4C,GACjBwC,EAAQ,EACrB,CACG,CACH,CHsBAV,GAAa7Q,YAAc0Q,GAE3BG,GAAatQ,SAAW,SAASoN,GAE/B,OADAA,EAAS,MAALA,EAAYpN,GAAWvE,KAAK4R,IAAIrN,GAAUoN,GACvC,IAAI+C,GAAIrU,KAAKsQ,EAAGtQ,KAAKuQ,EAAGvQ,KAAKoU,EAAI9C,EAAGtR,KAAK8P,QAClD,EAEA0E,GAAavQ,OAAS,SAASqN,GAE7B,OADAA,EAAS,MAALA,EA7CO,GA6Cc3R,KAAK4R,IA7CnB,GA6C+BD,GACnC,IAAI+C,GAAIrU,KAAKsQ,EAAGtQ,KAAKuQ,EAAGvQ,KAAKoU,EAAI9C,EAAGtR,KAAK8P,QAClD,EAEA0E,GAAapG,IAAM,WACjB,IAAIkC,EAAID,MAAMrQ,KAAKsQ,GAAK,EAAItQ,KAAKsQ,EAAI,IAAqB,KAAdtQ,KAAKsQ,EAAI,GACjDC,EAAIF,MAAMrQ,KAAKsQ,IAAMD,MAAMrQ,KAAKuQ,GAAK,EAAIvQ,KAAKuQ,EAC9C6D,EAAIpU,KAAKoU,EACTzE,EAAI3P,KAAK8P,QACTgD,EAAIsB,EAAI7D,EACRnR,EAAI0T,GAAK,EAAInT,KAAK0V,IAAK/E,EAAI,GAAM,EAAI,IACrC5B,EAAI0F,EAAItB,EACZ,OAAOxC,EAAI,GAAKmE,GAAQ3B,EAAG1T,EAAG,EAAGsP,EAAGiB,GAC9BW,EAAI,IAAMmE,GAAQrV,EAAG0T,EAAG,EAAGpE,EAAGiB,GAC9BW,EAAI,IAAMmE,GAAQ,EAAG3B,EAAG1T,EAAGsP,EAAGiB,GAC9BW,EAAI,IAAMmE,GAAQ,EAAGrV,EAAG0T,EAAGpE,EAAGiB,GAC9BW,EAAI,IAAMmE,GAAQrV,EAAG,EAAG0T,EAAGpE,EAAGiB,GAC9B8E,GAAQ3B,EAAG,EAAG1T,EAAGsP,EAAGiB,EAC5B,EAEA6E,GAAarD,YAAc,WACzB,OAAQ,GAAKnR,KAAKuQ,GAAKvQ,KAAKuQ,GAAK,GAAKF,MAAMrQ,KAAKuQ,KACzC,GAAKvQ,KAAKoU,GAAKpU,KAAKoU,GAAK,GACzB,GAAKpU,KAAK8P,SAAW9P,KAAK8P,SAAW,CAC/C,EGpDA,IAAAwF,GAAenB,GDXR,SAAaxE,EAAGD,GACrB,IAAI4E,EAAI5E,EAAIC,EACZ,OAAO2E,EAAIQ,GAAOnF,EAAG2E,EAAI,KAAOA,GAAK,IAAMA,EAAI,IAAM3U,KAAKkD,MAAMyR,EAAI,KAAOA,GAAKU,GAAS3E,MAAMV,GAAKD,EAAIC,EAC1G,GCSW4F,GAAUpB,GAAI3F,ICOZgH,GAAYnV,SAAAA,GA0DvB,SAAAmV,EAAYzV,EAAiCO,GAA4BC,IAAAA,GACvEA,EAAAF,EAAAG,UAAMT,UAzDAoU,SAAG5T,EAAAA,EAMHkV,eAAS,EAAAlV,EAMTmV,wBAAgBnV,EAGPoV,cAAQpV,EAAAA,EAGjBqV,eAAS,EAAArV,EAGAsV,eAAOtV,EAGhBuV,cAAQvV,EAAAA,EAGCwV,YAAsB,IAAGxV,EAGlCyV,iBAA2B,EAACzV,EAG5BS,UAAwC,IAAIC,IAAKV,EACjDW,gBAAkB,EAACX,EAGnB0V,mBAAW1V,EAWX2V,oBAYN,EAAA,IAMM/U,EAAeC,OAAOC,OANe,CACzC8U,aAAc,QAKmC7V,GAqGrB,OAnG9BC,EAAK4T,IAAMA,GAAIhT,EAAagV,cACxBlT,OAAOoN,MAAM9P,EAAK4T,IAAI7D,KACxB/P,EAAK4T,IAAI7D,EAAI,KAGXrN,OAAOoN,MAAM9P,EAAK4T,IAAI5D,KACxBhQ,EAAK4T,IAAI5D,EAAI,GAGfhQ,EAAKkV,UAAYlV,EAAK4T,IAAI7D,EAC1B/P,EAAKmV,iBAAmBnV,EAAK4T,IAAI5D,EAGjChQ,EAAKN,OAAOuB,UAAUC,IAAI,oBAC1BlB,EAAKN,OAAOmW,UAEgD7V,8GAAAA,EAAKwV,YAAW,eAAexV,EAAKwV,YAC/BxV,4EAAAA,EAAKwV,yBAAwBxV,EAAKwV,YAEtCxV,wFAAAA,EAAKwV,YAAW,uFACDxV,EAAKwV,qJAGvBxV,EAAK8V,SAAQ,8hBAW4B9V,EAAK8V,SAIvG,8DAGD9V,EAAKoV,SAAWpV,EAAKN,OAAOE,cAAiC,sCAC7DI,EAAKqV,UAAYrV,EAAKoV,SAASW,WAAW,KAAM,CAACC,OAAO,IACxDhW,EAAKiW,eACLjW,EAAKkW,qBAGLlW,EAAKsV,QAAUtV,EAAKN,OAAOE,cAAiC,qCAC5DI,EAAKsV,QAAQa,MAAMC,WAAa,4DAEhCpW,EAAKuV,SAAWvV,EAAKsV,QAAQS,WAAW,KAAM,CAACC,OAAO,IACtDhW,EAAKqW,cACLrW,EAAKsW,oBAGLtW,EAAK2V,eAAiB3V,EAAKN,OAAOE,cAA8B,sBAGhEI,EAAK0V,YAAc,CACjB3F,EAAG,IAAIlQ,EAAiBG,EAAKN,OAAOE,cAA8B,6BAA8B,CAC9FO,MAAO,MACPE,IAAK,EACLC,IAAK,IACLU,aAAchB,EAAK4T,IAAI7D,IAEzBC,EAAG,IAAInQ,EAAiBG,EAAKN,OAAOE,cAA8B,6BAA8B,CAC9FO,MAAO,MACPE,IAAK,EACLC,IAAK,IACLU,aAA2B,IAAbhB,EAAK4T,IAAI5D,IAEzB6D,EAAG,IAAIhU,EAAiBG,EAAKN,OAAOE,cAA8B,6BAA8B,CAC9FO,MAAO,MACPE,IAAK,EACLC,IAAK,IACLU,aAA2B,IAAbhB,EAAK4T,IAAIC,IAGzB5E,EAAG,IAAIpP,EAAiBG,EAAKN,OAAOE,cAA8B,6BAA8B,CAC9FO,MAAO,MACPE,IAAK,EACLC,IAAK,IACLU,aAAchB,EAAK4T,IAAI/F,MAAMoB,IAE/BC,EAAG,IAAIrP,EAAiBG,EAAKN,OAAOE,cAA8B,6BAA8B,CAC9FO,MAAO,MACPE,IAAK,EACLC,IAAK,IACLU,aAAchB,EAAK4T,IAAI/F,MAAMqB,IAE/BC,EAAG,IAAItP,EAAiBG,EAAKN,OAAOE,cAA8B,6BAA8B,CAC9FO,MAAO,MACPE,IAAK,EACLC,IAAK,IACLU,aAAchB,EAAK4T,IAAI/F,MAAMsB,IAG/BO,IAAK1P,EAAKN,OAAOE,cAAgC,gCAEnDI,EAAKuW,yBAAyBvW,CAChC,CA1KuB0B,EAAAuT,EAAAnV,GA0KtB,IAAA6B,EAAAsT,EAAArT,iBAAAD,EAOME,YAAA,SAAYC,GACjB,IAAMC,EAAKtC,KAAKkB,kBAGhB,OAFAlB,KAAKgB,UAAUuB,IAAID,EAAID,GACvBA,EAASrC,MACFsC,CACT,EAACJ,EAGMM,eAAA,SAAeF,GACpBtC,KAAKgB,iBAAiBsB,EACxB,EAACJ,EAMM6U,OAAA,SAAOvI,GACZxO,KAAKmU,IAAMA,GAAI3F,GACfxO,KAAKgX,2BACLhX,KAAKiX,aACLjX,KAAKkX,WACP,EAAChV,EAGMiV,OAAA,SAAO3H,EAAWC,EAAWC,GAClC1P,KAAKmU,IAAMA,UAAW3E,EAAC,IAAIC,EAAKC,IAAAA,OAChC1P,KAAKgX,2BACLhX,KAAKiX,aACLjX,KAAKkX,WACP,EAAChV,EAGMkV,iBAAA,SAAiB5H,EAAWC,EAAWC,GAC5C1P,KAAKmX,OAAW,IAAJ3H,EAAa,IAAJC,EAAa,IAAJC,EAChC,EAACxN,EAMMmV,OAAA,SAAO/G,EAAWC,EAAW5B,GAClC3O,KAAKmU,IAAMA,UAAW7D,EAAC,IAAIC,EAAK5B,IAAAA,OAChC3O,KAAKgX,2BACLhX,KAAKiX,aACLjX,KAAKkX,WACP,EAAChV,EAGMoV,iBAAA,SAAiBhH,EAAWC,EAAW5B,GAC5C3O,KAAKqX,OAAW,IAAJ/G,EAAa,IAAJC,EAAa,IAAJ5B,EAChC,EAACzM,EAMMqV,OAAA,SAAOjH,EAAWC,EAAW6D,GAClCpU,KAAKmU,IAAMA,GAAI7D,EAAGC,EAAG6D,GACrBpU,KAAKgX,2BACLhX,KAAKiX,aACLjX,KAAKkX,WACP,EAAChV,EAGMsV,iBAAA,SAAiBlH,EAAWC,EAAW6D,GAC5CpU,KAAKuX,OAAW,IAAJjH,EAAa,IAAJC,EAAa,IAAJ6D,EAChC,EAAClS,EAGMmU,OAAA,WACL,YAAYlC,IAAI9F,WAClB,EAACnM,EAGMuV,OAAA,WACL,IAAMrJ,EAAMpO,KAAKmU,IAAI/F,MACrB,MAAO,CAACoB,EAAGpB,EAAIoB,EAAGC,EAAGrB,EAAIqB,EAAGC,EAAGtB,EAAIsB,EACrC,EAACxN,EAGMwV,iBAAA,WACL,IAAMtJ,EAAMpO,KAAKmU,IAAI/F,MACrB,MAAO,CAACoB,EAAGpB,EAAIoB,EAAI,IAAKC,EAAGrB,EAAIqB,EAAI,IAAKC,EAAGtB,EAAIsB,EAAI,IACrD,EAACxN,EAGMyV,OAAA,WACL,IAAMC,EAAWlH,EAAI1Q,KAAKmU,IAAI9C,aAC9B,MAAO,CAACf,EAAGsH,EAAStH,EAAGC,EAAgB,IAAbqH,EAASrH,EAAS5B,EAAgB,IAAbiJ,EAASjJ,EAC1D,EAACzM,EAGM2V,iBAAA,WACL,IAAMD,EAAWlH,EAAI1Q,KAAKmU,IAAI9C,aAC9B,MAAO,CAACf,EAAGsH,EAAStH,EAAI,IAAKC,EAAGqH,EAASrH,EAAG5B,EAAGiJ,EAASjJ,EAC1D,EAACzM,EAGM4V,OAAA,WACL,MAAO,CAACxH,EAAGtQ,KAAKmU,IAAI7D,EAAGC,EAAgB,IAAbvQ,KAAKmU,IAAI5D,EAAS6D,EAAgB,IAAbpU,KAAKmU,IAAIC,EAC1D,EAAClS,EAGM6V,iBAAA,WACL,MAAO,CAACzH,EAAGtQ,KAAKmU,IAAI7D,EAAI,IAAKC,EAAGvQ,KAAKmU,IAAI5D,EAAG6D,EAAGpU,KAAKmU,IAAIC,EAC1D,EAAClS,EAMM8V,SAAA,WAKL,MAAO,CAAC5J,IAJIpO,KAAKyX,SAIJ/G,IAHD1Q,KAAK2X,SAGCxD,IAFNnU,KAAK8X,SAEM7H,IADXjQ,KAAKqW,SAEnB,EAACnU,EAMM+V,mBAAA,WAKL,MAAO,CAAC7J,IAJIpO,KAAK0X,mBAIJhH,IAHD1Q,KAAK6X,mBAGC1D,IAFNnU,KAAK+X,mBAEM9H,IADXjQ,KAAKqW,SAEnB,EAACnU,EAMO+U,WAAA,WAAU,IAAAtU,EAChB3C,KAAAA,KAAKkW,eAAeQ,MAAMwB,gBAAkBlY,KAAKqW,SACjDrW,KAAKgB,UAAU+B,QAAQ,SAACV,GACtBA,EAASM,EACX,EACF,EAACT,EAGOgV,UAAA,WACNlX,KAAKmY,UACLnY,KAAKoY,mBACP,EAAClW,EAGOiW,QAAA,WACNnY,KAAK4W,cACL5W,KAAKwW,cACP,EAACtU,EAGOsU,aAAA,WAINxW,KAAK4V,UAAUyC,UAAYlE,GAAInU,KAAKmU,IAAI7D,EAAG,EAAG,GAAGjC,YACjDrO,KAAK4V,UAAU0C,SAAS,EAAG,EAAGtY,KAAK+V,YAAa/V,KAAK+V,aAGrD,IAAMwC,EAAqBvY,KAAK4V,UAAU4C,qBACxC,EACAxY,KAAK+V,YAAc,EACnB/V,KAAK+V,YACL/V,KAAK+V,YAAc,GAErBwC,EAAmBE,aAAa,EAAG,sBACnCF,EAAmBE,aAAa,EAAG,yBACnCzY,KAAK4V,UAAUyC,UAAYE,EAC3BvY,KAAK4V,UAAU0C,SAAS,EAAG,EAAGtY,KAAK+V,YAAa/V,KAAK+V,aAGrD,IAAM2C,EAAgB1Y,KAAK4V,UAAU4C,qBACnCxY,KAAK+V,YAAc,EACnB/V,KAAK+V,YACL/V,KAAK+V,YAAc,EACnB,GAEF2C,EAAcD,aAAa,EAAG,gBAC9BC,EAAcD,aAAa,EAAG,mBAC9BzY,KAAK4V,UAAUyC,UAAYK,EAC3B1Y,KAAK4V,UAAU0C,SAAS,EAAG,EAAGtY,KAAK+V,YAAa/V,KAAK+V,aAKrD7W,EAAiBc,KAAK4V,UAFZ5V,KAAKmU,IAAI5D,EAAIvQ,KAAK+V,aACjB,EAAI/V,KAAKmU,IAAIC,GAAKpU,KAAK+V,YACK/V,KAAKgW,iBAC9C,EAAC9T,EAGO0U,YAAA,WAEN5W,KAAK8V,SAAS6C,UAAU,EAAG,EAAG3Y,KAAK6V,QAAQ+C,MAAO5Y,KAAK6V,QAAQgD,QAK/D3Z,EAAiBc,KAAK8V,SAFZ9V,KAAK6V,QAAQ+C,MAAQ,GACpB,EAAI5Y,KAAKmU,IAAI7D,EAAI,KAAOtQ,KAAK6V,QAAQgD,OACV7Y,KAAKgW,iBAC7C,EAAC9T,EAGOuU,mBAAA,WAAkB,IAAArT,EACxBpD,KAAI8Y,GAAa,EACbC,EAAmC,KAGjCC,EAAW,SAAC5Z,EAAGC,GAEnB+D,EAAK+Q,IAAI5D,EAAIiB,GAAMpS,EAAIgE,EAAK2S,YAAa,EAAG,GAC5C3S,EAAKsS,iBAAmBtS,EAAK+Q,IAAI5D,EACjCnN,EAAK+Q,IAAIC,EAAI5C,GAAM,EAAInS,EAAI+D,EAAK2S,YAAa,EAAG,GAGhD3S,EAAK6T,aAGL7T,EAAKoT,eACLpT,EAAK6V,uBACL7V,EAAK8V,uBACL9V,EAAK+V,qBACP,EAIAnZ,KAAK2V,SAAStS,iBAAiB,YAAa,SAAC+V,GAC1B,IAAbA,EAAEC,SACJN,EAAkB,IAAIO,gBACtBpZ,SAASmD,iBACP,YACA,SAAC+V,GACCA,EAAE7V,iBACFyV,EACEI,EAAEG,QAAUnW,EAAKuS,SAAS6D,wBAAwBpa,EAClDga,EAAEK,QAAUrW,EAAKuS,SAAS6D,wBAAwBna,EAEtD,EACA,CAACqa,OAAQX,EAAgBW,SAG3BZ,GAAa,EACbE,EAASI,EAAEO,QAASP,EAAEQ,SAE1B,GAGA1Z,SAASmD,iBAAiB,UAAW,WAC/ByV,GAAcC,IAChBA,EAAgBc,QAChBd,EAAkB,KAClBD,GAAa,EAEjB,EACF,EAAC5W,EAGO2U,kBAAA,WAAiBiD,IAAAA,OACnBhB,GAAa,EACbC,EAAmC,KAGjCgB,EAAU,SAAC1a,GAEfya,EAAK3F,IAAI7D,EAAIkB,GAAM7R,KAAKkD,MAAmC,KAA5B,EAAIxD,EAAIya,EAAK/D,cAAqB,EAAG,KACpE+D,EAAKrE,UAAYqE,EAAK3F,IAAI7D,EAG1BwJ,EAAK7C,aAGL6C,EAAK3B,UACL2B,EAAK7D,YAAY3F,EAAEzO,SAASiY,EAAK3F,IAAI7D,GACrCwJ,EAAKZ,uBACLY,EAAKX,qBACP,EAIAnZ,KAAK6V,QAAQxS,iBAAiB,YAAa,SAAC+V,GAC1CL,EAAkB,IAAIO,gBACtBpZ,SAASmD,iBACP,YACA,SAAC+V,GACCA,EAAE7V,iBACFwW,EAAQX,EAAEK,QAAUK,EAAKnE,SAAS6D,wBAAwBna,EAC5D,EACA,CAACqa,OAAQX,EAAgBW,SAG3BZ,GAAa,EACbiB,EAAQX,EAAEQ,QACZ,GAGA1Z,SAASmD,iBAAiB,UAAW,WAC/ByV,GAAcC,IAChBA,EAAgBc,QAChBd,EAAkB,KAClBD,GAAa,EAEjB,EACF,EAAC5W,EAGO4U,uBAAA,WACN9W,KAAKga,4BACLha,KAAKia,mBACP,EAAC/X,EAGO8X,0BAAA,WAAyB,IAAAE,EAAAla,KAE3Bma,GAAmB,EAEjBC,EAAc,WACbD,IACHA,GAAmB,EACnBD,EAAKjD,aACLiD,EAAK/B,UACL+B,EAAKhB,uBACLgB,EAAKf,sBACLgB,GAAmB,EAEvB,EAEME,EAAc,SAAC7K,EAAGC,EAAGC,GACpByK,IACHA,GAAmB,EACnBD,EAAK/F,IAAMA,GAAG,OAAQxU,KAAKkD,MAAM2M,OAAM7P,KAAKkD,MAAM4M,GAAM9P,IAAAA,KAAKkD,MAAM6M,GAAM,KACzEwK,EAAKlD,2BACLkD,EAAKjD,aACLiD,EAAK/B,UACL+B,EAAKjB,uBACLiB,EAAKf,sBACLgB,GAAmB,EAEvB,EAIAna,KAAKiW,YAAY3F,EAAElO,YAAY,SAAC3B,GAC1BA,IAAUyZ,EAAK/F,IAAI7D,IACrB4J,EAAK/F,IAAI7D,EAAI7P,EACbyZ,EAAKzE,UAAYhV,EACjB2Z,IAEJ,GAEApa,KAAKiW,YAAY1F,EAAEnO,YAAY,SAAC3B,GAC1BA,IAAUyZ,EAAK/F,IAAI5D,IACrB2J,EAAK/F,IAAI5D,EAAI9P,EAAQ,IACrByZ,EAAKxE,iBAAmBwE,EAAK/F,IAAI5D,EACjC6J,IAEJ,GAEApa,KAAKiW,YAAY7B,EAAEhS,YAAY,SAAC3B,GAC1BA,IAAUyZ,EAAK/F,IAAIC,IACrB8F,EAAK/F,IAAIC,EAAI3T,EAAQ,IACrB2Z,IAEJ,GAIApa,KAAKiW,YAAYzG,EAAEpN,YAAY,SAAC3B,GAC9B,IAAM6Z,EAASJ,EAAK/F,IAAI/F,MACpB3N,IAAU6Z,EAAO9K,GACnB6K,EAAY5Z,EAAO6Z,EAAO7K,EAAG6K,EAAO5K,EAExC,GAEA1P,KAAKiW,YAAYxG,EAAErN,YAAY,SAAC3B,GAC9B,IAAM6Z,EAASJ,EAAK/F,IAAI/F,MACpB3N,IAAU6Z,EAAO7K,GACnB4K,EAAYC,EAAO9K,EAAG/O,EAAO6Z,EAAO5K,EAExC,GAEA1P,KAAKiW,YAAYvG,EAAEtN,YAAY,SAAC3B,GAC9B,IAAM6Z,EAASJ,EAAK/F,IAAI/F,MACpB3N,IAAU6Z,EAAO5K,GACnB2K,EAAYC,EAAO9K,EAAG8K,EAAO7K,EAAGhP,EAEpC,EACF,EAACyB,EAGO+X,kBAAA,eAAiBM,EAAAva,KACvBA,KAAKiW,YAAYhG,IAAI5M,iBAAiB,QAAS,SAACC,GAC9C,IAAMkX,EAAUlX,EAAGmX,cACbha,EAAQ+Z,EAAQ/Z,MAClBA,EAAMia,MAAM,uCACdH,EAAKpG,IAAMA,GAAI1T,GACf8Z,EAAKvD,2BACLuD,EAAKtD,aACLsD,EAAKpC,UACLoC,EAAKrB,uBACLqB,EAAKtB,uBACLuB,EAAQhZ,UAAUmZ,OAAO,uCAEzBH,EAAQhZ,UAAUC,IAAI,qCAE1B,GAEAzB,KAAKiW,YAAYhG,IAAI5M,iBAAiB,WAAY,SAACC,GACjD,IAAMkX,EAAUlX,EAAGmX,cACLD,EAAQ/Z,MACXia,MAAM,wCACfF,EAAQ/Z,MAAQ8Z,EAAKlE,SACrBmE,EAAQhZ,UAAUmZ,OAAO,sCAE7B,EACF,EAACzY,EAGOkW,kBAAA,WACNpY,KAAKiZ,uBACLjZ,KAAKkZ,uBACLlZ,KAAKmZ,qBACP,EAACjX,EAGO+W,qBAAA,WACNjZ,KAAKiW,YAAY3F,EAAEzO,SAAS7B,KAAKmU,IAAI7D,GAAG,GACxCtQ,KAAKiW,YAAY1F,EAAE1O,SAAsB,IAAb7B,KAAKmU,IAAI5D,GAAS,GAC9CvQ,KAAKiW,YAAY7B,EAAEvS,SAAsB,IAAb7B,KAAKmU,IAAIC,GAAS,EAChD,EAAClS,EAGOgX,qBAAA,WACN,IAAM9K,EAAMpO,KAAKmU,IAAI/F,MACrBpO,KAAKiW,YAAYzG,EAAE3N,SAASuM,EAAIoB,GAAG,GACnCxP,KAAKiW,YAAYxG,EAAE5N,SAASuM,EAAIqB,GAAG,GACnCzP,KAAKiW,YAAYvG,EAAE7N,SAASuM,EAAIsB,GAAG,EACrC,EAACxN,EAGOiX,oBAAA,WACNnZ,KAAKiW,YAAYhG,IAAIxP,MAAQT,KAAKqW,QACpC,EAACnU,EAMO8U,yBAAA,WACF/T,OAAOoN,MAAMrQ,KAAKmU,IAAI7D,GACxBtQ,KAAKmU,IAAI7D,EAAItQ,KAAKyV,UAElBzV,KAAKyV,UAAYzV,KAAKmU,IAAI7D,EAGxBrN,OAAOoN,MAAMrQ,KAAKmU,IAAI5D,GACxBvQ,KAAKmU,IAAI5D,EAAIvQ,KAAK0V,iBAElB1V,KAAK0V,iBAAmB1V,KAAKmU,IAAI5D,CAErC,EAACiF,CAAA,CA7nBsBnV,CAAQP,GA4oBjC,SAAS0R,GAAMoJ,EAAQha,EAAKC,GAC1B,OAAOlB,KAAKkB,IAAID,EAAKjB,KAAKiB,IAAIC,EAAK+Z,GACrC,CA8B+D,OAA3D1a,SAAS2a,KAAK1a,cAAc,4BAC9BD,SAAS2a,KAAKC,mBACZ,YAkDH,knCCzvBD,IAAIC,GAAoB,SAA2Bta,GAClD,OAID,SAAyBA,GACxB,QAASA,GAA0B,iBAAVA,CAC1B,CANQua,CAAgBva,KAQxB,SAAmBA,GAClB,IAAIwa,EAAc7Z,OAAOe,UAAUP,SAASpB,KAAKC,GAEjD,MAAuB,oBAAhBwa,GACa,kBAAhBA,GAQL,SAAwBxa,GACvB,OAAOA,EAAMya,WAAaC,EAC3B,CATKC,CAAe3a,EACpB,CAbM4a,CAAU5a,EAChB,EAgBI0a,GADiC,mBAAXG,QAAyBA,OAAOC,IAClBD,OAAOC,IAAI,iBAAmB,MAUtE,SAASC,GAA8B/a,EAAOH,GAC7C,OAA0B,IAAlBA,EAAQmb,OAAmBnb,EAAQya,kBAAkBta,GAC1Dib,GALIC,MAAMC,QAKYnb,GALG,GAAK,CAAE,EAKFA,EAAOH,GACrCG,CACJ,CAEA,SAASob,GAAkBC,EAAQC,EAAQzb,GAC1C,OAAOwb,EAAOE,OAAOD,GAAQE,IAAI,SAASzB,GACzC,OAAOgB,GAA8BhB,EAASla,EAChD,EACA,CAkBA,SAAS4b,GAAQJ,GAChB,OAAO1a,OAAO+a,KAAKL,GAAQE,OAT5B,SAAyCF,GACxC,OAAO1a,OAAOgb,sBACXhb,OAAOgb,sBAAsBN,GAAQO,OAAO,SAASC,GACtD,OAAOlb,OAAOmb,qBAAqB/b,KAAKsb,EAAQQ,EACnD,GACI,EACJ,CAGmCE,CAAgCV,GACnE,CAEA,SAASW,GAAmBC,EAAQC,GACnC,IACC,OAAOA,KAAYD,CACnB,CAAC,MAAME,GACP,OAAO,CACP,CACF,CA8BA,SAASlB,GAAUI,EAAQC,EAAQzb,IAClCA,EAAUA,GAAW,IACbuc,WAAavc,EAAQuc,YAAchB,GAC3Cvb,EAAQya,kBAAoBza,EAAQya,mBAAqBA,GAGzDza,EAAQkb,8BAAgCA,GAExC,IAAIsB,EAAgBnB,MAAMC,QAAQG,GAIlC,OAFgCe,IADZnB,MAAMC,QAAQE,GAKvBgB,EACHxc,EAAQuc,WAAWf,EAAQC,EAAQzb,GApC5C,SAAqBwb,EAAQC,EAAQzb,GACpC,IAAIyc,EAAc,CAAA,EAiBlB,OAhBIzc,EAAQya,kBAAkBe,IAC7BI,GAAQJ,GAAQ/Y,QAAQ,SAASU,GAChCsZ,EAAYtZ,GAAO+X,GAA8BM,EAAOrY,GAAMnD,EACjE,GAEC4b,GAAQH,GAAQhZ,QAAQ,SAASU,IAblC,SAA0BqY,EAAQrY,GACjC,OAAOgZ,GAAmBX,EAAQrY,MAC5BrC,OAAOiO,eAAe7O,KAAKsb,EAAQrY,IACpCrC,OAAOmb,qBAAqB/b,KAAKsb,EAAQrY,GAC/C,EAUMuZ,CAAiBlB,EAAQrY,KAK5BsZ,EAAYtZ,GADTgZ,GAAmBX,EAAQrY,IAAQnD,EAAQya,kBAAkBgB,EAAOtY,IA/C1E,SAA0BA,EAAKnD,GAC9B,IAAKA,EAAQ2c,YACZ,OAAOvB,GAER,IAAIuB,EAAc3c,EAAQ2c,YAAYxZ,GACtC,MAA8B,mBAAhBwZ,EAA6BA,EAAcvB,EAC1D,CA0CsBwB,CAAiBzZ,EAAKnD,EAAtB4c,CAA+BpB,EAAOrY,GAAMsY,EAAOtY,GAAMnD,GAEzDkb,GAA8BO,EAAOtY,GAAMnD,GAEjE,GACQyc,CACR,CAmBSI,CAAYrB,EAAQC,EAAQzb,GAJ5Bkb,GAA8BO,EAAQzb,EAM/C,CAEAob,GAAU0B,IAAM,SAAsBC,EAAO/c,GAC5C,IAAKqb,MAAMC,QAAQyB,GAClB,MAAM,IAAIC,MAAM,qCAGjB,OAAOD,EAAME,OAAO,SAASC,EAAMC,GAClC,OAAO/B,GAAU8B,EAAMC,EAAMnd,EAC7B,EAAE,GACJ,EAEA,IAEAod,GAFkBhC,GClIH,SAAAiC,GAAShO,EAAGD,GACzB,OAAOC,EAAID,GAAK,EAAIC,EAAID,EAAI,EAAIC,GAAKD,EAAI,EAAIJ,GAC/C,CCAe,SAAQsO,GAACC,GACtB,IAAIC,EAAQD,EACRE,EAAUF,EAOd,SAASG,EAAKrO,EAAGvQ,EAAG6e,EAAIC,GAGtB,IAFU,MAAND,IAAYA,EAAK,GACX,MAANC,IAAYA,EAAKvO,EAAEZ,QAChBkP,EAAKC,GAAI,CACd,MAAMC,EAAOF,EAAKC,IAAQ,EACtBH,EAAQpO,EAAEwO,GAAM/e,GAAK,EAAG6e,EAAKE,EAAM,EAClCD,EAAKC,CACX,CACD,OAAOF,CACR,CAoBD,OAlCiB,IAAbJ,EAAE9O,SACJ+O,EAAQ,CAACxJ,EAAGlV,IAAMye,EAAEvJ,GAAKlV,EACzB2e,EAmCJ,SAA6BF,GAC3B,MAAO,CAACvJ,EAAGlV,IAAMue,GAAUE,EAAEvJ,GAAIlV,EACnC,CArCcgf,CAAoBP,IAgCzB,CAACG,OAAMK,OAPd,SAAgB1O,EAAGvQ,EAAG6e,EAAIC,GACd,MAAND,IAAYA,EAAK,GACX,MAANC,IAAYA,EAAKvO,EAAEZ,QACvB,MAAMxP,EAAIye,EAAKrO,EAAGvQ,EAAG6e,EAAIC,EAAK,GAC9B,OAAO3e,EAAI0e,GAAMH,EAAMnO,EAAEpQ,EAAI,GAAIH,IAAM0e,EAAMnO,EAAEpQ,GAAIH,GAAKG,EAAI,EAAIA,CACjE,EAEqB+e,MAlBtB,SAAe3O,EAAGvQ,EAAG6e,EAAIC,GAGvB,IAFU,MAAND,IAAYA,EAAK,GACX,MAANC,IAAYA,EAAKvO,EAAEZ,QAChBkP,EAAKC,GAAI,CACd,MAAMC,EAAOF,EAAKC,IAAQ,EACtBH,EAAQpO,EAAEwO,GAAM/e,GAAK,EAAG8e,EAAKC,EAC5BF,EAAKE,EAAM,CACjB,CACD,OAAOF,CACR,EAUH,CCrCA,MACaM,GADWX,GAASD,IACUW,MAEfV,GCPb,SAASxe,GACtB,OAAa,OAANA,EAAakQ,KAAOlQ,CAC7B,GDMA,IAAAof,GAAeD,GERXE,GAAM9e,KAAKqT,KAAK,IAChB0L,GAAK/e,KAAKqT,KAAK,IACf2L,GAAKhf,KAAKqT,KAAK,GAkCZ,SAAS4L,GAAc1J,EAAO2J,EAAMC,GACzC,IAAIhe,GAAQ+d,EAAO3J,GAASvV,KAAKkB,IAAI,EAAGie,GACpCC,EAAQpf,KAAKqf,MAAMrf,KAAKsf,IAAIne,GAAQnB,KAAKuf,MACzCC,EAAQre,EAAOnB,KAAK4R,IAAI,GAAIwN,GAChC,OAAOA,GAAS,GACTI,GAASV,GAAM,GAAKU,GAAST,GAAK,EAAIS,GAASR,GAAK,EAAI,GAAKhf,KAAK4R,IAAI,GAAIwN,IAC1Epf,KAAK4R,IAAI,IAAKwN,IAAUI,GAASV,GAAM,GAAKU,GAAST,GAAK,EAAIS,GAASR,GAAK,EAAI,EACzF,CC3CO,SAASS,GAAUC,EAAQC,GAChC,OAAQvP,UAAUhB,QAChB,KAAK,EAAG,MACR,KAAK,EAAG/O,KAAKsf,MAAMD,GAAS,MAC5B,QAASrf,KAAKsf,MAAMA,GAAOD,OAAOA,GAEpC,OAAOrf,IACT,CCPe,SAAAgR,GAASrN,EAAaC,EAASzB,GAC5CwB,EAAYxB,UAAYyB,EAAQzB,UAAYA,EAC5CA,EAAUwB,YAAcA,CAC1B,CAEO,SAASE,GAAO5D,EAAQ6D,GAC7B,IAAI3B,EAAYf,OAAO2C,OAAO9D,EAAOkC,WACrC,IAAK,IAAIsB,KAAOK,EAAY3B,EAAUsB,GAAOK,EAAWL,GACxD,OAAOtB,CACT,CCPO,SAAS6B,KAAU,CAEnB,IAAIC,GAAS,GACTC,GAAW,EAAID,GAEtBE,GAAM,sBACNC,GAAM,gDACNC,GAAM,iDACNC,GAAQ,qBACRC,GAAe,IAAIC,OAAO,UAAY,CAACL,GAAKA,GAAKA,IAAO,QACxDM,GAAe,IAAID,OAAO,UAAY,CAACH,GAAKA,GAAKA,IAAO,QACxDK,GAAgB,IAAIF,OAAO,WAAa,CAACL,GAAKA,GAAKA,GAAKC,IAAO,QAC/DO,GAAgB,IAAIH,OAAO,WAAa,CAACH,GAAKA,GAAKA,GAAKD,IAAO,QAC/DQ,GAAe,IAAIJ,OAAO,UAAY,CAACJ,GAAKC,GAAKA,IAAO,QACxDQ,GAAgB,IAAIL,OAAO,WAAa,CAACJ,GAAKC,GAAKA,GAAKD,IAAO,QAE/DU,GAAQ,CACVC,UAAW,SACXC,aAAc,SACdC,KAAM,MACNC,WAAY,QACZC,MAAO,SACPC,MAAO,SACPC,OAAQ,SACRC,MAAO,EACPC,eAAgB,SAChBC,KAAM,IACNC,WAAY,QACZC,MAAO,SACPC,UAAW,SACXC,UAAW,QACXC,WAAY,QACZC,UAAW,SACXC,MAAO,SACPC,eAAgB,QAChBC,SAAU,SACVC,QAAS,SACTC,KAAM,MACNC,SAAU,IACVC,SAAU,MACVC,cAAe,SACfC,SAAU,SACVC,UAAW,MACXC,SAAU,SACVC,UAAW,SACXC,YAAa,QACbC,eAAgB,QAChBC,WAAY,SACZC,WAAY,SACZC,QAAS,QACTC,WAAY,SACZC,aAAc,QACdC,cAAe,QACfC,cAAe,QACfC,cAAe,QACfC,cAAe,MACfC,WAAY,QACZC,SAAU,SACVC,YAAa,MACbC,QAAS,QACTC,QAAS,QACTC,WAAY,QACZC,UAAW,SACXC,YAAa,SACbC,YAAa,QACbC,QAAS,SACTC,UAAW,SACXC,WAAY,SACZC,KAAM,SACNC,UAAW,SACXC,KAAM,QACNC,MAAO,MACPC,YAAa,SACbC,KAAM,QACNC,SAAU,SACVC,QAAS,SACTC,UAAW,SACXC,OAAQ,QACRC,MAAO,SACPC,MAAO,SACPC,SAAU,SACVC,cAAe,SACfC,UAAW,QACXC,aAAc,SACdC,UAAW,SACXC,WAAY,SACZC,UAAW,SACXC,qBAAsB,SACtBC,UAAW,SACXC,WAAY,QACZC,UAAW,SACXC,UAAW,SACXC,YAAa,SACbC,cAAe,QACfC,aAAc,QACdC,eAAgB,QAChBC,eAAgB,QAChBC,eAAgB,SAChBC,YAAa,SACbC,KAAM,MACNC,UAAW,QACXC,MAAO,SACPC,QAAS,SACTC,OAAQ,QACRC,iBAAkB,QAClBC,WAAY,IACZC,aAAc,SACdC,aAAc,QACdC,eAAgB,QAChBC,gBAAiB,QACjBC,kBAAmB,MACnBC,gBAAiB,QACjBC,gBAAiB,SACjBC,aAAc,QACdC,UAAW,SACXC,UAAW,SACXC,SAAU,SACVC,YAAa,SACbC,KAAM,IACNC,QAAS,SACTC,MAAO,QACPC,UAAW,QACXC,OAAQ,SACRC,UAAW,SACXC,OAAQ,SACRC,cAAe,SACfC,UAAW,SACXC,cAAe,SACfC,cAAe,SACfC,WAAY,SACZC,UAAW,SACXC,KAAM,SACNC,KAAM,SACNC,KAAM,SACNC,WAAY,SACZC,OAAQ,QACRC,cAAe,QACfC,IAAK,SACLC,UAAW,SACXC,UAAW,QACXC,YAAa,QACbC,OAAQ,SACRC,WAAY,SACZC,SAAU,QACVC,SAAU,SACVC,OAAQ,SACRC,OAAQ,SACRC,QAAS,QACTC,UAAW,QACXC,UAAW,QACXC,UAAW,QACXC,KAAM,SACNC,YAAa,MACbC,UAAW,QACXC,IAAK,SACLC,KAAM,MACNC,QAAS,SACTC,OAAQ,SACRC,UAAW,QACXC,OAAQ,SACRC,MAAO,SACPC,MAAO,SACPC,WAAY,SACZC,OAAQ,SACRC,YAAa,UAiBf,SAASC,KACP,OAAOnO,KAAKoO,MAAMC,WACpB,CAMA,SAASC,KACP,OAAOtO,KAAKoO,MAAMG,WACpB,CAEe,SAASC,GAAMC,GAC5B,IAAIC,EAAGC,EAEP,OADAF,GAAUA,EAAS,IAAIG,OAAOC,eACtBH,EAAIpK,GAAMwK,KAAKL,KAAYE,EAAID,EAAE,GAAGK,OAAQL,EAAIM,SAASN,EAAE,GAAI,IAAW,IAANC,EAAUM,GAAKP,GAC/E,IAANC,EAAU,IAAIO,GAAKR,GAAK,EAAI,GAAQA,GAAK,EAAI,IAAQA,GAAK,EAAI,GAAY,IAAJA,GAAiB,GAAJA,IAAY,EAAU,GAAJA,EAAU,GACzG,IAANC,EAAUQ,GAAKT,GAAK,GAAK,IAAMA,GAAK,GAAK,IAAMA,GAAK,EAAI,KAAW,IAAJA,GAAY,KACrE,IAANC,EAAUQ,GAAMT,GAAK,GAAK,GAAQA,GAAK,EAAI,IAAQA,GAAK,EAAI,GAAQA,GAAK,EAAI,IAAQA,GAAK,EAAI,GAAY,IAAJA,IAAkB,GAAJA,IAAY,EAAU,GAAJA,GAAY,KAClJ,OACCA,EAAInK,GAAauK,KAAKL,IAAW,IAAIS,GAAIR,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAI,IAC3DA,EAAIjK,GAAaqK,KAAKL,IAAW,IAAIS,GAAW,IAAPR,EAAE,GAAW,IAAY,IAAPA,EAAE,GAAW,IAAY,IAAPA,EAAE,GAAW,IAAK,IAC/FA,EAAIhK,GAAcoK,KAAKL,IAAWU,GAAKT,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAIA,EAAE,KAC3DA,EAAI/J,GAAcmK,KAAKL,IAAWU,GAAY,IAAPT,EAAE,GAAW,IAAY,IAAPA,EAAE,GAAW,IAAY,IAAPA,EAAE,GAAW,IAAKA,EAAE,KAC/FA,EAAI9J,GAAakK,KAAKL,IAAWW,GAAKV,EAAE,GAAIA,EAAE,GAAK,IAAKA,EAAE,GAAK,IAAK,IACpEA,EAAI7J,GAAciK,KAAKL,IAAWW,GAAKV,EAAE,GAAIA,EAAE,GAAK,IAAKA,EAAE,GAAK,IAAKA,EAAE,IACxE5J,GAAMuK,eAAeZ,GAAUQ,GAAKnK,GAAM2J,IAC/B,gBAAXA,EAA2B,IAAIS,GAAII,IAAKA,IAAKA,IAAK,GAClD,IACR,CAEA,SAASL,GAAKM,GACZ,OAAO,IAAIL,GAAIK,GAAK,GAAK,IAAMA,GAAK,EAAI,IAAU,IAAJA,EAAU,EAC1D,CAEA,SAASJ,GAAKK,EAAGC,EAAGC,EAAGC,GAErB,OADIA,GAAK,IAAGH,EAAIC,EAAIC,EAAIJ,KACjB,IAAIJ,GAAIM,EAAGC,EAAGC,EAAGC,EAC1B,CASO,SAASvB,GAAIoB,EAAGC,EAAGC,EAAGI,GAC3B,OAA4B,IAArBC,UAAUhB,SARQc,EAQkBL,aAPxBxL,KAAQ6L,EAAIrB,GAAMqB,IAChCA,EAEE,IAAIX,IADXW,EAAIA,EAAEzB,OACWoB,EAAGK,EAAEJ,EAAGI,EAAEH,EAAGG,EAAEC,SAFjB,IAAIZ,IAM6B,IAAIA,GAAIM,EAAGC,EAAGC,EAAc,MAAXI,EAAkB,EAAIA,GARlF,IAAoBD,CAS3B,CAEO,SAASX,GAAIM,EAAGC,EAAGC,EAAGI,GAC3B9P,KAAKwP,GAAKA,EACVxP,KAAKyP,GAAKA,EACVzP,KAAK0P,GAAKA,EACV1P,KAAK8P,SAAWA,CAClB,CA0BA,SAASE,KACP,MAAO,IAAMC,GAAIjQ,KAAKwP,GAAKS,GAAIjQ,KAAKyP,GAAKQ,GAAIjQ,KAAK0P,EACpD,CAEA,SAASQ,KACP,IAAIP,EAAI3P,KAAK8P,QACb,OAAc,KADQH,EAAIU,MAAMV,GAAK,EAAIhQ,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,EAAG+O,KAC/C,OAAS,SACrBhQ,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,IAAKjB,KAAKkD,MAAM7C,KAAKwP,IAAM,IAAM,KACtD7P,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,IAAKjB,KAAKkD,MAAM7C,KAAKyP,IAAM,IAAM,KACtD9P,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,IAAKjB,KAAKkD,MAAM7C,KAAK0P,IAAM,KACzC,IAANC,EAAU,IAAM,KAAOA,EAAI,IACpC,CAEA,SAASM,GAAIxP,GAEX,QADAA,EAAQd,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,IAAKjB,KAAKkD,MAAMpC,IAAU,KACvC,GAAK,IAAM,IAAMA,EAAMmB,SAAS,GAClD,CAEA,SAASwN,GAAKkB,EAAGC,EAAG5B,EAAGgB,GAIrB,OAHIA,GAAK,EAAGW,EAAIC,EAAI5B,EAAIW,IACfX,GAAK,GAAKA,GAAK,EAAG2B,EAAIC,EAAIjB,IAC1BiB,GAAK,IAAGD,EAAIhB,KACd,IAAIkB,GAAIF,EAAGC,EAAG5B,EAAGgB,EAC1B,CAEO,SAASc,GAAWZ,GACzB,GAAIA,aAAaW,GAAK,OAAO,IAAIA,GAAIX,EAAES,EAAGT,EAAEU,EAAGV,EAAElB,EAAGkB,EAAEC,SAEtD,GADMD,aAAa7L,KAAQ6L,EAAIrB,GAAMqB,KAChCA,EAAG,OAAO,IAAIW,GACnB,GAAIX,aAAaW,GAAK,OAAOX,EAE7B,IAAIL,GADJK,EAAIA,EAAEzB,OACIoB,EAAI,IACVC,EAAII,EAAEJ,EAAI,IACVC,EAAIG,EAAEH,EAAI,IACV9O,EAAMjB,KAAKiB,IAAI4O,EAAGC,EAAGC,GACrB7O,EAAMlB,KAAKkB,IAAI2O,EAAGC,EAAGC,GACrBY,EAAIhB,IACJiB,EAAI1P,EAAMD,EACV+N,GAAK9N,EAAMD,GAAO,EAUtB,OATI2P,GACaD,EAAXd,IAAM3O,GAAU4O,EAAIC,GAAKa,EAAc,GAATd,EAAIC,GAC7BD,IAAM5O,GAAU6O,EAAIF,GAAKe,EAAI,GAC5Bf,EAAIC,GAAKc,EAAI,EACvBA,GAAK5B,EAAI,GAAM9N,EAAMD,EAAM,EAAIC,EAAMD,EACrC0P,GAAK,IAELC,EAAI5B,EAAI,GAAKA,EAAI,EAAI,EAAI2B,EAEpB,IAAIE,GAAIF,EAAGC,EAAG5B,EAAGkB,EAAEC,QAC5B,CAMA,SAASU,GAAIF,EAAGC,EAAG5B,EAAGmB,GACpB9P,KAAKsQ,GAAKA,EACVtQ,KAAKuQ,GAAKA,EACVvQ,KAAK2O,GAAKA,EACV3O,KAAK8P,SAAWA,CAClB,CAwCA,SAASe,GAAQP,EAAGQ,EAAIC,GACtB,OAGY,KAHJT,EAAI,GAAKQ,GAAMC,EAAKD,GAAMR,EAAI,GAChCA,EAAI,IAAMS,EACVT,EAAI,IAAMQ,GAAMC,EAAKD,IAAO,IAAMR,GAAK,GACvCQ,EACR,CAzMAE,GAAOhN,GAAOwK,GAAO,CACnByC,KAAM,SAASC,GACb,OAAO9P,OAAOC,OAAO,IAAIrB,KAAK2D,YAAa3D,KAAMkR,EAClD,EACDC,YAAa,WACX,OAAOnR,KAAKoO,MAAM+C,aACnB,EACDlB,IAAK9B,GACLE,UAAWF,GACXkD,UASF,WACE,OAAOZ,GAAWzQ,MAAMqR,WAC1B,EAVE9C,UAAWD,GACX1M,SAAU0M,KA6DZ0C,GAAO9B,GAAKd,GAAKvK,GAAOG,GAAO,CAC7BE,SAAU,SAASoN,GAEjB,OADAA,EAAS,MAALA,EAAYpN,GAAWvE,KAAK4R,IAAIrN,GAAUoN,GACvC,IAAIpC,GAAIlP,KAAKwP,EAAI8B,EAAGtR,KAAKyP,EAAI6B,EAAGtR,KAAK0P,EAAI4B,EAAGtR,KAAK8P,QACzD,EACD7L,OAAQ,SAASqN,GAEf,OADAA,EAAS,MAALA,EAAYrN,GAAStE,KAAK4R,IAAItN,GAAQqN,GACnC,IAAIpC,GAAIlP,KAAKwP,EAAI8B,EAAGtR,KAAKyP,EAAI6B,EAAGtR,KAAK0P,EAAI4B,EAAGtR,KAAK8P,QACzD,EACD1B,IAAK,WACH,OAAOpO,IACR,EACDmR,YAAa,WACX,OAAS,IAAOnR,KAAKwP,GAAKxP,KAAKwP,EAAI,QAC1B,IAAOxP,KAAKyP,GAAKzP,KAAKyP,EAAI,QAC1B,IAAOzP,KAAK0P,GAAK1P,KAAK0P,EAAI,OAC3B,GAAK1P,KAAK8P,SAAW9P,KAAK8P,SAAW,CAC9C,EACDG,IAAKD,GACL3B,UAAW2B,GACXzB,UAAW2B,GACXtO,SAAUsO,MAiEZc,GAAOR,GAXA,SAAaF,EAAGC,EAAG5B,EAAGmB,GAC3B,OAA4B,IAArBC,UAAUhB,OAAe0B,GAAWH,GAAK,IAAIE,GAAIF,EAAGC,EAAG5B,EAAc,MAAXmB,EAAkB,EAAIA,EACzF,EASiBjM,GAAOG,GAAO,CAC7BE,SAAU,SAASoN,GAEjB,OADAA,EAAS,MAALA,EAAYpN,GAAWvE,KAAK4R,IAAIrN,GAAUoN,GACvC,IAAId,GAAIxQ,KAAKsQ,EAAGtQ,KAAKuQ,EAAGvQ,KAAK2O,EAAI2C,EAAGtR,KAAK8P,QACjD,EACD7L,OAAQ,SAASqN,GAEf,OADAA,EAAS,MAALA,EAAYrN,GAAStE,KAAK4R,IAAItN,GAAQqN,GACnC,IAAId,GAAIxQ,KAAKsQ,EAAGtQ,KAAKuQ,EAAGvQ,KAAK2O,EAAI2C,EAAGtR,KAAK8P,QACjD,EACD1B,IAAK,WACH,IAAIkC,EAAItQ,KAAKsQ,EAAI,IAAqB,KAAdtQ,KAAKsQ,EAAI,GAC7BC,EAAIF,MAAMC,IAAMD,MAAMrQ,KAAKuQ,GAAK,EAAIvQ,KAAKuQ,EACzC5B,EAAI3O,KAAK2O,EACToC,EAAKpC,GAAKA,EAAI,GAAMA,EAAI,EAAIA,GAAK4B,EACjCO,EAAK,EAAInC,EAAIoC,EACjB,OAAO,IAAI7B,GACT2B,GAAQP,GAAK,IAAMA,EAAI,IAAMA,EAAI,IAAKQ,EAAIC,GAC1CF,GAAQP,EAAGQ,EAAIC,GACfF,GAAQP,EAAI,IAAMA,EAAI,IAAMA,EAAI,IAAKQ,EAAIC,GACzC/Q,KAAK8P,QAER,EACDqB,YAAa,WACX,OAAQ,GAAKnR,KAAKuQ,GAAKvQ,KAAKuQ,GAAK,GAAKF,MAAMrQ,KAAKuQ,KACzC,GAAKvQ,KAAK2O,GAAK3O,KAAK2O,GAAK,GACzB,GAAK3O,KAAK8P,SAAW9P,KAAK8P,SAAW,CAC9C,EACDuB,UAAW,WACT,IAAI1B,EAAI3P,KAAK8P,QACb,OAAc,KADQH,EAAIU,MAAMV,GAAK,EAAIhQ,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,EAAG+O,KAC/C,OAAS,UACpB3P,KAAKsQ,GAAK,GAAK,KACA,KAAftQ,KAAKuQ,GAAK,GAAW,MACN,KAAfvQ,KAAK2O,GAAK,GAAW,KACf,IAANgB,EAAU,IAAM,KAAOA,EAAI,IACnC,KCzWH,IAAe4P,GAAAngB,GAAK,IAAMA,ECyBX,SAASogB,GAAQ7P,EAAGD,GACjC,IAAI4E,EAAI5E,EAAIC,EACZ,OAAO2E,EAzBT,SAAgB3E,EAAG2E,GACjB,OAAO,SAAS5B,GACd,OAAO/C,EAAI+C,EAAI4B,CACnB,CACA,CAqBaQ,CAAOnF,EAAG2E,GAAKU,GAAS3E,MAAMV,GAAKD,EAAIC,EACpD,CCvBA,IAAAvB,GAAe,SAAUqR,EAASpgB,GAChC,IAAImP,EDaC,SAAenP,GACpB,OAAoB,IAAZA,GAAKA,GAAWmgB,GAAU,SAAS7P,EAAGD,GAC5C,OAAOA,EAAIC,EAbf,SAAqBA,EAAGD,EAAGrQ,GACzB,OAAOsQ,EAAIhQ,KAAK4R,IAAI5B,EAAGtQ,GAAIqQ,EAAI/P,KAAK4R,IAAI7B,EAAGrQ,GAAKsQ,EAAGtQ,EAAI,EAAIA,EAAG,SAASqT,GACrE,OAAO/S,KAAK4R,IAAI5B,EAAI+C,EAAIhD,EAAGrQ,EAC/B,CACA,CASmBqgB,CAAY/P,EAAGD,EAAGrQ,GAAK2V,GAAS3E,MAAMV,GAAKD,EAAIC,EAClE,CACA,CCjBcgQ,CAAMtgB,GAElB,SAAS+O,EAAI8G,EAAOC,GAClB,IAAI3F,EAAIhB,GAAO0G,EAAQ0K,GAAS1K,IAAQ1F,GAAI2F,EAAMyK,GAASzK,IAAM3F,GAC7DC,EAAIjB,EAAM0G,EAAMzF,EAAG0F,EAAI1F,GACvBC,EAAIlB,EAAM0G,EAAMxF,EAAGyF,EAAIzF,GACvBI,EAAU0P,GAAQtK,EAAMpF,QAASqF,EAAIrF,SACzC,OAAO,SAAS4C,GAKd,OAJAwC,EAAM1F,EAAIA,EAAEkD,GACZwC,EAAMzF,EAAIA,EAAEiD,GACZwC,EAAMxF,EAAIA,EAAEgD,GACZwC,EAAMpF,QAAUA,EAAQ4C,GACjBwC,EAAQ,EACrB,CACG,CAID,OAFA9G,EAAIuR,MAAQF,EAELrR,CACR,CApBc,CAoBZ,GCzBY,SAAAyR,GAASlQ,EAAGD,GACpBA,IAAGA,EAAI,IACZ,IAEInQ,EAFAgQ,EAAII,EAAIhQ,KAAKiB,IAAI8O,EAAEX,OAAQY,EAAEZ,QAAU,EACvC+D,EAAIpD,EAAEoQ,QAEV,OAAO,SAASpN,GACd,IAAKnT,EAAI,EAAGA,EAAIgQ,IAAKhQ,EAAGuT,EAAEvT,GAAKoQ,EAAEpQ,IAAM,EAAImT,GAAKhD,EAAEnQ,GAAKmT,EACvD,OAAOI,CACX,CACA,CCFO,SAASiN,GAAapQ,EAAGD,GAC9B,IAIInQ,EAJAygB,EAAKtQ,EAAIA,EAAEX,OAAS,EACpBkR,EAAKtQ,EAAIhQ,KAAKiB,IAAIof,EAAIrQ,EAAEZ,QAAU,EAClC3P,EAAI,IAAIuc,MAAMsE,GACdnN,EAAI,IAAI6I,MAAMqE,GAGlB,IAAKzgB,EAAI,EAAGA,EAAI0gB,IAAM1gB,EAAGH,EAAEG,GAAKkB,GAAMkP,EAAEpQ,GAAImQ,EAAEnQ,IAC9C,KAAOA,EAAIygB,IAAMzgB,EAAGuT,EAAEvT,GAAKmQ,EAAEnQ,GAE7B,OAAO,SAASmT,GACd,IAAKnT,EAAI,EAAGA,EAAI0gB,IAAM1gB,EAAGuT,EAAEvT,GAAKH,EAAEG,GAAGmT,GACrC,OAAOI,CACX,CACA,CCrBe,SAAAoN,GAASvQ,EAAGD,GACzB,IAAI4E,EAAI,IAAI6L,KACZ,OAAOxQ,GAAKA,EAAGD,GAAKA,EAAG,SAASgD,GAC9B,OAAO4B,EAAE8L,QAAQzQ,GAAK,EAAI+C,GAAKhD,EAAIgD,GAAI4B,CAC3C,CACA,CCLe,SAAA+L,GAAS1Q,EAAGD,GACzB,OAAOC,GAAKA,EAAGD,GAAKA,EAAG,SAASgD,GAC9B,OAAO/C,GAAK,EAAI+C,GAAKhD,EAAIgD,CAC7B,CACA,CCFe,SAAAgK,GAAS/M,EAAGD,GACzB,IAEI4B,EAFA/R,EAAI,CAAE,EACNuT,EAAI,CAAE,EAMV,IAAKxB,KAHK,OAAN3B,GAA2B,iBAANA,IAAgBA,EAAI,IACnC,OAAND,GAA2B,iBAANA,IAAgBA,EAAI,IAEnCA,EACJ4B,KAAK3B,EACPpQ,EAAE+R,GAAK7Q,GAAMkP,EAAE2B,GAAI5B,EAAE4B,IAErBwB,EAAExB,GAAK5B,EAAE4B,GAIb,OAAO,SAASoB,GACd,IAAKpB,KAAK/R,EAAGuT,EAAExB,GAAK/R,EAAE+R,GAAGoB,GACzB,OAAOI,CACX,CACA,CCpBA,IAAIwN,GAAM,8CACNC,GAAM,IAAI/b,OAAO8b,GAAIvE,OAAQ,KAclB,SAAAyE,GAAS7Q,EAAGD,GACzB,IACI+Q,EACAC,EACAC,EAHAC,EAAKN,GAAIO,UAAYN,GAAIM,UAAY,EAIrCthB,GAAK,EACLgR,EAAI,GACJuQ,EAAI,GAMR,IAHAnR,GAAQ,GAAID,GAAQ,IAGZ+Q,EAAKH,GAAIxR,KAAKa,MACd+Q,EAAKH,GAAIzR,KAAKY,MACfiR,EAAKD,EAAGK,OAASH,IACpBD,EAAKjR,EAAEoQ,MAAMc,EAAID,GACbpQ,EAAEhR,GAAIgR,EAAEhR,IAAMohB,EACbpQ,IAAIhR,GAAKohB,IAEXF,EAAKA,EAAG,OAASC,EAAKA,EAAG,IACxBnQ,EAAEhR,GAAIgR,EAAEhR,IAAMmhB,EACbnQ,IAAIhR,GAAKmhB,GAEdnQ,IAAIhR,GAAK,KACTuhB,EAAEE,KAAK,CAACzhB,EAAGA,EAAGH,EAAGwb,GAAO6F,EAAIC,MAE9BE,EAAKL,GAAIM,UAYX,OARID,EAAKlR,EAAEX,SACT4R,EAAKjR,EAAEoQ,MAAMc,GACTrQ,EAAEhR,GAAIgR,EAAEhR,IAAMohB,EACbpQ,IAAIhR,GAAKohB,GAKTpQ,EAAExB,OAAS,EAAK+R,EAAE,GA7C3B,SAAapR,GACX,OAAO,SAASgD,GACd,OAAOhD,EAAEgD,GAAK,EAClB,CACA,CA0CQuO,CAAIH,EAAE,GAAG1hB,GApDjB,SAAcsQ,GACZ,OAAO,WACL,OAAOA,CACX,CACA,CAiDQwR,CAAKxR,IACJA,EAAIoR,EAAE/R,OAAQ,SAAS2D,GACtB,IAAK,IAAW7C,EAAPtQ,EAAI,EAAMA,EAAImQ,IAAKnQ,EAAGgR,GAAGV,EAAIiR,EAAEvhB,IAAIA,GAAKsQ,EAAEzQ,EAAEsT,GACrD,OAAOnC,EAAE4Q,KAAK,GACxB,EACA,CCrDe,SAAAC,GAASzR,EAAGD,GACzB,IAAkBoD,ENAU1T,EMAxBsT,SAAWhD,EACf,OAAY,MAALA,GAAmB,YAANgD,EAAkBsC,GAAStF,IAClC,WAANgD,EAAiBkI,GACZ,WAANlI,GAAmBI,EAAItE,GAAMkB,KAAOA,EAAIoD,EAAG1E,IAAOoS,GAClD9Q,aAAalB,GAAQJ,GACrBsB,aAAayQ,KAAOD,INLE9gB,EMMRsQ,GNLb2R,YAAYC,OAAOliB,IAAQA,aAAamiB,SMMzC5F,MAAMC,QAAQlM,GAAKqQ,GACE,mBAAdrQ,EAAE8R,SAAgD,mBAAf9R,EAAE9N,UAA2ByO,MAAMX,GAAKgN,GAClF9B,GAHmBiF,KAGXlQ,EAAGD,EACnB,CCrBe,SAAA+R,GAAS9R,EAAGD,GACzB,OAAOC,GAAKA,EAAGD,GAAKA,EAAG,SAASgD,GAC9B,OAAO/S,KAAKkD,MAAM8M,GAAK,EAAI+C,GAAKhD,EAAIgD,EACxC,CACA,CCJe,SAASkI,GAAOxb,GAC7B,OAAQA,CACV,CCGA,IAAIsiB,GAAO,CAAC,EAAG,GAER,SAASC,GAASviB,GACvB,OAAOA,CACT,CAEA,SAASwiB,GAAUjS,EAAGD,GACpB,OAAQA,GAAMC,GAAKA,GACb,SAASvQ,GAAK,OAAQA,EAAIuQ,GAAKD,CAAI,GCbTtQ,EDcjBiR,MAAMX,GAAKJ,IAAM,GCbzB,WACL,OAAOlQ,CACX,GAHe,IAAmBA,CDelC,CAUA,SAASyiB,GAAMxC,EAAQC,EAAO8B,GAC5B,IAAIU,EAAKzC,EAAO,GAAI0C,EAAK1C,EAAO,GAAI2C,EAAK1C,EAAM,GAAI5K,EAAK4K,EAAM,GAG9D,OAFIyC,EAAKD,GAAIA,EAAKF,GAAUG,EAAID,GAAKE,EAAKZ,EAAY1M,EAAIsN,KACrDF,EAAKF,GAAUE,EAAIC,GAAKC,EAAKZ,EAAYY,EAAItN,IAC3C,SAAStV,GAAK,OAAO4iB,EAAGF,EAAG1iB,IACpC,CAEA,SAAS6iB,GAAQ5C,EAAQC,EAAO8B,GAC9B,IAAIc,EAAIviB,KAAKiB,IAAIye,EAAOtQ,OAAQuQ,EAAMvQ,QAAU,EAC5CuF,EAAI,IAAIqH,MAAMuG,GACd1S,EAAI,IAAImM,MAAMuG,GACd3iB,GAAK,EAQT,IALI8f,EAAO6C,GAAK7C,EAAO,KACrBA,EAASA,EAAOS,QAAQqC,UACxB7C,EAAQA,EAAMQ,QAAQqC,aAGf5iB,EAAI2iB,GACX5N,EAAE/U,GAAKqiB,GAAUvC,EAAO9f,GAAI8f,EAAO9f,EAAI,IACvCiQ,EAAEjQ,GAAK6hB,EAAY9B,EAAM/f,GAAI+f,EAAM/f,EAAI,IAGzC,OAAO,SAASH,GACd,IAAIG,EAAIif,GAAOa,EAAQjgB,EAAG,EAAG8iB,GAAK,EAClC,OAAO1S,EAAEjQ,GAAG+U,EAAE/U,GAAGH,GACrB,CACA,CE5CO,SAASgjB,GAAmBhjB,EAAGijB,GACpC,IAAK9iB,GAAKH,EAAIijB,EAAIjjB,EAAEkjB,cAAcD,EAAI,GAAKjjB,EAAEkjB,iBAAiBC,QAAQ,MAAQ,EAAG,OAAO,KACxF,IAAIhjB,EAAGijB,EAAcpjB,EAAE0gB,MAAM,EAAGvgB,GAIhC,MAAO,CACLijB,EAAYzT,OAAS,EAAIyT,EAAY,GAAKA,EAAY1C,MAAM,GAAK0C,GAChEpjB,EAAE0gB,MAAMvgB,EAAI,GAEjB,CCjBe,SAAQkjB,GAACrjB,GACtB,OAAOA,EAAIgjB,GAAmBziB,KAAK0V,IAAIjW,KAASA,EAAE,GAAKkQ,GACzD,CCHA,ICCWoT,GDDPC,GAAK,2EAEM,SAASC,GAAgBC,GACtC,KAAMnI,EAAQiI,GAAG7T,KAAK+T,IAAa,MAAM,IAAIvF,MAAM,mBAAqBuF,GACxE,IAAInI,EACJ,OAAO,IAAIoI,GAAgB,CACzBC,KAAMrI,EAAM,GACZsI,MAAOtI,EAAM,GACbuI,KAAMvI,EAAM,GACZ4B,OAAQ5B,EAAM,GACdwG,KAAMxG,EAAM,GACZ9B,MAAO8B,EAAM,GACbwI,MAAOxI,EAAM,GACbyI,UAAWzI,EAAM,IAAMA,EAAM,GAAGoF,MAAM,GACtClR,KAAM8L,EAAM,GACZ/Y,KAAM+Y,EAAM,KAEhB,CAIO,SAASoI,GAAgBD,GAC9B7iB,KAAK+iB,UAA0BzhB,IAAnBuhB,EAAUE,KAAqB,IAAMF,EAAUE,KAAO,GAClE/iB,KAAKgjB,WAA4B1hB,IAApBuhB,EAAUG,MAAsB,IAAMH,EAAUG,MAAQ,GACrEhjB,KAAKijB,UAA0B3hB,IAAnBuhB,EAAUI,KAAqB,IAAMJ,EAAUI,KAAO,GAClEjjB,KAAKsc,YAA8Bhb,IAArBuhB,EAAUvG,OAAuB,GAAKuG,EAAUvG,OAAS,GACvEtc,KAAKkhB,OAAS2B,EAAU3B,KACxBlhB,KAAK4Y,WAA4BtX,IAApBuhB,EAAUjK,WAAsBtX,GAAauhB,EAAUjK,MACpE5Y,KAAKkjB,QAAUL,EAAUK,MACzBljB,KAAKmjB,eAAoC7hB,IAAxBuhB,EAAUM,eAA0B7hB,GAAauhB,EAAUM,UAC5EnjB,KAAK4O,OAASiU,EAAUjU,KACxB5O,KAAK2B,UAA0BL,IAAnBuhB,EAAUlhB,KAAqB,GAAKkhB,EAAUlhB,KAAO,EACnE,CE/Be,SAAAyhB,GAAShkB,EAAGijB,GACzB,IAAI/N,EAAI8N,GAAmBhjB,EAAGijB,GAC9B,IAAK/N,EAAG,OAAOlV,EAAI,GACnB,IAAIojB,EAAclO,EAAE,GAChBmO,EAAWnO,EAAE,GACjB,OAAOmO,EAAW,EAAI,KAAO,IAAI9G,OAAO8G,GAAUtB,KAAK,KAAOqB,EACxDA,EAAYzT,OAAS0T,EAAW,EAAID,EAAY1C,MAAM,EAAG2C,EAAW,GAAK,IAAMD,EAAY1C,MAAM2C,EAAW,GAC5GD,EAAc,IAAI7G,MAAM8G,EAAWD,EAAYzT,OAAS,GAAGoS,KAAK,IACxE,CFUAyB,GAAgBzgB,UAAY2gB,GAAgB3gB,UAe5C2gB,GAAgB3gB,UAAUP,SAAW,WACnC,OAAO5B,KAAK+iB,KACN/iB,KAAKgjB,MACLhjB,KAAKijB,KACLjjB,KAAKsc,QACJtc,KAAKkhB,KAAO,IAAM,UACH5f,IAAftB,KAAK4Y,MAAsB,GAAKjZ,KAAKkB,IAAI,EAAgB,EAAbb,KAAK4Y,SACjD5Y,KAAKkjB,MAAQ,IAAM,UACA5hB,IAAnBtB,KAAKmjB,UAA0B,GAAK,IAAMxjB,KAAKkB,IAAI,EAAoB,EAAjBb,KAAKmjB,aAC3DnjB,KAAK4O,KAAO,IAAM,IACnB5O,KAAK2B,IACb,EG1CA,IAAe0hB,GAAA,CACb,IAAK,CAACjkB,EAAGijB,KAAW,IAAJjjB,GAASkkB,QAAQjB,GACjC3S,EAAMtQ,GAAMO,KAAKkD,MAAMzD,GAAGwC,SAAS,GACnCkR,EAAM1T,GAAMA,EAAI,GAChBkV,ELRa,SAASlV,GACtB,OAAOO,KAAK0V,IAAIjW,EAAIO,KAAKkD,MAAMzD,KAAO,KAChCA,EAAEmkB,eAAe,MAAMC,QAAQ,KAAM,IACrCpkB,EAAEwC,SAAS,GACnB,EKKEwX,EAAK,CAACha,EAAGijB,IAAMjjB,EAAEkjB,cAAcD,GAC/BxE,EAAK,CAACze,EAAGijB,IAAMjjB,EAAEkkB,QAAQjB,GACzB5S,EAAK,CAACrQ,EAAGijB,IAAMjjB,EAAEqkB,YAAYpB,GAC7BxS,EAAMzQ,GAAMO,KAAKkD,MAAMzD,GAAGwC,SAAS,GACnCygB,EAAK,CAACjjB,EAAGijB,IAAMe,GAAkB,IAAJhkB,EAASijB,GACtC7S,EAAK4T,GACL7S,EFXa,SAASnR,EAAGijB,GACzB,IAAI/N,EAAI8N,GAAmBhjB,EAAGijB,GAC9B,IAAK/N,EAAG,OAAOlV,EAAI,GACnB,IAAIojB,EAAclO,EAAE,GAChBmO,EAAWnO,EAAE,GACb/U,EAAIkjB,GAAYC,GAAuE,EAAtD/iB,KAAKkB,KAAK,EAAGlB,KAAKiB,IAAI,EAAGjB,KAAKqf,MAAMyD,EAAW,MAAY,EAC5FlT,EAAIiT,EAAYzT,OACpB,OAAOxP,IAAMgQ,EAAIiT,EACXjjB,EAAIgQ,EAAIiT,EAAc,IAAI7G,MAAMpc,EAAIgQ,EAAI,GAAG4R,KAAK,KAChD5hB,EAAI,EAAIijB,EAAY1C,MAAM,EAAGvgB,GAAK,IAAMijB,EAAY1C,MAAMvgB,GAC1D,KAAO,IAAIoc,MAAM,EAAIpc,GAAG4hB,KAAK,KAAOiB,GAAmBhjB,EAAGO,KAAKkB,IAAI,EAAGwhB,EAAI9iB,EAAI,IAAI,EAC1F,EECEmkB,EAAMtkB,GAAMO,KAAKkD,MAAMzD,GAAGwC,SAAS,IAAI+hB,cACvCvkB,EAAMA,GAAMO,KAAKkD,MAAMzD,GAAGwC,SAAS,KCjBtB,SAAQ+f,GAACviB,GACtB,OAAOA,CACT,CCOA,ICPIwkB,GACOnV,GACAoV,GDKP5H,GAAMN,MAAMxZ,UAAU8Z,IACtB6H,GAAW,CAAC,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,GAAG,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,IAAI,KEiDhE,SAAShP,KACtB,IAAIiP,EXIC,WACL,IAGIC,EACAC,EACAC,EAEAC,EACAC,EACAzjB,EATA0e,EAASqC,GACTpC,EAAQoC,GACRN,EAAciD,GAId7S,EAAQmQ,GAKZ,SAAS2C,IACP,IA5Da3U,EAAGD,EACdgD,EA2DEnD,EAAI5P,KAAKiB,IAAIye,EAAOtQ,OAAQuQ,EAAMvQ,QAItC,OAHIyC,IAAUmQ,MA7DDhS,EA6D2B0P,EAAO,KA7D/B3P,EA6DmC2P,EAAO9P,EAAI,MA3DrDmD,EAAI/C,EAAGA,EAAID,EAAGA,EAAIgD,GA2DHlB,EA1DnB,SAASpS,GAAK,OAAOO,KAAKkB,IAAI8O,EAAGhQ,KAAKiB,IAAI8O,EAAGtQ,GAAI,GA2DtD+kB,EAAY5U,EAAI,EAAI0S,GAAUJ,GAC9BuC,EAASzjB,EAAQ,KACVojB,CACR,CAED,SAASA,EAAM3kB,GACb,OAAY,MAALA,GAAaiR,MAAMjR,GAAKA,GAAK8kB,GAAWE,IAAWA,EAASD,EAAU9E,EAAOpD,IAAI+H,GAAY1E,EAAO8B,KAAe4C,EAAUxS,EAAMpS,IAC3I,CA8BD,OA5BA2kB,EAAMQ,OAAS,SAASllB,GACtB,OAAOmS,EAAMyS,GAAatjB,IAAUA,EAAQwjB,EAAU7E,EAAOD,EAAOpD,IAAI+H,GAAYQ,MAAqBnlB,IAC7G,EAEE0kB,EAAM1E,OAAS,SAASzC,GACtB,OAAO7M,UAAUhB,QAAUsQ,EAAS1D,MAAM8I,KAAK7H,EAAGhC,IAAS0J,KAAajF,EAAOS,OACnF,EAEEiE,EAAMzE,MAAQ,SAAS1C,GACrB,OAAO7M,UAAUhB,QAAUuQ,EAAQ3D,MAAM8I,KAAK7H,GAAI0H,KAAahF,EAAMQ,OACzE,EAEEiE,EAAMW,WAAa,SAAS9H,GAC1B,OAAO0C,EAAQ3D,MAAM8I,KAAK7H,GAAIwE,EAAcK,GAAkB6C,GAClE,EAEEP,EAAMvS,MAAQ,SAASoL,GACrB,OAAO7M,UAAUhB,QAAUyC,IAAQoL,GAAW+E,GAAU2C,KAAa9S,IAAUmQ,EACnF,EAEEoC,EAAM3C,YAAc,SAASxE,GAC3B,OAAO7M,UAAUhB,QAAUqS,EAAcxE,EAAG0H,KAAalD,CAC7D,EAEE2C,EAAMG,QAAU,SAAStH,GACvB,OAAO7M,UAAUhB,QAAUmV,EAAUtH,EAAGmH,GAASG,CACrD,EAES,SAASxR,EAAGiS,GAEjB,OADAX,EAAYtR,EAAGuR,EAAcU,EACtBL,GACX,CACA,CAGSM,GAAcjD,GAAUA,IWvD/B,OANAoC,EAAM9S,KAAO,WACX,OXRiB8K,EWQLgI,EAAOjP,KXNhBuK,OAAOtD,EAAOsD,UACdC,MAAMvD,EAAOuD,SACb8B,YAAYrF,EAAOqF,eACnB5P,MAAMuK,EAAOvK,SACb0S,QAAQnI,EAAOmI,WANf,IAAcnI,CWSrB,EAEEqD,GAAUyF,MAAMd,EAAOhU,WA7DlB,SAAmBgU,GACxB,IAAI1E,EAAS0E,EAAM1E,OAkDnB,OAhDA0E,EAAMe,MAAQ,SAAShG,GACrB,IAAIxK,EAAI+K,IACR,O3BNW,SAASnK,EAAO2J,EAAMC,GACnC,IAAIqD,EAEA5S,EACAuV,EACAhkB,EAHAvB,GAAK,EAMT,GAD8Buf,GAASA,GAAzB5J,GAASA,KAAvB2J,GAAQA,IACcC,EAAQ,EAAG,MAAO,CAAC5J,GAEzC,IADIiN,EAAUtD,EAAO3J,KAAO3F,EAAI2F,EAAOA,EAAQ2J,EAAMA,EAAOtP,GACT,KAA9CzO,EAAO8d,GAAc1J,EAAO2J,EAAMC,MAAkB5b,SAASpC,GAAO,MAAO,GAEhF,GAAIA,EAAO,EAAG,CACZ,IAAIkhB,EAAKriB,KAAKkD,MAAMqS,EAAQpU,GAAO4T,EAAK/U,KAAKkD,MAAMgc,EAAO/d,GAI1D,IAHIkhB,EAAKlhB,EAAOoU,KAAS8M,EACrBtN,EAAK5T,EAAO+d,KAAQnK,EACxBoQ,EAAQ,IAAInJ,MAAMpM,EAAImF,EAAKsN,EAAK,KACvBziB,EAAIgQ,GAAGuV,EAAMvlB,IAAMyiB,EAAKziB,GAAKuB,CAC1C,KAAS,CACLA,GAAQA,EACR,IAAIkhB,EAAKriB,KAAKkD,MAAMqS,EAAQpU,GAAO4T,EAAK/U,KAAKkD,MAAMgc,EAAO/d,GAI1D,IAHIkhB,EAAKlhB,EAAOoU,KAAS8M,EACrBtN,EAAK5T,EAAO+d,KAAQnK,EACxBoQ,EAAQ,IAAInJ,MAAMpM,EAAImF,EAAKsN,EAAK,KACvBziB,EAAIgQ,GAAGuV,EAAMvlB,IAAMyiB,EAAKziB,GAAKuB,CACvC,CAID,OAFIqhB,GAAS2C,EAAM3C,UAEZ2C,CACT,C2BxBWA,CAAMxQ,EAAE,GAAIA,EAAEA,EAAEvF,OAAS,GAAa,MAAT+P,EAAgB,GAAKA,EAC7D,EAEEiF,EAAMgB,WAAa,SAASjG,EAAO+D,GACjC,IAAIvO,EAAI+K,IACR,OCZW,SAAoBnK,EAAO2J,EAAMC,EAAO+D,GACrD,IACIM,EADAriB,E5ByCC,SAAkBoU,EAAO2J,EAAMC,GACpC,IAAIkG,EAAQrlB,KAAK0V,IAAIwJ,EAAO3J,GAASvV,KAAKkB,IAAI,EAAGie,GAC7CmG,EAAQtlB,KAAK4R,IAAI,GAAI5R,KAAKqf,MAAMrf,KAAKsf,IAAI+F,GAASrlB,KAAKuf,OACvDC,EAAQ6F,EAAQC,EAIpB,OAHI9F,GAASV,GAAKwG,GAAS,GAClB9F,GAAST,GAAIuG,GAAS,EACtB9F,GAASR,KAAIsG,GAAS,GACxBpG,EAAO3J,GAAS+P,EAAQA,CACjC,C4BjDaC,CAAShQ,EAAO2J,EAAMC,GAGjC,QADA+D,EAAYD,GAA6B,MAAbC,EAAoB,KAAOA,IACrClhB,MAChB,IAAK,IACH,IAAIlB,EAAQd,KAAKkB,IAAIlB,KAAK0V,IAAIH,GAAQvV,KAAK0V,IAAIwJ,IAE/C,OAD2B,MAAvBgE,EAAUM,WAAsB9S,MAAM8S,ECRjC,SAASriB,EAAML,GAC5B,OAAOd,KAAKkB,IAAI,EAAgE,EAA7DlB,KAAKkB,KAAK,EAAGlB,KAAKiB,IAAI,EAAGjB,KAAKqf,MAAMyD,GAAShiB,GAAS,KAAWgiB,GAAS9iB,KAAK0V,IAAIvU,IACxG,CDM4DqkB,CAAgBrkB,EAAML,MAASoiB,EAAUM,UAAYA,GACpGU,GAAahB,EAAWpiB,GAEjC,IAAK,GACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACwB,MAAvBoiB,EAAUM,WAAsB9S,MAAM8S,EEhBjC,SAASriB,EAAMD,GAE5B,OADAC,EAAOnB,KAAK0V,IAAIvU,GAAOD,EAAMlB,KAAK0V,IAAIxU,GAAOC,EACtCnB,KAAKkB,IAAI,EAAG4hB,GAAS5hB,GAAO4hB,GAAS3hB,IAAS,CACvD,CFa4DskB,CAAetkB,EAAMnB,KAAKkB,IAAIlB,KAAK0V,IAAIH,GAAQvV,KAAK0V,IAAIwJ,QAAUgE,EAAUM,UAAYA,GAAgC,MAAnBN,EAAUlhB,OACrK,MAEF,IAAK,IACL,IAAK,IACwB,MAAvBkhB,EAAUM,WAAsB9S,MAAM8S,EGrBjC,SAASriB,GACtB,OAAOnB,KAAKkB,IAAI,GAAI4hB,GAAS9iB,KAAK0V,IAAIvU,IACxC,CHmB4DukB,CAAevkB,MAAQ+hB,EAAUM,UAAYA,EAAuC,GAAP,MAAnBN,EAAUlhB,OAI9H,OAAO8M,GAAOoU,EAChB,CDbWkC,CAAWzQ,EAAE,GAAIA,EAAEA,EAAEvF,OAAS,GAAa,MAAT+P,EAAgB,GAAKA,EAAO+D,EACzE,EAEEkB,EAAMuB,KAAO,SAASxG,GACP,MAATA,IAAeA,EAAQ,IAE3B,IAKIyG,EACAzkB,EANAwT,EAAI+K,IACJmG,EAAK,EACLC,EAAKnR,EAAEvF,OAAS,EAChBmG,EAAQZ,EAAEkR,GACV3G,EAAOvK,EAAEmR,GAGTC,EAAU,GAOd,IALI7G,EAAO3J,IACTpU,EAAOoU,EAAOA,EAAQ2J,EAAMA,EAAO/d,EACnCA,EAAO0kB,EAAIA,EAAKC,EAAIA,EAAK3kB,GAGpB4kB,KAAY,GAAG,CAEpB,IADA5kB,EAAO8d,GAAc1J,EAAO2J,EAAMC,MACrByG,EAGX,OAFAjR,EAAEkR,GAAMtQ,EACRZ,EAAEmR,GAAM5G,EACDQ,EAAO/K,GACT,GAAIxT,EAAO,EAChBoU,EAAQvV,KAAKqf,MAAM9J,EAAQpU,GAAQA,EACnC+d,EAAOlf,KAAKgmB,KAAK9G,EAAO/d,GAAQA,MAC3B,MAAIA,EAAO,GAIhB,MAHAoU,EAAQvV,KAAKgmB,KAAKzQ,EAAQpU,GAAQA,EAClC+d,EAAOlf,KAAKqf,MAAMH,EAAO/d,GAAQA,CAGlC,CACDykB,EAAUzkB,CACX,CAED,OAAOijB,CACX,EAESA,CACT,CAWS6B,CAAU7B,EACnB,CDxDEH,GDDa,SAASA,GACtB,IObsBiC,EAAUC,EPa5BC,OAA4BzkB,IAApBsiB,EAAOiC,eAA+CvkB,IAArBsiB,EAAOkC,UAA0BnE,IObxDkE,EPa+E5J,GAAIzb,KAAKojB,EAAOiC,SAAU5iB,QOb/F6iB,EPawGlC,EAAOkC,UAAY,GOZpJ,SAASrlB,EAAOmY,GAOrB,IANA,IAAIrZ,EAAIkB,EAAMsO,OACV2D,EAAI,GACJwP,EAAI,EACJzS,EAAIoW,EAAS,GACb9W,EAAS,EAENxP,EAAI,GAAKkQ,EAAI,IACdV,EAASU,EAAI,EAAImJ,IAAOnJ,EAAI9P,KAAKkB,IAAI,EAAG+X,EAAQ7J,IACpD2D,EAAEsO,KAAKvgB,EAAMulB,UAAUzmB,GAAKkQ,EAAGlQ,EAAIkQ,OAC9BV,GAAUU,EAAI,GAAKmJ,KACxBnJ,EAAIoW,EAAS3D,GAAKA,EAAI,GAAK2D,EAAS9W,QAGtC,OAAO2D,EAAEyP,UAAUhB,KAAK2E,EAC5B,GPFMG,OAAqC3kB,IAApBsiB,EAAOsC,SAAyB,GAAKtC,EAAOsC,SAAS,GAAK,GAC3EC,OAAqC7kB,IAApBsiB,EAAOsC,SAAyB,GAAKtC,EAAOsC,SAAS,GAAK,GAC3EE,OAA6B9kB,IAAnBsiB,EAAOwC,QAAwB,IAAMxC,EAAOwC,QAAU,GAChEC,OAA+B/kB,IAApBsiB,EAAOyC,SAAyB1E,GQjBlC,SAAS0E,GACtB,OAAO,SAAS5lB,GACd,OAAOA,EAAM+iB,QAAQ,SAAU,SAASjkB,GACtC,OAAO8mB,GAAU9mB,EACvB,EACA,CACA,CRW4D+mB,CAAerK,GAAIzb,KAAKojB,EAAOyC,SAAUE,SAC/FC,OAA6BllB,IAAnBsiB,EAAO4C,QAAwB,IAAM5C,EAAO4C,QAAU,GAChEC,OAAyBnlB,IAAjBsiB,EAAO6C,MAAsB,IAAM7C,EAAO6C,MAAQ,GAC1DC,OAAqBplB,IAAfsiB,EAAO8C,IAAoB,MAAQ9C,EAAO8C,IAAM,GAE1D,SAASC,EAAU9D,GAGjB,IAAIE,GAFJF,EAAYD,GAAgBC,IAEPE,KACjBC,EAAQH,EAAUG,MAClBC,EAAOJ,EAAUI,KACjB3G,EAASuG,EAAUvG,OACnB4E,EAAO2B,EAAU3B,KACjBtI,EAAQiK,EAAUjK,MAClBsK,EAAQL,EAAUK,MAClBC,EAAYN,EAAUM,UACtBvU,EAAOiU,EAAUjU,KACjBjN,EAAOkhB,EAAUlhB,KAGR,MAATA,GAAcuhB,GAAQ,EAAMvhB,EAAO,KAG7B0hB,GAAY1hB,UAAqBL,IAAd6hB,IAA4BA,EAAY,IAAKvU,GAAO,EAAMjN,EAAO,MAG1Fuf,GAAkB,MAAT6B,GAA0B,MAAVC,KAAgB9B,GAAO,EAAM6B,EAAO,IAAKC,EAAQ,KAI9E,IAAI4D,EAAoB,MAAXtK,EAAiB2J,EAA4B,MAAX3J,GAAkB,SAASuK,KAAKllB,GAAQ,IAAMA,EAAKkN,cAAgB,GAC9GiY,EAAoB,MAAXxK,EAAiB6J,EAAiB,OAAOU,KAAKllB,GAAQ6kB,EAAU,GAKzEO,EAAa1D,GAAY1hB,GACzBqlB,EAAc,aAAaH,KAAKllB,GAUpC,SAAS8M,EAAOhO,GACd,IAEIlB,EAAGgQ,EAAGuD,EAFNmU,EAAcL,EACdM,EAAcJ,EAGlB,GAAa,MAATnlB,EACFulB,EAAcH,EAAWtmB,GAASymB,EAClCzmB,EAAQ,OACH,CAIL,IAAI0mB,GAHJ1mB,GAASA,GAGmB,GAAK,EAAIA,EAAQ,EAiB7C,GAdAA,EAAQ4P,MAAM5P,GAASimB,EAAMK,EAAWpnB,KAAK0V,IAAI5U,GAAQ0iB,GAGrDvU,IAAMnO,ESjFH,SAAS8P,GACtB6W,EAAK,IAAK,IAAkC3B,EAA9BlW,EAAIgB,EAAExB,OAAQxP,EAAI,EAAGimB,GAAM,EAAOjmB,EAAIgQ,IAAKhQ,EACvD,OAAQgR,EAAEhR,IACR,IAAK,IAAKimB,EAAKC,EAAKlmB,EAAG,MACvB,IAAK,IAAgB,IAAPimB,IAAUA,EAAKjmB,GAAGkmB,EAAKlmB,EAAG,MACxC,QAAS,KAAMgR,EAAEhR,GAAI,MAAM6nB,EAAS5B,EAAK,IAAGA,EAAK,GAGrD,OAAOA,EAAK,EAAIjV,EAAEuP,MAAM,EAAG0F,GAAMjV,EAAEuP,MAAM2F,EAAK,GAAKlV,CACrD,CTwE0B8W,CAAW5mB,IAGzB0mB,GAA4B,IAAV1mB,GAAwB,MAATwiB,IAAckE,GAAgB,GAGnEF,GAAeE,EAA0B,MAATlE,EAAeA,EAAOwD,EAAkB,MAATxD,GAAyB,MAATA,EAAe,GAAKA,GAAQgE,EAC3GC,GAAwB,MAATvlB,EAAemiB,GAAS,EAAIpB,GAAiB,GAAK,IAAMwE,GAAeC,GAA0B,MAATlE,EAAe,IAAM,IAIxH+D,EAEF,IADAznB,GAAK,EAAGgQ,EAAI9O,EAAMsO,SACTxP,EAAIgQ,GACX,GAA6B,IAAzBuD,EAAIrS,EAAM6mB,WAAW/nB,KAAcuT,EAAI,GAAI,CAC7CoU,GAAqB,KAANpU,EAAWsT,EAAU3lB,EAAMqf,MAAMvgB,EAAI,GAAKkB,EAAMqf,MAAMvgB,IAAM2nB,EAC3EzmB,EAAQA,EAAMqf,MAAM,EAAGvgB,GACvB,KACD,CAGN,CAGG2jB,IAAUhC,IAAMzgB,EAAQslB,EAAMtlB,EAAO8mB,WAGzC,IAAIxY,EAASkY,EAAYlY,OAAStO,EAAMsO,OAASmY,EAAYnY,OACzDyY,EAAUzY,EAAS6J,EAAQ,IAAI+C,MAAM/C,EAAQ7J,EAAS,GAAGoS,KAAK4B,GAAQ,GAM1E,OAHIG,GAAShC,IAAMzgB,EAAQslB,EAAMyB,EAAU/mB,EAAO+mB,EAAQzY,OAAS6J,EAAQsO,EAAYnY,OAASwY,UAAWC,EAAU,IAG7GxE,GACN,IAAK,IAAKviB,EAAQwmB,EAAcxmB,EAAQymB,EAAcM,EAAS,MAC/D,IAAK,IAAK/mB,EAAQwmB,EAAcO,EAAU/mB,EAAQymB,EAAa,MAC/D,IAAK,IAAKzmB,EAAQ+mB,EAAQ1H,MAAM,EAAG/Q,EAASyY,EAAQzY,QAAU,GAAKkY,EAAcxmB,EAAQymB,EAAcM,EAAQ1H,MAAM/Q,GAAS,MAC9H,QAAStO,EAAQ+mB,EAAUP,EAAcxmB,EAAQymB,EAGnD,OAAOb,EAAS5lB,EACjB,CAMD,OAtEA0iB,OAA0B7hB,IAAd6hB,EAA0B,EAChC,SAAS0D,KAAKllB,GAAQhC,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,GAAIuiB,IAC/CxjB,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,GAAIuiB,IAgE/B1U,EAAO7M,SAAW,WAChB,OAAOihB,EAAY,EACzB,EAEWpU,CACR,CAYD,MAAO,CACLA,OAAQkY,EACR9C,aAZF,SAAsBhB,EAAWpiB,GAC/B,IAAIod,EAAI8I,IAAW9D,EAAYD,GAAgBC,IAAsBlhB,KAAO,IAAKkhB,IAC7EzJ,EAAiE,EAA7DzZ,KAAKkB,KAAK,EAAGlB,KAAKiB,IAAI,EAAGjB,KAAKqf,MAAMyD,GAAShiB,GAAS,KAC1D6Q,EAAI3R,KAAK4R,IAAI,IAAK6H,GAClBwN,EAAS9C,GAAS,EAAI1K,EAAI,GAC9B,OAAO,SAAS3Y,GACd,OAAOod,EAAEvM,EAAI7Q,GAASmmB,CAC5B,CACG,EAMH,CCtIWa,CAPG,CACZ3B,UAAW,IACXD,SAAU,CAAC,GACXK,SAAU,CAAC,IAAK,MAKhBzX,GAASmV,GAAOnV,OAChBoV,GAAeD,GAAOC,aSfxB,IAAe7O,GAAA5V,GAAK,IAAMA,ECE1B,SAAS0V,GAAOnF,EAAG2E,GACjB,OAAO,SAAS5B,GACd,OAAO/C,EAAI+C,EAAI4B,CACnB,CACA,CAQO,SAASW,GAAItF,EAAGD,GACrB,IAAI4E,EAAI5E,EAAIC,EACZ,OAAO2E,EAAIQ,GAAOnF,EAAG2E,EAAI,KAAOA,GAAK,IAAMA,EAAI,IAAM3U,KAAKkD,MAAMyR,EAAI,KAAOA,GAAKU,GAAS3E,MAAMV,GAAKD,EAAIC,EAC1G,CAQe,SAAS6P,GAAQ7P,EAAGD,GACjC,IAAI4E,EAAI5E,EAAIC,EACZ,OAAO2E,EAAIQ,GAAOnF,EAAG2E,GAAKU,GAAS3E,MAAMV,GAAKD,EAAIC,EACpD,CCvBA,IAAA+X,GAAe,SAAUjI,EAASpgB,GAChC,IAAImP,EDaC,SAAenP,GACpB,OAAoB,IAAZA,GAAKA,GAAWmgB,GAAU,SAAS7P,EAAGD,GAC5C,OAAOA,EAAIC,EAbf,SAAqBA,EAAGD,EAAGrQ,GACzB,OAAOsQ,EAAIhQ,KAAK4R,IAAI5B,EAAGtQ,GAAIqQ,EAAI/P,KAAK4R,IAAI7B,EAAGrQ,GAAKsQ,EAAGtQ,EAAI,EAAIA,EAAG,SAASqT,GACrE,OAAO/S,KAAK4R,IAAI5B,EAAI+C,EAAIhD,EAAGrQ,EAC/B,CACA,CASmBqgB,CAAY/P,EAAGD,EAAGrQ,GAAK2V,GAAS3E,MAAMV,GAAKD,EAAIC,EAClE,CACA,CCjBcgQ,CAAMtgB,GAElB,SAAS+O,EAAI8G,EAAOC,GAClB,IAAI3F,EAAIhB,GAAO0G,EAAQ0K,EAAS1K,IAAQ1F,GAAI2F,EAAMyK,EAASzK,IAAM3F,GAC7DC,EAAIjB,EAAM0G,EAAMzF,EAAG0F,EAAI1F,GACvBC,EAAIlB,EAAM0G,EAAMxF,EAAGyF,EAAIzF,GACvBI,EAAU0P,GAAQtK,EAAMpF,QAASqF,EAAIrF,SACzC,OAAO,SAAS4C,GAKd,OAJAwC,EAAM1F,EAAIA,EAAEkD,GACZwC,EAAMzF,EAAIA,EAAEiD,GACZwC,EAAMxF,EAAIA,EAAEgD,GACZwC,EAAMpF,QAAUA,EAAQ4C,GACjBwC,EAAQ,EACrB,CACG,CAID,OAFA9G,EAAIuR,MAAQF,EAELrR,CACR,CApBc,CAoBZ,GCzBY,SAAAoW,GAAS7U,EAAGD,GACzB,OAAOC,GAAKA,EAAGD,GAAKA,EAAG,SAASgD,GAC9B,OAAO/C,GAAK,EAAI+C,GAAKhD,EAAIgD,CAC7B,CACA,CCDA,SAAShC,GAAIuE,GACX,OAAO,SAASC,EAAOC,GACrB,IAAI7E,EAAI2E,GAAKC,EAAQyS,EAASzS,IAAQ5E,GAAI6E,EAAMwS,EAASxS,IAAM7E,GAC3DC,EAAI/B,GAAM0G,EAAM3E,EAAG4E,EAAI5E,GACvB5B,EAAIH,GAAM0G,EAAMvG,EAAGwG,EAAIxG,GACvBmB,EAAUtB,GAAM0G,EAAMpF,QAASqF,EAAIrF,SACvC,OAAO,SAAS4C,GAKd,OAJAwC,EAAM5E,EAAIA,EAAEoC,GACZwC,EAAM3E,EAAIA,EAAEmC,GACZwC,EAAMvG,EAAIA,EAAE+D,GACZwC,EAAMpF,QAAUA,EAAQ4C,GACjBwC,EAAQ,EACrB,CACG,CACH,CAEA,IAAA0S,GAAelX,GAAIuE,IACR4S,GAAUnX,GAAIlC,ICjBV,SAASiE,GAAIyC,EAAOC,GACjC,IAAIxG,EAAIH,IAAO0G,EAAQ4S,EAAS5S,IAAQvG,GAAIwG,EAAM2S,EAAS3S,IAAMxG,GAC7DgB,EAAInB,GAAM0G,EAAMvF,EAAGwF,EAAIxF,GACvBD,EAAIlB,GAAM0G,EAAMxF,EAAGyF,EAAIzF,GACvBI,EAAUtB,GAAM0G,EAAMpF,QAASqF,EAAIrF,SACvC,OAAO,SAAS4C,GAKd,OAJAwC,EAAMvG,EAAIA,EAAE+D,GACZwC,EAAMvF,EAAIA,EAAE+C,GACZwC,EAAMxF,EAAIA,EAAEgD,GACZwC,EAAMpF,QAAUA,EAAQ4C,GACjBwC,EAAQ,EACnB,CACA,CCZA,SAASrC,GAAIoC,GACX,OAAO,SAASC,EAAOC,GACrB,IAAI7E,EAAI2E,GAAKC,EAAQ6S,GAAS7S,IAAQ5E,GAAI6E,EAAM4S,GAAS5S,IAAM7E,GAC3DwC,EAAItE,GAAM0G,EAAMpC,EAAGqC,EAAIrC,GACvBnE,EAAIH,GAAM0G,EAAMvG,EAAGwG,EAAIxG,GACvBmB,EAAUtB,GAAM0G,EAAMpF,QAASqF,EAAIrF,SACvC,OAAO,SAAS4C,GAKd,OAJAwC,EAAM5E,EAAIA,EAAEoC,GACZwC,EAAMpC,EAAIA,EAAEJ,GACZwC,EAAMvG,EAAIA,EAAE+D,GACZwC,EAAMpF,QAAUA,EAAQ4C,GACjBwC,EAAQ,EACrB,CACG,CACH,CAEA,IAAA8S,GAAenV,GAAIoC,IACRgT,GAAUpV,GAAIrE,ICjBzB,SAASoF,GAAUqB,GACjB,OAAO,SAAUiT,EAAe7oB,GAG9B,SAASuU,EAAUsB,EAAOC,GACxB,IAAI7E,EAAI2E,GAAKC,EAAQiT,GAAejT,IAAQ5E,GAAI6E,EAAMgT,GAAehT,IAAM7E,GACvEC,EAAI/B,GAAM0G,EAAM3E,EAAG4E,EAAI5E,GACvB5B,EAAIH,GAAM0G,EAAMvG,EAAGwG,EAAIxG,GACvBmB,EAAUtB,GAAM0G,EAAMpF,QAASqF,EAAIrF,SACvC,OAAO,SAAS4C,GAKd,OAJAwC,EAAM5E,EAAIA,EAAEoC,GACZwC,EAAM3E,EAAIA,EAAEmC,GACZwC,EAAMvG,EAAIA,EAAEhP,KAAK4R,IAAImB,EAAGrT,IACxB6V,EAAMpF,QAAUA,EAAQ4C,GACjBwC,EAAQ,EACvB,CACK,CAID,OAlBA7V,GAAKA,EAgBLuU,EAAU+L,MAAQuI,EAEXtU,CACR,CApBM,CAoBJ,EACL,CAEA,IAAAwU,GAAexU,GAAUqB,IACdoT,GAAgBzU,GAAUpF,ICd/B8Z,GAAkB,IAAIC,QAMtB,SAAUC,GAAcC,GAC5B,GAAIH,GAAgBI,IAAID,GACtB,OAAOH,GAAgBK,IAAIF,GAG7B,IAAMG,EAAaC,KAChBxJ,OAAOoJ,EAASK,WAAW7M,IAAI,SAAC8M,GAAU,OAAAA,EAAMlK,IAAI,IACpDS,MAAMmJ,EAASK,WAAW7M,IAAI,SAAC8M,GAAK,OAAKA,EAAMva,KAAK,IACpD4S,YAAY4H,GAAqBP,EAASQ,sBAE7C,OADAX,GAAgB/lB,IAAIkmB,EAAUG,GACvBA,CACT,CAKgB,SAAAM,GAAuBT,EAAoBhoB,GAEzD,OADmB+nB,GAAcC,EAExBG,CADLH,EAASU,UAAYV,EAASW,KACdzpB,KAAKqf,MAAMve,EAAQgoB,EAASW,OAASX,EAASW,KAAO,GAGvD3oB,EACpB,CAMM,SAAU4oB,GAAgBZ,GAC9B,IAAKA,EAASU,WAAaV,EAASW,KAClC,MAAO,GAWT,IARA,IAAMxoB,EAAM6nB,EAASK,WAAW,GAAGjK,KAG7ByK,GAFMb,EAASK,WAAWL,EAASK,WAAW/Z,OAAS,GAAG8P,KAC5Cje,GACI6nB,EAASW,KAE3BR,EAAaJ,GAAcC,GAC3Bc,EAA6B,GAE1BhqB,EAAI,EAAGA,EAAIkpB,EAASW,KAAM7pB,IAAK,CACtC,IAAMiqB,EAAa5oB,EAAMrB,EAAI+pB,EACvBG,EAAaD,EAAaF,EAC1BjL,GAAUmL,EAAaC,GAAc,EACrCjb,EAAQoa,EAAWjpB,KAAKqf,MAAMX,EAASoK,EAASW,OAASX,EAASW,KAAO,IAC/EG,EAAOvI,KAAK,CAACwI,WAAAA,EAAYnL,OAAAA,EAAQoL,WAAAA,EAAYjb,MAAAA,GAC9C,CAED,OAAO+a,CACT,CAKM,SAAUP,GAAqBU,GACnC,OAAQA,GACN,KAAKzqB,EAAoB0qB,IACvB,OAAOjC,GACT,KAAKzoB,EAAoB2qB,IACvB,OAAOhC,GACT,KAAK3oB,EAAoB4qB,SACvB,OAAOC,GACT,KAAK7qB,EAAoB8qB,IACvB,OAAOzU,GACT,KAAKrW,EAAoB+qB,SACvB,OAAOC,GACT,KAAKhrB,EAAoBirB,IACvB,OAAOlC,GACT,KAAK/oB,EAAoBkrB,SACvB,OAAOC,GACT,KAAKnrB,EAAoBorB,IACvB,OAAOC,GACT,KAAKrrB,EAAoBsrB,UACvB,OAAOnC,GACT,KAAKnpB,EAAoBurB,eACvB,OAAOC,GAEb,CCnGa,IAAAC,GAAiB,SAACC,EAA+BC,GAAuB,OAAKA,CAAW,ECgCxFC,GAAe,SAAAxqB,GAqD1B,SAAAwqB,EAAY9qB,EAAiCO,GAA+B,IAAAC,GAC1EA,EAAAF,EAAAG,KAAAR,KAAMD,IAAUC,MApDD8qB,iBAAW,EAAAvqB,EAGXwqB,cAAMxqB,EAGfyqB,SAAGzqB,EAAAA,EAGHuoB,gBAAUvoB,EAAAA,EAGV0oB,yBAAmB,EAAA1oB,EAGnByV,sBAAgB,EAAAzV,EAGhB4oB,cAAQ5oB,EAAAA,EAGR6oB,YAAI7oB,EAGJ0qB,qBAAe1qB,EAAAA,EAGN2qB,0BAAoB,EAAA3qB,EAG7B4qB,gCAA0B,EAAA5qB,EAG1B6qB,uBAAe7qB,EAGf8qB,iBAAW9qB,EAAAA,EAGX+qB,iBAAW/qB,EAAAA,EAGXS,UAAmE,IAAIC,IAAKV,EAC5EW,gBAAkB,EAYxB,IAmBMC,EAAeoqB,GAnByB,CAC5CC,gBAAiB,CACf1C,WAAY,CACV,CAACjK,KAAM,EAAGrQ,MAAO,SACjB,CAACqQ,KAAM,GAAKrQ,MAAO,UACnB,CAACqQ,KAAM,EAAGrQ,MAAO,QAEnBya,oBAAqBhqB,EAAoB2qB,IACzCT,UAAU,EACVC,KAAM,GAER6B,iBAAiB,EACjBQ,8BAA8B,EAC9BC,qBAAqB,EACrB1V,iBAAkB,SAKuB1V,EAAAA,EAAW,CAAA,EAAI,CAAEuc,WAAY6N,KA6CzC,OA3C/BnqB,EAAKuoB,WAAa3nB,EAAaqqB,gBAAgB1C,WAC/CvoB,EAAKorB,oBACLprB,EAAK0qB,gBAAkB9pB,EAAa8pB,gBACpC1qB,EAAK0oB,oBAAsB9nB,EAAaqqB,gBAAgBvC,oBACxD1oB,EAAK4oB,SAAWhoB,EAAaqqB,gBAAgBrC,SAC7C5oB,EAAK6oB,KAAOjoB,EAAaqqB,gBAAgBpC,KACzC7oB,EAAKyV,iBAAmB7U,EAAa6U,iBAErCzV,EAAKN,OAAOuB,UAAUC,IAAI,wBAG1BlB,EAAKuqB,YAAc5qB,SAASwB,cAAc,OAC1CnB,EAAKuqB,YAAYtpB,UAAUC,IAAI,6BAC/BlB,EAAKuqB,YAAYpU,MAAMkV,QAAU,OACjCrrB,EAAKuqB,YAAYpU,MAAMmV,cAAgB,SACvCtrB,EAAKuqB,YAAYpU,MAAMoV,IAAM,MAC7BvrB,EAAKN,OAAO8B,YAAYxB,EAAKuqB,aAG7BvqB,EAAKwqB,OAAS7qB,SAASwB,cAAc,UACrCnB,EAAKwqB,OAAOnS,MAAQrY,EAAKN,OAAO8rB,YAChCxrB,EAAKwqB,OAAOlS,OAAStY,EAAKN,OAAO+rB,aAEjCzrB,EAAKuqB,YAAY/oB,YAAYxB,EAAKwqB,QAClCxqB,EAAKyqB,IAAMzqB,EAAKwqB,OAAOzU,WAAW,KAAM,CAACC,OAAO,IAGhDhW,EAAK2qB,qBAAuBhrB,SAASwB,cAAc,OACnDnB,EAAK2qB,qBAAqB1pB,UAAUC,IAAI,+CACxClB,EAAK2qB,qBAAqBxU,MAAMkC,MAAQ,cACxCrY,EAAK2qB,qBAAqBxU,MAAM8Q,QAAU,OAC1CjnB,EAAK2qB,qBAAqBxU,MAAMwB,gBAAkB,QAClD3X,EAAK2qB,qBAAqBxU,MAAMuV,OAAS,kBACzC1rB,EAAK2qB,qBAAqBxU,MAAMwV,WAAa,SAC7C3rB,EAAK2qB,qBAAqBxU,MAAMyV,SAAW,WAC3C5rB,EAAKN,OAAO8B,YAAYxB,EAAK2qB,sBAC7B3qB,EAAK+qB,YAAc,IAAI9V,GAAYjV,EAAK2qB,sBAExC3qB,EAAK6rB,mBAAmBjrB,GAExBZ,EAAK8rB,OAGL9rB,EAAK+rB,0BAA0B/rB,CACjC,CA1H0B0B,EAAA4oB,EAAAxqB,GA0HzB,IAAA6B,EAAA2oB,EAAA1oB,UA+gBA,OA/gBAD,EAGMqqB,cAAA,SAAczD,GACnB9oB,KAAK8oB,WAAaA,EAClB9oB,KAAK2rB,oBACL3rB,KAAKqsB,OACLrsB,KAAKwsB,aACP,EAACtqB,EAGMuqB,cAAA,WACL,OAAOzsB,KAAK8oB,UACd,EAAC5mB,EAGMwqB,wBAAA,SAAwBzD,GAC7BjpB,KAAKipB,oBAAsBA,EAEvBjpB,KAAKmrB,6BACPnrB,KAAKmrB,2BAA2B1qB,MAAQT,KAAKipB,qBAG/CjpB,KAAKqsB,OACLrsB,KAAKwsB,aACP,EAACtqB,EAGMyqB,wBAAA,WACL,OAAO3sB,KAAKipB,mBACd,EAAC/mB,EAMM0qB,YAAA,SAAYzD,GACjBnpB,KAAKmpB,SAAWA,EAEZnpB,KAAKorB,kBACPprB,KAAKqrB,YAAYwB,UAAY7sB,KAAKmpB,UAGpCnpB,KAAKqsB,OACLrsB,KAAKwsB,aACP,EAACtqB,EAGM4qB,WAAA,WACL,OAAO9sB,KAAKmpB,QACd,EAACjnB,EAGM6qB,QAAA,SAAQ3D,GACbppB,KAAKopB,KAAOzpB,KAAKkB,IAAIuoB,EAAM,GAEvBppB,KAAKqrB,cACPrrB,KAAKqrB,YAAYvoB,cAAgB9C,KAAKopB,MAGxCppB,KAAKqsB,OACLrsB,KAAKwsB,aACP,EAACtqB,EAGM8qB,QAAA,WACL,OAAOhtB,KAAKopB,IACd,EAAClnB,EAGM+qB,YAAA,SAAYxE,GACjBzoB,KAAK8oB,WAAaL,EAASK,WAC3B9oB,KAAK2rB,oBACL3rB,KAAKmpB,SAAWV,EAASU,SACzBnpB,KAAKopB,KAAOzpB,KAAKkB,IAAI4nB,EAASW,MAAQ,EAAG,GACzCppB,KAAKipB,oBAAsBR,EAASQ,oBAEhCjpB,KAAKorB,iBAAmBprB,KAAKqrB,cAC/BrrB,KAAKorB,gBAAgB8B,QAAUltB,KAAKmpB,SACpCnpB,KAAKqrB,YAAYvoB,cAAgB9C,KAAKopB,KACtCppB,KAAKqrB,YAAYwB,UAAY7sB,KAAKmpB,UAGhCnpB,KAAKmrB,6BACPnrB,KAAKmrB,2BAA2B1qB,MAAQT,KAAKipB,qBAG/CjpB,KAAKqsB,OACLrsB,KAAKwsB,aACP,EAACtqB,EAGMirB,YAAA,WACL,MAAO,CACLrE,WAAY9oB,KAAK8oB,WACjBG,oBAAqBjpB,KAAKipB,oBAC1BE,SAAUnpB,KAAKmpB,eAAY7nB,EAC3B8nB,KAAMppB,KAAKmpB,SAAWnpB,KAAKopB,UAAO9nB,EAEtC,EAACY,EAMMkrB,oBAAA,WACL,OAAO/D,GAAgBrpB,KAAKmtB,cAC9B,EAACjrB,EAOME,YAAA,SAAYC,GACjB,IAAMC,EAAKtC,KAAKkB,kBAGhB,OAFAlB,KAAKgB,UAAUuB,IAAID,EAAID,GACvBA,EAASrC,MACFsC,CACT,EAACJ,EAGMM,eAAA,SAAeF,GACpBtC,KAAKgB,UAAgB,OAACsB,EACxB,EAACJ,EAGOsqB,YAAA,WAAW7pB,IAAAA,OACjB3C,KAAKgB,UAAU+B,QAAQ,SAACtC,GAAK,OAAKA,EAAMkC,EAAK,EAC/C,EAACT,EAEOypB,kBAAA,WACN3rB,KAAK8oB,WAAWuE,KAAK,SAAC1d,EAAGD,GAAM,OAAAC,EAAEkP,KAAOnP,EAAEmP,IAAI,EAChD,EAAC3c,EAGOmqB,KAAA,WAEN,IAAK,IAAI9sB,EAAI,EAAGA,EAAIS,KAAK+qB,OAAOnS,QAASrZ,EACvCS,KAAKgrB,IAAI3S,UAAY6Q,GACnB,CACEJ,WAAY9oB,KAAK8oB,WACjBG,oBAAqBjpB,KAAKipB,oBAC1BE,SAAUnpB,KAAKmpB,SACfC,KAAMppB,KAAKopB,MAEb7pB,GAAKS,KAAK+qB,OAAOnS,MAAQ,IAG3B5Y,KAAKgrB,IAAI1S,SAAS/Y,EAAG,EAAG,EAAGS,KAAK+qB,OAAOlS,QAIzC,IAAK,IAAItZ,EAAI,EAAGA,EAAIS,KAAK8oB,WAAW/Z,OAAQxP,IAAK,CAC/C,IAAMH,EAAIY,KAAK8oB,WAAWvpB,GAAGsf,KAAO7e,KAAK+qB,OAAOnS,MAC1CvZ,EAAI,GAAMW,KAAK+qB,OAAOlS,OACtBrK,EAAQxO,KAAK8oB,WAAWvpB,GAAGiP,MAUjC,GARAxO,KAAKgrB,IAAI3S,UAAY7J,EACrBxO,KAAKgrB,IAAIxrB,YACTQ,KAAKgrB,IAAItrB,IAAIN,EAAGC,EAAGW,KAAKgW,iBAAkB,EAAG,EAAIrW,KAAKC,IACtDI,KAAKgrB,IAAIjI,OAET7jB,EAAiBc,KAAKgrB,IAAK5rB,EAAGC,EAAGW,KAAKgW,kBAGlChW,KAAKirB,gBAAiB,CAEtBjrB,KAAKgrB,IAAIsC,UADD,IAAN/tB,EACmB,OACZA,IAAMS,KAAK8oB,WAAW/Z,OAAS,EACnB,QAEA,SAGvB,IAAMwe,EAAa7c,EAAIlC,GAAOG,EAC9B3O,KAAKgrB,IAAI3S,UAAYkV,EAAa,GAAM,QAAU,QAClDvtB,KAAKgrB,IAAIwC,SAASxtB,KAAK8oB,WAAWvpB,GAAGsf,KAAK4E,YAAY,GAAIrkB,EAAGY,KAAK+qB,OAAOlS,OAAS,EACnF,CACF,CACH,EAAC3W,EAGOoqB,wBAAA,WAAuB,IAAAlpB,EAAApD,KAEzBytB,GAAyB,EAGzB3U,GAAsB,EAGtB4U,GAAqB,EAGrB3U,EAAmC,KAMjC4U,EAAiB,SAACvU,GAEtBsU,GAAa,EACb,IAAK,IAAInuB,EAAI,EAAGA,EAAI6D,EAAK0lB,WAAW/Z,OAAQxP,IAG1C,GADWI,KAAK0V,IADHjS,EAAK0lB,WAAWvpB,GACJsf,KAAOzb,EAAK2nB,OAAOnS,MAAQQ,EAAEO,SAC7CvW,EAAK4S,iBAAkB,CAC9B0X,EAAYnuB,EACZuZ,GAAa,EACb,KACD,CAGCA,IAEFC,EAAkB,IAAIO,gBACtBpZ,SAASmD,iBACP,YACA,SAAC+V,GAGC,GAFAA,EAAE7V,iBAEEmqB,EAAY,GAAKA,EAAYtqB,EAAK0lB,WAAW/Z,OAAS,EAAG,CAC3D,IAAM4K,EAAUP,EAAEG,QAAUnW,EAAK2nB,OAAOvR,wBAAwBpa,EAGhEgE,EAAK0lB,WAAW4E,GAAW7O,KAAOlf,KAAKkB,IAFrBuC,EAAK0lB,WAAW4E,EAAY,GAAG7O,KAAO5b,OAAO2qB,QAETjuB,KAAKiB,IADxCwC,EAAK0lB,WAAW4E,EAAY,GAAG7O,KAAO5b,OAAO2qB,QACWjU,EAAUvW,EAAK2nB,OAAOnS,QACjGxV,EAAKipB,OACLjpB,EAAKopB,aACN,CAEDiB,GAAgB,CAClB,EACA,CAAC/T,OAAQX,EAAgBW,SAG/B,EAOA1Z,KAAK+qB,OAAO1nB,iBAAiB,YAAa,SAAC+V,GAGzC,GAFAqU,GAAgB,EAEC,IAAbrU,EAAEC,QAKJ,GAFAsU,EAAevU,IAEVN,EAAY,CAEf,IAAM1Z,EAAIO,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,EAAGwY,EAAEO,QAAUvW,EAAK2nB,OAAOnS,QACpDpK,EAAQ0a,GACZ,CACEJ,WAAY1lB,EAAK0lB,WACjBG,oBAAqB7lB,EAAK6lB,oBAC1BE,SAAU/lB,EAAK+lB,SACfC,KAAMhmB,EAAKgmB,MAEbhqB,GAGFgE,EAAK0lB,WAAW9H,KADH,CAACnC,KAAMzf,EAAGoP,MAAAA,IAEvBpL,EAAKuoB,oBACLvoB,EAAKipB,OACLjpB,EAAKopB,cACLmB,EAAevU,EAChB,OACI,GAAiB,IAAbA,EAAEC,OAAc,CAEzBD,EAAE7V,iBAEF,IAAK,IAAIhE,EAAI,EAAGA,EAAI6D,EAAK0lB,WAAW/Z,OAAS,EAAGxP,IAAK,CACnD,IACMsuB,EADOzqB,EAAK0lB,WAAWvpB,GACbsf,KAAOzb,EAAK2nB,OAAOnS,MAAQQ,EAAEO,QACvCmU,EAAK,GAAM1qB,EAAK2nB,OAAOlS,OAASO,EAAEQ,QACxC,GAAIja,KAAKqT,KAAK6a,EAAKA,EAAKC,EAAKA,GAAM1qB,EAAK4S,iBAItC,OAHA5S,EAAK0lB,WAAWiF,OAAOxuB,EAAG,GAC1B6D,EAAKipB,YACLjpB,EAAKopB,aAGR,CACF,CACH,GAEAxsB,KAAK+qB,OAAO1nB,iBAAiB,cAAe,SAAC+V,GAG3C,OAFAA,EAAE7V,iBACF6V,EAAE4U,mBAEJ,CAAA,GAGA9tB,SAASmD,iBAAiB,UAAW,WAC/ByV,GAAcC,IAChBA,EAAgBc,QAChBd,EAAkB,KAClBD,GAAa,EACb4U,GAAa,EAEjB,GAGA,IAAIO,GAAuB,EAG3BjuB,KAAK+qB,OAAO1nB,iBAAiB,QAAS,SAAC+V,GACrC,IAAIqU,EAAJ,CAIArU,EAAE4U,kBAEF,IADA,IAAInP,EAAO,KACFtf,EAAI,EAAGA,EAAI6D,EAAK0lB,WAAW/Z,SAClC8P,EAAOzb,EAAK0lB,WAAWvpB,KACZI,KAAK0V,IAAIwJ,EAAKA,KAAOzb,EAAK2nB,OAAOnS,MAAQQ,EAAEO,SAC7CvW,EAAK4S,mBAH4BzW,KAQ5C,GAAa,OAATsf,EAAe,CAEjB,IAAMqP,EAAQ9qB,EAAK2nB,OAAOlS,OAAS,EAAIzV,EAAK2nB,OAAOvR,wBAAwBna,EACrE8uB,EAAiBC,OAAOC,YACxBC,EAAWlrB,EAAK8nB,qBAAqBc,aAKzC5oB,EAAK8nB,qBAAqBxU,MAAM6X,OAH9BL,EAAQI,EAAWH,EAEX/qB,EAAK2nB,OAAOlS,OAAS,EACc,KACpCqV,EAAQI,EAAW,EAElBlrB,EAAK2nB,OAAOlS,OAAS,EAAIyV,EAEpC,KAEWlrB,EAAK2nB,OAAOlS,OAAS,EAAIyV,EAAW,EAE/C,KAED,IAAME,EAAQ3P,EAAKA,KAAOzb,EAAK2nB,OAAOnS,MAAQxV,EAAK2nB,OAAOvR,wBAAwBpa,EAC5EqvB,EAAgBL,OAAOM,WACvBC,EAAUvrB,EAAK8nB,qBAAqBa,YAKxC3oB,EAAK8nB,qBAAqBxU,MAAMsH,KAH9BwQ,EAAQG,EAAUF,EAEV5P,EAAKA,KAAOzb,EAAK2nB,OAAOnS,MAEnC,KAAU4V,EAAQG,EAAU,EAEjB9P,EAAKA,KAAOzb,EAAK2nB,OAAOnS,MAAQ+V,EAE3C,KAEW9P,EAAKA,KAAOzb,EAAK2nB,OAAOnS,MAAQ+V,EAAU,EACT,KAG7CvrB,EAAK8nB,qBAAqBxU,MAAMwV,WAAa,UAC7C9oB,EAAKkoB,YAAY9oB,eAAeyrB,GAChC7qB,EAAKkoB,YAAYvU,OAAO8H,EAAKrQ,OAC7Byf,EAAsB7qB,EAAKkoB,YAAYlpB,YAAY,SAACkpB,GAClDzM,EAAKrQ,MAAQ8c,EAAYjV,SACzBjT,EAAKipB,OACLjpB,EAAKopB,aACP,EACD,CA1DA,CA2DH,GAGAtsB,SAASmD,iBAAiB,QAAS,WACjCD,EAAK8nB,qBAAqBxU,MAAMwV,WAAa,QAC/C,GAGAlsB,KAAKkrB,qBAAqB7nB,iBAAiB,QAAS,SAAC+V,GAAM,OAAAA,EAAE4U,iBAAiB,GAGvD,IAAIY,eAAe,WACxCxrB,EAAK2nB,OAAOnS,MAAQxV,EAAKnD,OAAO8rB,YAChC3oB,EAAK2nB,OAAOlS,OAASzV,EAAKnD,OAAO+rB,aACjC5oB,EAAKipB,MACP,GACewC,QAAQ7uB,KAAKC,OAC9B,EAACiC,EAMOkqB,mBAAA,SAAmBjrB,GAAY2Y,IAAAA,EAErC9Z,KAAA,GAAKmB,EAAasqB,8BAAiCtqB,EAAauqB,oBAAhE,CAKA,IAAMoD,EAAoB5uB,SAASwB,cAAc,OASjD,GARAotB,EAAkBttB,UAAUC,IAAI,iCAChCqtB,EAAkBpY,MAAMkV,QAAU,OAClCkD,EAAkBpY,MAAMmV,cAAgB,MACxCiD,EAAkBpY,MAAMqY,eAAiB,gBACzCD,EAAkBpY,MAAMsY,WAAa,SACrCF,EAAkBpY,MAAMuY,SAAW,OACnCjvB,KAAK8qB,YAAY/oB,YAAY+sB,GAEzB3tB,EAAasqB,6BAA8B,CAC7C,IAAM/qB,EAAQR,SAASwB,cAAc,SACrChB,EAAMc,UAAUC,IAAI,mDACpBf,EAAMoB,UAAY,kBAElB9B,KAAKmrB,2BAA6BjrB,SAASwB,cAAc,UACzD1B,KAAKmrB,2BAA2B3pB,UAAUC,IAAI,oDAG9C,IAAAytB,IAAAA,IAAAC,EAAmB/tB,OAAO+a,KAAKld,GAAoBiwB,EAAAC,EAAApgB,OAAAmgB,IAAE,CAAhD,IAAIE,EAAMD,EAAAD,GACPG,EAASnvB,SAASwB,cAAc,UACtC2tB,EAAO7tB,UAAUC,IAAI,oDACrB4tB,EAAO5uB,MAAQ2uB,EACfC,EAAOvtB,UAAYstB,EAAO5L,QAAQ,IAAK,KACvCxjB,KAAKmrB,2BAA2B7qB,QAAQmB,IAAI4tB,EAC7C,CAEDrvB,KAAKmrB,2BAA2B1qB,MAAQT,KAAKipB,oBAE7CjpB,KAAKmrB,2BAA2B9nB,iBAAiB,SAAU,WACzDyW,EAAKmP,oBAAsBhqB,EAAoB6a,EAAKqR,2BAA2B1qB,OAC/EqZ,EAAKuS,OACLvS,EAAK0S,aACP,GAEA9rB,EAAMqB,YAAY/B,KAAKmrB,4BACvB2D,EAAkB/sB,YAAYrB,EAC/B,CAED,GAAIS,EAAauqB,oBAAqB,CACpC,IAAM4D,EAAkBpvB,SAASwB,cAAc,OAC/C4tB,EAAgB9tB,UAAUC,IAAI,qCAC9B6tB,EAAgB5Y,MAAMkV,QAAU,OAChC0D,EAAgB5Y,MAAMmV,cAAgB,MACtCyD,EAAgB5Y,MAAMoV,IAAM,OAC5BwD,EAAgB5Y,MAAMsY,WAAa,SACnCF,EAAkB/sB,YAAYutB,GAE9B,IAAMC,EAAgBrvB,SAASwB,cAAc,SAC7C6tB,EAAc/tB,UAAUC,IAAI,oDAC5B8tB,EAAcztB,UAAY,aAC1BwtB,EAAgBvtB,YAAYwtB,GAE5BvvB,KAAKorB,gBAAkBlrB,SAASwB,cAAc,SAC9C1B,KAAKorB,gBAAgB5pB,UAAUC,IAAI,8CACnCzB,KAAKorB,gBAAgBzpB,KAAO,WAC5B3B,KAAKorB,gBAAgB8B,QAAUltB,KAAKmpB,SACpCoG,EAAcxtB,YAAY/B,KAAKorB,iBAE/B,IAAMoE,EAAYtvB,SAASwB,cAAc,SACzC8tB,EAAUhuB,UAAUC,IAAI,kDACxB+tB,EAAU1tB,UAAY,SACtBwtB,EAAgBvtB,YAAYytB,GAE5BxvB,KAAKqrB,YAAcnrB,SAASwB,cAAc,SAC1C1B,KAAKqrB,YAAY7pB,UAAUC,IAAI,kDAC/BzB,KAAKqrB,YAAY3U,MAAMkC,MAAQ,OAC/B5Y,KAAKqrB,YAAYwB,UAAY7sB,KAAKmpB,SAClCnpB,KAAKqrB,YAAY1pB,KAAO,SACxB3B,KAAKqrB,YAAYzqB,IAAM,IACvBZ,KAAKqrB,YAAYvqB,KAAO,IACxBd,KAAKqrB,YAAYvoB,cAAgB9C,KAAKopB,KAEtCppB,KAAKorB,gBAAgB/nB,iBAAiB,SAAU,WAC9CyW,EAAKqP,SAAWrP,EAAKsR,gBAAgB8B,QACrCpT,EAAKuR,YAAYwB,UAAY/S,EAAKqP,SAElCrP,EAAKuS,OACLvS,EAAK0S,aACP,GAEAxsB,KAAKqrB,YAAYhoB,iBAAiB,SAAU,WAC1CyW,EAAKsP,KAAOtP,EAAKuR,YAAYvoB,cAE7BgX,EAAKuS,OACLvS,EAAK0S,aACP,GAGAxsB,KAAKqrB,YAAYhoB,iBAAiB,QAAS,SAACC,GAC1CA,EAAGC,iBAEH,IAAI9C,EAAQqZ,EAAKuR,YAAYvoB,cACzBQ,EAAGE,OAAS,EAEd/C,EAAQd,KAAKkB,IAAIJ,EAAQ,EAAG,GACnB6C,EAAGE,OAAS,IAErB/C,EAAQd,KAAKkB,IAAIJ,EAAQ,EAAG,IAG9BqZ,EAAKuR,YAAYvoB,cAAgBnD,KAAKkD,MAAMpC,GAC5CqZ,EAAKsP,KAAOtP,EAAKuR,YAAYvoB,cAE7BgX,EAAKuS,OACLvS,EAAK0S,aACP,GAGA,IAAMiD,EAAe,SAACnsB,GACpB,IAAMosB,EAAKpsB,EAAGmX,gBACTiV,EAAG5sB,eAAiB4sB,EAAG5sB,cAAgB,KAC1C4sB,EAAG5sB,cAAgB,EACnBgX,EAAKsP,KAAOtP,EAAKuR,YAAYvoB,eAG/BgX,EAAKuS,OACLvS,EAAK0S,aACP,EAEAxsB,KAAKqrB,YAAYhoB,iBAAiB,WAAYosB,GAC9CzvB,KAAKqrB,YAAYhoB,iBAAiB,WAAY,SAACC,GAC9B,UAAXA,EAAGG,KACLgsB,EAAansB,EAEjB,GAEAksB,EAAUztB,YAAY/B,KAAKqrB,YAC5B,CAlIA,CAmIH,EAACR,CAAA,CAzoByB,CAAQ/qB,GCDvB6vB,GAAmB,SAAAtvB,GAuC9B,SAAAsvB,EAAY5vB,EAAiCO,GAAmC,IAAAC,GAC9EA,EAAAF,EAAAG,KAAMT,KAAAA,IAAUC,MAtCD+qB,YAAM,EAAAxqB,EAGfyqB,SAAG,EAAAzqB,EAGHqvB,gBAAUrvB,EAAAA,EAOVkoB,cAAQloB,EAAAA,EAGRsvB,gBAAUtvB,EAAAA,EAGVyV,sBAAgBzV,EAAAA,EAGhBuvB,mBAAa,EAAAvvB,EAGbwvB,mBAAa,EAAAxvB,EAGbS,UAA2E,IAAIC,IAAKV,EACpFW,gBAAkB,EAYxB,IAoBMC,EAAeoqB,GApB6B,CAChDyE,kBAAmB,CACjB,CAACnR,KAAM,EAAGtI,MAAO,GACjB,CAACsI,KAAM,GAAKtI,MAAO,IACnB,CAACsI,KAAM,EAAGtI,MAAO,IAEnBiV,gBAAiB,CACf1C,WAAY,CACV,CAACjK,KAAM,EAAGrQ,MAAO,SACjB,CAACqQ,KAAM,EAAGrQ,MAAO,UAEnBya,oBAAqBhqB,EAAoB0qB,KAE3C3T,iBAAkB,EAClB8Z,eAAe,EACfC,cAAe,GAKiC,MAAPzvB,EAAAA,EAAW,CAAA,EAAI,CAAEuc,WAAY6N,KAqB/C,OAnBzBnqB,EAAKqvB,WAAazuB,EAAa6uB,kBAC/BzvB,EAAKorB,oBACLprB,EAAKkoB,SAAWtnB,EAAaqqB,gBAE7BjrB,EAAKyV,iBAAmB7U,EAAa6U,iBAErCzV,EAAKuvB,cAAgB3uB,EAAa2uB,cAClCvvB,EAAKwvB,cAAgB5uB,EAAa4uB,cAElCxvB,EAAKN,OAAOuB,UAAUC,IAAI,2BAE1BlB,EAAKwqB,OAAS7qB,SAASwB,cAAc,UACrCnB,EAAKwqB,OAAOnS,MAAQrY,EAAKN,OAAO8rB,YAChCxrB,EAAKwqB,OAAOlS,OAAStY,EAAKN,OAAO+rB,aACjCzrB,EAAKwqB,OAAOrU,MAAMuZ,eAAiB,YACnC1vB,EAAKN,OAAO8B,YAAYxB,EAAKwqB,QAC7BxqB,EAAKyqB,IAAMzqB,EAAKwqB,OAAOzU,WAAW,MAClC/V,EAAK2vB,mBACL3vB,EAAK8rB,OACL9rB,EAAK4vB,oBAAoB5vB,CAC3B,CArF8B0B,EAAA0tB,EAAAtvB,GAqF7B,IAAA6B,EAAAytB,EAAAxtB,UAuSAwtB,OAvSAztB,EAQME,YAAA,SAAYC,GACjB,IAAMC,EAAKtC,KAAKkB,kBAGhB,OAFAlB,KAAKgB,UAAUuB,IAAID,EAAID,GACvBA,EAASrC,MACFsC,CACT,EAACJ,EAGMM,eAAA,SAAeF,GACpBtC,KAAKgB,UAAS,OAAQsB,EACxB,EAACJ,EAGMkuB,oBAAA,WACL,MAAO,CAACR,WAAY5vB,KAAK4vB,WAAYnH,SAAUzoB,KAAKyoB,SACtD,EAACvmB,EAGMuV,OAAA,SAAOoH,GACZ,OAAOqK,GAAuBlpB,KAAKyoB,SAAU5J,EAC/C,EAAC3c,EAGMmuB,SAAA,SAASxR,GACd,OAAW7e,KAAC6vB,WAAWhR,EACzB,EAAC3c,EAGMouB,QAAA,SAAQzR,GACb,IAAMrQ,EAAQJ,EAAIpO,KAAKyX,OAAOoH,IAE9B,OADArQ,EAAMsB,QAAU9P,KAAKqwB,SAASxR,GACvBrQ,EAAM4C,YACf,EAAClP,EAGMquB,gBAAA,SAAgB1R,EAAMtI,GAC3BvW,KAAK4vB,WAAW5O,KAAK,CAACnC,KAAAA,EAAMtI,MAAAA,IAC5BvW,KAAK2rB,oBACL3rB,KAAKkwB,mBACLlwB,KAAKiX,aACLjX,KAAKqsB,MACP,EAACnqB,EAGMsuB,qBAAA,SAAqBpxB,EAAGC,GAE7B,IADA,IAAIoxB,GAAiB,EACZlxB,EAAI,EAAGA,EAAIS,KAAK4vB,WAAW7gB,OAAS,EAAGxP,IAAK,CACnD,IAAMmxB,EAAe1wB,KAAK4vB,WAAWrwB,GAC/BsuB,EAAK6C,EAAa7R,KAAO7e,KAAK+qB,OAAOnS,MAAQxZ,EAC7C0uB,GAAM,EAAI4C,EAAana,OAASvW,KAAK+qB,OAAOlS,OAASxZ,EAC3D,GAAIM,KAAKqT,KAAK6a,EAAKA,EAAKC,EAAKA,GAAM9tB,KAAKgW,iBAAkB,CACxDya,EAAgBlxB,EAChB,KACD,CACF,EACsB,IAAnBkxB,IACFzwB,KAAK4vB,WAAW7B,OAAO0C,EAAe,GACtCzwB,KAAKkwB,mBACLlwB,KAAKiX,aACLjX,KAAKqsB,OAET,EAACnqB,EAGMyuB,cAAA,WACL,OAAW3wB,KAAC4vB,UACd,EAAC1tB,EAGM0uB,cAAA,SAAchB,GACnB5vB,KAAK4vB,WAAaA,EAClB5vB,KAAK2rB,oBACL3rB,KAAKkwB,mBACLlwB,KAAKiX,aACLjX,KAAKqsB,MACP,EAACnqB,EAGMirB,YAAA,WACL,YAAY1E,QACd,EAACvmB,EAGM+qB,YAAA,SAAYxE,GACjBzoB,KAAKyoB,SAAWA,EAChBzoB,KAAKiX,aACLjX,KAAKqsB,MACP,EAACnqB,EAEM2uB,kBAAA,SAAkBC,GAEvB,IADA,IAAMvH,EAAwB,GACrBhqB,EAAI,EAAKA,GAAK,EAAKA,GAAK,GAAOuxB,EAAU,GAChDvH,EAAOvI,KAAKhhB,KAAKswB,QAAQ/wB,IAE3B,OAAOgqB,CACT,EAACrnB,EAGO+U,WAAA,WAAU,IAAAtU,EAAA3C,KAChBA,KAAKgB,UAAU+B,QAAQ,SAACtC,UAAUA,EAAMkC,EAAK,EAC/C,EAACT,EAGOguB,iBAAA,WACNlwB,KAAK6vB,WAAahH,KACfxJ,OAAOrf,KAAK4vB,WAAW3T,IAAI,SAAC8M,UAAUA,EAAMlK,IAAI,IAChDS,MAAMtf,KAAK4vB,WAAW3T,IAAI,SAAC8M,GAAU,OAAAA,EAAMxS,KAAK,IAChD6K,YAAYoD,GACjB,EAACtiB,EAGOmqB,KAAA,WAKN,GAHArsB,KAAKgrB,IAAIrS,UAAU,EAAG,EAAG3Y,KAAK+qB,OAAOnS,MAAO5Y,KAAK+qB,OAAOlS,QAGpD7Y,KAAK8vB,cAAe,CACtB9vB,KAAKgrB,IAAI3S,UAAY,UACrB,IAAK,IAAIhZ,EAAI,EAAGA,EAAIW,KAAK+qB,OAAOlS,OAAS7Y,KAAK+vB,cAAe1wB,IAC3D,IAAK,IAAID,EAAI,EAAGA,EAAIY,KAAK+qB,OAAOnS,MAAQ5Y,KAAK+vB,cAAe3wB,KACrDA,EAAI,GAAK,GAAKC,EAAI,GAAK,GAAOD,EAAI,GAAK,GAAKC,EAAI,GAAK,IACxDW,KAAKgrB,IAAI1S,SAASlZ,EAAIY,KAAK+vB,cAAe1wB,EAAIW,KAAK+vB,cAAe/vB,KAAK+vB,cAAe/vB,KAAK+vB,cAIlG,CAGD,IAAK,IAAIxwB,EAAI,EAAGA,EAAIS,KAAK+qB,OAAOnS,QAASrZ,EAAG,CAC1C,IAAMgX,EAAQvW,KAAKqwB,SAAS9wB,GAAKS,KAAK+qB,OAAOnS,MAAQ,IACrD5Y,KAAKgrB,IAAI3S,UAAYrY,KAAKswB,QAAQ/wB,GAAKS,KAAK+qB,OAAOnS,MAAQ,IAC3D5Y,KAAKgrB,IAAI1S,SAAS/Y,GAAI,EAAIgX,GAASvW,KAAK+qB,OAAOlS,OAAQ,EAAGtC,EAAQvW,KAAK+qB,OAAOlS,QAE1E7Y,KAAK8vB,eACP9vB,KAAKgrB,IAAIrS,UAAUpZ,EAAG,EAAG,GAAI,EAAIgX,GAASvW,KAAK+qB,OAAOlS,OAEzD,CAGD7Y,KAAKgrB,IAAIvrB,YAAc,QACvBO,KAAKgrB,IAAIxrB,YACT,IAAK,IAAID,EAAI,EAAGA,EAAIS,KAAK4vB,WAAW7gB,OAAQxP,IAAK,CAC/C,IAAMH,EAAIY,KAAK4vB,WAAWrwB,GAAGsf,KAAO7e,KAAK+qB,OAAOnS,MAC1CvZ,GAAK,EAAIW,KAAK4vB,WAAWrwB,GAAGgX,OAASvW,KAAK+qB,OAAOlS,OAC7C,IAANtZ,EACFS,KAAKgrB,IAAI+F,OAAO3xB,EAAGC,GAEnBW,KAAKgrB,IAAIgG,OAAO5xB,EAAGC,EAEtB,CACDW,KAAKgrB,IAAInrB,SAGTG,KAAKgrB,IAAI3S,UAAY,QACrB,IAAK,IAAI9Y,EAAI,EAAGA,EAAIS,KAAK4vB,WAAW7gB,OAAQxP,IAAK,CAC/C,IAAMH,EAAIY,KAAK4vB,WAAWrwB,GAAGsf,KAAO7e,KAAK+qB,OAAOnS,MAC1CvZ,GAAK,EAAIW,KAAK4vB,WAAWrwB,GAAGgX,OAASvW,KAAK+qB,OAAOlS,OACvD7Y,KAAKgrB,IAAIvrB,YAAc,QACvBO,KAAKgrB,IAAIxrB,YACTQ,KAAKgrB,IAAItrB,IAAIN,EAAGC,EAAGW,KAAKgW,iBAAkB,EAAG,EAAIrW,KAAKC,IACtDI,KAAKgrB,IAAIjI,OACT/iB,KAAKgrB,IAAInrB,QACV,CACH,EAACqC,EAGOypB,kBAAA,WACN3rB,KAAK4vB,WAAWvC,KAAK,SAAC1d,EAAGD,GAAM,OAAAC,EAAEkP,KAAOnP,EAAEmP,IAAI,EAChD,EAAC3c,EAGO+uB,kBAAA,SAAkB7xB,EAAWC,GAGnC,MAAO,CAACwf,KAFKlf,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,EAAGxB,EAAIY,KAAK+qB,OAAOnS,QAEvCrC,MADA5W,KAAKkB,IAAI,EAAGlB,KAAKiB,IAAI,EAAG,EAAIvB,EAAIW,KAAK+qB,OAAOlS,SAE5D,EAAC3W,EAGOiuB,kBAAA,WAAiB/sB,IAAAA,EAEvBpD,KAAI8Y,GAAsB,EAGtB4U,GAAqB,EAGrB3U,EAAmC,KAMjC4U,EAAiB,SAACvU,GAEtBsU,GAAa,EACb,IAAK,IAAInuB,EAAI,EAAGA,EAAI6D,EAAKwsB,WAAW7gB,OAAQxP,IAAK,CAC/C,IAAMmxB,EAAettB,EAAKwsB,WAAWrwB,GAC/BsuB,EAAK6C,EAAa7R,KAAOzb,EAAK2nB,OAAOnS,MAAQQ,EAAEO,QAC/CmU,GAAM,EAAI4C,EAAana,OAASnT,EAAK2nB,OAAOlS,OAASO,EAAEQ,QAC7D,GAAIja,KAAKqT,KAAK6a,EAAKA,EAAKC,EAAKA,GAAM1qB,EAAK4S,iBAAkB,CACxD0X,EAAYnuB,EACZuZ,GAAa,EACb,KACD,CACF,CAEGA,IAEFC,EAAkB,IAAIO,gBACtBpZ,SAASmD,iBACP,YACA,SAAC+V,GACCA,EAAE7V,iBACF,IAAMoW,EAAUP,EAAEG,QAAUnW,EAAK2nB,OAAOvR,wBAAwBpa,EAC1Dwa,EAAUR,EAAEK,QAAUrW,EAAK2nB,OAAOvR,wBAAwBna,EAEhE6xB,EAAsB9tB,EAAK6tB,kBAAkBtX,EAASC,GAAzCrD,EAAK2a,EAAL3a,MAEK,IAAdmX,GAEOA,IAActqB,EAAKwsB,WAAW7gB,OAAS,IAKhD3L,EAAKwsB,WAAWlC,GAAW7O,KAAOlf,KAAKkB,IAFrBuC,EAAKwsB,WAAWlC,EAAY,GAAG7O,KAAO5b,OAAO2qB,QAETjuB,KAAKiB,IADxCwC,EAAKwsB,WAAWlC,EAAY,GAAG7O,KAAO5b,OAAO2qB,QARvDsD,EAAJrS,QAGLzb,EAAKwsB,WAAWlC,GAAWnX,MAAQA,EASrCnT,EAAK8sB,mBACL9sB,EAAK6T,aACL7T,EAAKipB,MACP,EACA,CAAC3S,OAAQX,EAAgBW,SAG/B,EAOA1Z,KAAK+qB,OAAO1nB,iBAAiB,YAAa,SAAC+V,GAMzC,GALiB,IAAbA,EAAEC,QAEJsU,EAAevU,IAGbN,EAIJ,GAAiB,IAAbM,EAAEC,OAAc,CAElB,IAAA8X,EAAsB/tB,EAAK6tB,kBAAkB7X,EAAEO,QAASP,EAAEQ,SAC1DxW,EAAKmtB,gBADMY,EAAJtS,KAAWsS,EAAL5a,OAEboX,EAAevU,EAChB,MAAuB,IAAbA,EAAEC,SAEXD,EAAE7V,iBACFH,EAAKotB,qBAAqBpX,EAAEO,QAASP,EAAEQ,SAE3C,GAEA5Z,KAAK+qB,OAAO1nB,iBAAiB,cAAe,SAAC+V,GAG3C,OAFAA,EAAE7V,iBACF6V,EAAE4U,mBAEJ,CAAA,GAGA9tB,SAASmD,iBAAiB,UAAW,WAC/ByV,GAAcC,IAChBA,EAAgBc,QAChBd,EAAkB,KAClBD,GAAa,EACb4U,GAAa,EAEjB,GAGuB,IAAIkB,eAAe,WACxCxrB,EAAK2nB,OAAOnS,MAAQxV,EAAKnD,OAAO8rB,YAChC3oB,EAAK2nB,OAAOlS,OAASzV,EAAKnD,OAAO+rB,aACjC5oB,EAAKipB,MACP,GACewC,QAAQ7uB,KAAKC,OAC9B,EAAC0vB,CAAA,CA5X6B,CAAQ7vB,GCa3BsxB,GAAsB,WAoBjC,SAAAA,EAAYrxB,EAAiCO,GAAuC,IAAAC,EAAAP,KAClF,GADkFA,KAlB5ED,eAAS,EAAAC,KAGTqxB,wBAAkB,EAAArxB,KAGlBsxB,oBAAc,EAAAtxB,KAGdgB,UAAmF,IAAIC,IAAKjB,KAC5FkB,gBAAkB,GASpBnB,EAOF,KAAM,oBALJC,KAAKD,UADkB,iBAAdA,EACQG,SAASC,cAAcJ,GAEvBA,EAOrB,IAIMoB,EAAeoqB,GAJiC,CAAA,EAIJ,MAAPjrB,EAAAA,EAAW,CAAA,EAAI,CAAEuc,WAAY6N,KAExE1qB,KAAKD,UAAUyB,UAAUC,IAAI,gCAE7B,IAAM8vB,EAA4BrxB,SAASwB,cAAc,OACzD6vB,EAA0B7a,MAAMkC,MAAQ,OACxC2Y,EAA0B7a,MAAM8a,UAAY,OAC5CxxB,KAAKD,UAAU0xB,OAAOF,GACtBvxB,KAAKqxB,mBAAqB,IAAI1B,GAAmB4B,EAA2BpwB,GAE5E,IAAMuwB,EAAwBxxB,SAASwB,cAAc,OACrDgwB,EAAsBhb,MAAMkC,MAAQ,OACpC8Y,EAAsBhb,MAAM8a,UAAY,OACxCxxB,KAAKD,UAAU0xB,OAAOC,GACtB1xB,KAAKsxB,eAAiB,IAAIzG,GAAe6G,EAAuBvwB,GAGhEnB,KAAKsxB,eAAelvB,YAAY,SAACkvB,GAC/B,OAAA/wB,EAAK8wB,mBAAmBpE,YAAYqE,EAAenE,cAAc,GAGnEntB,KAAKqxB,mBAAmBpE,YAAYjtB,KAAKsxB,eAAenE,eAKxDntB,KAAKqxB,mBAAmBjvB,YAAY,WAClC7B,EAAKS,UAAU+B,QAAQ,SAACtC,GAAK,OAAKA,EAAMF,EAAK,EAC/C,EACF,CAAC,IAAA2B,EAAAkvB,EAAAjvB,iBAAAD,EAQME,YAAA,SAAYC,GACjB,IAAMC,EAAKtC,KAAKkB,kBAGhB,OAFAlB,KAAKgB,UAAUuB,IAAID,EAAID,GACvBA,EAASrC,MACFsC,CACT,EAACJ,EAGMM,eAAA,SAAeF,GACpBtC,KAAKgB,UAAgB,OAACsB,EACxB,EAACJ,EAEMuV,OAAA,SAAOoH,GACZ,OAAO7e,KAAKqxB,mBAAmB5Z,OAAOoH,EACxC,EAAC3c,EAGMmuB,SAAA,SAASxR,GACd,OAAW7e,KAACqxB,mBAAmBhB,SAASxR,EAC1C,EAAC3c,EAGMouB,QAAA,SAAQzR,GACb,OAAW7e,KAACqxB,mBAAmBf,QAAQzR,EACzC,EAAC3c,EAGMyuB,cAAA,WACL,OAAW3wB,KAACqxB,mBAAmBV,eACjC,EAACzuB,EAGM0uB,cAAA,SAAchB,GACnB5vB,KAAKqxB,mBAAmBT,cAAchB,EACxC,EAAC1tB,EAGMirB,YAAA,WACL,OAAWntB,KAACsxB,eAAenE,aAC7B,EAACjrB,EAMMkrB,oBAAA,WACL,OAAWptB,KAACsxB,eAAelE,qBAC7B,EAAClrB,EAGM+qB,YAAA,SAAYxE,GACjBzoB,KAAKsxB,eAAe/E,cAAc9D,EACpC,EAACvmB,EAGMkuB,oBAAA,WACL,OAAWpwB,KAACqxB,mBAAmBjB,qBACjC,EAACluB,EAEM2uB,kBAAA,SAAkBC,GACvB,OAAO9wB,KAAKqxB,mBAAmBR,kBAAkBC,EACnD,EAACM,CAAA,CAtIgC"}